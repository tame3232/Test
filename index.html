<!DOCTYPE html>   
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹¨á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ áˆ˜á‰°áŒá‰ áˆªá‹«</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script src="https://adsgram.ai/js/adsgram.js" onerror="window.adsgramError = true;"></script>
<style>
        /* ==============================================================
           === NEW: Loading Screen Styles (áŒ¥á‰áˆ© á‹¨áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ­ áŒˆáŒ½) ===
           ============================================================== */
        #loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #17212b; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999; 
            transition: opacity 0.5s ease-out; 
            opacity: 1;
            /* ğŸ›‘ NEW: á‹³áˆ«á‹ áˆˆáˆµáˆ‹áˆ³ á‰¥áˆ­áˆƒáŠ• áŠ¥áŠ•á‹²á‹«áˆ˜áŠáŒ­ */
            box-shadow: 0 0 100px rgba(255, 193, 7, 0.1) inset;
        }
        
        /* ğŸ›‘ NEW: á‹¨áˆ³áŠ•á‰²áˆ™áŠ• áˆáˆµáˆ á‹­á‰ áˆáŒ¥ á‰†áŠ•áŒ† á‹¨áˆšá‹«á‹°áˆ­áŒˆá‹ CSS */
        #coin-image {
            width: 70px; 
            height: 70px;
            margin-bottom: 20px;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.8), 
                        0 0 30px rgba(255, 215, 0, 0.5); /* Glowing Effect */
            /* ğŸ›‘ NEW: á‹¨3D á‹ˆáˆ­á‰… áŒˆáŒ½á‰³ áˆˆáˆ˜áˆµáŒ á‰µ */
            background: radial-gradient(circle at 60% 30%, #FFD700, #DAA520, #FFD700 80%, #B8860B);
            /* ğŸ›‘ NEW: áŒ áˆ­á‹ áˆ‹á‹­ á‰µáŠ•áˆ½ áŒˆáŒ½á‰³ áˆˆáˆ˜áˆµáŒ á‰µ */
            border: 5px solid #FFECB3; 
        }

        #loading-text {
            /* ğŸ›‘ IMPROVED: áŒ½áˆá‰ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
            color: #FFC107; 
            font-size: 1.1em;
            font-weight: 300; /* Boldest */
            margin-top: 15px;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
            /* ğŸ›‘ NEW: á‹¨áŒ½áˆá á‰¥áˆ­áˆƒáŠ• áŠ¥áŠ•á‹²á‹«áˆ˜áŠáŒ­ */
            animation: pulse-glow 2s infinite alternate; 
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        /* ğŸ›‘ NEW: á‹¨á‰¥áˆ­áˆƒáŠ• áŠ•á‹áˆ¨á‰µ (Pulsating Glow) */
        @keyframes pulse-glow {
            from {
                text-shadow: 0 0 5px rgba(255, 193, 7, 0.5), 0 0 10px rgba(255, 193, 7, 0.3);
            }
            to {
                text-shadow: 0 0 15px #FFC107, 0 0 25px rgba(255, 215, 0, 0.7);
            }
        }
        
        /* ğŸ›‘ NEW: áˆˆáŠ á‹¶á‹á‰½ á‹¨áˆšáŠ•áˆ³áˆá áŠ•á‰…áŠ“á‰„ (Floating Effect) */
        @keyframes icon-float {
            0% { transform: translateY(0); box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
            50% { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7); }
            100% { transform: translateY(0); box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
        }

        /* ğŸ›‘ NEW: áˆˆ Luck Slot áŠ á‹¶ á‰¥áˆ­áˆƒáŠ• áˆ›áˆ˜áŠ•áŒ¨á‰µ (Pulsating Glow) */
        @keyframes slot-glow {
            from {
                box-shadow: 0 0 8px rgba(255, 140, 0, 0.7);
            }
            to {
                box-shadow: 0 0 20px #FF8C00, 0 0 30px rgba(255, 215, 0, 0.9);
            }
        }

        .coin-spinner {
            animation: spin 1.5s linear infinite; 
        }
        /* ==============================================================
           === Loading Screen Styles áˆ˜áŒ¨áˆ¨áˆ» ===
           ============================================================== */
      


     
        /* CSS Styles */
        :root {
            --et-yellow: #FFC107;
            --et-green: #4CAF50;
            --et-purple: #9C27B0;
            --et-red: #F44336;
            --et-blue: #2196F3;
            
            /* âœ… ğŸ›‘ á‰´áˆŒáŒáˆ«áˆ áˆ‹á‹­ áŒ¥áŒˆáŠ› á‹¨áŠá‰ áˆ© á‰€áˆˆáˆá‰½ áŠ¥á‹šáˆ… á‰‹áˆš á‰°á‹°áˆ­áŒˆá‹‹áˆ */
            --tg-bg: #1b2129;
            --tg-secondary-bg: #181818;
            --tg-text: #FFFFFF;
            --tg-hint: #AAAAAA;
        }

        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding-bottom: 70px; 
            overflow-x: hidden;
        }

        #root {
            min-height: calc(100vh - 70px);
            box-sizing: border-box;
            padding: 0 15px 15px 15px;
        }

        /* --- Global Title --- */
        .page-title {
            color: var(--et-yellow);
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding-top: 15px;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.5); /* ğŸ›‘ NEW: áˆˆ Title áŒ¥áˆ‹ */
        }
        
        /* ğŸ›‘ NEW: áˆˆ Score Display á‹¨áˆšáˆ†áŠ• áŠ«áˆ­á‹µ */
        .score-card-display {
            text-align: center; 
            font-size: 18px; 
            font-weight: bold; 
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 10px;
            /* ğŸ›‘ NEW: á‹ˆáˆ­á‰ƒáˆ› ááˆ¬áˆ áŠ¥áŠ“ áŒ¥á‰áˆ­ á‹³áˆ« */
            border: 2px solid var(--et-yellow); 
            background-color: var(--tg-secondary-bg);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }



        /* --- Task and Card Styling --- */
        .daily-tasks-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }
        .task-button {
            flex: 1 1 30%;
            padding: 15px 5px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            font-size: 14px;
            color: #212121;
            position: relative;
            cursor: pointer;
            text-align: center;
            min-width: 80px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, opacity 0.1s; /* ğŸ›‘ NEW: áˆˆáˆµáˆ‹áˆ³ áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´ */
        }
        /* ğŸ›‘ NEW: Task Button áˆ²áŒ«áŠ• */
        .task-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .task-button span {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            /* ğŸ›‘ IMPROVED: á‹¨áŒ½áˆá á‰€áˆˆáˆ */
            color: rgba(33, 33, 33, 0.8); 
        }
        .card-button {
            background-color: #333333;
            color: var(--tg-text);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: left;
            border: none;
            width: 100%;
            display: flex;
            align-items: center;
            cursor: pointer;
           box-shadow: 0 0 0 2px red, 0 0 10px #FFC107;
    transition: box-shadow 0.3s;  
          IMPROVED: á‹¨á‰°áˆ»áˆˆ á‹¨áŒ¥áˆ‹ áŒˆáŒ½á‰³ */
            transition: transform 0.2s, box-shadow 0.2s;
        }
        /* ğŸ›‘ NEW: Card Button áˆ²áŒ«áŠ•/ áˆ²áŠáŠ« */
        .card-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        .card-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        
        /* ğŸ›‘ NEW: Cooldown Style for Cards */
        .card-button.cooldown-style {
            opacity: 0.6; /* ğŸ›‘ IMPROVED: á‹­á‰ áˆáŒ¥ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
            /* pointer-events: none; - á‰ JS á‰°áˆµá‰°áŠ«áŠ­áˆáˆ */
        }

        .card-icon-circle {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            flex-shrink: 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* ğŸ›‘ NEW: áˆˆáŠ á‹¶ áŒ¥áˆ‹ */
            /* âœ… NEW: á‹¨áˆ˜áŠ•áˆ³áˆá áŠ•á‰…áŠ“á‰„ */
            animation: icon-float 20s infinite alternate ease-in-out; 
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        /* ğŸ›‘ NEW: áˆˆ "Day Spin" áŠ á‹¶ áˆá‹© á‹˜á‹­á‰¤ */
        .card-icon-circle.daily-spin-icon {
            /* á‹¨ Day Spin áŠ á‹¶á‹ áŠ¥áŠ•á‹²áˆ½áŠ¨áˆ¨áŠ¨áˆ­ áŠ¥áŠ“ áŠ¥áŠ•á‹²áŠ•áˆ³áˆá á‹«á‹°áˆ­áŒ‹áˆ */
            background-color: var(--et-purple); 
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.8);
            animation: spin 1.5s linear infinite, icon-float 2s infinite alternate ease-in-out; 
        }

        /* ğŸ›‘ NEW: áˆˆ "Luck Slot" áŠ á‹¶ áˆá‹© á‹˜á‹­á‰¤ */
        .card-icon-circle.luck-slot-icon {
            /* á‹¨ Luck Slot áŠ á‹¶á‹ á‰ á‰¥áˆ­á‰± áŠ¥áŠ•á‹²á‹«áŠ•áŒ¸á‰£áˆ­á‰… áŠ¥áŠ“ áŠ¥áŠ•á‹²áŠ•áˆ³áˆá á‹«á‹°áˆ­áŒ‹áˆ */
            background-color: #FF8C00; /* Darker Orange */
            border: 2px solid var(--et-yellow);
            font-size: 28px; 
            animation: slot-glow 3s infinite alternate, icon-float 2s infinite alternate ease-in-out;
        }

        .card-text-container {
            flex-grow: 1;
            margin-right: 10px; 
        }
        .card-title {
            font-size: 16px;
            font-weight: bold;
        }
        .card-subtitle {
            font-size: 12px;
            color: var(--tg-hint);
        }

        /* ğŸ›‘ NEW BADGE STYLES */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
            margin-left: auto;
            transition: background-color 0.3s, box-shadow 0.3s; /* ğŸ›‘ NEW */
        }
        .status-badge.ready {
            background-color: var(--et-green); 
            color: white;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.7); /* ğŸ›‘ IMPROVED: á‹¨áˆšá‹«á‰ áˆ« Ready */
        }
        .status-badge.cooldown {
            background-color: var(--et-red); 
            color: white;
        }

        .arrow-icon {
            font-size: 24px;
            color: var(--et-yellow);
            margin-left: 10px;
            flex-shrink: 0;
        }
        
        
        
        /* =========================================================
           ğŸ›‘ NEW: Social Tasks Styles
           ========================================================= */
        .social-tasks-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--tg-text);
            margin-bottom: 5px;
      
        }
        .social-tasks-subtitle {
            font-size: 14px;
            color: var(--tg-hint);
            margin-bottom: 20px;
        }
        .social-task-card {
            background-color: #242424; /* áŒ¥á‰áˆ­ á‹³áˆ« áŠ¨áˆáˆµáˆ‰ áŒ‹áˆ­ áŠ¥áŠ•á‹²áˆ˜áˆ³áˆ°áˆ */
            padding: 15px;
            border-radius: 15px; /* á‹¨á‰°áŒ áŒ‹áŒ‹ áŒ áˆ­á‹ */
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
        }
        .social-task-icon-container {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            flex-shrink: 0;
            box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
            /* âœ… NEW: á‹¨áˆ˜áŠ•áˆ³áˆá áŠ•á‰…áŠ“á‰„ */
            animation: icon-float 2s infinite alternate ease-in-out; 
        }
        .social-task-text-container {
            flex-grow: 1;
        }
        .social-task-title {
            font-weight: bold;
            font-size: 16px;
            color: white;
            margin-bottom: 3px;
        }
        .social-task-reward {
            font-size: 14px;
            color: var(--et-yellow); 
            font-weight: bold;
        }
        .social-task-action-button {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .social-task-action-button.join-style {
            background-color: var(--et-blue); 
            color: white;
            box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
        }
        .social-task-action-button.join-style:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #1565C0;
        }
        .social-task-action-button.completed-style {
            background-color: #555;
            color: var(--tg-text);
            cursor: not-allowed;
        }
        .social-task-action-button .check-icon {
            margin-left: 5px;
            font-size: 16px;
            color: var(--et-yellow);
        }

        /* =========================================================
           ğŸ›‘ NEW: Daily Reward Modal Styles (á‰ áˆáˆµáˆ‰ áˆ˜áˆ°áˆ¨á‰µ á‹¨á‰°áˆ°áˆ«)
           ========================================================= */
        #daily-reward-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none; /* á‰  JS á‹­áŠ¨áˆá‰³áˆ */
            align-items: center;
            justify-content: center;
        }

        .reward-content {
            background-color: var(--tg-bg);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
        }
        
        .reward-content h2 {
            margin-top: 0;
            color: var(--et-yellow);
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .reward-content p {
            font-size: 14px;
            color: var(--tg-hint);
            margin-bottom: 20px;
        }

        .reward-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .reward-day-card {
            background-color: var(--tg-secondary-bg);
            padding: 10px 5px;
            border-radius: 8px;
            border: 2px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .reward-day-card.claimed {
            background-color: #333;
            border-color: var(--et-green);
        }

        .reward-day-card.active-ready {
            background-color: var(--et-purple); /* áˆáˆµáˆ‰ áˆ‹á‹­ áŠ¥áŠ•á‹³áˆˆá‹ */
            border-color: var(--et-yellow);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }
        
        .reward-day-card.active-ready:active {
            transform: translateY(2px);
        }
        
        .reward-day-card span {
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
            color: var(--et-yellow);
        }
        
        .reward-day-card.claimed span {
            color: var(--tg-hint);
            text-decoration: line-through;
        }

        .reward-coin-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(circle at 60% 30%, #FFD700, #DAA520, #FFD700 80%, #B8860B);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 900;
            color: #444;
            box-shadow: 0 0 5px rgba(255, 193, 7, 0.8);
            margin-bottom: 3px;
        }

        #daily-reward-claim-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background-color: var(--et-green);
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 0 #388E3C;
            transition: all 0.1s ease;
        }
        
        #daily-reward-claim-button:disabled {
            background-color: #555;
            box-shadow: 0 4px 0 #333;
            cursor: not-allowed;
        }

        #daily-reward-claim-button:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 #388E3C;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--tg-hint);
            font-size: 24px;
            cursor: pointer;
        }





        /* =========================================================
           ğŸ›‘ NEW: Social Tasks Styles áˆ˜áŒ¨áˆ¨áˆ»
           ========================================================= */

/* ====================================================================== */
/* === GLOBAL & THEME VARIABLES === */
/* ====================================================================== */
:root {
    /* á‰¥áŒ á‰€áˆˆáˆá‰½ */
    --et-blue: #1976D2;          /* áˆ°áˆ›á‹«á‹Š */
    --et-yellow: #FFC300;        /* á‹‹áŠ“ á‰¢áŒ« áŠ áŠ­áˆ°áŠ•á‰µ (Gold) */
    --et-yellow-dark: #cc9c00;   /* áˆˆáŒ¥áˆ‹ (Shadow) */
    --et-red: #F44336;           /* á‰€á‹­ */
    --et-green: #4CAF50;         /* áŠ áˆ¨áŠ•áŒ“á‹´ */
    
    /* á‹³áˆ« áŠ¥áŠ“ á…áˆá (á‰‹áˆš áŒ¥á‰áˆ­ áŒˆáŒ½á‰³) */
    --bg-primary: #121212;       /* áŒ¥áˆá‰… áŒ¥á‰áˆ­ á‹³áˆ« */
    --bg-card: #2B2B2B;          /* á‹¨áŠ«áˆ­á‹µ á‹³áˆ« */
    --text-light: #F0F0F0;       /* á‰€áˆ‹áˆ á‹¨á…áˆá á‰€áˆˆáˆ */
    --text-grey: #A0A0A0;        /* áŒáˆ«áŒ«áˆ› á‹¨á…áˆá á‰€áˆˆáˆ */
    --shadow-dark: rgba(0, 0, 0, 0.7); /* áŒ¥áˆá‰… áŒ¥áˆ‹ */

    /* === áˆˆáŠ áŠ’áˆœáˆ½áŠ• áŠ á‹²áˆµ á‰°áˆˆá‹‹á‹‹áŒ®á‰½ === */
    --glow-color: var(--et-yellow);
    --glow-secondary: rgba(255, 195, 0, 0.15); /* á‰µáŠ•áˆ½ á‹°á‰¥á‹›á‹› á‰¢áŒ« */
}



/* ====================================================================== */
/* === KEYFRAMES FOR ANIMATION (áŠ á‹²áˆµ á‹¨á‰°áŒ¨áˆ˜áˆ¨) === */
/* ====================================================================== */
@keyframes spinBorder {
    0% {
        box-shadow: 0 0 0 2px var(--glow-secondary), 0 0 15px var(--glow-color);
        border-color: var(--glow-color); /* áŒ áŠ•áŠ«áˆ« á‰¥áˆ­áˆƒáŠ• */
    }
    50% {
        box-shadow: 0 0 0 0px var(--glow-secondary), 0 0 5px var(--glow-secondary);
        border-color: var(--glow-secondary); /* á‹°á‰¥á‹˜á‹ á‹«áˆˆ á‰¥áˆ­áˆƒáŠ• */
    }
    100% {
        box-shadow: 0 0 0 2px var(--glow-secondary), 0 0 15px var(--glow-color);
        border-color: var(--glow-color);
    }
}




/* ====================================================================== */
/* === BASE STYLES & LAYOUT === */
/* ====================================================================== */
/* á‹¨áŒ‹áˆ« á‰°áˆˆá‹‹á‹‹áŒ®á‰½ (Variables) */
{
    background-color: var(--bg-primary); 
    color: var(--text-light);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    padding: 20px; /* áˆˆáŠ®á‹± áˆ›áˆ³á‹« */
}



/* ====================================================================== */
/* === INVITE CARD STYLES (Glow Animation á‹¨á‰°áŒ¨áˆ˜áˆ¨á‰ á‰µ) === */
/* ====================================================================== */
.invite-card-container {
    /* áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆƒáˆ áˆˆáˆ›á‹µáˆ¨áŒ á‰ áˆ™áˆ‰ HTML á‹áˆµáŒ¥ á‹¨áŠá‰ áˆ¨á‹áŠ• `invite-card-container` áŠ­ááˆ á‹­áŒ á‰€áˆ™ */
    padding: 0; 
}

/* á‹¨áŠ«áˆ­á‹± á‹‹áŠ“ áˆ˜á‹«á‹£ */
.invite-card {
    background-color: var(--bg-card); 
    padding: 10px;
    border-radius: 18px; /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ á‹¨á‰°áŒ áŒ‹áŒ‹ áŒ áˆ­á‹ */
    box-shadow: 0 8px 30px var(--shadow-dark); /* á‹­á‰ áˆáŒ¥ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‹ˆáŒ£ áŒ¥áˆá‰… áŒ¥áˆ‹ */
    width: 330px;
    max-width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 10px; /* á‰  header áŠ¥áŠ“ button áˆ˜áŠ«áŠ¨áˆ á‰µáˆá‰… áŠ­áá‰°á‰µ */
    
    /* === áˆˆ Animation áŠ¥áŠá‹šáˆ… áˆáˆˆá‰µ áˆ˜áˆµáˆ˜áˆ®á‰½ á‰¥á‰» á‰°áŒ¨áˆáˆ¨á‹‹áˆ === */
    border: 2px solid var(--glow-secondary); /* á‹¨ Border áˆµá‰³á‹­áˆáŠ• á‹ˆá‹° 2px áŠ á‹µáˆ­áŒˆáŠ“áˆ */
    animation: spinBorder 2.5s infinite alternate ease-in-out; /* áŠ á‹²áˆµ áŠ áŠ’áˆœáˆ½áŠ• */
  margin-bottom:20px;
}

/* á‹¨áˆ‹á‹­áŠ›á‹ áŠ­ááˆ (áŠ á‹­áŠ®áŠ• áŠ¥áŠ“ á…áˆáá‰½) */
.header-section {
    display: flex;
    align-items: center;
}

.icon-circle {
    background-color: var(--et-yellow); 
    color: var(--bg-card); 
    width: 48px; /* á‰µáˆá‰… áŠ á‹­áŠ®áŠ• */
    height: 48px;
    border-radius: 12px; /* áŠ«áˆ¬á£ á‹¨á‰°áŒ áŒ‹áŒ‹ áŒ áˆ­á‹ á‹«áˆˆá‹ */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px; /* á‰µáˆá‰… ááŠ•á‰µ */
    font-weight: 900; /* á‰ áŒ£áˆ á‹¨á‹°áˆ˜á‰€ */
    margin-right: 15px;
    box-shadow: 0 0 10px rgba(255, 195, 0, 0.5); /* á‹¨á‰¢áŒ«á‹ á‰¥áˆ­áˆƒáŠ• */
}

.title {
    font-size: 17px;
    font-weight: 700;
    margin: 0;
    color: var(--text-light);
}

.subtitle {
    font-size: 12px;
    margin: 4px 0 0 0;
    color: var(--text-grey); 
    line-height: 1.4;
    font-style: italic; /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ áŒ½áˆ‘á */
}



/* ====================================================================== */
/* === BUTTONS SECTION === */
/* ====================================================================== */
.button-row {
    display: flex;
    gap: 12px; /* á‰ á‰áˆáá‰¹ áˆ˜áŠ«áŠ¨áˆ á‹«áˆˆ áŠ­áá‰°á‰µ á‹­áŒ¨áˆáˆ«áˆ */
}

/* --- INVITE BUTTON (3D EFFECT) --- */
.invite-button {
    text-decoration: none; /* áˆˆ <a> tag */
    width: 100%;
    height: 45px; /* á‰áˆ˜á‰±áŠ• á‹­áŒ¨áˆáˆ«áˆ */
    padding: 0 15px;
    border: none;
    border-radius: 12px;
    background-color: var(--et-yellow); 
    color: var(--bg-card); 
    font-weight: 800;
    font-size: 16px;
    cursor: pointer;
    
    /* 3D/Raised Effect */
    box-shadow: 0 5px 0 var(--et-yellow-dark); 
    transition: all 0.15s ease;
    
    display: flex;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
    text-transform: uppercase; /* áŠá‹°áˆ‰áŠ• áŠ¨á á‹«á‹°áˆ­áŒ‹áˆ */
}

.invite-button:active {
    box-shadow: 0 2px 0 var(--et-yellow-dark);
    transform: translateY(5px); /* áˆ²áŒ«áŠ• á‹¨áŒ¥áˆ‹á‹ áˆ˜áŒ áŠ• á‹«áˆ…áˆ á‹­áŒˆá‰£áˆ */
}

/* --- COPY BUTTON (SQUARE, 3D EFFECT) --- */
.copy-button {
    background-color: #3A3A3A; /* áŒ¥á‰áˆ­ áŒáˆ«áŒ« á‹³áˆ« */
    border: none; 
    width: 55px; /* áŠ¨á‹‹áŠ“á‹ á‰áˆá áŒ‹áˆ­ á‰áˆ˜á‰µ áŠ¥áŠ•á‹²áˆ˜áˆ³áˆ°áˆ */
    height: 55px; 
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.15s ease;
    
    /* 3D/Raised Effect */
    box-shadow: 0 7px 0 #202020; /* áŠ¨áŒ¨áˆˆáˆ› á‹³áˆ« áŒ‹áˆ­ á‹¨áˆšáˆ˜áˆ³áˆ°áˆ áŒ¥áˆá‰… áŒ¥áˆ‹ */
}

.copy-button:active {
    transform: translateY(5px); 
    box-shadow: 0 2px 0 #202020;
}
        
.copy-icon {
    width: 26px; 
    height: 26px;
    color: var(--et-yellow); /* áŠ á‹­áŠ®áŠ‘áŠ• á‰¢áŒ« á‹«á‹°áˆ­áŒˆá‹‹áˆ */
    stroke-width: 2.5; /* áŠ á‹­áŠ®áŠ‘áŠ• á‹°áˆ˜á‰… á‹«á‹°áˆ­áŒˆá‹‹áˆ */
}


.mystery-text {
    flex-grow: 1;
    margin-left: 15px;
}
.mystery-status {
    background-color: var(--et-green);
    color: var(--bg-primary);
    padding: 5px 10px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 12px;
}
/* ... (áˆŒáˆá‰½ áŠ áˆµáˆáˆ‹áŒŠ áˆµá‰³á‹­áˆá‰½) ... */



/* ====================================================================== */
/* === NAVIGATION BAR STYLES (á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ - áŠ¨á á‹«áˆˆáŠ“ á‹¨á‰°áŒ áŒ‹áŒ‹) === */
/* ====================================================================== */
#nav-bar {
    position: fixed;
    /* ğŸ›‘ áŠ¨ 0 á‹ˆá‹° 20px á‰°á‰€á‹­áˆ¯áˆ (áŠ¨á‰³á‰½ 20px áŠ¨á áŠ¥áŠ•á‹²áˆ) */
    bottom: 21px; 
    
    /* ğŸ›‘ á‰ áŒáˆ« á‰ áŠ©áˆ 5% áŠ­áá‰°á‰µ (áˆ˜áˆƒáˆ áˆ‹á‹­ áŠ¥áŠ•á‹²áˆ†áŠ•) */
    left: 5%; 
    
    /* ğŸ›‘ áˆµá‹á‰± 90% á‹­áˆáŠ• (áŠ¨áˆ™áˆ‰ áˆµá‹á‰µ á‰€áŠ•áˆ°áŠ“áˆ) */
    width: 90%; 
    
    /* ğŸ›‘ áŒ«áá‰¹ áŠ¥áŠ•á‹²áŒ áŒ‹áŒ‰ (Round) */
    border-radius: 30px; 

    /* á‰áˆ˜á‰µ áŠ¥áŠ“ á‹³áˆ« (Background) */
    height: 65px; /* á‰µáŠ•áˆ½ áŠ¨á áŠ¥áŠ•á‹²áˆ */
    background-color: #202c33; 
    
    display: flex;
    justify-content: space-around;
    align-items: center;
    
    /* á‹¨á‰°áŠ•áˆ³áˆáˆ á‰ áˆ˜áˆ†áŠ‘ á‹¨áˆ‹á‹­áŠ›á‹ á‹µáŠ•á‰ áˆ­ (border-top) áŠ á‹«áˆµáˆáˆáŒáˆ */
    /* border-top: 1px solid #1a2227; */ 
    
    /* ğŸ›‘ áŒ¥áˆ‹á‹ áŒáˆ‹ áŠ¥áŠ•á‹²áˆ */
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6); 
    z-index: 1000;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    
    /* á‹¨áˆáˆ‰áˆ áŠ•áŒ¥áˆá‰½ (Items) á‰€áˆˆáˆ áŒáˆ«áŒ« */
    color: var(--text-grey); 
    
    font-size: 11px;
    width: 25%; 
    height: 100%;
    transition: color 0.3s;
    
    /* áŠ•áŒ¥áˆá‰¹ á‰ áŠ á‹²áˆµ á‰áˆ˜á‰µ (65px) á‹áˆµáŒ¥ á‰ á‰µáŠ­áŠ­áˆ áŠ¥áŠ•á‹²áˆ°ááˆ© */
    padding-top: 5px; 
}

/* ğŸ›‘ NEW: áŠ•á‰ á‹¨áˆ†áŠá‹áŠ• áŠ á‹¶ áŠ­á‰¥ áŠ¥áŠ•á‹²áŠ–áˆ¨á‹ áˆˆáˆ›á‹µáˆ¨áŒ */
.nav-icon-container {
    width: 42px; /* á‰µáŠ•áˆ½ áŠ¥áŠ•á‹²á‰€áŠ•áˆµ */
    height: 42px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 2px;
    transition: background-color 0.3s, transform 0.2s;
}

.nav-item.active .nav-icon-container {
    /* ğŸ›‘ NEW: áŠ•á‰ áˆ²áˆ†áŠ• áˆ°áˆ›á‹«á‹Š á‹³áˆ« (Circle Background) */
    background-color: #5d93bb; 
    transform: translateY(-3px); /* áŠ•á‰ áˆ²áˆ†áŠ• á‰µáŠ•áˆ½ áŠ¨á áŠ¥áŠ•á‹²áˆ */
    box-shadow: 0 4px 8px rgba(93, 147, 187, 0.4); 
}

.nav-icon {
    font-size: 20px;
    /* ğŸ›‘ NEW: á‹¨áŠ á‹¶á‹á‰¹ á‰€áˆˆáˆ á‰ áŠá‰£áˆª áŠáŒ­ (text-light) á‹­áˆ†áŠ“áˆ */
    color: var(--text-light); 
}

.nav-item.active {
    /* áŠ•á‰ áŒ½áˆá (Active Text) áˆ°áˆ›á‹«á‹Š á‹­áˆ†áŠ“áˆ */
    color: #5d93bb; 
    text-shadow: none; 
    font-weight: bold;
}





/* ====================================================================== */
/* === âœ… ğŸ›‘ Top pages=== */
/* ====================================================================== */
/* --- Top Page (Leaderboard) --- */
        .top-user-card {
            background-color: var(--tg-secondary-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* ğŸ›‘ IMPROVED: áŒ¥áˆá‰… áŒ¥áˆ‹ */
            /* ğŸ›‘ IMPROVEMENT: á‹ˆáˆ­á‰ƒáˆ› ááˆ¬áˆ áˆˆá‹‹áŠ“á‹ áŠ«áˆ­á‹µ */
            border: 2px solid var(--et-yellow); 
        }
        .top-user-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .stat-item {
            padding: 3px;
            border-radius: 8px;
            background-color: #333;
            flex-basis: 45%;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) inset; /* ğŸ›‘ NEW: á‹¨3D áŒˆáŒ½á‰³ */
        }
        .stat-item span {
            display: block;
            font-size: 12px;
            color: var(--tg-hint);
            margin-top: 3px;
        }
        #leaderboard-list {
            background-color: var(--tg-secondary-bg);
            padding: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* ğŸ›‘ IMPROVED: áŒ¥áˆá‰… áŒ¥áˆ‹ */
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #2a2a2a;
            transition: background-color 0.2s; /* ğŸ›‘ NEW */
        }
        
        /* ğŸ›‘ NEW/IMPROVEMENT: áˆˆ Top 3 á‹¨áŒ€áˆ­á‰£ á‰€áˆˆáˆ áˆ›á‹µáˆ˜á‰‚á‹« */
        .leaderboard-item.gold-highlight {
            background-color: rgba(255, 215, 0, 0.15); /* á‰€áˆ‹áˆ á‹ˆáˆ­á‰ƒáˆ› */
            border-left: 4px solid #FFD700;
        }
        .leaderboard-item.silver-highlight {
            background-color: rgba(192, 192, 192, 0.15); /* á‰€áˆ‹áˆ á‰¥áˆ­áˆ› */
            border-left: 4px solid #C0C0C0;
        }
        .leaderboard-item.bronze-highlight {
            background-color: rgba(205, 127, 50, 0.15); /* á‰€áˆ‹áˆ áŠáˆáˆ³áˆ› */
            border-left: 4px solid #CD7F32;
        }

        .leaderboard-item-rank {
            font-weight: bold;
            width: 35px; /* á‰¦á‰³á‹áŠ• áˆ˜áŒ¨áˆ˜áˆ­ */
            text-align: center;
            color: var(--tg-text);
            font-size: 16px;
        }
        /* ğŸ›‘ NEW/IMPROVEMENT: áˆˆ Top 3 á‹°áˆ¨áŒƒá‹á‰½ áˆá‹© á‰€áˆˆáˆ áŠ¥áŠ“ áˆ˜áŒ áŠ• */
        .leaderboard-item-rank.gold {
            color: #FFD700; /* á‹ˆáˆ­á‰… */
            font-size: 20px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
        }
        .leaderboard-item-rank.silver {
            color: #C0C0C0; /* á‰¥áˆ­ */
            font-size: 18px;
        }
        .leaderboard-item-rank.bronze {
            color: #CD7F32; /* áŠáˆáˆµ */
            font-size: 17px;
        }

        .leaderboard-item-photo { 
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--et-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            overflow: hidden; 
            flex-shrink: 0;
            border: 2px solid #555; /* ğŸ›‘ NEW: áˆˆáá‰¶ á‰µáŠ•áˆ½ ááˆ¬áˆ */
        }
        .leaderboard-item-name {
            flex: 1;
            font-size: 15px;
            font-weight: 500;
            /* ğŸ›‘ IMPROVEMENT: áˆ¨áŒ…áˆ áˆµáˆá‰½ áŠ¥áŠ•á‹³á‹­á‹ˆáŒ¡ áˆ˜áŠ¨áˆ‹áŠ¨áˆ */
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap;
            margin-right: 10px; 
        }
        .leaderboard-item-score {
            font-weight: bold;
            color: var(--et-green);
            white-space: nowrap;
            font-size: 15px;
            text-shadow: 0 0 3px rgba(76, 175, 80, 0.5); /* ğŸ›‘ NEW: áˆˆáŠáŒ¥á‰¥ áŒ¥áˆ‹ */
        }
        .current-user-highlight {
            background-color: rgba(76, 175, 80, 0.3); /* ğŸ›‘ IMPROVED: á‹¨áŒ á‰†áˆ¨ á‹³áˆ« */
            border-left: 4px solid var(--et-green); 
            font-weight: bold; /* ğŸ›‘ NEW: áŒáˆ‹ á‰¥áˆ áŠ¥áŠ•á‹²á‰³á‹­ */
        }




        /* --- Profile Page Styling --- */
        #profile-page {
            text-align: center;
            padding-top: 40px;
      
        }
        .profile-avatar {
            width: 100px;
            height: 100px;
            background-color: var(--et-green);
            border-radius: 50%;
            margin: 0 auto 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            font-weight: bold;
            /* ğŸ›‘ NEW: áˆˆ Profile Avatar áŒ¥áˆ‹ */
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            border: 4px solid white; 
            overflow: hidden; 
        }
        .profile-username-display {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 30px;
            color: var(--et-yellow); /* ğŸ›‘ IMPROVED: á‹ˆáˆ­á‰ƒáˆ› á‰€áˆˆáˆ */
        }
        .profile-stat-box {
            background-color: var(--tg-secondary-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* ğŸ›‘ NEW */
      
        }
        .stat-label {
            display: flex;
            align-items: center;
            font-size: 16px;
          
        }
        .stat-label .icon {
            margin-right: 10px;
            font-size: 20px;
            color: var(--et-yellow);
        }
        .balance-value {
            font-weight: bold;
            color: var(--et-green);
            text-shadow: 0 0 3px rgba(76, 175, 80, 0.5); 
        }
        .withdraw-button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background-color: var(--et-green);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .withdraw-button:hover {
            background-color: #388E3C;
        }
        .profile-action-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-align: left;
            background-color: var(--tg-secondary-bg);
            color: var(--tg-text);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* ğŸ›‘ NEW */
            transition: transform 0.2s, box-shadow 0.2s;
        }
         .profile-action-button:hover {
            transform: translateX(5px); /* ğŸ›‘ NEW: áˆ²áŠáŠ« áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .profile-action-button .icon {
            margin-right: 15px;
            font-size: 20px;
        }
        .exchange-status {
            color: var(--tg-hint);
            font-size: 14px;
            margin-right: 10px;
        }



        /* --- Game Page Styles --- */
        .game-page-container {
            padding: 20px 10px;
            text-align: center;
        }
        .game-page-container h2 {
            margin-bottom: 20px;
            color: var(--et-yellow);
            font-size: 22px;
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
        }
        .game-info-box {
            background-color: var(--tg-secondary-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); /* ğŸ›‘ IMPROVED */
        }
        .game-action-button {
            display: block;
            width: 80%;
            margin: 20px auto;
            padding: 15px;
            border: none;
            border-radius: 8px;
            background-color: var(--et-green);
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 6px 0 #388E3C; /* ğŸ›‘ IMPROVED */
            transition: all 0.1s ease;
        }
        .game-action-button:active {
            box-shadow: 0 2px 0 #388E3C;
            transform: translateY(4px); /* ğŸ›‘ IMPROVED */
        }
        .game-action-button.cooldown {
             background-color: #555;
             box-shadow: 0 6px 0 #333;
             cursor: not-allowed;
        }
        .game-back-button {
            display: block;
            width: 80%;
            margin: 40px auto 10px auto;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #424242;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .game-back-button:hover {
            background-color: #555555;
        }
        .cooldown-timer {
            font-size: 20px;
            font-weight: bold;
            color: var(--et-red);
            margin-top: 10px;
            text-shadow: 0 0 5px rgba(244, 67, 54, 0.5); /* ğŸ›‘ NEW */
        }
        
        
        
/* ==========================================
   --- Daily Spin Wheel FIXED Styles ---
   ========================================== */
.wheel-container {
    position: relative;
    width: 300px; /* áŠ¥áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ á‰ á‹°áŠ•á‰¥ áŠ¥áŠ•á‹²á‰³á‹­ á‰µáŠ•áˆ½ áŠ¨á á‹­á‰ áˆ */
    height: 300px;
    margin: 20px auto 40px auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

.wheel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    overflow: hidden;
    border: 8px solid #fff;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 1); /* Smooth Spin */
}

/* --- The Geometric Calculation (Skew Method) --- */
/* 10 Segments = 360 / 10 = 36 degrees each.
   Skew Angle = 90 - 36 = 54 degrees.
*/
.segment {
    position: absolute;
    top: 0;
    right: 0;
    width: 50%;
    height: 50%;
    background: var(--clr);
    transform-origin: 0% 100%; /* áˆ˜á‹áˆªá‹«á‹ áŠ¨á‰³á‰½ á‰ áŒáˆ« (áˆ›áŠ¥áŠ¨áˆ) */
    
    /* áŠ¥á‹šáˆ… áŒ‹áˆ­ áŠá‹ áŒ¨á‹‹á‰³á‹! á‰…áˆ­áŒ¹áŠ• áˆˆáˆ›áˆµá‰°áŠ«áŠ¨áˆ Skew áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• */
    transform: rotate(calc(36deg * var(--i))) skewY(-54deg);
}

.segment-text {
    position: absolute;
    left: -100%;
    width: 200%;
    height: 200%;
    text-align: center;
    display: block;
    
    /* Skew á‹¨á‰°á‹°áˆ¨áŒˆá‹áŠ• á‰…áˆ­áŒ½ áˆ˜áˆáˆ¶ áˆ›áˆµá‰°áŠ«áŠ¨áˆ áŠ¥áŠ“ áŒ½áˆá‰áŠ• áˆ›á‹áˆ­ */
    transform: skewY(54deg) rotate(18deg); 
    padding-top: 20px; /* áŒ½áˆá‰áŠ• áŠ¨áŒ áˆ­á‹™ á‰µáŠ•áˆ½ á‹á‰… áˆˆáˆ›á‹µáˆ¨áŒ */
    
    color: white;
    font-weight: bold;
    font-size: 13px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    line-height: 1.2;
}

/* --- Center Circle (SPIN text) --- */
.center-circle {
    position: absolute;
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 50%;
    z-index: 10;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    color: #333;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
    border: 4px solid #FFD700;
}

/* --- Pointer (Triangle) --- */
.pointer {
    position: absolute;
    top: -15px; /* áŠ¨áˆ³áŒ¥áŠ‘ á‰µáŠ•áˆ½ á‹ˆáŒ£ á‰¥áˆ */
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    
    /* á‰µáˆªá‹«áŠ•áŒáˆ‰ á‹ˆá‹° á‰³á‰½ áŠ¥áŠ•á‹²á‹«áˆ˜áˆˆáŠ­á‰µ border-top áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• */
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-top: 30px solid #ff3e3e; 
    
    z-index: 20;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
}

           
           
/* ====================================================================== */
/* === âœ… ğŸ›‘ á‹¨ mystery game === */
/* ====================================================================== */

        /* --- Mystery Box Styles --- */
        .box-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .mystery-box {
            width: 90px; /* ğŸ›‘ IMPROVED: á‰µáˆá‰… áŠ¥áŠ•á‹²áˆ†áŠ• */
            height: 90px; /* ğŸ›‘ IMPROVED: á‰µáˆá‰… áŠ¥áŠ•á‹²áˆ†áŠ• */
            background-color: var(--et-red);
            border-radius: 12px; /* ğŸ›‘ IMPROVED: á‰µáŠ•áˆ½ áŠ­á‰¥ á‰…áˆ­áŒ½ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px; /* ğŸ›‘ IMPROVED: á‰µáˆá‰… á‰…áˆ­áŒ¸-á‰áˆáŠ */
            cursor: pointer;
            transition: transform 0.2s, background-color 0.5s;
            box-shadow: 0 8px 0 #A83232; /* ğŸ›‘ IMPROVED: áŒ¥áˆá‰… áŒ¥áˆ‹ */
        }
        .mystery-box:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #A83232;
        }
        .mystery-box.opened {
            background-color: var(--et-green);
            box-shadow: 0 8px 0 #388E3C;
        }
        .mystery-box.missed {
            background-color: #666; /* ğŸ›‘ IMPROVED: á‹¨áŒ á‰†áˆ¨ áŒáˆ«áŒ« */
        }
        
        /* --- Reflex Game Styles --- */
        #reflex-play-area {
            height: 200px;
            background-color: var(--tg-secondary-bg);
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: var(--tg-hint);
            cursor: pointer; 
            border: 2px dashed var(--et-yellow); /* ğŸ›‘ NEW: áˆˆáŒ¨á‹‹á‰³á‹ á‰¦á‰³ áŒ áˆ­á‹ */
        }
        #reflex-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--et-red);
            color: white;
            font-size: 24px;
            font-weight: bold;
            display: none; 
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 7px 0 #882222;
            transition: transform 0.1s;
        }
        #reflex-button:active {
            transform: translateY(3px);
            box-shadow: 0 4px 0 #882222;
        }
        
        
        
        
       /* ============================================== */
        /* âœ… ğŸ›‘ áŠ á‹²áˆµ: Scratch Card Game Styles */
        /* ============================================== */
        
        /* á‹­áˆ… áˆ˜á‹«á‹£ (container) áˆ½áˆáˆ›á‰±áŠ• áŠ¥áŠ“ áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áŠ¥áŠ•á‹²á‹°áˆ«áˆ¨á‰¡ á‹«á‹°áˆ­áŒ‹áˆ */
        #scratch-card-container {
            position: relative;
            width: 280px; /* á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹ áˆµá‹á‰µ */
            height: 150px; /* á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹ á‰áˆ˜á‰µ */
            margin: 20px auto 0 auto;
            border-radius: 10px;
            overflow: hidden; /* áŠ¨áŠ­á‰¥ áŒ áˆ­á‹™ á‹áŒª áŠ¥áŠ•á‹³á‹­á‰³á‹­ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            background-color: var(--tg-secondary-bg); /* áŠ¨áˆµáˆ­ á‹«áˆˆá‹ á‹³áˆ« */
        }

        /* 1. áŠ¨á‰³á‰½ á‹«áˆˆá‹ á‹¨áˆ½áˆáˆ›á‰µ áŒ½áˆá */
        .scratch-prize-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            
            /* áˆˆáˆ½áˆáˆ›á‰± á‹¨áˆšá‹«áˆáˆ­ áŒ½áˆá */
            font-size: 32px;
            font-weight: 900;
            color: var(--et-green);
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
            
            /* á‰°áŒ á‰ƒáˆšá‹ áŒ½áˆá‰áŠ• áŠ¥áŠ•á‹³á‹­áˆ˜áˆ­áŒ á‹ (select) áˆ›á‹µáˆ¨áŒ */
            user-select: none; 
            -webkit-user-select: none;
        }
        
        /* 2. áŠ¨áˆ‹á‹­ á‹«áˆˆá‹ áˆ˜áˆá‰…áˆá‰‚á‹« (Canvas) */
        .scratch-top-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2; /* áŠ¨áˆ½áˆáˆ›á‰± áŒ½áˆá á‰ áˆ‹á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• */
            
            /* á‹¨áˆ˜áˆá‰…áˆá‰‚á‹« áŠ á‹­áŒ¥ áˆáˆáŠ­á‰µ (cursor) */
            cursor: grab; 
        }

        .scratch-top-layer:active {
            cursor: grabbing;
        }




 
        /* ============================================== */
        /* âœ… Slot Game CSS */
        /* ============================================== */
        .game-page-container {
            padding: 15px;
            text-align: center;
        }

        .daily-game-card {
            background-color: var(--tg-secondary-bg);
            border-radius: 12px;
            padding: 20px 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin: 20px 0;
        }

        .daily-game-card .header {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 15px;
        }

        .daily-game-card .header .back-button {
            position: absolute;
            left: 0;
            font-size: 24px;
            color: var(--tg-hint);
            cursor: pointer;
            padding: 5px;
        }

        .daily-game-card .header .main-title {
            font-size: 22px;
            font-weight: bold;
            color: var(--et-yellow);
        }

        .daily-game-card .header .sub-title {
            font-size: 14px;
            color: var(--tg-hint);
            text-align: center;
            margin-top: 5px;
        }

        .info-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
        }

        .info-item {
            font-size: 14px;
            color: var(--tg-text);
            font-weight: 500;
        }

        .info-item span {
            font-weight: bold;
            color: var(--et-yellow);
            display: block;
            font-size: 18px;
        }

        .slots-area {
            display: flex;
            justify-content: space-around;
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 3px solid #3d3d3d;
        }

        .slot {
            width: 30%;
            height: 80px;
            background-color: #000000;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.2);
            overflow: hidden; 
        }

        .daily-game-card .btn {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            color: white;
            text-transform: uppercase;
        }

        #spin-btn {
            background-color: var(--et-red);
            box-shadow: 0 4px #911a1a; /* Darker red for shadow */
        }

        #claim-btn {
            background-color: #6d6d6d;
            box-shadow: 0 4px #575757;
        }

        #claim-btn:not([disabled]) {
            background-color: var(--et-green);
            box-shadow: 0 4px #006000; /* Darker green for shadow */
        }
        
        
        
        /* ============================================== */
/* âœ… ADDED: SLOTS SPINNING ANIMATION */
/* ============================================== */

/* 1. á‹¨áˆ½áŠ­áˆ­áŠ­áˆ©áŠ• áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´ á‹¨áˆšá‹ˆáˆµáŠ• á‰áˆá ááˆ¬áˆ */
@keyframes slot-spin {
    /* 1200px á‰áˆ˜á‰± á‹«áˆˆá‹ á‹¨á‹áŒ¤á‰¶á‰½ áˆ°áŠ•áˆ°áˆˆá‰µ (Strip) áŠ áˆˆ á‰¥áˆˆáŠ• áŠ¥áŠ•áŒˆáˆá‰³áˆˆáŠ• */
    to {
        transform: translateY(-1200px); /* áŠ¨áˆ‹á‹­ á‹ˆá‹° á‰³á‰½ á‰ ááŒ¥áŠá‰µ á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ«áˆ */
    }
}

/* 2. áˆ½áŠ­áˆ­áŠ­áˆ©áŠ• áˆˆáˆšáŒ€áˆáˆ­ áˆ›áŠ•áŠ›á‹áˆ Slot Reel */
.slot-reel.spinning {
    /* á‹¨áŠ áŠ’áˆœáˆ½áŠ‘ ááŒ¥áŠá‰µ áŠ¥áŠ“ áŠ á‹­áŠá‰µ */
    animation: slot-spin 0.1s steps(10) infinite; 
    /* ğŸ›‘ steps(10) áˆ›áˆˆá‰µ 10 á‹¨á‰°áˆˆá‹«á‹© áˆáˆµáˆá‰½ á‹«áˆ‰á‰µ Strip áŠ áˆˆ á‰¥áˆˆáŠ• áŒˆáˆá‰°áŠ“áˆ */
}

/* 3. áˆ½áŠ­áˆ­áŠ­áˆ© áˆ²á‰†áˆ á‹ˆá‹° á‰µáŠ­áŠ­áˆˆáŠ›á‹ á‰¦á‰³ áŠ¥áŠ•á‹²á‹«áˆ­á */
/* áˆ½áŠ­áˆ­áŠ­áˆ© áˆ²á‹«áˆá‰… á‹ˆá‹° á‰¦á‰³á‹ áŠ¥áŠ•á‹²áŠ•áˆ¸áˆ«á‰°á‰µ */
.slot-reel {
    transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); /* áˆ½áŠ­áˆ­áŠ­áˆ© áŠ¥áŠ•á‹²á‹«áˆáˆ­ á‹«á‹°áˆ­áŒˆá‹‹áˆ */
}

/* âœ… Slot Container - á‹­áˆ… áˆ˜áˆµáŠ®á‰± áŠá‹ (áŠ á‹­áŠ•á‰€áˆ³á‰€áˆµáˆ) */
.slot {
    width: 30%;
    height: 80px;
    background-color: #000000;
    border-radius: 6px;
    border: 1px solid #333;
    overflow: hidden; /* áŠ¨áˆ³áŒ¥áŠ‘ á‹¨á‹˜áˆˆáˆˆ áŠáŒˆáˆ­ áŠ¥áŠ•á‹³á‹­á‰³á‹­ á‹­á‰†áˆ­áŒ£áˆ */
    position: relative;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
}

/* âœ… The Moving Strip - á‹­áˆ… á‹­áŠ•á‰€áˆ³á‰€áˆ³áˆ */
.slot-reel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    display: flex;
    flex-direction: column; /* áˆáˆµáˆá‰¹ áŠ¨áˆ‹á‹­ á‹ˆá‹° á‰³á‰½ á‹­á‹°áˆ¨á‹°áˆ«áˆ‰ */
    transition: transform 3s cubic-bezier(0.25, 1, 0.5, 1); /* á‹¨áˆ˜áˆ½áŠ¨áˆ­áŠ¨áˆ­ áŠ áŠ’áˆœáˆ½áŠ• */
}

/* á‰ áŠ¥á‹«áŠ•á‹³áŠ•á‹± áˆ³áŒ¥áŠ• á‹áˆµáŒ¥ á‹«áˆˆá‹ áˆáˆµáˆ */
.reel-item {
    height: 80px; /* áŠ¨ Slot á‰áˆ˜á‰µ áŒ‹áˆ­ áŠ¥áŠ©áˆ áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µ */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    line-height: 80px;
}

        .timer-container {
            background-color: #333333;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 14px;
            color: var(--tg-text);
        }
        
        
        
        
        /* ====================================================================== */
/* === âœ… ğŸ›‘ áŠ á‹²áˆµ: KENO GAME STYLES (Prefixed) === */
/* ====================================================================== */

/* á‹¨ Keno áŒ¨á‹‹á‰³ á‰€áˆˆáˆá‰½ */
#keno-game-page {
    --keno-primary: #f7a01d; 
    --keno-win: #17e05e; 
    --keno-bet-btn: #ffc107; 
    --keno-dark-bg: #1e1e1e;
    --keno-grid-bg: #440000; 
    --keno-text: #ffffff;
    --keno-selected: #ffc107; 
    --keno-drawn: #ffc107; 
    --keno-random-btn: #007bff; 
    --keno-history-bg: #2c2c2c;
    --keno-tab-active: var(--keno-primary);
    --keno-tab-inactive: #777;
    --keno-loss: #f44336; 
}

/* á‹¨ Keno áŒ¨á‹‹á‰³ á‹‹áŠ“ áŒˆáŒ½á‰³ */
#keno-game-page {
    background-color: var(--keno-dark-bg);
    color: var(--keno-text);
    text-align: center;
    user-select: none;
    padding: 10px 5px !important; /* áŠ¨ game-page-container áŒ‹áˆ­ áŠ¥áŠ•á‹³á‹­áŒ‹áŒ­ */
}

#keno-game-page #keno-game-container {
    width: 100%;
    max-width: 800px; 
    padding: 10px 0;
}

/* ------------------- KENO TAB STYLES ------------------- */
#keno-game-page #keno-tab-navigation {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-top: 15px;
    border-top: 2px solid #333;
    border-bottom: 2px solid #333;
    background-color: #2c2c2c;
}
#keno-game-page .keno-tab-button {
    flex-grow: 1;
    padding: 15px 0;
    font-size: 1em;
    font-weight: bold;
    color: var(--keno-tab-inactive);
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s;
    border-bottom: 3px solid transparent;
}
#keno-game-page .keno-tab-button.active {
    color: var(--keno-tab-active);
    border-bottom: 3px solid var(--keno-tab-active);
}

#keno-game-page .keno-tab-content {
    display: none;
    padding-top: 20px;
    min-height: 200px; 
    width: 100%;
    text-align: left;
}
#keno-game-page .keno-tab-content.active {
    display: block;
}

/* ------------------- KENO HEADER & GRID ------------------- */
#keno-game-page #keno-message {
    min-height: 20px;
    font-size: 1.1em;
    font-weight: bold;
    color: var(--keno-primary);
    margin-bottom: 10px;
    text-align: center;
}

#keno-game-page #keno-header-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 10px;
    background-color: #333;
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: bold;
}
#keno-game-page #keno-header-status span:last-child {
    color: var(--et-yellow); /* áŠ¨á‹‹áŠ“á‹ áŒˆáŒ½ áŒ‹áˆ­ áˆˆáˆ›áˆ˜áˆ³áˆ°áˆ */
}


#keno-game-page #keno-main-game-area {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 15px;
    width: 96%;
}

#keno-game-page #keno-grid {
    flex-shrink: 0;
    display: grid;
    grid-template-columns: repeat(10, 1fr); 
    gap: 2px;
    padding: 5px;
    background-color: var(--keno-grid-bg);
    border-radius: 10px;
    width: 100%; 
    transition: width 0.3s ease; 
}

#keno-game-page #keno-draw-shaker-area {
    flex-grow: 1;
    width: 35%; 
    display: none; /* á‰  JS á‹­á‰³á‹«áˆ */
    flex-direction: column;
    align-items: center;
    background-color: #2c2c2c;
    border-radius: 10px;
    padding: 10px;
    text-align: center;
}
#keno-game-page #keno-current-ball-area {
    width: 60px; 
    height: 60px; 
    font-size: 1.5em; 
    margin: 10px 0; 
    border-radius: 50%; 
    background-color: var(--keno-drawn); 
    color: var(--keno-dark-bg); 
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-weight: bold;
}


#keno-game-page .number-cell {
    padding: 5px 0;
    background-color: var(--keno-grid-bg); 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); 
    transition: all 0.2s;
    font-size: 0.8em;
    cursor: pointer;
    color: var(--keno-text);
    text-align: center;
    border-radius: 4px; /* á‰µáŠ•áˆ½ á‹µáŠ•á‰ áˆ­ */
}

#keno-game-page .number-cell.selected {
    background-color: var(--keno-selected);
    color: var(--keno-dark-bg);
    font-weight: bold;
    border: 2px solid var(--keno-text);
    transform: scale(1.05);
}

@keyframes keno-pulse-win {
    from {
        box-shadow: 0 0 10px var(--keno-win), 0 0 0px var(--keno-win);
        transform: scale(1.05);
    }
    to {
        box-shadow: 0 0 25px var(--keno-win), 0 0 15px var(--keno-primary);
        transform: scale(1.10);
    }
}

#keno-game-page .number-cell.match {
    background-color: var(--keno-win) !important;
    color: var(--keno-dark-bg);
    font-weight: bold;
    border: 3px solid var(--keno-primary) !important; 
    animation: keno-pulse-win 0.5s infinite alternate; 
}
#keno-game-page .number-cell.drawn-cell {
     /* áŠ¥áŒ£ á‹¨á‹ˆáŒ£á‰ á‰µáŠ• áˆˆáˆ›áˆ³á‹¨á‰µ (á‹«áˆá‰°áˆ˜áˆ¨áŒ  á‰¢áˆ†áŠ•áˆ) */
    background-color: #555;
}

#keno-game-page .number-cell.disabled {
    cursor: not-allowed; 
    opacity: 0.6;        
}

/* ------------------- KENO BET CONTROLS ------------------- */
#keno-game-page #keno-bet-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-top: 15px;
}

#keno-game-page #keno-bet-input-group {
    display: flex;
    align-items: center;
    background-color: #333; 
    border-radius: 4px;
    overflow: hidden; 
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5); 
    margin-right: 10px;
}

#keno-game-page .keno-bet-modifier {
    padding: 10px 15px;
    font-size: 1.5em;
    background-color: var(--keno-primary); 
    color: var(--keno-dark-bg); 
    font-weight: bold; 
    border: none; 
    cursor: pointer;
}

#keno-game-page #keno-bet-amount-input {
    padding: 8px 5px;
    width: 100%; 
    background-color: #333; 
    border: none;
    color: var(--keno-text);
    text-align: center;
    font-size: 1.2em; 
    font-weight: bold; 
    max-width: 100px;
    min-width: 60px;
    /* Webkit-specific (hides arrows) */
    -webkit-appearance: textfield;
     -moz-appearance: textfield;
          appearance: textfield;
}
#keno-game-page #keno-bet-amount-input::-webkit-inner-spin-button,
#keno-game-page #keno-bet-amount-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}


#keno-game-page #keno-bet-button-group {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-shrink: 0; 
}

#keno-game-page #keno-bet-btn {
    padding: 15px 50px;
    background-color: var(--keno-bet-btn);
    color: var(--keno-dark-bg);
    font-weight: bold;
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 0 #b8860b; 
    cursor: pointer;
    transition: all 0.1s ease;
}
#keno-game-page #keno-bet-btn:disabled {
    background-color: #555;
    box-shadow: 0 4px 0 #333;
    cursor: not-allowed;
}
#keno-game-page #keno-bet-btn:active:not(:disabled) {
    transform: translateY(4px);
    box-shadow: 0 0 0 #b8860b;
}


#keno-game-page #keno-random-pick-btn {
    width: 100%;
    padding: 12px;
    background-color: var(--keno-random-btn);
    color: var(--keno-text);
    font-weight: bold;
    border: none;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 3px 0 #0056b3; 
    cursor: pointer;
}

/* ------------------- KENO HISTORY/RESULTS ------------------- */
#keno-game-page #keno-history-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}
#keno-game-page .keno-history-card {
    background-color: #2c2c2c;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border-left: 5px solid #555;
    overflow: hidden;
}
#keno-game-page .keno-history-card.win {
    border-left-color: var(--keno-win);
}
#keno-game-page .keno-history-card.loss {
    border-left-color: var(--keno-loss);
}
#keno-game-page .keno-history-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background-color: #3a3a3a;
}
#keno-game-page .keno-history-card .game-id {
    font-weight: bold;
    font-size: 1.1em;
}
#keno-game-page .keno-history-card .game-date {
    font-size: 0.8em;
    color: #ccc;
}
#keno-game-page .keno-history-card .game-result {
    font-weight: bold;
    font-size: 1.1em;
    padding: 4px 10px;
    border-radius: 5px;
}
#keno-game-page .keno-history-card .game-result.win {
    background-color: var(--keno-win);
    color: var(--keno-dark-bg);
}
#keno-game-page .keno-history-card .game-result.loss {
    background-color: var(--keno-loss);
    color: var(--keno-text);
}
#keno-game-page .keno-history-card .card-body {
    padding: 15px;
    text-align: left;
}
#keno-game-page .keno-history-card .card-body p {
    margin: 5px 0 10px;
}
#keno-game-page .keno-history-card .card-body .pick-list {
    color: var(--keno-primary);
    font-weight: bold;
}
#keno-game-page .keno-history-card .card-body details {
    margin-top: 10px;
    color: #aaa;
}
#keno-game-page .keno-history-card .card-body summary {
    cursor: pointer;
    font-weight: bold;
}
#keno-game-page .keno-history-card .card-body .drawn-list {
    padding-top: 8px;
    color: #ccc;
    font-size: 0.9em;
    word-wrap: break-word;
    line-height: 1.5;
}

#keno-game-page #keno-paytable-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
}
#keno-game-page .keno-paytable-card {
    background-color: #2c2c2c;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
}
#keno-game-page .keno-paytable-header {
    background-color: var(--keno-primary);
    color: var(--keno-dark-bg);
    padding: 12px;
    font-size: 1.3em;
    font-weight: bold;
    text-align: center;
}

#keno-game-page .keno-paytable-card table {
    width: 100%;
    border-collapse: collapse;
    text-align: left;
}
#keno-game-page .keno-paytable-card th, 
#keno-game-page .keno-paytable-card td {
    padding: 12px 15px;
    border-bottom: 1px solid #444;
}
#keno-game-page .keno-paytable-card th {
    background-color: #3a3a3a;
    font-size: 1em;
    color: #ccc;
}
#keno-game-page .keno-paytable-card td {
    font-size: 1.1em;
}
#keno-game-page .keno-paytable-card td:last-child {
    font-weight: bold;
    color: var(--keno-win);
    text-align: right;
    font-size: 1.2em;
}
#keno-game-page .keno-paytable-card tr:last-child td {
    border-bottom: none;
}
/* ====================================================================== */
/* === âœ… ğŸ›‘ á‹¨ KENO GAME STYLES áˆ˜áŒ¨áˆ¨áˆ» === */
/* ====================================================================== */


/* ====================================================================== */
/* === âœ… ğŸ›‘ profil page STYLES === */
/* ====================================================================== */


    /* --- 1. [áŠ á‹²áˆµ] á‹¨áˆ‹á‹­áŠ›á‹ áŠ­ááˆ (Header) --- */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.header h1 {
    font-size: 24px;
    margin: 0;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

.connect-wallet-btn {
    background-color: #007BFF; /* áˆ°áˆ›á‹«á‹Š */
    color: white;
    border: none;
    border-radius: 20px;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

.connect-wallet-btn svg {
    width: 20px;
    height: 20px;
}

/* --- 2. [á‹¨á‹µáˆ®] á•áˆ®á‹á‹­áˆ (áŠ«áˆ­á‹µ áŠ¥áŠ•á‹²áˆ˜áˆµáˆ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ) --- */
.profile-avatar {
    font-size: 50px;
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 50%; /* áŠ­á‰¥ áŠ¥áŠ•á‹²áˆ†áŠ• */
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 10px auto;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

.profile-username-display {
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 25px;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}


/* --- 3. [áŠ á‹²áˆµ] á‹‹áŠ“á‹ á‹¨ "Total Coin" áŠ«áˆ­á‹µ --- */
.assets-card {
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    text-align: left;
  box-shadow: 0 0 0 2px #FFC107, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
}

.assets-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-size: 16px;
    margin-bottom: 10px;
}

.assets-card-header .history-btn {
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
}

.history-btn svg {
    width: 16px;
    height: 16px;
    stroke: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    text-align: left;
    margin-top: 5px; 
}

.balance-display {
    font-size: 15px;
    font-weight: 700;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

.balance-display .currency {
    font-size: 15px;
    font-weight: 600;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin-left: 8px;
}

/* --- 3.1. [áŠ á‹²áˆµ] á‹¨áˆ¶áˆµá‰± áŠ á‹áˆ«áˆ®á‰½ (Actions) áŠ­ááˆ --- */
.card-actions {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 25px;
  
}

.action-btn {
    flex: 1; 
    background-color: var(--btn-bg, #3E4041);
    border: none;
    border-radius: 12px;
    padding: 15px 10px;
    cursor: pointer;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-size: 14px;
    font-weight: 600;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  box-shadow: 0 0 0 2px red, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
}

.action-btn svg {
    width: 24px;
    height: 24px;
}

.action-btn.exchange svg {
    stroke: var(--et-yellow, #FFC107);
}

.action-btn.withdraw svg,
.action-btn.airdrop svg {
    stroke: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

/* --- 4. [á‹¨á‹µáˆ®] á‹¨ Settings áŠ­ááˆ (áˆµá‰³á‹­áˆ‰ áŠ¨á‹µáˆ®á‹ áŠ®á‹µáˆ… áŒ‹áˆ­ áŠ áŠ•á‹µ áŠá‹) --- */
.profile-action-button {
    background-color: var(--card-bg, #2B2D2E);
    border-radius: 10px;
    padding: 15px;
    width: 100%;
    border: none;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin-bottom: 12px;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between; 
    box-sizing: border-box; 
}

.profile-action-button .stat-label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 16px;
    font-weight: 500;
}

.profile-action-button .icon {
    font-size: 20px;
}



  exchange ccs code

                                                                    
/* --- á‹˜áˆ˜áŠ“á‹Š á‹¨áˆá‹á‹áŒ¥ áŒˆáŒ½ á‰…áŒ¦á‰½ (Scoped) --- */

/* 1. áŠ áŒ á‰ƒáˆ‹á‹­ á‹˜áˆ˜áŠ“á‹Š áŠ«áˆ­á‹µ á‰…áŒ¥ (Modern Card Style) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-card, 
#exchange-page .modern-card-3d {
    background-color: var(--tg-secondary-bg);
    padding: 10px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); 
    text-align: center;
    border: 1px solid #444;
}

/* 2. 3D áŠ«áˆ­á‹µ (Hover effect) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-card-3d {
    background-color: #2c2c2c;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 0 5px rgba(76, 175, 80, 0.1); 
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-card-3d:hover {
    transform: translateY(-5px); 
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.6), 0 0 0 5px rgba(76, 175, 80, 0.3);
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .card-title {
    font-size: 14px;
    color: var(--tg-hint);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .balance-amount {
    font-size: 20px;
    font-weight: 900;
    margin: 5px   0;
    text-shadow: 0 0 5px rgba(255, 193, 7, 0.6);
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .currency-label {
    font-size: 14px;
    color: var(--tg-text);
    opacity: 0.7;
}

/* 3. Rate Display (áˆá‹á‹áŒ¥ áˆáŒ£áŠ” áŠ á‰€áˆ›áˆ˜áŒ¥) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .rate-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .rate-label {
    font-size: 14px;
    color: var(--tg-hint);
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .rate-value {
    font-size: 16px;
    font-weight: bold;
    color: var(--et-green);
}

/* 4. Quantity Control (+/- Buttons) */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .quantity-control {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0;
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .qty-input {
    width: 120px;
    padding: 10px;
    text-align: center;
    border: 2px solid #555;
    border-radius: 5px;
    background-color: var(--tg-secondary-bg);
    color: var(--tg-text);
    font-size: 20px;
    font-weight: bold;
    margin: 0 10px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.4); 
}

/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .qty-btn {
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 20%;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
    background-color: var(--et-yellow); 
    color: #1c1c1c;
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.4);
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .qty-btn:active {
    transform: scale(0.95);
}

/* 5. Smart Coin Output */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .smart-coin-output {
    
    justify-content: space-between;
    padding: 10px 0;
    margin-top: 15px;
    font-size: 15px;
    font-weight: bold;
    border-top: 1px dashed #555;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page #smartCoinResult {
    color: var(--et-green);
    font-size: 22px;
}

/* 6. Main Exchange Button */
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-exchange-btn {
    width: 80%;
    padding: 15px;
    font-size: 18px;
    font-weight: bold;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 30px;
    background-color: var(--et-green);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5); 
    transition: background-color 0.3s, box-shadow 0.3s, transform 0.1s;
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .modern-exchange-btn:not(.disabled-btn):hover {
    background-color: #388E3C;
    transform: translateY(-2px);
}
/* ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: #exchange-page á‰°áŒ¨áˆáˆ¯áˆ */
#exchange-page .disabled-btn {
    background-color: #555555 !important;
    cursor: not-allowed;
    box-shadow: none !important;
}



/* =========================================================
   âœ… ğŸ›‘ áŠ á‹²áˆµ: á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdrawal Page) á‰…áŒ¦á‰½
   ========================================================= */

/* === áŠ áŒ á‰ƒáˆ‹á‹­ á‰…áŒ¦á‰½ (General Styles) === */

/* â­ï¸ áˆ›áˆµá‰°áŠ«áŠ¨á‹« 1: á‹¨áŒˆáŒ¹áŠ• á‹³áˆ« á‰‹áˆš áˆ›á‹µáˆ¨áŒ */
#withdraw-page {
    background-color: #1b2129; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    padding: 15px; 
    box-sizing: border-box;
}

#withdraw-page .page-title {
    margin-bottom: 15px; 
    text-align: center;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

#withdraw-page hr {
    border: 0;
    height: 1px;
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin: 20px 0;
}

/* === áŠ«áˆ­á‹¶á‰½ (Cards) === */
#withdraw-page .modern-card-3d {
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 14px; 
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); 
    transition: all 0.2s ease;
    margin-bottom: 15px; 
}

#withdraw-page .card-title {
    font-size: 1.1em;
    font-weight: 600;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    margin: 0 0 15px 0;
}

/* === á‰€áˆª áˆ’áˆ³á‰¥ áŠ«áˆ­á‹µ (Balance Card) === */
#withdraw-page .balance-input-card .balance-amount {
    font-size: 2.5em;
    font-weight: 700;
    color: var(--et-green, #4CAF50); 
    margin: 5px 0;
}

#withdraw-page .balance-input-card .currency-label {
    font-size: 0.9em;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
}

/* === á‹¨á‰áŒ¥áˆ­ áˆ›áˆµáŒˆá‰¢á‹« áˆ›áˆµá‰°áŠ«áŠ¨á‹« === */
#withdraw-page .quantity-control {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

#withdraw-page .qty-btn {
    background-color: #0088cc; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border: none;
    border-radius: 15%;
    width: 44px;
    height: 44px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
    flex-shrink: 0;
}

#withdraw-page #withdrawAmountInput {
    flex-grow: 1;
    max-width: 150px;
    padding: 12px;
    font-size: 1.5em; 
    font-weight: 700; 
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    background-color: #1b2129; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border: 5px solid #333333; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 12px;
    text-align: center;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    -moz-appearance: textfield;
}

#withdraw-page #withdrawAmountInput::-webkit-outer-spin-button,
#withdraw-page #withdrawAmountInput::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* === á‹¨áˆ˜áŠ­áˆá‹« á‹˜á‹´á‹á‰½ === */
#withdraw-page .method-master-card {
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 14px;
    padding: 20px;
    box-shadow: 0 0 0 2px #2196F3, 0 0 10px #FFC107;
    transition: box-shadow 0.3s; 
    margin-bottom: 15px;
}

#withdraw-page #method-selection-container {
    display: flex;
    flex-direction: column;
    gap: 10px; 
    margin-top: 15px; 
  
}

#withdraw-page .method-wrapper {
    background-color: #333333; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    border-radius: 10px;
    padding: 0; 
    transition: all 0.s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  
}

#withdraw-page .method-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border: 2px solid transparent; 
    cursor: pointer;
    background-color: transparent; 
    border-radius: 10px;
  
}

#withdraw-page .method-info {
    display: flex;
    align-items: center;
    gap: 15px;
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-weight: 500; 
}

#withdraw-page .method-fee {
    font-size: 0.9em;
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    font-weight: 500;
    text-align: right;
}

#withdraw-page .selection-indicator {
    display: none; 
    font-size: 24px;
    color: var(--et-green, #4CAF50);
    flex-shrink: 0;
    margin-left: 10px;
}

/* á‹¨áŠ áˆ›áˆ«áŒ­ áˆ›á‹µáˆ˜á‰… (Selection Highlight) */
#withdraw-page .method-wrapper.active {
    box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); 
}

#withdraw-page .method-wrapper.active > .method-card {
    border-color: var(--et-green, #4CAF50); 
}

#withdraw-page .method-wrapper.active .selection-indicator {
    display: block; 
}

/* === Button Card áˆ›áˆµá‰°áŠ«áŠ¨á‹« === */
#withdraw-page .action-card {
     padding: 20px;
}

#withdraw-page #withdrawMessage {
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    color: var(--et-red, #F44336); 
    margin-bottom: 15px;
    min-height: 1.2em;
}

/* === modern-exchange-btn (áŠ¨ Exchange áŒˆáŒ½ áŒ‹áˆ­ áŠ¥áŠ•á‹²áˆ˜áˆ³áˆ°áˆ) === */
#withdraw-page .modern-exchange-btn {
    width: 100%;
    padding: 16px;
    font-size: 1.2em;
    font-weight: 700;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    letter-spacing: 0.5px;
}

/* Enabled State */
#withdraw-page .modern-exchange-btn:not(.disabled-btn) {
    background: linear-gradient(135deg, var(--et-green, #4CAF50), #208f3c); 
    color: #FFFFFF; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
}

/* Disabled State */
#withdraw-page .modern-exchange-btn.disabled-btn {
    background-color: #181818; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    color: #AAAAAA; /* âœ… ğŸ›‘ á‰‹áˆš á‰€áˆˆáˆ */
    cursor: not-allowed;
    box-shadow: none;
}


/* 1. .method-info áŠ• áˆ›áˆµá‰°áŠ«áŠ¨áˆ (áŠ á‹¶ áŠ¥áŠ“ áˆµáˆ á‰¥á‰» áŠ¥áŠ•á‹²á‹­á‹) */
#withdraw-page .method-info {
    display: flex;
    align-items: center;
    gap: 15px; /* áŠ á‹¶á‹áŠ• áŠ¥áŠ“ áˆµáˆ™áŠ• á‹­áˆˆá‹«áˆ */
    /* ... á‰€áˆª á‰…áŒ¦á‰½ ... */
}

/* 2. â­ï¸ áŠ á‹²áˆµ á‰…áŒ¥: áŠ­áá‹«á‹áŠ• áŠ¥áŠ“ á‹¨áˆ˜áˆáˆ¨áŒ« áˆáˆáŠ­á‰±áŠ• á‰ áŠ áŠ•á‹µ áˆ‹á‹­ á‹ˆá‹° á‰€áŠ á‹«áˆ°áˆá‹áˆ */
#withdraw-page .right-aligned-fee {
    display: flex;
    align-items: center; 
    gap: 10px; /* á‰  Fee áŠ¥áŠ“ á‰ áˆ˜áˆáˆ¨áŒ« áˆáˆáŠ­á‰± áˆ˜áŠ«áŠ¨áˆ á‹«áˆˆ áŠ­áá‰°á‰µ */
    flex-shrink: 0; /* áŠ¥áŠ•á‹³á‹­áŒ á‰¥ áŠ¥áŠ•á‹²á‹«á‹°áˆ­áŒ */
}

/* 3. .method-fee: áŠ áˆáŠ• á‰  method-card á‹áˆµáŒ¥ áˆµáˆˆáˆ†áŠá£ á‹¨ááˆŒáŠ­áˆµ áŠ áˆ°áˆ‹áˆˆááŠ• á‹­áŠ¨á‰°áˆ‹áˆ */
/* â­ï¸ á‹­áˆ… á‰…áŒ¥ Fee áŒ½áˆ‘á‰áŠ• áŠ¨ method-name áŒ‹áˆ­ á‰ á‰µá‹­á‹© áŠ¥áŠ•á‹²áˆ†áŠ• á‹­áˆ¨á‹³áˆ */
#withdraw-page .method-fee {
    /* á‹¨áŠ áˆáŠ‘áŠ• á‰…áŒ¥ á‹­á‰€áŒ¥áˆ‹áˆ */
    font-size: 0.9em;
    color: var(--tg-hint); /* âœ… á‹­áˆ… áŠ¨áˆ‹á‹­ áŠ«áˆˆá‹ --tg-hint áˆµáˆˆáˆšá‹ˆáˆ­áˆµ á‰½áŒáˆ­ á‹¨áˆˆá‹áˆ */
    font-weight: 500;
    /* text-align: right; áŠ á‹«áˆµáˆáˆáŒáˆ */
}

/* 4. .method-card: áŠ áˆáŠ• á‰µáŠ­áŠ­áˆˆáŠ›á‹áŠ• justify-content á‹­áŒ á‰€áˆ›áˆ */
#withdraw-page .method-card {
    display: flex;
    justify-content: space-between; /* áŒáˆ« áŠ¥áŠ“ á‰€áŠ áŒáŠ• áˆˆáŒáŠ• á‹«á‹°áˆ­áŒ‹áˆ */
    align-items: center;
    /* ... á‰€áˆª á‰…áŒ¦á‰½ ... */
}



        /* ==============================================================
           === âœ… ğŸ›‘ áŠ á‹²áˆµ: á‰€áˆˆáˆ á‹«áˆˆ á‹¨áŒ¨á‹‹á‰³ áˆá‹²áŠ•áŒ áˆµáŠ­áˆªáŠ• (Modal Spinner) ===
           ============================================================== */
        #game-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* áŠ¨áŠáˆ-áŒáˆáŒ½ áŒ¥á‰áˆ­ á‹³áˆ« */
            background-color: rgba(0, 0, 0, 0.6); 
            display: none; /* á‰ áŠá‰£áˆª á‹­á‹°á‰ á‰… */
            justify-content: center;
            align-items: center;
            z-index: 9998; /* áŠ¨áˆáˆ‰áˆ áŠáŒˆáˆ­ á‰ áˆ‹á‹­ (áŠ¨á‹‹áŠ“á‹ áˆá‹°áˆ­ á‰ á‰³á‰½) */
            opacity: 0;
            transition: opacity 0.3s ease; /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ áˆ˜áŒá‰¢á‹« */
        }

        .game-spinner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 5px solid #555; /* á‹¨áŠ­á‰¡ á‹³áˆ« (track) */
            
            /* âœ… áŠá‰£áˆ©áŠ• á‰¢áŒ« á‰°áˆˆá‹‹á‹‹áŒ­ (variable) áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• */
            border-top-color: var(--et-yellow); 
            
            /* âœ… áŠá‰£áˆ©áŠ• 'spin' áŠ áŠ’áˆœáˆ½áŠ• áŠ¥áŠ•áŒ‹áˆ«áˆˆáŠ• */
            animation: spin 1s linear infinite; 
        }

        /* (áŠá‰£áˆ© @keyframes spin áŠ¨áˆ‹á‹­ áˆµáˆ‹áˆˆ áˆ˜á‹µáŒˆáˆ áŠ á‹«áˆµáˆáˆáŒáˆ) */
        /* ==============================================================
           === á‹¨áŒ¨á‹‹á‰³ áˆá‹²áŠ•áŒ áˆµáŠ­áˆªáŠ• áˆ˜áŒ¨áˆ¨áˆ» ===
           ============================================================== */
</style>

<style>
    /* ... (áŠá‰£áˆ© áŠ®á‹µáˆ… áŠ¥áŠ•á‹³áˆˆ áˆ†áŠ–) ... */

    /* =========================================================
       ğŸ›‘ NEW: áŠ á‹³á‹²áˆµ á‹¨áŠ áŠ’áˆœáˆ½áŠ• áŠ á‹­áŠá‰¶á‰½ (Keyframes)
       ========================================================= */

    /* 1. áˆˆ Mystery (áˆ˜áŠ•á‰€áŒ¥á‰€áŒ¥) */
    @keyframes shake {
      0%, 100% { transform: translateX(0) rotate(0); }
      10%, 30%, 50% { transform: translateX(-3px) rotate(-2deg); }
      20%, 40%, 60% { transform: translateX(3px) rotate(2deg); }
      80% { transform: translateX(-2px) rotate(-1deg); }
      90% { transform: translateX(2px) rotate(1deg); }
    }

    /* 2. áˆˆ Reflex (áˆáŒ£áŠ• áŠ•á‹áˆ¨á‰µ/Pulse) */
    @keyframes pulse-fast {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    
    /* 3. áˆˆ Social Tasks (á‰µáŠ©áˆ¨á‰µ áˆ˜áˆ³á‰¢á‹«) */
    @keyframes tada {
      from { transform: scale3d(1, 1, 1); }
      10%, 20% { transform: scale3d(.95, .95, .95) rotate3d(0, 0, 1, -3deg); }
      30%, 50%, 70%, 90% { transform: scale3d(1.05, 1.05, 1.05) rotate3d(0, 0, 1, 3deg); }
      40%, 60%, 80% { transform: scale3d(1.05, 1.05, 1.05) rotate3d(0, 0, 1, -3deg); }
      to { transform: scale3d(1, 1, 1); }
    }

    /* ... (áˆŒáˆá‰¹ áŠá‰£áˆ­ @keyframes áŠ¥áŠ•á‹³áˆ‰ áˆ†áŠá‹) ... */


    /* =========================================================
       ğŸ›‘ NEW: áŠ á‹²áˆ¶á‰¹áŠ• áŠ áŠ’áˆœáˆ½áŠ–á‰½ áˆˆáŠ á‹¶á‹á‰¹ áˆ˜áˆµáŒ á‰µ
       ========================================================= */
    
    /* 1. áˆˆ Mystery Icon (áŠ á‹²áˆµ class áŠ¥áŠ•áˆáŒ¥áˆ«áˆˆáŠ•) */
    .card-icon-circle.mystery-icon {
        background-color: var(--et-red); /* áˆˆáˆáˆ³áˆŒ (á‰€á‹­) */
        /* 'shake' áŠ• áŠ¨ 'icon-float' áŒ‹áˆ­ áŠ¥áŠ“á‰€áˆ‹á‰…áˆ‹áˆˆáŠ• */
        animation: shake 2.5s infinite ease-in-out, icon-float 2s infinite alternate ease-in-out;
    }

    /* 2. áˆˆ Reflex Icon (áŠ á‹²áˆµ class áŠ¥áŠ•áˆáŒ¥áˆ«áˆˆáŠ•) */
    .card-icon-circle.reflex-icon {
        background-color: var(--et-blue); /* áˆˆáˆáˆ³áˆŒ (áˆ°áˆ›á‹«á‹Š) */
        /* 'pulse-fast' áŠ• áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• (icon-float áŠ¥á‹šáˆ… áŠ á‹«áˆµáˆáˆáŒáˆ) */
        animation: pulse-fast 1.2s infinite ease-in-out;
    }

    /* 3. áˆˆ Social Tasks (áŠá‰£áˆ©áŠ• class áŠ¥áŠ“áˆµá‰°áŠ«áŠ­áˆ‹áˆˆáŠ•) */
    .social-task-icon-container {
        /* ... (áŠá‰£áˆ­ áˆµá‰³á‹­áˆá‰¹ áŠ¥áŠ•á‹³áˆ‰ áˆ†áŠá‹) ... */
        
        /* âœ… áŠá‰£áˆ©áŠ• 'icon-float' áŠ áŠ’áˆœáˆ½áŠ• á‰ áŠ á‹²áˆ± 'tada' áŠ¥áŠ•á‰°áŠ«áˆˆáŠ• */
        animation: tada 2s infinite alternate ease-in-out;
        /* á‰µáŠ•áˆ½ áŠ¥áŠ•á‹²á‹˜áŒˆá‹­ áŠ¨áˆáˆˆáŒáŠ• */
        /* animation-delay: 1s; */
    }

    /* áˆ›áˆ³áˆ°á‰¢á‹«: .daily-spin-icon (spin) áŠ¥áŠ“ .luck-slot-icon (slot-glow) 
      áŠá‰£áˆ®á‰¹ áŠ áŠ’áˆœáˆ½áŠ–á‰»á‰¸á‹ áˆ‹á‹­ áˆáŠ•áˆ áˆˆá‹áŒ¥ áŠ áˆ‹á‹°áˆ¨áŒáŠ•áˆá¢
    */
 





/* ================================================= */
/* âœ… ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: Staking Page CSS - áŠ•áŒ¹áˆ… áŠ á‰€áˆ›áˆ˜áŒ¥ (FINAL) */
/* ================================================= */

/* á‰‹áˆš á‰€áˆˆáˆá‰½ (Themes) */
#staking-page {
    --stake-bg-primary: #1b2129;
    --stake-bg-secondary: #181818;
    --stake-text-primary: #FFFFFF;
    --stake-text-secondary: #AAAAAA;
    --stake-yellow: #FFC107;
    --stake-green: #4CAF50;
    --stake-red: #F44336;
    --stake-blue: #2196F3;
    --stake-border: #444;
}

#staking-page {
    background-color: var(--stake-bg-primary);
    color: var(--stake-text-primary);
    padding: 0 15px; 
}

/* Header áŠ¥áŠ“ Coin Status */
#stake-header-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    margin-bottom: 20px;
    background-color: var(--stake-bg-secondary);
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: bold;
    border: 1px solid var(--stake-border);
}

/* 1. á‹¨á‰³á‰¦á‰½ (Tabs) áŠ á‰€áˆ›áˆ˜áŒ¥ */
#stake-tab-navigation {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 25px; 
    border-radius: 8px;
    overflow: hidden;
    background-color: var(--stake-bg-secondary);
    border: 1px solid var(--stake-border);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}

#staking-page .stake-tab-button {
    flex: 1;
    padding: 12px 0;
    font-size: 15px;
    font-weight: 600;
    color: var(--stake-text-secondary);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border-right: 1px solid #333; 
}

#staking-page .stake-tab-button.active {
    color: var(--stake-text-primary);
    background-color: #333;
    border-bottom: 3px solid var(--stake-yellow);
}

/* 2. á‹¨á‰³á‰¥ á‹­á‹˜á‰µ Display Fix */
#staking-page .stake-tab-content {
    display: none; 
    padding-top: 15px; 
    min-height: 200px; 
    width: 100%;
}
#staking-page .stake-tab-content.active {
    display: block;
}

/* ğŸ›‘ 3. á‹¨á‰°áˆ»áˆ»áˆˆ: History Card Styling (áŠ¥áŠ•á‹° Rule áŒˆá…) */
#stake-history-list {
    display: flex;
    flex-direction: column;
    gap: 15px; /* á‰ áŠ«áˆ­á‹¶á‰½ áˆ˜áŠ«áŠ¨áˆ áŠ­áá‰°á‰µ áŒ¨áˆáˆ¯áˆ */
    padding-top: 5px;
}

#staking-page .stake-history-card {
    background-color: var(--stake-bg-secondary);
    border-radius: 12px; /* á‰µáŠ•áˆ½ á‰µáˆá‰… áŠ­á‰¥ áŒ áˆ­á‹ */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
    border: 1px solid #333; /* áŒ á‰…áˆ‹áˆ‹ á‹µáŠ•á‰ áˆ­ áŒ¨áˆáˆ¯áˆ */
    
    /* á‹¨áŒáˆ« á‹µáŠ•á‰ áˆ­ á‰€áˆˆáˆ á‰  class áˆ˜áˆ°áˆ¨á‰µ á‹­áˆµá‰°áŠ«áŠ¨áˆ‹áˆ */
    border-left-width: 5px; 
    border-left-style: solid;
}

#staking-page .stake-history-card.stake {
    border-left-color: var(--stake-red);
}
#staking-page .stake-history-card.claim {
    border-left-color: var(--stake-green);
}

#staking-page .stake-history-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 18px; /* á‹¨á‹áˆµáŒ¥ áŠ­áá‰°á‰µ áŒ¨áˆáˆ¯áˆ */
    background-color: #2c2c2c; 
    border-bottom: 1px solid #333; /* áŒáˆáŒ½ áˆ˜áˆˆá‹«á‹« */
}

#staking-page .stake-history-card .action-amount {
    font-weight: 800; /* á‹°áˆ›á‰… áŠ á‹µáˆ­áŒ“áˆ */
    font-size: 1.1em;
    padding: 4px 10px;
    border-radius: 5px;
}

#staking-page .stake-history-card .card-body {
    padding: 15px 18px; /* á‹¨á‹áˆµáŒ¥ áŠ­áá‰°á‰µ áŒ¨áˆáˆ¯áˆ */
    text-align: left;
    color: var(--stake-text-secondary);
}


/* 4. Rules Card Styling (áŠ¨á‹šáˆ… á‰ áŠá‰µ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ) */
#stake-rules-tab ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
    padding-top: 10px; 
}
#stake-rules-tab li {
    background-color: var(--stake-bg-secondary);
    border: 1px solid #333;
    padding: 18px; 
    margin-bottom: 15px; 
    border-radius: 12px;
    border-left: 5px solid var(--stake-yellow); 
    font-size: 14px;
    line-height: 1.6;
    color: var(--stake-text-primary);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* 5. "á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ" á‰áˆá áˆ›áˆµá‰°áŠ«áŠ¨á‹« */
#staking-page .game-back-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 15px;
    margin-top: 20px;
    margin-bottom: 80px; 
    background-color: #2c2c2c; 
    color: white;
    font-weight: bold;
    font-size: 15px;
    border: 1px solid #444;
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.2s;
}



/* Staking Progress Bar */
.stake-progress-container {
    width: 100%;
    background-color: #333;
    border-radius: 10px;
    height: 12px;
    margin-top: 15px;
    margin-bottom: 10px;
    overflow: hidden;
    border: 1px solid #444;
}

.stake-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--et-yellow), var(--et-green));
    width: 0%;
    transition: width 1s linear;
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
}

/* Accrued Interest Text */
.accrued-text {
    font-size: 12px;
    color: var(--tg-hint);
    margin-top: 5px;
    text-align: right;
}

.accrued-value {
    color: var(--et-green);
    font-weight: bold;
}
/* Stake Plan Cards Styling */
.stake-plan-card {
    background-color: var(--tg-secondary-bg); /* áŠ¨ TG áŒ­á‰¥áŒ¥ áŒ‹áˆ­ á‹¨áˆšáˆµáˆ›áˆ› á‹³áˆ« */
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid var(--tg-hint); /* á‰€áˆ‹áˆ áŒ áˆ­á‹ */
}

/* áŠ«áˆ­á‹± áˆ²áŒ«áŠ• á‰µáŠ•áˆ½ áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ */
.stake-plan-card:not(.disabled):active {
    transform: scale(0.98);
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
}

/* á‰ á‰‚ áŒˆáŠ•á‹˜á‰¥ áŠ¨áˆŒáˆˆ áŠ«áˆ­á‹± áŠ¥áŠ•á‹²á‹°á‰¥á‹á‹ */
.stake-plan-card.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* áˆ­á‹•áˆµ áŠ¥áŠ“ á‹¨á‹ˆáˆˆá‹µ áˆ˜áŒ áŠ• áŠ¥áŠ•á‹²áˆˆá‹«á‹© */
.plan-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dashed var(--tg-hint); /* á‰ áŠáŒ áˆ‹ áˆ°áˆ¨á‹ á‹¨á‰°áŠ¨á‹áˆáˆˆ áˆ˜áˆµáˆ˜áˆ­ */
}

.plan-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--tg-text);
}

/* á‹¨á‹ˆáˆˆá‹µ áˆ˜áŒ áŠ• áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
.plan-rate {
    font-size: 18px;
    font-weight: 800;
    color: var(--stake-yellow, #FFD700); /* áˆˆá‹ˆáˆˆá‹µ áˆ˜áŒ áŠ• á‹ˆáˆ­á‰ƒáˆ› á‰¢áŒ« */
}

.plan-details {
    font-size: 13px;
    line-height: 1.8;
    color: var(--tg-hint); /* á‰€áˆ‹áˆ á‰€áˆˆáˆ */
}

/* á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ˜áŒ áŠ–á‰½ áŒáˆá‰°á‹ áŠ¥áŠ•á‹²á‹ˆáŒ¡ */
.plan-details span {
    color: var(--tg-text); 
    font-weight: 600;
}




/* --- Daily Cipher Styles --- */
.cipher-display-area {
    margin: 30px auto;
    text-align: center;
}

#cipher-input {
    background-color: #333;
    border: 2px solid var(--et-purple);
    color: white;
    font-size: 24px;
    text-align: center;
    padding: 15px;
    border-radius: 10px;
    width: 80%;
    letter-spacing: 5px;
    text-transform: uppercase;
    outline: none;
    box-shadow: 0 0 15px rgba(156, 39, 176, 0.4);
}

#cipher-input:focus {
    border-color: var(--et-yellow);
    box-shadow: 0 0 20px rgba(255, 193, 7, 0.6);
}

/* --- Memory Match Styles --- */
#memory-game-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 áŠ«áˆ­á‹¶á‰½ á‰ áŠ áŒá‹µáˆ */
    gap: 10px;
    max-width: 350px;
    margin: 0 auto;
    perspective: 1000px; /* áˆˆ 3D áˆ˜áŒˆáˆá‰ áŒ¥ */
}

.memory-card {
    background-color: #2c2c2c;
    border: 2px solid var(--et-yellow);
    border-radius: 8px;
    height: 80px;
    position: relative;
    cursor: pointer;
    transform: scale(1);
    transform-style: preserve-3d;
    transition: transform 0.5s;
}

.memory-card:active {
    transform: scale(0.95);
}

/* áŠ«áˆ­á‹± áˆ²áŒˆáˆˆá‰ áŒ¥ */
.memory-card.flip {
    transform: rotateY(180deg);
}

/* á‹¨áŠ«áˆ­á‹± áŠá‰µáŠ“ áŠ‹áˆ‹ */
.front-face, .back-face {
    width: 100%;
    height: 100%;
    position: absolute;
    border-radius: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    backface-visibility: hidden; /* áŒ€áˆ­á‰£á‹áŠ• áˆ˜á‹°á‰ á‰… */
}

.front-face {
    background-color: #fff;
    color: #000;
    transform: rotateY(180deg); /* áŠá‰± á‰°áŒˆáˆá‰¥áŒ¦ áŠ¥áŠ•á‹²á‰€áˆ˜áŒ¥ */
}

.back-face {
    background-color: var(--et-yellow); /* á‹¨áŠ«áˆ­á‹± áŒ€áˆ­á‰£ */
    color: #000;
    font-size: 24px;
    font-weight: bold;
}

.memory-card.matched .front-face {
    background-color: var(--et-green); /* áŠ¨á‰°áŒˆáŠ˜ áŠ áˆ¨áŠ•áŒ“á‹´ á‹­áˆáŠ• */
}

 
    /* áŠ¢áˆáŒ‚á‹ á‰¥á‰»á‹áŠ• áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ á‹­áˆ… áŒá‹´á‰³ áŠá‹ */
    .emoji-animate {
        display: inline-block; /* á‹­áˆ… áŠ¨áˆŒáˆˆ áŠ¢áˆáŒ‚á‹ áŠ á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ­áˆ */
        font-size: 24px; /* á‹¨áŠ¢áˆáŒ‚ áˆ˜áŒ áŠ• */
    }

    /* 1. Daily Spin (á‹¨áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ­ áŒáˆ› - Momentum) */
    @keyframes spin-momentum {
        0% { transform: rotate(0deg); }
        60% { transform: rotate(340deg); }
        80% { transform: rotate(355deg); }
        100% { transform: rotate(360deg); }
    }
    .anim-spin {
        animation: spin-momentum 2.5s infinite cubic-bezier(0.1, 0.7, 1.0, 0.1);
    }

    /* 2. Lucky Slot (á‹ˆá‹° áˆ‹á‹­ áŠ¥áŠ“ á‰³á‰½ - Vertical Scroll) */
    @keyframes slot-scroll {
        0% { transform: translateY(0); }
        25% { transform: translateY(-8px); }
        50% { transform: translateY(0); }
        75% { transform: translateY(5px); }
        100% { transform: translateY(0); }
    }
    .anim-slot {
        animation: slot-scroll 1.2s infinite ease-in-out;
    }

    /* 3. Mystery Box (á‹¨áˆšáŠ•á‰€áŒ á‰€áŒ¥ - Shake) */
    @keyframes shake-icon {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-15deg); }
        75% { transform: rotate(15deg); }
    }
    .anim-shake {
        animation: shake-icon 1.5s infinite ease-in-out;
    }

    /* 4. Daily Cipher (á‹¨áˆšá‹«á‰ áˆ« - Glow/Pulse) */
    @keyframes glow-icon {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.7; }
    }
    .anim-glow {
        animation: glow-icon 2s infinite alternate;
    }

    /* 5. Memory Match (á‹¨áˆšáŒˆáˆˆá‰ áŒ¥ - Flip) */
    @keyframes flip-icon {
        0% { transform: rotateY(0); }
        50% { transform: rotateY(180deg); }
        100% { transform: rotateY(360deg); }
    }
    .anim-flip {
        animation: flip-icon 3s infinite ease-in-out;
    }

    /* 6. Reflex Game (á‹¨áˆá‰¥ áˆá‰µ - Heartbeat) */
    @keyframes pulse-heart {
        0% { transform: scale(1); }
        15% { transform: scale(1.3); }
        30% { transform: scale(1); }
        45% { transform: scale(1.15); }
        60% { transform: scale(1); }
    }
    .anim-pulse {
        animation: pulse-heart 1.5s infinite ease-in-out;
    }

    /* 7. Social Tasks (áˆ˜áŠ•áˆ³áˆá - Bounce) */
    @keyframes bounce-icon {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
    }
    .anim-bounce {
        animation: bounce-icon 2s infinite ease-in-out;
    }

   
   /* Dropdown Style */
#language-dropdown {
    background-color: #222;
    color: white;
    border: 1px solid #FFC107; /* á‹ˆáˆ­á‰ƒáˆ› á‰€áˆˆáˆ */
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    outline: none;
    cursor: pointer;
    text-align: center;
}
/* ============================================== */
/* ğŸ’£ MINES GAME STYLES */
/* ============================================== */
#mines-game-page {
    text-align: center;
}

#mines-header-stats {
    background-color: #333;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-weight: bold;
    color: var(--et-yellow);
    border: 1px solid var(--et-yellow);
}

#mines-controls {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 20px;
}

.control-group {
    flex: 1;
    background-color: var(--tg-secondary-bg);
    padding: 10px;
    border-radius: 10px;
}

.control-group label {
    display: block;
    font-size: 12px;
    color: var(--tg-hint);
    margin-bottom: 5px;
}

.input-wrapper {
    display: flex;
    align-items: center;
    background-color: #222;
    border-radius: 5px;
    overflow: hidden;
}

.input-wrapper button {
    background-color: #444;
    border: none;
    color: white;
    padding: 8px 12px;
    font-size: 16px;
    cursor: pointer;
}

.input-wrapper input {
    width: 100%;
    background: transparent;
    border: none;
    color: white;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
}

#mines-grid-container {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    max-width: 320px;
    margin: 0 auto 20px auto;
    background-color: #222;
    padding: 10px;
    border-radius: 10px;
}

.mine-tile {
    aspect-ratio: 1; /* áŠ«áˆ¬ áŠ¥áŠ•á‹²áˆ†áŠ• */
    background-color: #3a4a5a;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    transition: transform 0.1s, background-color 0.2s;
    box-shadow: 0 4px 0 #2c3a45;
}

.mine-tile:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 #2c3a45;
}

.mine-tile.revealed {
    background-color: #1b2129;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    cursor: default;
}

.mine-tile.diamond {
    background-color: #1b2129;
    border: 1px solid var(--et-green);
}

.mine-tile.exploded {
    background-color: var(--et-red);
    animation: shake 0.5s;
}

#mines-status-bar {
    display: flex;
    justify-content: space-between;
    background-color: #333;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-weight: bold;
    font-size: 14px;
}

/* ============================================== */
/* ğŸ’£ MINES TREMBLE ANIMATION */
/* ============================================== */

@keyframes mine-tremble {
    /* 0% áŠ¥áŠ“ 100% áˆ‹á‹­ áˆ˜áˆ¨áŒ‹áŒ‹á‰µ */
    0%, 100% {
        transform: translate(0, 0) rotate(0deg) scale(1);
    }
    /* á‰µáŠ•áˆ½ áˆ˜áŠ•á‰€áŒ¥á‰€áŒ¥ (Shifting and Rotating) */
    10% {
        transform: translate(-1px, -1px) rotate(-1deg) scale(1.03);
    }
    20% {
        transform: translate(1px, 1px) rotate(1deg) scale(1);
    }
    30% {
        transform: translate(-1px, 1px) rotate(-1deg) scale(1.03);
    }
    40% {
        transform: translate(1px, -1px) rotate(1deg) scale(1);
    }
    /* áŠ áŠ’áˆœáˆ½áŠ‘áŠ• á‹¨áˆšá‰†áŒ£áŒ áˆ­ áŠ­áˆ‹áˆµ */
    60% {
        /* á‹¨ááŠ•á‹³á‰³ áŒ¥áˆ‹ áˆˆáˆ˜áˆµáŒ á‰µ */
        filter: drop-shadow(0 0 5px rgba(255, 69, 0, 0.8)); 
    }
}

.icon-mine-tremble {
    /* áŠ áŠ’áˆœáˆ½áŠ‘ áˆˆ 3 áˆ°áŠ¨áŠ•á‹µ á‹­á‰†á‹«áˆ áŠ¥áŠ“ á‹«áˆˆáˆ›á‰‹áˆ¨áŒ¥ á‹­á‹°áŒáˆ›áˆ */
    animation: mine-tremble 3s ease-in-out infinite; 
    display: inline-block; /* 'transform' áŠ¥áŠ•á‹²áˆ°áˆ« áŠ áˆµáˆáˆ‹áŒŠ áŠá‹ */
}

/* ==============================================================
   === ğŸ“¢ 3D AD CAROUSEL STYLES (áŠ á‹²áˆµ á‹¨á‰°áŒ¨áˆ˜áˆ¨) ===
   ============================================================== */
.ad-carousel-container {
    position: relative;
    width: 100%;
    max-width: 100%;
    overflow: hidden; /* áŠ¨áˆ³áŒ¥áŠ‘ á‹¨á‹ˆáŒ£á‹áŠ• á‹­á‰†áˆ­áŒ£áˆ */
    border-radius: 15px;
    margin-bottom: 25px;
    /* 3D Effect Base */
    perspective: 1000px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
    border: 1px solid #333;
}

.ad-track {
    display: flex;
    transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1); /* áˆˆáˆµáˆˆáˆµ á‹«áˆˆ áŠ•á‰…áŠ“á‰„ */
    width: 100%;
}

.ad-slide {
    min-width: 100%;
    box-sizing: border-box;
    position: relative;
    padding: 5px;
}

/* á‹¨áŠ«áˆ­á‹± á‹²á‹›á‹­áŠ• */
.ad-card-3d {
    position: relative;
    height: 110px; /* á‰áˆ˜á‰µ */
    border-radius: 12px;
    overflow: hidden;
    text-decoration: none;
    display: block;
    background-size: cover;
    background-position: center;
    /* 3D Pop Effect */
    transform: scale(0.98);
    transition: transform 0.3s;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.8); 
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Active Slide á‰µáŠ•áˆ½ áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­ */
.ad-slide.active .ad-card-3d {
    transform: scale(1);
    border-color: var(--et-yellow);
}

/* áŒ½áˆá áˆ›áˆ³á‹« (Gradient Overlay) */
.ad-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 10%, rgba(0,0,0,0.3) 50%, transparent 100%);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 15px;
    box-sizing: border-box;
}

.ad-title {
    color: #fff;
    font-size: 16px;
    font-weight: 800;
    margin-bottom: 5px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
}

.ad-btn {
    background-color: var(--et-yellow);
    color: #000;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    align-self: flex-start;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

/* á‹¨á‰³á‰½áŠ›á‹ áŠáŒ á‰¥áŒ£á‰¦á‰½ (Dots Indicator) */
.ad-dots {
    position: absolute;
    bottom: 10px;
    right: 15px;
    display: flex;
    gap: 5px;
    z-index: 10;
}

.ad-dot {
    width: 8px;
    height: 8px;
    background-color: rgba(255,255,255,0.4);
    border-radius: 50%;
    transition: all 0.3s;
}

.ad-dot.active {
    background-color: var(--et-yellow);
    width: 20px; /* Active áˆ²áˆ†áŠ• á‹­áˆ¨á‹áˆ›áˆ */
    border-radius: 10px;
}

/* ============================================== */
/* ğŸ›‘ áŠ­ááˆ 1: á‹¨á‹‹áŠ“á‹ áŠ®áŠ•á‰´á‹­áŠáˆ­ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (áŠ áˆµáˆáˆ‹áŒŠ) */
/* ============================================== */

/* áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• á‹¨á‹«á‹˜á‹ á‹‹áŠ“á‹ áˆ˜á‹«á‹£ (á‹­áˆ…áŠ•áŠ• áŠ¨áˆŒáˆ‹ á‰¦á‰³ áˆ›áŠ¨áˆ áˆŠá‹«áˆµáˆáˆáŒá‹ á‹­á‰½áˆ‹áˆ) */
#self-ad-banner-container {
    /* ğŸ›‘ á‹­áˆ… áˆ˜áˆµáˆ˜áˆ­ á‹ˆáˆ³áŠ áŠá‹! 
       á‹¨ Skip áŠ á‹áˆ«áˆ©áŠ• áŠ á‰€áˆ›áˆ˜áŒ¥ áŠ¨á‹šáˆ… áŠ®áŠ•á‰´á‹­áŠáˆ­ áŒ‹áˆ­ á‹«á‹«á‹­á‹˜á‹‹áˆ (Anchor) */
    position: relative; 
    /* á‰áˆ˜á‰± áŠ¥áŠ“ áˆµá‹á‰± (Height and Width) áˆŠáŠ–áˆ­ á‹­áŒˆá‰£áˆ */
    /* overflow: hidden; áˆˆáŒ¥áˆ© áŠ¥á‹­á‰³ áˆ˜áŒ¨áˆ˜áˆ­ áŒ¥áˆ© áŠá‹ */
}

/* ============================================== */
/* ğŸ›‘ áŠ­ááˆ 2: á‹¨ Skip áŠ á‹áˆ«áˆ­ áˆµá‰³á‹­áˆ (á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ) */
/* ============================================== */

.skip-ad-btn {
    /* áŠ¨áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ á‰ áˆ‹á‹­ áŠ¥áŠ•á‹²á‰€áˆ˜áŒ¥ */
    position: absolute; 
    /* á‰ áˆ‹á‹­áŠ›á‹ á‰€áŠ áŒ¥áŒ áˆ‹á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• */
    top: 10px;
    right: 10px;
    
    padding: 8px 12px;
    background-color: rgba(0, 0, 0, 0.7); /* á‰µáŠ•áˆ½ áŒ¥á‰áˆ­ áŒáˆáŒ½áŠá‰µ áŒ¨áˆáˆ¯áˆ */
    color: white;
    /* á‹µáŠ•á‰ áˆ­ */
    border: none; /* á‹µáŠ•á‰ áˆ©áŠ• áŠ áŒ¥áá‰°áŠ• á‰µáŠ•áˆ½ áˆˆá‹¨á‰µ áŠ¥áŠ“á‹µáˆ­áŒˆá‹ */
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    /* ğŸ›‘ Z-IndexáŠ• á‹ˆá‹° áŠ¨áá‰°áŠ›á‹ áŠ á‹µáˆ­áŒˆáŠ“áˆ (áŠ¨áˆáˆ‰áˆ áŠáŒˆáˆ­ á‰ áˆ‹á‹­ áŠ¥áŠ•á‹²á‰³á‹­) */
    z-index: 9999; 
    transition: background-color 0.3s, opacity 0.3s, transform 0.3s;
    /* á‹¨áŠ«áˆ­á‹± 3D Effect áŠ¥áŠ•á‹³á‹­áŠáŠ«á‹ */
    transform: translateZ(0); 
}

/* áŠ á‹áˆ«áˆ© Disabled áˆ²áˆ†áŠ• (áŒŠá‹œá‹ áˆ³á‹­á‹°áˆ­áˆµ) */
.skip-ad-btn:disabled {
    cursor: not-allowed;
    opacity: 0.8; /* á‰µáŠ•áˆ½ á‹°á‰¥á‹˜á‹ áŠ¥áŠ•á‹²áˆ */
    background-color: rgba(0, 0, 0, 0.4);
    /* á‹¨áŒ½áˆá‰áŠ• á‰€áˆˆáˆ á‹°á‰¥á‹á‹ */
    color: #ccc;
    pointer-events: none; /* áŠ¥áŠ•á‹³á‹­áŒ«áŠ• áˆ™áˆ‰ á‰ áˆ™áˆ‰ áˆ˜áŠ¨áˆáŠ¨áˆ */
}

/* áŠ á‹áˆ«áˆ© Click áˆˆáˆ›á‹µáˆ¨áŒ áˆ²á‹˜áŒ‹áŒ… */
.skip-ad-btn:not(:disabled) {
    pointer-events: auto; /* áˆˆáˆ˜áŒ«áŠ• áˆ˜áá‰€á‹µ */
}

/* Hover Effect */
.skip-ad-btn:not(:disabled):hover {
    background-color: rgba(255, 0, 0, 0.8); /* áˆ²áŠáŠ« á‰€á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• (áŠ áˆµáˆáˆ‹áŒŠ áŠ á‹áˆ«áˆ­ áˆ˜áˆ†áŠ‘áŠ• áˆˆáˆ›áˆ³á‹¨á‰µ) */
    transform: scale(1.05);
}
/* áˆˆ Tasks Page áˆ›áˆµá‰³á‹ˆá‰‚á‹« áŠ®áŠ•á‰´á‹­áŠáˆ­ */
#tasks-ad-container {
    position: relative; /* ğŸ›‘ á‹­áˆ… á‰ áŒ£áˆ á‹ˆáˆ³áŠ áŠá‹! */
    width: 100%;
    min-height: 150px; /* áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ áŠ¥áˆµáŠªáŒ«áŠ• á‰¦á‰³ áŠ¥áŠ•á‹²á‹­á‹ */
    margin-bottom: 1px;
    border-radius: 15px;
    z-index: 10; /* áŠ¨áˆŒáˆá‰½ áŠáŒˆáˆ®á‰½ á‰ áˆ‹á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• */
}

/* áˆˆ Staking Page áˆ›áˆµá‰³á‹ˆá‰‚á‹« áŠ®áŠ•á‰´á‹­áŠáˆ­ (áŠ¥áŠ•á‹³áˆˆ áˆˆáˆ›áˆ¨áŒ‹áŒˆáŒ¥) */
#self-ad-banner-container {
    position: relative; /* ğŸ›‘ á‹­áˆ… áŠ«áˆá‰°áŒ¨áˆ˜áˆ¨ áŠ á‹áˆ«áˆ© á‹­áŒ á‹áˆ */
    width: 100%;
    min-height: 150px;
    margin-bottom: 0px;
    border-radius: 15px;
}



/* 2. á‹¨áŒ½áˆá‰ áŠ á‰€áˆ›áˆ˜áŒ¥ */
#loading-text {
    display: flex; /* áŒ½áˆá‰áŠ“ áŠáŒ á‰¥áŒ£á‰¦á‰¹ áŒáŠ• áˆˆáŒáŠ• áŠ¥áŠ•á‹²áˆ†áŠ‘ */
    justify-content: center;
    align-items: center;
    color: #FFC107;
    font-size: 1.1em;
    font-weight: bold;
    text-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
    margin-top: 15px;
}

/* 3. áŠáŒ á‰¥áŒ£á‰¦á‰¹ (Dots) áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆ± á‹¨áˆšá‹«á‹°áˆ­áŒ */
.dots-container::after {
    content: '';
    display: inline-block;
    width: 20px; /* áŠáŒ¥á‰¦á‰¹ áˆ²áˆ˜áŒ¡ áŒ½áˆá‰ áŠ¥áŠ•á‹³á‹­áŠá‰ƒáŠá‰… */
    text-align: left;
    animation: loading-dots 1.5s infinite;
}

@keyframes loading-dots {
    0% { content: ''; }
    33% { content: '.'; }
    66% { content: '..'; }
    100% { content: '...'; }
}
/* P2P Tabs */
.p2p-tabs {
    display: flex;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 20px;
}
.p2p-tab {
    flex: 1;
    text-align: center;
    padding: 10px;
    cursor: pointer;
    border-radius: 8px;
    color: #888;
    transition: all 0.3s;
    font-weight: bold;
}
.p2p-tab.active {
    background: var(--et-yellow);
    color: black;
    box-shadow: 0 4px 10px rgba(255, 215, 0, 0.3);
}

/* Toggle Buttons */
.toggle-search-type {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}
.toggle-btn {
    flex: 1;
    background: #333;
    border: 1px solid #444;
    color: #fff;
    padding: 8px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
}
.toggle-btn.active {
    background: var(--et-blue);
    border-color: var(--et-blue);
}

/* Recipient Card */
.recipient-card {
    display: flex;
    align-items: center;
    gap: 15px;
    background: linear-gradient(145deg, #1a1a1a, #252525);
    padding: 15px;
    border-radius: 12px;
    border: 1px solid var(--et-green);
    margin-top: 15px;
    animation: fadeIn 0.5s ease;
}
.recipient-avatar {
    width: 50px;
    height: 50px;
    background: #444;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    overflow: hidden;
}
.recipient-info p { margin: 0; }
.recipient-name { font-weight: bold; color: white; font-size: 16px; }
.recipient-status { font-size: 12px; color: var(--et-green); }

.verify-btn {
    width: 100%;
    background: #333;
    color: var(--et-yellow);
    border: 1px dashed var(--et-yellow);
    padding: 10px;
    border-radius: 8px;
    margin-top: 5px;
    cursor: pointer;
}
.fee-text { font-size: 12px; color: #888; margin-top: 5px; text-align: right; }

/* Custom Modal */
.custom-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); z-index: 10000;
    display: flex; justify-content: center; align-items: center;
}
.modal-content {
    background: #1e1e1e; padding: 20px; border-radius: 15px;
    width: 85%; max-width: 350px; text-align: center;
    border: 1px solid var(--et-yellow);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
}
.summary-box {
    background: #2a2a2a; padding: 15px; border-radius: 10px;
    margin: 15px 0; text-align: left;
}
.summary-box p { display: flex; justify-content: space-between; margin: 8px 0; font-size: 14px; }
.modal-actions { display: flex; gap: 10px; margin-top: 15px; }
.confirm-btn { flex: 1; background: var(--et-green); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; }
.cancel-btn { flex: 1; background: #d32f2f; color: white; border: none; padding: 12px; border-radius: 8px; }
/* ================= P2P MODERN STYLING ================= */

/* 1. Main Container & Balance */
.p2p-balance-card {
    background: linear-gradient(135deg, #1e1e1e 0%, #252525 100%);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.p2p-balance-card p {
    color: #aaa;
    margin: 0;
    font-size: 14px;
}

.p2p-balance-card h1 {
    color: var(--et-yellow, #FFD700);
    margin: 5px 0 0;
    font-size: 32px;
    font-weight: 800;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

/* 2. Tabs */
.p2p-tabs {
    display: flex;
    background: #111;
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 20px;
    border: 1px solid #333;
}

.p2p-tab {
    flex: 1;
    text-align: center;
    padding: 10px;
    cursor: pointer;
    border-radius: 8px;
    color: #666;
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 14px;
}

.p2p-tab.active {
    background: var(--et-yellow, #FFD700);
    color: #000;
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2);
}

/* 3. Inputs (áˆ›áˆµá‰°áŠ«áŠ¨á‹« á‹¨á‰°á‹°áˆ¨áŒˆá‰ á‰µ áŠ­ááˆ) */
.input-group {
    margin-bottom: 20px;
    text-align: left;
}

.input-label {
    display: block;
    color: #ddd;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 500;
}

.modern-input {
    width: 100%;
    background-color: #2a2a2a !important; /* áŒáˆáŒ½ á‹¨áˆ†áŠ background */
    color: #ffffff !important; /* áŠáŒ­ áŒ½áˆá */
    border: 1px solid #444;
    padding: 14px;
    border-radius: 12px;
    font-size: 16px;
    outline: none;
    transition: 0.3s;
    box-sizing: border-box; /* áˆ³áŒ¥áŠ‘ áŠ¥áŠ•á‹³á‹­áˆáˆµ */
}

.modern-input:focus {
    border-color: var(--et-yellow, #FFD700);
    background-color: #333 !important;
    box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1);
}

/* Placeholder color */
.modern-input::placeholder {
    color: #666;
}

/* 4. Buttons */
.toggle-search-type {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.toggle-btn {
    flex: 1;
    background: #222;
    border: 1px solid #444;
    color: #888;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    transition: 0.3s;
}

.toggle-btn.active {
    background: rgba(33, 150, 243, 0.2);
    border-color: #2196F3;
    color: #2196F3;
    font-weight: bold;
}

.verify-btn {
    width: 100%;
    background: #333;
    color: var(--et-yellow, #FFD700);
    border: 1px dashed var(--et-yellow, #FFD700);
    padding: 12px;
    border-radius: 10px;
    margin-top: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s;
}
.verify-btn:hover {
    background: rgba(255, 215, 0, 0.1);
}

.modern-exchange-btn {
    width: 100%;
    background: linear-gradient(180deg, var(--et-yellow, #FFD700) 0%, #FFC107 100%);
    color: #000;
    border: none;
    padding: 16px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
    box-shadow: 0 4px 0 #b38f00; /* 3D effect */
    transition: transform 0.1s;
}

.modern-exchange-btn:active {
    transform: translateY(4px);
    box-shadow: none;
}

.modern-exchange-btn:disabled, .disabled-btn {
    background: #444;
    color: #888;
    box-shadow: none;
    cursor: not-allowed;
}

/* 5. Recipient Card */
.recipient-card {
    display: flex;
    align-items: center;
    gap: 15px;
    background: #1e1e1e;
    padding: 15px;
    border-radius: 12px;
    border: 1px solid var(--et-green, #4CAF50);
    margin-top: 15px;
    animation: fadeIn 0.4s ease;
}

.recipient-avatar {
    width: 45px;
    height: 45px;
    background: #333;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    border: 2px solid var(--et-green, #4CAF50);
}

    #p2p-amount-input {
    margin-bottom: 5px;
}
.fee-preview-text {
    font-weight: bold;
    animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Loading Overlay Styling */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85); /* á‹³áˆ«á‹áŠ• áŠ¥áŠ•á‹²á‹«áŒ¨áˆáˆ */
    z-index: 20000;
    display: none; /* áˆ˜áŒ€áˆ˜áˆªá‹« áŠ¥áŠ•á‹³á‹­á‰³á‹­ */
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255, 215, 0, 0.1);
    border-left-color: #FFD700; /* á‰¢áŒ« áŠ¨áˆˆáˆ­ */
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-text {
    color: white;
    margin-top: 15px;
    font-size: 16px;
    font-weight: bold;
}

/* âœ… Verified Badge */
.verified-badge {
    color: #00bcd4; /* áˆ°áˆ›á‹«á‹Š á‰€áˆˆáˆ */
    font-size: 14px;
    margin-left: 5px;
    vertical-align: middle;
}

/* âœ… Avatar Borders (Gamification) */
.avatar-bronze { border: 2px solid #cd7f32; box-shadow: 0 0 5px #cd7f32; }
.avatar-silver { border: 2px solid #c0c0c0; box-shadow: 0 0 8px #c0c0c0; }
.avatar-gold { border: 3px solid #ffd700; box-shadow: 0 0 12px #ffd700; animation: pulseGold 2s infinite; }

@keyframes pulseGold {
    0% { box-shadow: 0 0 5px #ffd700; }
    50% { box-shadow: 0 0 15px #ffd700; }
    100% { box-shadow: 0 0 5px #ffd700; }
}

/* âœ… Receipt Modal Style */
.receipt-paper {
    background: #fff;
    color: #000;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 320px;
    font-family: 'Courier New', monospace;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    background-image: radial-gradient(#ddd 1px, transparent 0);
    background-size: 10px 10px;
}
.receipt-header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 15px; }
.receipt-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;}
.receipt-total { border-top: 2px dashed #000; padding-top: 10px; margin-top: 10px; font-size: 16px; font-weight: 800; }
.receipt-stamp {
    position: absolute; right: 20px; bottom: 60px; 
    border: 3px solid #28a745; color: #28a745; 
    padding: 5px 10px; font-weight: bold; transform: rotate(-15deg);
    font-size: 18px; opacity: 0.8;
}

/* =========================================
   1. LAUNCH AD OVERLAY STYLES (POP-UP) 
   ========================================= */

#launch-ad-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.0); /* áŒ á‰†áˆ­ á‹«áˆˆ á‹­áˆáŠ• */
    backdrop-filter: blur(0.1px);
    z-index: 99999; /* áŠ¨áˆáˆ‰áˆ á‰ áˆ‹á‹­ */
    
    display: none; /* JS á‹ˆá‹° flex á‹­á‰€á‹­áˆ¨á‹‹áˆ */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
}

/* áŠ¥á‹šáˆ… áŒ‹áˆ­ áˆµáˆ™áŠ• á‰€á‹­áˆ¨áŠá‹‹áˆ: .ad-card-3d -> .launch-card */
.launch-card {
    position: relative;
    width: 90%; 
    max-width: 340px; /* áˆµáŠ­áˆªáŠ‘áŠ• áŠ¥áŠ•á‹³á‹­áˆáˆ‹ */
    background: #1e1e1e;
    border-radius: 20px;
    padding: 0; /* Padding á‹áˆµáŒ¡ áˆ‹áˆ‰á‰µ áŠ¥áŠ•áˆ°áŒ£áˆˆáŠ• */
    border: 1.5px solid #ffc107; 
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 10px rgba(255, 193, 7, 0.2);
    
    
    
    text-align: center;
    overflow: hidden; /* áŠ­á‰¡ áŒ áˆ­á‹ áŠ¥áŠ•á‹³á‹­á‰ áˆ‹áˆ½ */
    animation: popUpBounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    display: flex;
    flex-direction: column;
}

/* áŠ áŠ’áˆœáˆ½áŠ• */
@keyframes popUpBounce {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

/* á‹¨áˆáˆµáˆ áˆ³áŒ¥áŠ• */
.launch-img-container {
    width: 100%;
    height: 160px; /* á‰áˆ˜á‰± áŠ¥áŠ•á‹³á‹­á‰ á‹› */
    position: relative;
    background-color: #333;
}

#launch-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* áˆáˆµáˆ‰ áŠ¥áŠ•á‹³á‹­áˆˆáŒ áŒ¥ */
    display: block;
}

.launch-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #ffc107;
    color: #000;
    font-size: 10px;
    font-weight: 900;
    padding: 4px 8px;
    border-radius: 4px;
    z-index: 2;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

/* áŒ½áˆá áŠ¥áŠ“ áŠ á‹áˆ«áˆ­ */
.launch-content {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.launch-content h3 {
    margin: 0;
    color: #fff;
    font-size: 20px;
}

.launch-content p {
    margin: 0;
    color: #aaa;
    font-size: 14px;
    line-height: 1.4;
}

.launch-cta-btn {
    margin-top: 10px;
    background: linear-gradient(90deg, #007bff, #0056b3);
    color: white;
    padding: 14px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
    transition: transform 0.2s;
}

.launch-cta-btn:active {
    transform: scale(0.95);
}

/* á‹¨áˆ˜á‹áŒŠá‹« áŠ­á‰ á‰¥ áŠ¥áŠ“ á‰áˆá */
.launch-close-area {
    margin-top: 25px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    cursor: pointer;
}

.progress-ring {
    position: relative;
    width: 50px;
    height: 50px;
}

.progress-ring svg {
    width: 50px;
    height: 50px;
    transform: rotate(-90deg);
}

.progress-ring circle {
    fill: transparent;
    stroke: #444;
    stroke-width: 3;
}

#launch-timer-circle {
    stroke: #fff;
    stroke-dasharray: 138;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 4s linear;
}

.launch-close-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: none;
    border: none;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
}

.close-text {
    color: #888;
    font-size: 12px;
    margin-top: 5px;
}

/* 1. á‹¨áŠ¨áˆˆáˆ­ á‰°áˆˆá‹‹á‹‹áŒ®á‰½ (Variables) */
:root {
    --bg-dark: #0f0f0f;
    --card-bg: #1e1e1e;
    --et-yellow: #ffca28;
    --et-green: #00e676;
    --et-blue: #2196F3;
    --et-purple: #9c27b0;
    --et-orange: #ff9800;
    --et-red: #f44336;
}

/* 2. á‹¨áŠ«áˆ­á‹¶á‰¹ áˆ˜á‹«á‹£ (Grid Container) */
.games-grid-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 10px;
    width: 100%;
    box-sizing: border-box;
}

/* 3. á‹¨áŠ«áˆ­á‹± áˆµá‰³á‹­áˆ (3D Card Effect) */
.game-card-3d {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(145deg, #2b2b2b, #1a1a1a);
    border-radius: 18px;
    padding: 15px 5px;
    min-height: 120px;
    box-shadow: 5px 5px 10px #080808, -2px -2px 6px #3d3d3d;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.2s ease;
    cursor: pointer;
    text-align: center;
}

.game-card-3d:active {
    transform: scale(0.95);
    box-shadow: inset 3px 3px 5px #0f0f0f;
}

/* 4. á‹¨áŠ á‹­áŠ®áŠ• á‹³áˆ« á‰€áˆˆáˆá‰½ (áŠ áŠ•á‰° HTML áˆ‹á‹­ á‹¨áŒ á‰€áˆµáŠ«á‰¸á‹) */
.game-card-icon {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    margin-bottom: 8px;
    box-shadow: inset 2px 2px 5px rgba(0,0,0,0.3);
}

.icon-bg-blue { background-color: rgba(33, 150, 243, 0.2); border: 1px solid var(--et-blue); }
.icon-bg-purple { background-color: rgba(156, 39, 176, 0.2); border: 1px solid var(--et-purple); }
.icon-bg-orange { background-color: rgba(255, 152, 0, 0.2); border: 1px solid var(--et-orange); }
.icon-bg-red { background-color: rgba(244, 67, 54, 0.2); border: 1px solid var(--et-red); }
.icon-bg-green { background-color: rgba(0, 230, 118, 0.2); border: 1px solid var(--et-green); }
.icon-bg-dark { background-color: rgba(0, 0, 0, 0.4); border: 1px solid #444; }

/* 5. á‹¨áŒ½áˆá áˆµá‰³á‹­áˆá‰½ */
.game-card-title {
    font-size: 11px;
    font-weight: bold;
    color: #e0e0e0;
    margin-bottom: 4px;
}

.game-card-reward {
    font-size: 10px;
    color: var(--et-yellow);
    background: rgba(255, 202, 40, 0.1);
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: bold;
}

/* 6. á‹¨áˆšá‰ áˆ«á‹ áŠ áˆ¨áŠ•áŒ“á‹´ áŠáŒ¥á‰¥ (Status Dot) */
.card-badge-dot {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background-color: #444; /* á‹áŒ áˆ²áˆ†áŠ• */
}

.card-badge-dot.ready {
    background-color: var(--et-green);
    box-shadow: 0 0 8px var(--et-green);
    animation: blink 1.5s infinite;
}

@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.4; }
    100% { opacity: 1; }
}
/* á‹¨áŠ«áˆ­á‹¶á‰¹ á‹¨áŒ‹áˆ« áŒˆáŒ½á‰³ */
.game-card-3d {
    border: none !important;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3) !important;
    transition: transform 0.2s ease;
}

/* 1. áˆ°áˆ›á‹«á‹Š */
.card-blue { background: linear-gradient(180deg, #1e88e5, #0d47a1) !important; }
/* 2. á‹ˆá‹­áŠ•áŒ áŒ… */
.card-purple { background: linear-gradient(180deg, #8e24aa, #4a148c) !important; }
/* 3. á‹ˆáˆ­á‰ƒáˆ›/á‰¢áŒ« */
.card-gold { background: linear-gradient(180deg, #fbc02d, #f57f17) !important; }
/* 4. á‰€á‹­ */
.card-red { background: linear-gradient(180deg, #e53935, #b71c1c) !important; }
/* 5. áˆˆáˆµáˆ‹áˆ³ áˆ°áˆ›á‹«á‹Š */
.card-cyan { background: linear-gradient(180deg, #00acc1, #006064) !important; }
/* 6. áŒ¥á‰áˆ­ */
.card-dark { background: linear-gradient(180deg, #424242, #212121) !important; }
/* 7. áŠ áˆ¨áŠ•áŒ“á‹´ */
.card-green { background: linear-gradient(180deg, #43a047, #1b5e20) !important; }
/* 8. á‹°áˆ›á‰… á‹ˆá‹­áŠ•áŒ áŒ… */
.card-magenta { background: linear-gradient(180deg, #d81b60, #880e4f) !important; }
/* 9. á‰¥áˆ­á‰±áŠ«áŠ“áˆ› */
.card-orange { background: linear-gradient(180deg, #fb8c00, #e65100) !important; }

/* áŒ½áˆáá‰¹ áŠáŒ­ áˆ†áŠá‹ áŠ¥áŠ•á‹²áŒáˆ‰ */
.game-card-title {
    color: white !important;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
}

/* á‹¨áˆ½áˆáˆ›á‰µ áˆ³áŒ¥áŠ‘ (Badge) á‰ áŠ«áˆ­á‹± á‹áˆµáŒ¥ */
.game-card-reward {
    background: rgba(0, 0, 0, 0.25) !important;
    color: #fff !important;
    font-weight: bold;
    border: none !important;
}

/* áŠ á‹­áŠ®áŠ• áŠ­á‰¥ á‹³áˆ« */
.game-card-icon {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 50%;
    width: 50px;
    height: 50px;
}


/* áˆˆáˆµáˆ™ áŠ¥áŠ“ áˆˆá‰£áŒ áˆ˜á‹«á‹£ */
.name-wrapper {
    display: flex;
    align-items: center;
    gap: 4px; /* á‰ áˆµáˆ™ áŠ¥áŠ“ á‰ á‰£áŒ áˆ˜áŠ«áŠ¨áˆ áŠ­áá‰°á‰µ */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* áŠ¦áŠáˆ´áˆ‹á‹Šá‹ á‹¨á‰¬áˆªá‹á‹­á‹µ áˆáˆáŠ­á‰µ */
.verified-badge-icon {
    width: 16px;
    height: 16px;
    min-width: 16px; /* áŠ¥áŠ•á‹³á‹­áŒ¨áˆ˜á‰… */
    vertical-align: middle;
}
/* á‹¨Verified áˆáˆáŠ­á‰µ áŠ áŠ’áˆœáˆ½áŠ• */
@keyframes badge-pulse {
    0% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(41, 182, 246, 0)); }
    50% { transform: scale(1.15); filter: drop-shadow(0 0 4px rgba(41, 182, 246, 0.6)); }
    100% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(41, 182, 246, 0)); }
}

.verified-animated {
    animation: badge-pulse 2s infinite ease-in-out;
    transform-origin: center; /* áŠ áŠ’áˆœáˆ½áŠ‘ áŠ¨áˆ˜áˆƒáˆ áŠ¥áŠ•á‹²áŠáˆ³ */
    display: inline-block;
}

<div id="global-p2p-ticker" style="
    background: #111; 
    border-top: 1px solid #333; 
    border-bottom: 1px solid #333; 
    height: 30px; 
    overflow: hidden; 
    margin-bottom: 15px; 
    font-size: 12px; 
    white-space: nowrap; 
    position: relative;">
    </div>

    /* á‰²áŠ¨áˆ© áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ (Marquee Effect) */
    .ticker-scroll {
        display: inline-block;
        padding-left: 100%;
        animation: ticker-move 15s linear infinite;
    }
    .ticker-item {
        display: inline-block;
        margin-right: 40px;
        color: #ccc;
    }
    @keyframes ticker-move {
        0% { transform: translate3d(0, 0, 0); }
        100% { transform: translate3d(-100%, 0, 0); }
    }

/* === P2P MARKET STYLES === */
.market-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.market-filter-btn {
    background: #2a2a2a;
    border: 1px solid #444;
    color: #888;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: 0.3s;
}
.market-filter-btn.active {
    background: white;
    color: black;
    font-weight: bold;
}

.create-ad-btn {
    background: transparent;
    color: var(--et-yellow);
    border: 1px solid var(--et-yellow);
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
}

/* Offer Card */
.offer-card {
    display: flex;
    flex-direction: column;
    background: linear-gradient(145deg, #1e1e1e, #252525);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 12px;
    width: 100%;
    box-sizing: border-box;
    border-left: 4px solid #4CAF50;
    position: relative;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}


.offer-card.sell-type {
    border-left-color: #F44336; /* Red for Sell */
}

.offer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 10px;
}

.trader-name {
    font-weight: bold;
    color: white;
    display: flex;
    align-items: center;
    gap: 5px;
}
.chat-meta {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    margin-bottom: 3px;
    opacity: 0.8;
}

.chat-bubble.mine .chat-meta {
    color: #e0f7fa; /* á‹¨áˆ‹áŠªá‹ áˆµáˆ á‰€áˆˆáˆ (áˆˆáŠ”) */
}

.chat-bubble.theirs .chat-meta {
    color: #ffd700; /* á‹¨áˆŒáˆ‹áŠ›á‹ áˆ°á‹ áˆµáˆ á‰€áˆˆáˆ */
}

.price-tag {
    font-size: 18px;
    font-weight: 800;
    color: white;
}
.price-currency { font-size: 12px; color: #888; }

.offer-limits {
    font-size: 12px;
    color: #aaa;
    margin-bottom: 10px;
}

.offer-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #333;
    padding-top: 10px;
}

.payment-methods {
    display: flex;
    gap: 5px;
}
.pm-badge {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    background: #333;
    color: #ddd;
}
.pm-telebirr { border-left: 2px solid #00A3FF; }
.pm-cbe { border-left: 2px solid #800080; }

.trade-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 6px 16px;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
}
.sell-type .trade-btn { background: #F44336; }

/* Floating Fab for Create Ad (Optional) */
.fab-create {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: var(--et-yellow);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    z-index: 100;
    color: black;
}
.status-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
}
.status-badge.pending { background: #FFA500; color: black; }
.status-badge.paid { background: #00A3FF; color: white; }
.status-badge.completed { background: #4CAF50; color: white; }
.status-badge.cancelled { background: #555; color: #aaa; }
.status-badge.dispute { background: #F44336; color: white; }

#p2p-trade-room {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100vh;
    background: #000;
    z-index: 200;
    padding: 20px;
    overflow-y: auto;
    padding-bottom: 120px; /* Space for bottom buttons */
}

.star-rating span:hover {
    transform: scale(1.2);
    color: #FFD700;
}
/* === CHAT STYLES === */
.chat-container {
    background: #111;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    min-height: 250px; /* á‰‹áˆš 350px áŠ¨áˆ›á‹µáˆ¨áŒ á‹­áˆ„ á‹­áˆ»áˆ‹áˆ */
    max-height: 400px;
    border: 1px solid #333;
    margin-bottom: 120px; /* á‹¨á‰³á‰½áŠ›á‹ áŠ á‹áˆ«áˆ®á‰½ áŠ¥áŠ•á‹³á‹­áˆ¸ááŠ‘á‰µ */
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.chat-bubble {
    max-width: 80%;
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 13px;
    line-height: 1.4;
    word-wrap: break-word;
}

.chat-bubble.mine {
    background: #0088cc; /* Telegram Blue */
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 2px;
}

.chat-bubble.theirs {
    background: #333;
    color: #ddd;
    align-self: flex-start;
    border-bottom-left-radius: 2px;
}

.chat-time {
    font-size: 9px;
    opacity: 0.7;
    margin-top: 4px;
    text-align: right;
    display: block;
}

.chat-input-area {
    display: flex;
    padding: 10px;
    border-top: 1px solid #333;
    background: #222;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
}

.chat-input {
    flex: 1;
    background: #111;
    border: 1px solid #444;
    color: white;
    padding: 8px;
    border-radius: 20px;
    outline: none;
    font-size: 13px;
}

.chat-send-btn {
    background: var(--et-yellow);
    color: black;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    margin-left: 8px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.chat-container {
    background: #111;
    border-radius: 10px;
    height: 300px;
    display: flex;
    flex-direction: column;
    margin-top: 15px;
    border: 1px solid #333;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.chat-bubble {
    max-width: 80%;
    padding: 8px 12px;
    border-radius: 15px;
    font-size: 14px;
    position: relative;
    word-wrap: break-word;
}

.chat-bubble.mine {
    align-self: flex-end;
    background: #00A3FF;
    color: white;
    border-bottom-right-radius: 2px;
}

.chat-bubble.theirs {
    align-self: flex-start;
    background: #333;
    color: #eee;
    border-bottom-left-radius: 2px;
}

.chat-time {
    font-size: 9px;
    display: block;
    margin-top: 4px;
    opacity: 0.7;
    text-align: right;
}

.chat-input-area {
    display: flex;
    padding: 10px;
    background: #1a1a1a;
    border-top: 1px solid #333;
    gap: 8px;
}

.chat-input {
    flex: 1;
    background: #222;
    border: 1px solid #444;
    color: white;
    padding: 8px;
    border-radius: 5px;
}

.chat-send-btn {
    background: #00A3FF;
    border: none;
    color: white;
    padding: 0 15px;
    border-radius: 5px;
    cursor: pointer;
}




/* á‹¨á‹áŒªá‹ áŒ¥á‰áˆ­ áˆ˜áŒ‹áˆ¨áŒƒ (Overlay) */
#create-ad-modal.custom-modal {
    display: none; /* á‰  JS áŠá‹ á‹¨áˆšáŠ¨áˆá‰°á‹ */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 9999;
    align-items: center; /* áˆ˜áˆƒáˆ áˆ‹á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• */
    justify-content: center;
}

/* á‹¨á‹áˆµáŒ áŠ›á‹ áŠáŒ­/áŒ¥á‰áˆ­ áˆ³áŒ¥áŠ• (Content) */
#create-ad-modal .modal-content {
    background: #1a1a1a;
    width: 90%;
    max-width: 360px;
    padding: 15px;
    border-radius: 15px;
    border: 1px solid #333;
    
    /* á‹áˆ­áŒ¥áŒ¥ áŠ¥áŠ•á‹³á‹­áˆ á‹ˆáˆ³áŠ™ áŠ­ááˆ */
    display: block !important; /* Flex áŠ«áˆˆ á‹«áŒ á‹á‹‹áˆ */
    height: auto !important; /* á‰áˆ˜á‰± áŠ¥áŠ•á‹° á‹­á‹˜á‰± á‰¥á‰» */
    overflow: hidden; /* áˆ˜áŠ•áˆ¸áˆ«á‰°á‰µ á‹­áŠ¨áˆˆáŠ­áˆ‹áˆ */
}

/* á‰ á‹áˆµáŒ¡ á‹«áˆ‰ áŠáŒˆáˆ®á‰½ áŠ¥áŠ•á‹³á‹­áˆ«áˆ«á‰ */
#create-ad-modal h3 {
    margin: 0 0 15px 0;
    font-size: 18px;
}

#create-ad-modal .input-label {
    display: block;
    margin: 8px 0 4px 0;
    font-size: 13px;
    color: #aaa;
}

#create-ad-modal .modern-input {
    width: 100%;
    padding: 10px;
    background: #2a2a2a;
    border: 1px solid #444;
    border-radius: 8px;
    color: white;
    box-sizing: border-box; /* padding á‹ˆáŒª áŠ¥áŠ•á‹³á‹­áˆ†áŠ• */
}

/* áŠ á‹áˆ«áˆ®á‰¹ áŠ¨á‰³á‰½ á‰°áŒ£á‰¥á‰€á‹ áŠ¥áŠ•á‹²á‰€áˆ˜áŒ¡ */
#create-ad-modal .modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

#create-ad-modal .confirm-btn, 
#create-ad-modal .cancel-btn {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
}




</style>
<body>
<div id="loading-container">
    <img id="coin-image" class="coin-spinner" src="smart_airdrop_coin.png" alt="Coin Loading" />
    <div id="loading-text">
        <span data-lang="loading_text">SMART AIRDROP Loading</span><span class="dots-container"></span>
    </div>
</div>

<div id="game-loading-overlay">
    <div class="game-spinner"></div>
</div>

<div id="daily-reward-modal">
    <div class="reward-content">
        <button class="close-button" onclick="closeDailyRewardModal()">âœ•</button>
        <h2 data-lang="modal_reward_title">Daily Reward</h2>
        <p data-lang="modal_reward_desc">Get a daily bonus by logging into the game every day without skipping</p>

        <div class="reward-grid" id="reward-grid"></div>

        <button id="daily-reward-claim-button" disabled data-lang="btn_loading">Loading...</button>

    </div>
</div>

<div id="root">
    <div id="tasks-page" class="page" style="display: none; padding: 15px 0;">
        <h1 class="page-title" data-lang="title_daily_tasks">á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ</h1>

        <div class="score-card-display">
            <span data-lang="label_total_coin">áŒ á‰…áˆ‹áˆ‹ coin :</span> <span id="tasks-score-display" style="color: var(--et-yellow);">0 ğŸ’°</span>
        </div>

        <div class="invite-card-container">
            <div class="invite-card">
                <div class="header-section">
                    <div class="icon-circle">$</div>
                    <div class="text-content">
                        <p class="title" data-lang="invite_bonus_title">+500 Coin áˆµáŒ¦á‰³</p>
                        <p class="subtitle"></p>
                    </div>
                </div>
                <div class="button-row">
                    <a href="#" class="invite-button primary-button" id="telegramInviteLink" onclick="window.handleInviteClick(null, 500, 'last_invite_time')" data-lang="btn_invite">
                        áŒ“á‹°áŠ› áŒ‹á‰¥á‹
                    </a>
                    <button class="copy-button" title="á‰…á‹³" onclick="handleCopyInviteLink()">
                        <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="daily-tasks-container">
            <button class="task-button" style="background-color: var(--et-yellow);" onclick="window.showGameWithLoading('scratch-card-page');">
                SCRATCH ğŸ<span data-lang="task_scratch_desc">áŠ¥áˆˆá‰³á‹Š coin</span>
            </button>
            <button class="task-button" style="background-color: var(--et-purple);" onclick="window.showStreakWithLoading();">
                STREAK ğŸ”¥<span data-lang="task_streak_desc">á‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ</span>
            </button>
            <button class="task-button" style="background-color: var(--et-green);" onclick="window.showGameWithLoading('keno-game-page');">
                KENO GAME ğŸ²<span data-lang="task_keno_desc">Play & Win</span>
            </button>
            
            <div id="tasks-ad-container"></div>
            
            <div class="games-grid-container">
    <div class="game-card-3d card-blue" onclick="window.showAdsgramAd()">
        <div class="card-badge-dot ready"></div>
        <div class="game-card-icon"><span class="emoji-animate">ğŸ“º</span></div>
        <div class="game-card-title">Watch Ad</div>
        <div class="game-card-reward">+1000</div>
    </div>

    <div class="game-card-3d card-purple" id="daily-cipher-card" onclick="window.showGameWithLoading('daily-cipher-page')">
        <div class="card-badge-dot" id="daily-cipher-badge-dot"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-glow">ğŸ•µï¸</span></div>
        <div class="game-card-title" data-lang="card_cipher_title">Cipher</div>
        <div class="game-card-reward">+50K</div>
    </div>

    <div class="game-card-3d card-gold" id="memory-game-card" onclick="window.showGameWithLoading('memory-game-page')">
        <div class="card-badge-dot" id="memory-game-badge-dot"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-flip">ğŸƒ</span></div>
        <div class="game-card-title" data-lang="card_memory_title">Memory</div>
        <div class="game-card-reward">Play</div>
    </div>

    <div class="game-card-3d card-red" id="mystery-box-card" onclick="window.showGameWithLoading('mystery-box-page')">
        <div class="card-badge-dot" id="mystery-box-badge-dot"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-shake">ğŸ</span></div>
        <div class="game-card-title" data-lang="card_mystery_title">Mystery</div>
        <div class="game-card-reward">Random</div>
    </div>

    <div class="game-card-3d card-cyan" id="daily-spin-card" onclick="window.showGameWithLoading('daily-spin-page')">
        <div class="card-badge-dot" id="daily-spin-badge-dot"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-spin">ğŸ¡</span></div>
        <div class="game-card-title" data-lang="card_spin_title">Spin</div>
        <div class="game-card-reward">Win Big</div>
    </div>

    <div class="game-card-3d card-dark" onclick="window.showGameWithLoading('mines-game-page')">
        <div class="card-badge-dot ready"></div> 
        <div class="game-card-icon"><span class="icon-mine-tremble">ğŸ’£</span></div>
        <div class="game-card-title">Mines</div>
        <div class="game-card-reward">Bet</div>
    </div>

    <div class="game-card-3d card-green" id="reflex-game-card" onclick="window.showGameWithLoading('reflex-game-page')">
        <div class="card-badge-dot" id="reflex-game-badge-dot"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-pulse">âš¡</span></div>
        <div class="game-card-title" data-lang="card_reflex_title">Reflex</div>
        <div class="game-card-reward">Speed</div>
    </div>

    <div class="game-card-3d card-magenta" id="social-tasks-card" onclick="handleCardClick('social-tasks-page')">
        <div class="card-badge-dot ready"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-bounce">ğŸŒ</span></div>
        <div class="game-card-title" data-lang="card_social_title">Social</div>
        <div class="game-card-reward">Tasks</div>
    </div>

    <div class="game-card-3d card-orange" id="slots-game-card" onclick="window.showGameWithLoading('slots-game-page')">
        <div class="card-badge-dot" id="slots-game-badge-dot"></div>
        <div class="game-card-icon"><span class="emoji-animate anim-slot">ğŸ°</span></div>
        <div class="game-card-title" data-lang="card_slots_title">Slot</div>
        <div class="game-card-reward">Jackpot</div>
    </div>
</div>
</div>
</div>

            
         <div id="slots-game-page" class="game-page-container" style="display: none; text-align: center;">
        <h2 class="page-title" data-lang="title_slots">Lucky Slot Machine</h2>

        <div class="daily-game-card">
            <div class="header">
                <span class="back-button" onclick="showMainPage()">â†</span>
                <div class="main-title" data-lang="slots_main_title">á‹•á‹µáˆˆáŠ›</div>
                <div class="sub-title" data-lang="slots_sub_title">á‹•áˆˆá‰³á‹Š áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ</div>
            </div>

            <div class="info-bar">
                <div class="info-item">
                    <span id="coin-wins">0</span>
                </div>
                <div class="info-item">
                    <span data-lang="label_spins_left">á‰€áˆª áˆ™áŠ¨áˆ«á‹á‰½</span> <span id="spins-left">10</span>
                </div>
            </div>

            <div class="slots-area">
                <div class="slot" id="slot-1"><div class="slot-content">?</div></div>
                <div class="slot" id="slot-2"><div class="slot-content">?</div></div>
                <div class="slot" id="slot-3"><div class="slot-content">?</div></div>
            </div>

            <button class="btn" id="claim-btn" disabled data-lang="btn_claim_coin">Claim coin</button>

            <button class="btn" id="spin-btn" data-lang="btn_spin_start">
                áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‹­áŒ«áŠ‘ <br> SPIN
            </button>

            <div class="message" id="game-message"></div>

            <div class="timer-container" style="display: none;" id="reset-timer-container">
                <br>
                <span id="reset-timer"></span>
            </div>
        </div>

        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="top-page" class="page" style="display: none; padding: 15px 0;">
        <h1 class="page-title" data-lang="title_top_users">TOP USERS</h1>

        <div class="top-user-card" style="border: 2px solid var(--et-yellow);">
            <div style="font-size: 18px; font-weight: bold; color: var(--tg-text);" data-lang="label_your_rank">ğŸ‘¤ á‹¨áŠ¥áˆ­áˆµá‹ á‹°áˆ¨áŒƒ</div>
            <div class="top-user-stats">
                <div class="stat-item" style="color: var(--et-yellow); background-color: #333333;">
                    <span id="top-score-display">0 ğŸ’°</span>
                    <span data-lang="label_your_coin">á‹¨áŠ¥áˆ­áˆµá‹ coin</span>
                </div>
                <div class="stat-item" style="color: var(--et-blue); background-color: #333333;">
                    <span id="top-rank-display"> </span>
                    <span data-lang="label_your_rank_val">á‹¨áŠ¥áˆ­áˆµá‹ á‹°áˆ¨áŒƒ</span>
                </div>
            </div>
        </div>

        <h2 style="font-size: 20px; margin-bottom: 15px; color: var(--tg-text);" data-lang="title_leaderboard">ğŸ¥‡ Top Users (Top 100)</h2>

        <div id="leaderboard-container">
            <p style="text-align: center; color: var(--tg-hint); padding: 10px;" data-lang="msg_wait">áŠ¥á‰£áŠ­á‹áŠ• á‰µáŠ•áˆ½ á‹­áŒ á‰¥á‰á¢</p>
        </div>
    </div>

    <div id="profile-page" class="page">
        <div class="profile-avatar" id="profile-avatar">ğŸ‘¤</div>
        <div class="profile-username-display" id="profile-username">User Name</div>

        <div class="assets-card">
            <div class="assets-card-header">
                <span data-lang="label_total_asset">Total Coin</span>
                <span class="history-btn" onclick="window.showTransactionHistory()">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:16px; height:16px; margin-right:4px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path>
                    </svg>
                    <span data-lang="btn_history">History</span>
                </span>
            </div>

            <div class="balance-display">
                <span id="profile-score-display">0</span>
                <span class="currency">COIN ğŸ’°</span>
            </div>

            <div class="balance-display" style="margin-top: 10px; border-top: 1px dashed #444; padding-top: 10px;">
                <span id="profile-smart-coin-display">0</span>
                <span class="currency" style="color: var(--et-green);">SMART âš¡ï¸</span>
            </div>

<div class="card-actions">
    <button class="action-btn withdraw" onclick="switchPage('withdraw-page');">
        <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15M12 15V3m0 0L9 6m3-3 3 3" />
        </svg>
        <span data-lang="btn_withdraw">Withdraw</span>
    </button>

    <button class="action-btn exchange" onclick="switchPage('exchange-page');">
        <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h18m-7.5-12L21 9m0 0L16.5 4.5M21 9H3" />
        </svg>
        <span data-lang="btn_swap">Swap</span>
    </button>

<button class="action-btn airdrop" onclick="window.switchPage('p2p-page')">
        <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h18m-7.5-12L21 9m0 0L16.5 4.5M21 9H3" />
        </svg>
        <span>P2P Transfer</span>
    </button>
 </div>
   </div>

    <h2 class="profile-section-header" data-lang="title_settings">Settings</h2>
<button class="profile-action-button" onclick="handleWalletConnect()">
    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
        <span class="stat-label">
            <span class="icon">ğŸ’¼</span>
            <span id="wallet-btn-text" data-lang="btn_connect_wallet">Connect to Wallet</span>
        </span>
        <span class="exchange-status" id="wallet-btn-status">Connect ></span>
    </div>
</button>

<div class="profile-action-button">
    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
        <span class="stat-label">
            <span class="icon">ğŸŒ</span>
            <span data-lang="btn_change_lang">Change Language</span>
        </span>
        
        <select id="language-dropdown" onchange="window.changeLanguage(this.value)">
              <option value="en">English ğŸ‡ºğŸ‡¸</option>
              <option value="am">áŠ áˆ›áˆ­áŠ› ğŸ‡ªğŸ‡¹</option>
        </select>
    </div>
</div>

<button class="profile-action-button" onclick="window.handleSupportClick()">
    <span class="stat-label">
        <span class="icon">â“</span> 
        <span data-lang="btn_support">Support</span>
    </span>
</button>

<button class="profile-action-button" onclick="window.handleCloseClick()">
    <span class="stat-label">
        <span class="icon">âœ–ï¸</span> 
        <span data-lang="btn_close_app">Close App</span>
    </span>
</button>
    

        <div id="admin-panel" style="display: none; margin-top: 30px; border-top: 1px dashed #555; padding-top: 20px;">
            <h3 style="color: var(--et-red); font-size: 16px;">ğŸ‘® Admin Zone</h3>
            <button class="profile-action-button" onclick="window.generateWeeklyReport()" style="border: 1px solid var(--et-red); margin-bottom: 10px;">
                <span class="stat-label">
                    <span class="icon">ğŸ“Š</span> áˆ³áˆáŠ•á‰³á‹Š áˆªá–áˆ­á‰µ áˆ‹áŠ­áˆáŠ
                </span>
            </button>
            <button class="profile-action-button" onclick="window.generateTop10FrequentUsers()">
                <span class="stat-label">ğŸ‘‘ Top 10 á‰³á‰³áˆªá‹á‰½ áˆ½áˆáˆ›á‰µ</span>
            </button>
            <p id="report-status" style="font-size: 12px; color: #aaa; margin-top: 5px;"></p>
        </div>
    </div>

    <div id="social-tasks-page" class="game-page-container" style="display: none; text-align: left;">
        <h1 class="social-tasks-title" data-lang="card_social_title">Social Tasks</h1>
        <p class="social-tasks-subtitle" data-lang="card_social_desc">áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µáŠ• á‰ áˆ›áŒ áŠ“á‰€á‰… á‰°áŒ¨áˆ›áˆª coin á‹«áŒáŠ™!</p>

        <div class="social-task-card" id="task-channel">
            <div class="social-task-icon-container" style="background-color: var(--et-blue);">
                <span style="color: white;">âœˆï¸</span>
            </div>
            <div class="social-task-text-container">
                <div class="social-task-title">Telegram Channel</div>
                <div class="social-task-reward">+1500 ğŸ’°</div>
            </div>
            <button class="social-task-action-button join-style" id="channel-action" data-link="https://t.me/Smart_Airdropss" data-points="1500" data-field="last_social_tg_channel_time" data-name="Telegram Channel Join" onclick="window.handleSocialTaskClick(this, 'join')">
                Join
            </button>
        </div>
        <div class="social-task-card" id="task-group">
            <div class="social-task-icon-container" style="background-color: var(--et-blue);">
                <span style="color: white;">??</span>
            </div>
            <div class="social-task-text-container">
                <div class="social-task-title">Telegram Group</div>
                <div class="social-task-reward">+1000 ğŸ’°</div>
            </div>
            <button class="social-task-action-button join-style" id="group-action" data-link="https://t.me/school_library2012" data-points="1000" data-field="last_social_tg_group_time" data-name="Telegram Group Join" onclick="window.handleSocialTaskClick(this, 'join')">
                Join
            </button>
        </div>
        <div class="social-task-card" id="task-youtube">
            <div class="social-task-icon-container" style="background-color: var(--et-red);">
                <span style="color: white;">â–¶ï¸</span>
            </div>
            <div class="social-task-text-container">
                <div class="social-task-title">YouTube Subscribe</div>
                <div class="social-task-reward">+3000 ğŸ’°</div>
            </div>
            <button class="social-task-action-button join-style" id="youtube-action" data-link="https://www.youtube.com/" data-points="3000" data-field="last_social_youtube_time" data-name="YouTube Subscribe" onclick="window.handleSocialTaskClick(this, 'subscribe')">
                Subscribe
            </button>
        </div>
        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="mystery-box-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" data-lang="card_mystery_title">Mystery Box Game</h2>
        <div class="game-info-box">
            <p data-lang="mystery_info">á‹•áˆˆá‰³á‹Šá‹áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áˆ£áŒ¥áŠ• á‹­áŠ­áˆá‰± áŠ¥áŠ“ á‰µáˆá‰… coin á‹«áˆ¸áŠ•á‰!</p>
            <div id="mystery-box-timer" class="cooldown-timer">Ready!</div>
            <p style="font-size: 12px; color: var(--tg-hint); margin-top: 10px;" data-lang="reward_info">áˆ½áˆáˆ›á‰µ: +100 - +500 coin (á‰ á‹¨ 24 áˆ°á‹“á‰±)</p>
        </div>

        <div id="box-container" class="box-container">
            <div class="mystery-box" id="box-1" onclick="playMysteryBox(1)">?</div>
            <div class="mystery-box" id="box-2" onclick="playMysteryBox(2)">?</div>
            <div class="mystery-box" id="box-3" onclick="playMysteryBox(3)">?</div>
        </div>
        <p id="box-message" style="font-size: 16px; margin-top: 20px; font-weight: bold; color: var(--et-yellow);"></p>

        <button id="mystery-box-action" class="game-action-button" onclick="resetMysteryBox()" data-lang="btn_retry">áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©</button>
        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>
    <div id="daily-spin-page" class="game-page-container">
        <h2 class="page-title" data-lang="card_spin_title">Daily Spin</h2>
        <div class="game-info-box">
            <p data-lang="spin_info">á‹•á‹µáˆˆáŠ› áˆ½áŠ­áˆ­áŠ­áˆ­ (Spin) á‹«áˆ½áŠ¨áˆ­áŠ­áˆ© áŠ¥áŠ“ coin á‹«áŒáŠ™!</p>
            
            <div id="daily-spin-timer" class="cooldown-timer" data-lang="status_ready">Ready!</div>
        </div>

        <div class="wheel-container">
            <div class="pointer"></div>
            <div class="wheel" id="spin-wheel">
                <div class="segment" style="--i:0; --clr:#8BC34A;"><span class="segment-text">20<br>coin</span></div>
                <div class="segment" style="--i:1; --clr:#CDDC39;"><span class="segment-text">2000<br>coin</span></div>
                <div class="segment" style="--i:2; --clr:#FF9800;"><span class="segment-text">5<br>coin</span></div>
                <div class="segment" style="--i:3; --clr:#FF5722;"><span class="segment-text">0<br>coin</span></div>
                <div class="segment" style="--i:4; --clr:#F44336;"><span class="segment-text">10<br>coin</span></div>
                <div class="segment" style="--i:5; --clr:#FFEB3B;"><span class="segment-text">1000<br>coin</span></div>
                <div class="segment" style="--i:6; --clr:#9C27B0;"><span class="segment-text">500<br>coin</span></div>
                <div class="segment" style="--i:7; --clr:#2196F3;"><span class="segment-text">200<br>coin</span></div>
                <div class="segment" style="--i:8; --clr:#00BCD4;"><span class="segment-text">5000<br>coin</span></div>
                <div class="segment" style="--i:9; --clr:#4CAF50;"><span class="segment-text">50<br>coin</span></div>
            </div>
            <div class="center-circle">SPIN</div>
        </div>

        <button id="daily-spin-action" class="game-action-button" onclick="spinTheWheel()" data-lang="btn_spin">áŠ áˆ½áŠ¨áˆ­áŠ­áˆ­</button>
        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>


    <div id="reflex-game-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" data-lang="card_reflex_title">Reflex Game</h2>
        <div class="game-info-box">
            <p data-lang="reflex_info">áˆáŒ£áŠ•áŠá‰µá‹áŠ• á‹­áˆá‰µáŠ‘! á‰ ááŒ¥áŠá‰µ áˆáˆ‹áˆ½ áˆ°áŒ¥á‰°á‹ coin á‹«áŒáŠ™á¢</p>
            <div id="reflex-game-timer" class="cooldown-timer">Ready!</div>
            <p style="font-size: 12px; color: var(--tg-hint); margin-top: 10px;" data-lang="reward_info_24">áˆ½áˆáˆ›á‰µ: áŠ¨ááŒ¥áŠá‰µá‹ áŒ‹áˆ­ á‰°áˆ˜áŒ£áŒ£áŠ (á‰ á‹¨ 24 áˆ°á‹“á‰±)</p>
        </div>

        <div id="reflex-play-area">
           <div id="reflex-button" onclick="stopReflexGame(event)" data-lang="msg_reflex_tap">TAP ME!</div>
<p id="reflex-message" data-lang="msg_reflex_start_btn">áˆˆáˆ˜áŒ€áˆ˜áˆ­ áŠ¨á‰³á‰½ á‹«áˆˆá‹áŠ• á‰áˆá á‹­áŒ«áŠ‘á¢</p>
 
        </div>
        <p id="reflex-result" style="font-size: 18px; font-weight: bold; color: var(--et-yellow);"></p>

        <button id="reflex-game-action" class="game-action-button" onclick="startReflexGame()" data-lang="btn_start_game">áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­</button>
        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="scratch-card-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" data-lang="card_scratch_title">Scratch Card Game ğŸ</h2>
        <div class="game-info-box">
            <p data-lang="msg_scratch_instruction">áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆá‰…áˆá‰… (Scratch) á‹¨á‰°á‹°á‰ á‰€á‹áŠ• áˆ½áˆáˆ›á‰µ á‹«áŒáŠ™!</p>
            <div id="scratch-card-timer" class="cooldown-timer">Loading...</div>
            <p style="font-size: 12px; color: var(--tg-hint); margin-top: 10px;" data-lang="reward_info_12">áˆ½áˆáˆ›á‰µ: áŠ¨ +100 áŠ¥áˆµáŠ¨ +500 coin (á‰ á‹¨ 12 áˆ°á‹“á‰±)</p>
        </div>

        <div id="scratch-card-container">
            <div id="scratch-prize-text" class="scratch-prize-layer">
                <span>+500 ğŸ’°</span>
            </div>
            <canvas id="scratch-canvas" class="scratch-top-layer"></canvas>
        </div>

        <p id="scratch-result-message" style="font-size: 16px; margin-top: 20px; font-weight: bold; color: var(--et-yellow); min-height: 20px;"></p>

        <button id="scratch-card-action" class="game-action-button" style="display: none;" onclick="window.initScratchCard(true);" data-lang="btn_retry">
            áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©
        </button>
        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="withdraw-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" data-lang="title_withdraw_page">ğŸ’¸ á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdrawal)</h2>

        <div class="withdraw-card modern-card-3d balance-input-card">
            <p class="card-title" data-lang="label_withdrawable_balance">áˆŠá‹ˆáŒ£ á‹¨áˆšá‰½áˆ á‰€áˆª áˆ’áˆ³á‰¥</p>
            <p class="balance-amount">
                <span id="currentWithdrawBalance">0.00</span> $
            </p>
            <span class="currency-label">Token/áŒˆáŠ•á‹˜á‰¥</span>

            <hr>

            <p class="card-title" style="margin-top: 10px;" data-lang="label_withdraw_amount">áˆ›á‹áŒ£á‰µ á‹¨áˆšáˆáˆáŒ‰á‰µ áˆ˜áŒ áŠ•</p>
            <div class="quantity-control">
                <button class="qty-btn minus-btn" onclick="window.adjustWithdrawInput(-10)">âˆ’</button>
                <input type="number" id="withdrawAmountInput" placeholder="Min: 100" min="100" step="10" value="100" oninput="window.validateWithdrawal()" class="qty-input">
                <button class="qty-btn plus-btn" onclick="window.adjustWithdrawInput(10)">+</button>
            </div>
        </div>

        <div class="method-master-card">
            <p class="card-title" data-lang="label_withdraw_method">á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡</p>

            <div id="method-selection-container">
                <div class="method-wrapper" id="wrapper-telegram">
                    <div class="method-card method-card-tg" data-method="telegram" onclick="window.selectMethod('telegram', this)">
                        <div class="method-info">
                            <span class="method-icon">ğŸš€</span>
                            <div class="method-name">Telegram Payments (Native)</div>
                        </div>
                        <div class="method-fee">Free: 1%</div>
                        <span class="selection-indicator" id="telegram-indicator">âœ”</span>
                    </div>
                </div>
                            <div class="method-wrapper" id="wrapper-crypto">
                <div class="method-card method-card-crypto" data-method="crypto" onclick="window.selectMethod('crypto', this)">
                    <div class="method-info">
                        <span class="method-icon">â‚¿</span>
                        <div class="method-name">Crypto (USDT TRC20)</div>
                    </div>
                    <div class="method-fee">Free: 1.5%</div>
                    <span class="selection-indicator" id="crypto-indicator">âœ”</span>
                </div>
            </div>

            <div class="method-wrapper" id="wrapper-paypal">
                <div class="method-card method-card-paypal" data-method="paypal" onclick="window.selectMethod('paypal', this)">
                    <div class="method-info">
                        <span class="method-icon">ğŸ…¿ï¸</span>
                        <div class="method-name">PayPal</div>
                    </div>
                    <div class="method-fee">Free: 2%</div>
                    <span class="selection-indicator" id="paypal-indicator">âœ”</span>
                </div>
            </div>

                </div>
        </div>

        <div class="withdraw-card action-card modern-card-3d">
            <p id="withdrawMessage"></p>
            <button id="finalWithdrawButton" disabled class="modern-exchange-btn disabled-btn" onclick="window.initiateWithdrawal()" data-lang="btn_withdraw_now">
                WITHDRAW NOW
            </button>
        </div>

        <button class="game-back-button" onclick="switchPage('profile-page')" data-lang="btn_back_profile">â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="exchange-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" style="margin-bottom: 30px;" data-lang="title_exchange">âš¡ï¸ SMART COIN EXCHANGE âš¡ï¸</h2>

        <div class="modern-card" style="margin-bottom: 25px;">
            <p class="card-title" data-lang="label_owned_coin">á‹«áˆá‹á‰µ coin</p>
            <p class="balance-amount" id="currentCoinBalance" style="color: var(--et-yellow);">0</p>
            <span class="currency-label">COIN</span>

            <hr style="border: 0; height: 1px; background-color: #555; margin: 15px 0;">

            <div class="rate-display">
                <span class="rate-label" data-lang="label_exchange_rate">áˆá‹á‹áŒ¥ áˆáŒ£áŠ” (Rate)</span>
                <span class="rate-value" id="exchangeRateDisplay">10,000 Coin = 1 Smart Coin</span>
            </div>
        </div>

        <div class="modern-card-3d">
            <p class="card-title" data-lang="label_exchange_amount">áˆ˜á‰€á‹¨áˆ­ á‹¨áˆšáˆáˆáŒ‰á‰µ áˆ˜áŒ áŠ•</p>

            <div class="quantity-control">
                <button class="qty-btn minus-btn" onclick="adjustExchangeInput(-10000)">-</button>
                <input type="number" id="exchangePointsInput" placeholder="10,000" min="10000" step="10000" value="10000" oninput="calculateSmartCoin()" class="qty-input">
                <button class="qty-btn plus-btn" onclick="adjustExchangeInput(10000)">+</button>
            </div>

            <div class="smart-coin-output">
                <p></p>
                <p id="smartCoinResult">1 Smart Coin</p>
            </div>
        </div>

        <button id="finalExchangeButton" disabled class="modern-exchange-btn disabled-btn" data-lang="btn_exchange_now">
            EXCHANGE NOW
        </button>

        <p id="exchangeMessage" style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 14px;"></p>
        <button class="game-back-button" onclick="switchPage('profile-page')" data-lang="btn_back_profile">â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="transaction-history-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" data-lang="title_history">ğŸ“œ Transaction History</h2>
        <div id="general-history-list" style="padding-bottom: 20px;">
            <p style="text-align: center; color: #888;" data-lang="msg_no_history">áˆáŠ•áˆ á‰³áˆªáŠ­ á‹¨áˆˆáˆá¢</p>
        </div>
        <button class="game-back-button" onclick="switchPage('profile-page')" data-lang="btn_back_profile">â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="keno-game-page" class="page" style="display: none; padding: 15px 0;">
        <div id="keno-game-container">
            <div id="keno-header-status">
                <span>KENO GAME</span>
                <span id="keno-total-points">0.00 Coin</span>
            </div>

            <div id="keno-tab-navigation">
                <button class="keno-tab-button active" onclick="window.kenoShowTab('keno-live-tab', this)" data-lang="tab_live">Live</button>
                <button class="keno-tab-button" onclick="window.kenoShowTab('keno-history-tab', this)" data-lang="tab_history">History</button>
                <button class="keno-tab-button" onclick="window.kenoShowTab('keno-results-tab', this)" data-lang="tab_results">Results</button>
            </div>
            <div id="keno-tab-contents">
                <div id="keno-live-tab" class="keno-tab-content active">
                    <p id="keno-pick-info">0 Picks | Select up to 10 numbers</p>
                    <div id="keno-main-game-area">
                        <div id="keno-grid"></div>
                        <div id="keno-draw-shaker-area">
                            <span id="keno-draw-count-area">0 / 20</span>
                            <div id="keno-current-ball-area">?</div>
                            <span id="keno-draw-status">Waiting...</span>
                        </div>
                    </div>
                    <button id="keno-random-pick-btn" onclick="window.kenoRandomSelect(10)" data-lang="btn_random_pick">Random Pick (10 Numbers)</button>
                    <div id="keno-selected-picks-area" data-lang="label_selected_nums">á‹¨áˆ˜áˆ¨áŒ§á‰¸á‹ á‰áŒ¥áˆ®á‰½: [ ]</div>
                    <p id="keno-message" data-lang="msg_keno_start">á‰áŒ¥áˆ®á‰½á‹áŠ• á‹­áˆáˆ¨áŒ¡áŠ“ BET á‹­áŒ«áŠ‘á¢</p>
                    <div id="keno-bet-controls">
                        <div id="keno-bet-input-group">
                            <button class="keno-bet-modifier" onclick="window.kenoChangeBet(-100)">-</button>
                            <input type="number" id="keno-bet-amount-input" value="100" min="100" step="100">
                            <button class="keno-bet-modifier" onclick="window.kenoChangeBet(100)">+</button>
                        </div>
                        <div id="keno-bet-button-group">
                            <button id="keno-bet-btn" onclick="window.kenoStartGame()">BET</button>
                        </div>
                    </div>
                </div>
                <div id="keno-history-tab" class="keno-tab-content">
                    <h4 data-lang="title_keno_history">ğŸ“œ á‹«áˆˆá‰á‰µ áŒ¨á‹‹á‰³á‹á‰½ á‰³áˆªáŠ­ (Last 10 Games)</h4>
                    <div id="keno-history-list">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</div>
                </div>
                <div id="keno-results-tab" class="keno-tab-content">
                    <h4 data-lang="title_keno_payout">ğŸ’° á‹¨áˆ½áˆáˆ›á‰µ áˆ°áŠ•áŒ áˆ¨á‹¥ (Payout Table)</h4>
                    <p data-lang="desc_keno_payout">á‰ áˆ˜áˆ¨áŒ¡á‰µ á‹¨á‰áŒ¥áˆ®á‰½ á‰¥á‹›á‰µ (Picks) áˆ˜áˆ áˆ¨á‰µ á‹¨áˆ›áˆ¸áŠá á‰¥á‹œá‰µ (Multiplier) á‹­áˆˆá‹«á‹«áˆá¢</p>
                    <div id="keno-paytable-content"></div>
                </div>
            </div>
        </div>
        <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <div id="staking-page" class="game-page-container" style="display: none; text-align: left;">
        <h2 class="page-title" data-lang="title_stake">ğŸ’° Stake & Earn ğŸ’°</h2>

        <div id="stake-header-status">
            <span data-lang="label_owned_coin">á‹«áˆá‹á‰µ Coin</span>
            <span id="stake-total-points">0.00 Coin</span>
        </div>

        <div id="stake-tab-navigation">
            <button class="stake-tab-button active" onclick="window.showStakeTab('stake-live-tab', this)" data-lang="tab_stake">Stake</button>
            <button class="stake-tab-button" onclick="window.showStakeTab('stake-history-tab', this)" data-lang="tab_history">History</button>
            <button class="stake-tab-button" onclick="window.showStakeTab('stake-rules-tab', this)" data-lang="tab_rules">Rules</button>
        </div>

        <div id="stake-tab-contents">
            <div id="stake-live-tab" class="stake-tab-content active">
                <div id="staking-input-card" style="display: none;">
                    <p class="stake-card-title" data-lang="title_choose_stake">á‹¨ Stake áŠ áˆ›áˆ«áŒ­ á‹­áˆáˆ¨áŒ¡</p>
                    <div id="stake-plans-container"></div>
                    <p id="stakeInputMessage" class="stake-message"></p>
                </div>
                <div id="stake-card-wrapper" style="position: relative;">
                    <div id="self-ad-banner-container"></div>
                    <div id="staking-claim-card" class="modern-card-3d" style="display: none; border-color: var(--stake-green);">
                        <p class="stake-card-title" data-lang="title_current_stake">áŠ áˆáŠ• á‹«áˆˆá‹ Stake</p>
                        <p class="balance-amount" id="stakedAmountDisplay">0</p>
                        <span class="currency-label">COIN STAKED</span>
                        <hr>
                        <div class="game-info-box" style="background-color: var(--stake-bg-primary); padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px; color: #aaa;">Status:</span>
                                <div id="stakeCooldownTimer" class="cooldown-timer" style="font-size: 14px;">Loading...</div>
                            </div>
                            <div class="stake-progress-container">
                                <div id="stakeProgressBar" class="stake-progress-fill"></div>
                            </div>
                            <div class="accrued-text" style="margin-bottom: 10px;">
                                <span data-lang="label_accrued">áŠ¥áˆµáŠ«áˆáŠ• á‹¨á‰°áŒ áˆ«á‰€áˆ˜:</span> <span id="accruedInterestDisplay" class="accrued-value">0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 12px;" data-lang="label_total_reward">Total Reward:</span>
                                <span id="stakeReturnMessage" style="font-size: 14px; color: var(--stake-yellow); font-weight: bold;">...</span>
                            </div>
                        </div>
                        <button id="stakeClaimButton" class="game-action-button" onclick="window.handleClaimStakeClick()" disabled data-lang="btn_claim_reward">
                            CLAIM REWARD
                        </button>
                    </div>
                </div>
            </div>
            <div id="stake-history-tab" class="stake-tab-content">
                <h4 class="stake-card-title" style="text-align: center;" data-lang="title_stake_history">ğŸ“œ á‹¨ Stake á‰³áˆªáŠ­ (History)</h4>
                <div id="stake-history-list">
                    <p style="text-align: center; color: var(--stake-text-secondary);" data-lang="msg_no_list">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</p>
                </div>
            </div>
            <div id="stake-rules-tab" class="stake-tab-content">
                <h4 class="stake-card-title" style="text-align: center;" data-lang="title_stake_rules">âš–ï¸ áˆ…áŒ áŠ¥áŠ“ á‹°áŠ•á‰¥ (Rules)</h4>
                <div class="keno-paytable-card" style="background-color: var(--stake-bg-secondary);">
                    <div class="keno-paytable-header" style="background-color: var(--stake-yellow); color: #111;">
                        Staking Rules
                    </div>
                    <ul style="padding: 15px 30px; line-height: 1.6; color: var(--stake-text-primary);">
                        <li data-lang="rule_1">"Stake" áˆ›áˆˆá‰µ áˆ³áŠ•á‰²áˆá‹áŠ• áˆˆá‰°á‹ˆáˆ°áŠ áŒŠá‹œ á‰ áˆ˜á‰†áˆˆá á‹ˆáˆˆá‹µ (á‰µáˆ­á) áˆ›áŒáŠ˜á‰µ áˆ›áˆˆá‰µ áŠá‹á¢</li>
                        <li data-lang="rule_2">áŠ áŠ•á‹´ "Stake" áŠ«á‹°áˆ¨áŒ‰ á‰ áŠ‹áˆ‹á£ á‹«áˆµá‰€áˆ˜áŒ¡á‰µ áŒŠá‹œ (áˆˆáˆáˆ³áˆŒ 24 áˆ°á‹“á‰µ) áŠ¥áˆµáŠªá‹«áˆá‰… á‹µáˆ¨áˆµ áˆ³áŠ•á‰²áˆá‹áŠ• áˆ›á‹áŒ£á‰µ áŠ á‹­á‰½áˆ‰áˆá¢</li>
                        <li data-lang="rule_3">áŒŠá‹œá‹ áˆ²á‹«áˆá‰… "Claim" á‹¨áˆšáˆˆá‹áŠ• á‰áˆá á‰ áˆ˜áŒ«áŠ• á‹‹áŠ“á‹áŠ• áˆ³áŠ•á‰²áˆ áŠ¨áŠá‹ˆáˆˆá‹± áˆ˜á‹áˆ°á‹µ áŠ áˆˆá‰¥á‹á‰µá¢</li>
                    </ul>
                </div>
            </div>
        </div>
        <button class="game-back-button" onclick="window.showMainLobby()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>
<div id="p2p-page" class="game-page-container" style="display: none;">
    <h2 class="page-title">P2P Transfer ğŸ’¸</h2>

<div class="p2p-tabs">
    <div class="p2p-tab active" onclick="window.switchP2PTab('market')">Market ğŸ›’</div>
    <div class="p2p-tab" onclick="window.switchP2PTab('my-orders')">My Ads ğŸ“‹</div> <div class="p2p-tab" onclick="window.switchP2PTab('send')">Send</div>
    <div class="p2p-tab" onclick="window.switchP2PTab('history')">History</div>
    <div class="p2p-tab" onclick="window.switchP2PTab('rules')">Rules</div>
</div>

<div id="p2p-section-my-orders" class="p2p-content-section" style="display: none;">
    <h3 style="color: var(--et-yellow); padding: 10px;">á‹¨áŠ¥áŠ” áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹á‰½</h3>
    <div id="p2p-my-ads-list">
        <p style="text-align: center; color: #666;">Loading...</p>
    </div>
</div>

<div id="p2p-trade-room" class="p2p-content-section" style="display: none;">
    <div class="trade-header-status">
        <button onclick="closeTradeRoom()" style="background:none; border:none; color:white; font-size:20px;">â† Back</button>
        <div style="text-align:right;">
            <span id="trade-status-badge" class="status-badge pending">PENDING</span>
            <div id="trade-timer" style="color: var(--et-red); font-weight:bold; font-size:14px;">15:00</div>
        </div>
    </div>

    <div class="modern-card" style="margin-top: 10px; padding: 15px; background: #222;">
        <h2 id="trade-amount-display" style="color: var(--et-green); margin:0;">0 Coins</h2>
        <p style="color: #aaa; font-size: 12px;">Price: <span id="trade-price-display">0</span> ETB</p>
        <hr style="border-color: #444;">
        <div style="display:flex; justify-content:space-between;">
            <span style="color:white;">á‹¨áˆšáŠ¨ááˆ‰á‰µ:</span>
            <strong style="color:var(--et-yellow); font-size:18px;"><span id="trade-total-fiat">0</span> ETB</strong>
        </div>
    </div>

    <div class="modern-card" style="margin-top: 10px; padding: 15px; background: #1a1a1a; border-left: 4px solid #00A3FF;">
        <h4 style="margin-top:0; color:#ddd;">ğŸ¦ á‹¨áˆ˜áŠ­áˆá‹« áˆ˜áˆ¨áŒƒ (Seller Info)</h4>
        <p style="color: #aaa; font-size:13px; margin-bottom: 5px;">á‰£áŠ•áŠ­/á‹˜á‹´: <strong id="trade-bank-name" style="color:white;">---</strong></p>
        <p style="color: #aaa; font-size:13px; margin-bottom: 5px;">áˆµáˆ: <strong id="trade-seller-name" style="color:white;">---</strong></p>
        <div style="background: #333; padding: 8px; border-radius: 5px; display:flex; justify-content:space-between; align-items:center;">
            <span id="trade-account-num" style="color:white; font-family:monospace; font-size:16px;">---</span>
            <button onclick="copyTradeAccount()" style="background:black; color:white; border:none; padding:4px 8px; border-radius:4px; font-size:10px;">COPY</button>
        </div>
        <p style="font-size:10px; color:orange; margin-top:5px;">âš ï¸ áˆ›áˆ³áˆ°á‰¢á‹«á¡ áŠ­áá‹« áˆ²áˆáŒ½áˆ™ á‰  Reference á‰¦á‰³ áˆ‹á‹­ á‹­áˆ…áŠ• áŠ®á‹µ á‹«áˆµáŒˆá‰¡: <b id="trade-ref-code">---</b></p>
    </div>
<div id="p2p-chat-section" class="chat-container">
    <div class="chat-header" style="padding: 10px; border-bottom: 1px solid #333; font-size: 12px; color: #888; text-align: center;">
        ğŸ”’ á‹°áˆ…áŠ•áŠá‰± á‹¨á‰°áŒ á‰ á‰€ á‹¨á‹áˆµáŒ¥ áˆ˜á‹ˆá‹«á‹«
    </div>
    
    <div id="chat-messages-list" class="chat-messages">
        <p style="text-align: center; color: #555; font-size: 12px; margin-top: 20px;">
            áŠ¥á‹šáˆ… áˆ˜áŠáŒ‹áŒˆáˆ­ á‰µá‰½áˆ‹áˆ‹á‰½áˆá¢<br>á‹°áˆ¨áˆ°áŠ á‹ˆá‹­áˆ áˆ˜áˆ¨áŒƒ áˆˆáˆ˜áˆˆá‹‹á‹ˆáŒ¥ á‹­áŒ á‰…áˆ›áˆá¢
        </p>
    </div>

    <div class="chat-input-area">
        <input type="text" id="chat-input-field" class="chat-input" placeholder="áˆ˜áˆáŠ¥áŠ­á‰µ á‹­áŒ»á‰..." onkeypress="handleChatEnter(event)">
        <button class="chat-send-btn" onclick="sendChatMessage()">â¤</button>
    </div>
</div>

    <div id="trade-actions-area" style="position:fixed; bottom:0; left:0; width:100%; padding:20px; background:#111; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); display:flex; flex-direction:column; gap:10px;">
        
        <div id="buyer-controls" style="display:none;">
            <button onclick="markTradePaid()" class="confirm-btn" style="width:100%; background: #00A3FF;">âœ… áŠ¨áá‹«áˆˆáˆ (I have Paid)</button>
            <button onclick="cancelActiveTrade()" class="cancel-btn" style="width:100%; margin-top:10px; background:#333;">âŒ áˆ°áˆ­á‹ (Cancel)</button>
        </div>

        <div id="seller-controls" style="display:none;">
            <div style="background:rgba(255,255,0,0.1); color:yellow; padding:10px; font-size:12px; border-radius:5px; margin-bottom:10px; text-align:center;">
                áŒˆá‹¢á‹ "áŠ¨áá‹«áˆˆáˆ" áŠ¥áˆµáŠªáˆ á‹­áŒ á‰¥á‰á¢ á‰¥áˆ­ áˆ³á‹­áŒˆá‰£áˆá‹á‰µ Confirm áŠ¥áŠ•á‹³á‹­áˆ‰!
            </div>
            <button id="btn-release-coins" onclick="releaseTradeCoins()" class="confirm-btn" style="width:100%; background: #4CAF50;" disabled>ğŸ”’ Release Coins</button>
            <button id="btn-dispute" onclick="disputeTrade()" class="cancel-btn" style="width:100%; margin-top:10px; background:var(--et-red); display:none;">âš ï¸ Dispute (á‰½áŒáˆ­ áŠ áˆˆ)</button>
        </div>
    </div>
</div>





    <div id="p2p-section-market" class="p2p-content-section">
    <div class="market-header">
        <div style="display:flex; gap:10px;">
            <button class="market-filter-btn active" onclick="filterMarket('buy')">Buy</button>
            <button class="market-filter-btn" onclick="filterMarket('sell')">Sell</button>
        </div>
        <button class="create-ad-btn" onclick="openCreateAdModal()">+ Create Ad</button>
    </div>

    <div id="p2p-market-list">
        <p style="text-align: center; color: #666; padding: 20px;">Loading offers...</p>
    </div>
</div>

    <div id="p2p-section-send" class="p2p-content-section" style="display: none;">

        
        <div class="p2p-balance-card">
            <p>á‹¨áŠ¥áˆ­áˆµá‹ á‰€áˆª áˆ‚áˆ³á‰¥</p>
            <h1 id="p2p-user-balance">0.00 ğŸ’°</h1>
        </div>

        <div class="input-group">
            <label class="input-label">á‰°á‰€á‰£á‹­ (Recipient)</label>
            
            <div class="toggle-search-type">
                <button id="btn-search-id" class="toggle-btn active" onclick="window.setP2PSearchType('id')">By Telegram ID</button>
                <button id="btn-search-user" class="toggle-btn" onclick="window.setP2PSearchType('username')">By @Username</button>
            </div>
            
            <input type="text" id="p2p-recipient-input" class="modern-input" placeholder="Telegram ID á‹«áˆµáŒˆá‰¡..." oninput="window.resetP2PVerification()">
            
            <button class="verify-btn" onclick="window.verifyP2PUser()">á‰°á‰€á‰£á‹©áŠ• áŠ áˆ¨áŒ‹áŒáŒ¥ (Verify) ğŸ”</button>
        </div>

        <div id="p2p-recipient-preview" class="recipient-card" style="display: none;">
            <div class="recipient-avatar" id="p2p-preview-avatar">ğŸ‘¤</div>
            <div class="recipient-info">
                <p class="recipient-name" id="p2p-preview-name">User Name</p>
                <p class="recipient-status">âœ… á‹¨á‰°áˆ¨áŒ‹áŒˆáŒ  á‰°áŒ á‰ƒáˆš</p>
            </div>
        </div>

        <div class="input-group" style="margin-top: 20px;">
            <label class="input-label">á‹¨áˆšáˆáŠ©á‰µ áˆ˜áŒ áŠ• (Coin)</label>
            <input type="number" id="p2p-amount-input" class="modern-input" placeholder="Example: 1000" min="500">
            <p class="fee-text" style="color: #888; font-size: 12px; margin-top: 5px; text-align: right;">
                áŠ áŒˆáˆáŒáˆá‰µ áŠ­áá‹« (Fee): <span id="p2p-fee-display" style="color: var(--et-red);">0</span> coin (5%)
            </p>
        </div>

        <button id="p2p-send-btn" class="modern-exchange-btn disabled-btn" onclick="window.initiateP2PTransfer()" disabled>
            TRANSFER NOW ğŸš€
        </button>
    </div>

    <div id="p2p-section-history" class="p2p-content-section" style="display: none;">
        <div id="p2p-history-list">
            <p style="text-align: center; color: #888; padding: 20px;">Loading history...</p>
        </div>
    </div>

    <div id="p2p-section-rules" class="p2p-content-section" style="display: none;">
        <div class="modern-card" style="text-align: left; padding: 15px; background: #222; border: 1px dashed #444;">
            <h3 style="color: var(--et-yellow); margin-top: 0;">ğŸ“œ á‹¨ P2P áˆ…áŒáŒ‹á‰µ</h3>
            <ul style="color: #ccc; font-size: 14px; line-height: 1.8; padding-left: 20px;">
            <li>ğŸ“¤<b>á‰°á‰€á‰£á‹©áŠ• á‰  telegram ID á‹ˆá‹­áˆ á‰  Username áˆ˜áˆáˆˆáŒ á‹­á‰½áˆ‹áˆ‰á¢</li>
            <li>ğŸ”“ <b>áˆ˜áŒá‰¢á‹« áˆ˜áˆµáˆáˆ­á‰µ:</b> á‹¨P2P áŠ áŒˆáˆáŒáˆá‰µáŠ• áˆˆáˆ˜áŒ á‰€áˆ á‰¢á‹«áŠ•áˆµ <strong style="color: white;">1,000,000 ğŸ’°</strong> áˆŠáŠ–áˆ­á‹á‰µ á‹­áŒˆá‰£áˆá¢</li>
            <li>ğŸ“‰ <b>á‹á‰…á‰°áŠ› áˆ˜áˆ‹áŠªá‹«:</b> á‰ áŠ áŠ•á‹µ áŒŠá‹œ áˆ˜áˆ‹áŠ­ á‹¨áˆšá‰»áˆˆá‹ á‹á‰…á‰°áŠ› áˆ˜áŒ áŠ• <strong style="color: white;">500 ğŸ’°</strong> áŠá‹á¢</li>
            <li>ğŸš« <b>á‹¨á‰€áŠ• áŒˆá‹°á‰¥:</b> á‰ á‰€áŠ• áˆ˜áˆ‹áŠ­ á‹¨áˆšá‰»áˆˆá‹ áŠ¨áá‰°áŠ› áˆ˜áŒ áŠ• <strong style="color: white;">100,000 ğŸ’°</strong> á‰¥á‰» áŠá‹á¢</li>
            <li>ğŸ’¸ <b>á‹¨áŠ áŒˆáˆáŒáˆá‰µ áŠ­áá‹«:</b> áŠ¨áˆšáˆáŠ©á‰µ áˆ˜áŒ áŠ• áˆ‹á‹­ <strong style="color: var(--et-red);">5%</strong> á‰°á‰€áŠ“áˆ½ á‹­á‹°áˆ¨áŒ‹áˆá¢</li>
            <li>ğŸ” <b>áŒ¥áŠ•á‰ƒá‰„:</b> áˆˆá‰°áˆ³áˆ³á‰° á‹á‹á‹áˆ­ á‰¦á‰± áŠƒáˆ‹áŠáŠá‰µ áŠ á‹­á‹ˆáˆµá‹µáˆá£ áŠ¥á‰£áŠ­á‹ áŠ¨áˆ˜áˆ‹áŠ­á‹ á‰ áŠá‰µ áˆµáˆ™áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡á¢</li>
            </ul>
        </div>
    </div>

    <button class="game-back-button" onclick="window.switchPage('profile-page')">â† Back to Profile</button>
</div>
    <div id="create-ad-modal" class="custom-modal" style="display: none;">
    <div class="modal-content" style="text-align: left;">
        <h3 style="color: var(--et-yellow); text-align: center;">ğŸ“¢ áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‹­áˆˆáŒ¥á‰</h3>
        
        <label class="input-label">á‹“á‹­áŠá‰µ</label>
        <div class="toggle-search-type">
            <button id="btn-type-sell" class="toggle-btn active" onclick="setAdType('sell')">áŠ¥áˆ¸áŒ£áˆˆáˆ (Sell)</button>
            <button id="btn-type-buy" class="toggle-btn" onclick="setAdType('buy')">áŠ¥áŒˆá‹›áˆˆáˆ (Buy)</button>
        </div>

        <label class="input-label">áˆ˜áŒ áŠ• (Amount)</label>
        <input type="number" id="ad-amount" class="modern-input" placeholder="Ex: 5000 Coins">

        
<label class="input-label">á‹‹áŒ‹ á‰ áŠ áŠ•á‹µ áŠ®á‹­áŠ• (Price per Coin)</label>
<input type="number" id="ad-price" class="modern-input" placeholder="áˆáˆ³áˆŒ: 0.05 ETB" step="0.01">
       <label class="input-label">áˆ˜áŠ­áˆá‹« áˆ˜áŠ•áŒˆá‹µ</label>
<select id="ad-payment" class="modern-input" style="background:#2a2a2a; color:white;" onchange="toggleAccountInput()">
    <option value="Telebirr">Telebirr</option>
    <option value="CBE">CBE (Commercial Bank)</option>
    <option value="Abyssinia">Abyssinia</option>
</select>

<div id="account-input-area" style="margin-top: 10px;">
    <label class="input-label" id="account-label">á‹¨ Telebirr áˆµáˆáŠ­ á‰áŒ¥áˆ­</label>
    <input type="text" id="ad-account-number" class="modern-input" placeholder="09xxxxxxxx">
</div>



        <div class="modal-actions">
            <button onclick="document.getElementById('create-ad-modal').style.display='none'" class="cancel-btn">áˆ°áˆ­á‹</button>
            <button onclick="postMarketAd()" class="confirm-btn">áˆˆáŒ¥á âœ…</button>
        </div>
    </div>
</div>

<div id="p2p-confirm-modal" class="custom-modal" style="display: none;">
        <div class="modal-content">
            <h2>âš ï¸ á‹á‹á‹áˆ­ áˆ›áˆ¨áŒ‹áŒˆáŒ«</h2>
            <div class="summary-box">
                <p>áˆˆ: <span id="confirm-name" style="color: var(--et-yellow);">---</span></p>
                <p>áˆ˜áŒ áŠ•: <span id="confirm-amount" style="color: white; font-weight: bold;">---</span></p>
                <p>áŠ­áá‹« (Fee): <span id="confirm-fee" style="color: var(--et-red);">---</span></p>
                <hr style="border-color: #444;">
                <p>áŒ á‰…áˆ‹áˆ‹ á‹ˆáŒª: <span id="confirm-total" style="color: var(--et-green);">---</span></p>
            </div>
            <div class="modal-actions">
                <button onclick="document.getElementById('p2p-confirm-modal').style.display='none'" class="cancel-btn">áˆ°áˆ­á‹</button>
                <button onclick="window.executeP2PTransaction()" class="confirm-btn">áŠ áˆ¨áŒ‹áŒáŒ¥áŠ“ áˆ‹áŠ­ âœ…</button>
            </div>
        </div>
    </div>
    <div id="p2p-loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <p class="loading-text">processing... â³</p>
</div>
<div id="receipt-modal" class="custom-modal" style="display: none; align-items: center; justify-content: center; z-index: 10000;">
    <div class="receipt-paper" style="background: #fff; color: #000; padding: 20px; border-radius: 10px; width: 90%; max-width: 320px; font-family: 'Courier New', monospace; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
        <div class="receipt-header" style="text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 15px;">
            <h2 style="margin: 0; font-weight: 800;">SMART PAY</h2>
            <p style="margin: 5px 0 0;">Transaction Receipt</p>
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;">
            <span>DATE:</span> <span id="rec-date">...</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;">
    <span>REF NO:</span> <span id="rec-ref" style="color: #555;">...</span>
</div>

        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;">
            <span>SENDER:</span> <span id="rec-sender">...</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;">
            <span>RECEIVER:</span> <span id="rec-receiver">...</span>
        </div>
        
        <hr style="border-top: 2px dashed #000; margin: 10px 0;">
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;">
            <span>AMOUNT:</span> <span id="rec-amount">...</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: bold;">
            <span>FEE:</span> <span id="rec-fee">...</span>
        </div>
        
        <div style="border-top: 2px dashed #000; padding-top: 10px; margin-top: 10px; font-size: 16px; font-weight: 800; display: flex; justify-content: space-between;">
            <span>TOTAL:</span> <span id="rec-total">...</span>
        </div>

        <div style="position: absolute; right: 20px; bottom: 80px; border: 3px solid #28a745; color: #28a745; padding: 5px 10px; font-weight: bold; transform: rotate(-15deg); font-size: 18px; opacity: 0.8;">
            PAID âœ…
        </div>

        <div style="margin-top: 25px;">
            <button onclick="document.getElementById('receipt-modal').style.display='none'" 
                style="width: 100%; padding: 12px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                Close
            </button>
        </div>
    </div>
</div>

<div id="rating-modal" class="custom-modal" style="display: none; align-items: center; justify-content: center; z-index: 10001;">
    <div class="modal-content" style="text-align: center; background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid #333; width: 85%; max-width: 300px;">
        <h3 style="color: var(--et-yellow); margin-top: 0;">áŒá‰¥á‹­á‰± á‰°áŒ áŠ“á‰…á‰‹áˆ! âœ…</h3>
        <p style="color: #ccc; font-size: 13px;">áˆˆáˆ»áŒ© á‹«áˆˆá‹á‰µáŠ• áŠ¥áˆ­áŠ«á‰³ á‰ áŠ®áŠ¨á‰¥ á‹­áŒáˆˆáŒ¹á¡</p>
        
        <div class="star-rating" style="font-size: 32px; margin: 15px 0; color: #444;">
            <span onclick="setRating(1)" style="cursor:pointer; transition: 0.2s;">â­</span>
            <span onclick="setRating(2)" style="cursor:pointer; transition: 0.2s;">â­</span>
            <span onclick="setRating(3)" style="cursor:pointer; transition: 0.2s;">â­</span>
            <span onclick="setRating(4)" style="cursor:pointer; transition: 0.2s;">â­</span>
            <span onclick="setRating(5)" style="cursor:pointer; transition: 0.2s;">â­</span>
        </div>
        
        <p id="rating-value-text" style="color: var(--et-yellow); font-weight: bold; font-size: 14px;">á‹°áˆ¨áŒƒ á‹­áˆáˆ¨áŒ¡</p>
        
        <button onclick="submitUserRating()" class="confirm-btn" style="width: 100%; margin-top: 15px; background: var(--et-yellow); color: black;">á‹°áˆ¨áŒƒá‹áŠ• áˆ˜á‹áŒá‰¥</button>
    </div>
</div>


<div id="mines-game-page" class="game-page-container" style="display: none;">
    <h2 class="page-title">ğŸ’£ Mines Rush</h2>
    
    <div id="mines-header-stats">
        <span id="mines-balance-display">0 Coin</span>
    </div>

    <div class="game-info-box">
        <p data-lang="mines_info">áˆáŠ•áŒ‚á‹áŠ• áˆ³á‹­áŠáŠ© áŠ áˆáˆ›á‹á‰½áŠ• á‹­áˆ°á‰¥áˆµá‰¡! á‰¥á‹™ áŠ áˆáˆ›á‹ á‰£áŒˆáŠ™ á‰áŒ¥áˆ­á£ áˆ½áˆáˆ›á‰± á‹­áŒ¨áˆáˆ«áˆá¢</p>
    </div>

    <div id="mines-controls">
        <div class="control-group">
            <label data-lang="label_bet_amount">Bet Amount</label>
            <div class="input-wrapper">
                <button onclick="adjustMinesBet(-100)">-</button>
                <input type="number" id="mines-bet-input" value="100" min="100" readonly>
                <button onclick="adjustMinesBet(100)">+</button>
            </div>
        </div>

        <div class="control-group">
             <label data-lang="label_mines_count">Mines Count (1-20)</label>
            <div class="input-wrapper">
                <button onclick="adjustMinesCount(-1)">-</button>
                <input type="number" id="mines-count-input" value="3" min="1" max="20" readonly>
                <button onclick="adjustMinesCount(1)">+</button>
            </div>
        </div>
    </div>

    <div id="mines-grid-container"></div>

    <div id="mines-status-bar" style="display: none;">
        <div>Next: <span id="mines-next-multi" style="color: var(--et-yellow);">1.13x</span></div>
        <div>Win: <span id="mines-current-win" style="color: var(--et-green);">0</span></div>
    </div>

    <button id="mines-start-btn" class="game-action-button" onclick="startMinesGame()" data-lang="btn_bet_start">BET & START</button>
    <button id="mines-cashout-btn" class="game-action-button" style="display: none; background-color: var(--et-yellow); color: #000;" onclick="cashoutMines()" data-lang="btn_cashout">ğŸ’° CASHOUT</button>

    <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
</div>



<div id="daily-cipher-page" class="game-page-container" style="display: none;">
    <h2 class="page-title" data-lang="card_cipher_title">Daily Cipher ğŸ•µï¸</h2>
    <div class="game-info-box">
        <p data-lang="cipher_info">á‹¨á‹›áˆ¬á‹áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áŠ®á‹µ (Morse/Text) á‹«áˆµáŒˆá‰¡!</p>
        
        <div id="daily-cipher-timer" class="cooldown-timer" data-lang="status_ready">Ready!</div>
        
        <p style="font-size: 12px; color: var(--tg-hint);" data-lang="cipher_hint">áŠ®á‹±áŠ• áˆˆáˆ›áŒáŠ˜á‰µ á‹¨á‰´áˆŒáŒáˆ«áˆ á‰»áŠ“áˆ‹á‰½áŠ•áŠ• á‹­áŠ¨á‰³á‰°áˆ‰á¢</p>
    </div>
    
    <div class="cipher-display-area">
        <input type="text" id="cipher-input" data-lang="placeholder_code" placeholder="CODE HERE" maxlength="10">
    </div>
    <p id="cipher-message" style="margin-top: 10px; font-weight: bold;"></p>
    
    <button id="cipher-submit-btn" class="game-action-button" onclick="window.submitDailyCipher()" data-lang="btn_check_code">
        CHECK CODE
    </button>
    <button class="game-back-button" onclick="showMainPage()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
</div>
<div id="launch-ad-overlay">
    <div class="launch-card" onclick="handleAdClick()">
        <div class="launch-img-container">
            <img id="launch-image" src="" alt="Offer">
            <div class="launch-badge">SPONSORED</div>
        </div>
        
        <div class="launch-content">
            <h3 id="launch-title">Special Bonus!</h3>
            <p id="launch-desc">Join now and earn big rewards today.</p>
            <div class="launch-cta-btn">OPEN NOW ğŸš€</div>
        </div>
    </div>

    <div class="launch-close-area" onclick="closeLaunchAd(event)">
        <div class="progress-ring">
            <svg>
               <circle cx="25" cy="25" r="22"></circle>
               <circle cx="25" cy="25" r="22" id="launch-timer-circle"></circle>
            </svg>
            <button class="launch-close-btn">âœ•</button>
        </div>
        <span class="close-text">Close</span>
    </div>
</div>


    <div id="memory-game-page" class="game-page-container" style="display: none;">
        <h2 class="page-title" data-lang="card_memory_title">Memory Match ğŸƒ</h2>
        <div class="game-info-box">
            <p data-lang="card_memory_desc">áŒ¥áŠ•á‹µ áŠ«áˆ­á‹¶á‰½áŠ• á‰ áˆ›áŒˆáŠ“áŠ˜á‰µ áŠ áŠ¥áˆáˆ®á‹áŠ• á‹­áˆá‰µáŠ‘!</p>
            <div id="memory-game-timer-display" class="cooldown-timer">Ready!</div>
        </div>

        <div id="memory-game-grid"></div>
        
        <p id="memory-message" style="margin-top: 15px; font-weight: bold; color: var(--et-yellow); min-height: 20px;"></p>

        <button id="memory-start-btn" class="game-action-button" onclick="window.startMemoryGame()" data-lang="btn_start_game">
            áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­
        </button>

        <button class="game-back-button" onclick="window.cleanupGame()" data-lang="btn_back_home">â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ</button>
    </div>

</div>

<div id="nav-bar">
    <div class="nav-item active" id="nav-tasks" onclick="switchPage('tasks-page')">
        <span class="nav-icon">â­</span>
        <span data-lang="nav_tasks">Tasks</span>
    </div>
    <div class="nav-item" id="nav-stake" onclick="switchPage('staking-page')">
        <span class="nav-icon">ğŸ¦</span>
        <span data-lang="nav_stake">Stake</span>
    </div>
    <div class="nav-item" id="nav-top" onclick="switchPage('top-page')">
        <span class="nav-icon">ğŸ‘‘</span>
        <span data-lang="nav_top">Top</span>
    </div>
    <div class="nav-item" id="nav-profile" onclick="switchPage('profile-page')">
        <span class="nav-icon">ğŸ‘¤</span>
        <span data-lang="nav_profile">Profile</span>
    </div>
</div>




 <script>
        // ğŸ›‘ áˆ˜áá‰µáˆ” 2: á‹¨ showMainPage() á‰°áŒá‰£áˆ­ á‹ˆá‹° áŒáˆá‰£áˆ áˆµáŠ®á• á‰°áˆ˜áˆˆáˆ°
        window.showMainPage = () => switchPage('tasks-page'); 
        
        
        
        // ======================================================================
        // ğŸ›‘ NEW: á‹¨á‹ˆáˆ¨á‰€á‰µ áŠ®áŠ•áŒá‰² áŠ áŠ’áˆœáˆ½áŠ• á‰°áŒá‰£áˆ­ (Paper Confetti)
        // ======================================================================
        window.triggerConfetti = (points) => {
            if (typeof confetti === 'undefined') return;

            // áˆˆ200 coin áŠ¥áŠ“ áŠ¨á‹šá‹« á‰ áˆ‹á‹­ á‰¥á‰» áŠ¥áŠ•á‹²áˆ°áˆ«
            if (points < 200) return; 

            // á‹¨coin áˆ˜áŒ áŠ• áˆ²áŒ¨áˆáˆ­ á‹¨áŠ®áŠ•áŒá‰²á‹áŠ• áˆ˜áŒ áŠ• áŠ¥áŠ“ áˆµáˆ­áŒ­á‰µ á‹­áŒ¨áˆáˆ«áˆ
            const particleCount = points >= 500 ? 180 : 100;
            const spread = points >= 500 ? 90 : 70;
            
            // áˆˆá‹ˆáˆ¨á‰€á‰µ áŠ®áŠ•áŒá‰² á‹¨áˆšáˆ†áŠ‘ á‹°áˆ›á‰… á‰€áˆˆáˆá‰½
            const colors = ['#FFD700', '#1E90FF', '#FF69B4', '#32CD32', '#C0C0C0']; 

            // á‹¨á‹‹áŠ“ áŠ®áŠ•áŒá‰² ááŠ•á‹³á‰³
            confetti({
                particleCount: particleCount,
                spread: spread,
                origin: { y: 0.5 }, 
                colors: colors,
                // ğŸ›‘ á‹¨á‹ˆáˆ¨á‰€á‰µ áŒˆáŒ½á‰³: áŠ áˆ«á‰µ áˆ›á‹•á‹˜áŠ• áŠ¥áŠ“ á‰µáŠ•áˆ½ áŠ áˆ«á‰µ áˆ›á‹•á‹˜áŠ• á‰…áˆ­áŒ¾á‰½
                shapes: ['square', 'rect'], 
                scalar: 1.1, // á‹¨á‰…áŠ•áŒ£á‰¶á‰¹áŠ• áˆ˜áŒ áŠ• á‰µáŠ•áˆ½ áˆ˜áŒ¨áˆ˜áˆ­
                zIndex: 9998
            });
            
            // áˆˆá‰°áŒ¨áˆ›áˆª á‹µáˆ«áˆ›á‹ŠáŠá‰µ áˆ¨á‹£á‹¥áˆ á‹ˆáˆ¨á‰€á‰¶á‰½ (Ribbons)
            if (points >= 500) {
                function fireFromSide(angle, originX) {
                    confetti({
                        particleCount: 20,
                        angle: angle,
                        spread: 30,
                        origin: { x: originX, y: 0.9 }, 
                        colors: ['#FFC107', '#FFFFFF'], // á‹ˆáˆ­á‰… áŠ¥áŠ“ áŠáŒ­
                        // ğŸ›‘ á‹¨á‹ˆáˆ¨á‰€á‰µ áŒˆáŒ½á‰³: áˆ¨á‹£á‹¥áˆ á‹¨á‹ˆáˆ¨á‰€á‰µ áŠ­áˆ®á‰½ (ribbons)
                        shapes: ['line'], 
                        scalar: 0.6,
                        startVelocity: 30,
                        decay: 0.9,
                        zIndex: 9998
                    });
                }
                fireFromSide(45, 0); // áŠ¨áŒáˆ«
                fireFromSide(135, 1); // áŠ¨á‰€áŠ
            }
        }
        
        
        
   // ======================================================================
// âœ… á‹¨á‹µáˆáŒ½ áˆ›áŒ«á‹ˆá‰» á‰°áŒá‰£áˆ­ ( window. á‰°á‹ˆáŒá‹·áˆ - á‰µáŠ­áŠ­áˆˆáŠ› áŠ¥áŠ“ áŠ•áŒ¹áˆ… áˆµáˆªá‰µ)
// ======================================================================

const BASE_URL = 'https://tame3232.github.io/2/Sound/'; 

const soundUrls = {
    spin: BASE_URL + 'spin_sound.mp3',   
    win: BASE_URL + 'win_sound.mp3',     
    fail: BASE_URL + 'fail_sound.mp3',
    click: BASE_URL + 'click_sound.mp3'
};

const loadedSounds = {};
for (const type in soundUrls) {
    if (soundUrls.hasOwnProperty(type)) {
        loadedSounds[type] = new Audio(soundUrls[type]);
        // ğŸ›‘ FIX 5: .load() á‰°á‹ˆáŒá‹·áˆá¢
        // áŠ áˆ³áˆ¹ áˆ«áˆ± play() áˆ²á‰£áˆ áˆ˜áŒ«áŠ• á‹­áŒ€áˆáˆ«áˆ (á‹­áˆ… á‹¨á‰°áˆ»áˆˆ áŠá‹)
        // loadedSounds[type].load(); 
    }
}

// áŠ áˆáŠ• á‰°áŒá‰£áˆ© 'playSound' á‰¥á‰» á‰°á‰¥áˆáˆ
window.playSound = (type) => {
    const audio = loadedSounds[type];
    
    if (audio) {
        audio.pause();
        audio.currentTime = 0; 
        
        audio.play().catch(e => {
            console.warn(`Sound playback failed for '${type}':`, e.message);
        });
    } else {
        console.warn(`á‹¨áˆ›á‹­á‰³á‹ˆá‰… á‹¨á‹µáˆá… áŠ á‹­áŠá‰µ á‰°áŒ á‹­á‰‹áˆ: ${type}`);
    }
}
</script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, updateDoc, doc, setDoc, collection, query, where, onSnapshot, orderBy, limit, increment, serverTimestamp, getDoc, getDocs, runTransaction,addDoc, deleteDoc} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
   import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";



let maintenanceInterval = null;
let cachedLeaderboardData = null; 
let lastLeaderboardFetchTime = 0;
const CACHE_LIFETIME = 3 * 60 * 1000; // 3 á‹°á‰‚á‰ƒ á‰  áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ





        // ===================================================================================
        // === 2. á‹¨áŠ¥áˆ­áˆµá‹ Firebase Configuration ===
        // ===================================================================================
        const firebaseConfig = {
          apiKey: "AIzaSyA9rGEGZifwxz820MR-DZZ6BGHTTZfd7Y4",
          authDomain: "mysteryspingame-41d3b.firebaseapp.com",
          projectId: "mysteryspingame-41d3b",
          storageBucket: "mysteryspingame-41d3b.appspot.com", 
          messagingSenderId: "1078389216479",
          appId: "1:1078389216479:web:75c64f5e4ff147c10f856a"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 


        const WebApp = window.Telegram.WebApp;
        let currentFirebaseUserId = null; 
        let telegramUserId = null; 
        let currentScore = 0; 
        let currentSmartCoinBalance = 0;
        let currentTickets = 0; 
        let currentUserDocData = null; 
        let currentRank = 'N/A'; 
        let isReflexGameRunning = false; 
        let timerIntervals = {}; // áˆˆáˆáˆ‰áˆ Cooldown Timers á‹¨áˆšá‹áˆ
        let hasLaunchAdShown = false;
        onAuthStateChanged(auth, (user) => {
    if (user) {
        currentFirebaseUserId = user.uid;
        console.log("á‰°áŒ á‰ƒáˆšá‹ áŒˆá‰¥á‰·áˆ:", currentFirebaseUserId);
        setupCurrentUserListener(currentFirebaseUserId);
        setupLeaderboardListener();
        setupMiniAppMaintenance();
        fetchMarketOffers();

        
        switchPage('tasks-page');
    } else {
        console.log("á‰°áŒ á‰ƒáˆš áŠ áˆáŒˆá‰£áˆ á‹ˆá‹­áˆ á‹ˆáŒ¥á‰·áˆá¢");
    }
});


// ======================================================================
    // âœ… ğŸ›‘ TRANSLATIONS (áˆ™áˆ‰ á‰ áˆ™áˆ‰ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ)
    // ======================================================================
    const translations = {
        'am': {
            // Nav
            'nav_tasks': 'á‰°áŒá‰£áˆ«á‰µ',
            'nav_stake': 'Stake',
            'nav_top': 'á‹°áˆ¨áŒƒ',
            'nav_profile': 'á•áˆ®á‹á‹­áˆ',

            // Titles & Headers
            'title_daily_tasks': 'á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ',
            'loading_text': 'SMART AIRDROP Loading...',
            'invite_bonus_title': '+500 Coin áˆµáŒ¦á‰³',
            'title_slots': 'á‹¨áŠ¥á‹µáˆ áŒ¨á‹‹á‰³',
            'slots_main_title': 'á‹•á‹µáˆˆáŠ›',
            'slots_sub_title': 'á‹•áˆˆá‰³á‹Š áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ',
            'title_top_users': 'áˆáˆ­áŒ¥ á‰°áŒ á‰ƒáˆšá‹á‰½',
            'title_leaderboard': 'ğŸ¥‡ áˆáˆ­áŒ¥ ( 100 á‰°áŒ á‰ƒáˆšá‹á‰½ )',
            'title_settings': 'á‰…áŠ•á‰¥áˆ­',
            'title_withdraw_page': 'ğŸ’¸ á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdrawal)',
            'title_exchange': 'âš¡ï¸ SMART COIN EXCHANGE âš¡ï¸',
            'title_history': 'ğŸ“œ Transaction History',
            'title_stake': 'ğŸ’° Stake & Earn ğŸ’°',
            'title_stake_history': 'ğŸ“œ á‹¨ Stake á‰³áˆªáŠ­ (History)',
            'title_stake_rules': 'âš–ï¸ áˆ…áŒ áŠ¥áŠ“ á‹°áŠ•á‰¥ (Rules)',

            // Labels
            'label_total_coin': 'áŒ á‰…áˆ‹áˆ‹ coin :',
            'label_spins_left': 'á‰€áˆª áˆ™áŠ¨áˆ«á‹á‰½',
            'label_your_rank': 'ğŸ‘¤ á‹¨áŠ¥áˆ­áˆµá‹ á‹°áˆ¨áŒƒ',
            'label_your_coin': 'á‹¨áŠ¥áˆ­áˆµá‹ coin',
            'label_your_rank_val': 'á‹¨áŠ¥áˆ­áˆµá‹ á‹°áˆ¨áŒƒ',
            'label_total_asset': 'áŒ á‰…áˆ‹áˆ‹ Coin',
            'label_withdrawable_balance': 'áˆŠá‹ˆáŒ£ á‹¨áˆšá‰½áˆ á‰€áˆª áˆ’áˆ³á‰¥',
            'label_withdraw_amount': 'áˆ›á‹áŒ£á‰µ á‹¨áˆšáˆáˆáŒ‰á‰µ áˆ˜áŒ áŠ•',
            'label_withdraw_method': 'á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡',
            'label_owned_coin': 'á‹«áˆá‹á‰µ coin',
            'label_exchange_rate': 'áˆá‹á‹áŒ¥ áˆáŒ£áŠ” (Rate)',
            'label_exchange_amount': 'áˆ˜á‰€á‹¨áˆ­ á‹¨áˆšáˆáˆáŒ‰á‰µ áˆ˜áŒ áŠ•',
            'label_selected_nums': 'á‹¨áˆ˜áˆ¨áŒ§á‰¸á‹ á‰áŒ¥áˆ®á‰½: [ ]',
            'label_accrued': 'áŠ¥áˆµáŠ«áˆáŠ• á‹¨á‰°áŒ áˆ«á‰€áˆ˜:',
            'label_total_reward': 'Total Reward:',
'label_wallet_connected': 'Wallet Connected',
'label_connect_wallet': 'Connect Wallet',
'label_connect_prompt': 'Connect >',
            // Buttons
            'btn_invite': 'áŒ“á‹°áŠ› áŒ‹á‰¥á‹',
            'btn_claim_coin': 'á‹áˆ°á‹µ coin',
            'btn_spin_start': 'áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‹­áŒ«áŠ‘ <br> SPIN',
            'btn_back_home': 'â† á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ',
            'btn_history': 'á‰³áˆªáŠ­',
            'btn_withdraw': 'á‹ˆáŒª áˆˆáˆ›á‹µáˆ¨áŒ',
            'btn_swap': 'á‰€á‹­áˆ­',
            'btn_airdrop': 'áŠ¤áˆ­á‹µáˆ®á•',
            'btn_change_lang': 'á‰‹áŠ•á‰‹ ',
            'btn_connect_wallet': 'á‹‹áˆŒá‰µ áŠ áŒˆáŠ“áŠ',
            'btn_support': 'áŠ¥áˆ­á‹³á‰³',
            'btn_close_app': 'á‹áŒ‹',
            'btn_withdraw_now': 'áŠ áˆáŠ• á‹ˆáŒª áŠ á‹µáˆ­áŒ',
            'btn_back_profile': 'â† á‹ˆá‹° Profile á‰°áˆ˜áˆˆáˆµ',
            'btn_exchange_now': 'áŠ áˆáŠ• á‰€á‹­áˆ­',
            'btn_random_pick': 'Random Pick (10 Numbers)',
            'btn_start_game': 'áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­',
            'btn_retry': 'áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©',
            'btn_check_code': 'CHECK CODE',
            'btn_claim_reward': 'CLAIM REWARD',
            'btn_spin': 'áŠ áˆ½áŠ¨áˆ­áŠ­áˆ­',
            'btn_loading': 'Loading...',
            'btn_processing': 'á‰ áˆ›áŠ«áˆ„á‹µ áˆ‹á‹­...', 
            'btn_claimed': 'á‰°á‹ˆáˆµá‹·áˆ!', 
            'btn_reset_spin': 'á‹³áŒáˆ áŠ áˆµáŒ€áˆáˆ¨á‹',
            'btn_completed': 'á‰°áŒ áŠ“á‰‹áˆ âœ…',
            'btn_checking': 'á‰ áˆ›áˆ¨áŒ‹áŒˆáŒ¥ áˆ‹á‹­ áŠá‹...',
            'btn_join': 'Join',
            'btn_subscribe': 'Subscribe',
'btn_claiming': 'Claiming...',
'btn_claim_reward_social': 'Claim Reward',
// áŠ¥áŠá‹šáˆ…áŠ• áˆµáˆá‰½ á‰  'en' á‹áˆµáŒ¥ áŠ«áˆ‰á‰µ áŒ‹áˆ­ á‰€á‹­áˆ«á‰¸á‹
'msg_checking_timer': 'Checking... ({seconds}s)',
'msg_claiming': 'Claiming...',
'msg_completed': 'Completed âœ…',

     'btn_spinning': 'SPINNING...',
     'btn_spin_default': 'áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‹­áŒ«áŠ‘ \n SPIN',
   'btn_back_home': 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ',
 'btn_processing_stake': 'Processing... ğŸ”„',
'btn_retry_claim': 'RETRY CLAIM',
'btn_withdraw_processing': 'PROCESSING...',
'btn_exchanging': 'á‰ áˆ˜á‰€á‹¨áˆ­ áˆ‹á‹­...',
   // Status & Messages
            'status_ready': 'Ready to Play!',
            'status_cooldown': 'áŒŠá‹œá‹ áŠ¥áˆµáŠªá‹«áˆá‰… á‹­áŒ á‰¥á‰',
            'msg_cooldown_24': 'áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢ áŠ¥á‰£áŠ­á‹ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢',
            'msg_coin_success': 'coin á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ¨áˆ˜áˆ¨!',
            'msg_login_failed': 'áŠ¥á‰£áŠ­á‹ áˆ˜á‰°áŒá‰ áˆªá‹«á‹ áŠ¥áˆµáŠªáŒ«áŠ• á‹­áŒ á‰¥á‰ (Login Failed).',
            'msg_new_data': 'áŠ á‹²áˆµ áˆ˜áˆ¨áŒƒ á‰°áˆáŒ áˆ¨ áŠ¥áŠ“ coin á‰°áŒ¨áˆ˜áˆ¨!',
            'msg_error_update': 'coin á‰ áˆ›á‹˜áˆ˜áŠ• áˆ‹á‹­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ áˆ¨á¢',
            'msg_invite_copied': 'âœ… á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ­ á‰°á‰€á‹µá‰·áˆ!',
            'msg_invite_fail': 'âŒ áˆŠáŠ•áŠ©áŠ• áˆ˜á‰…á‹³á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢',
            'msg_invite_share': 'âœ… áŠ¥á‰£áŠ­á‹ áˆŠáŠ•áŠ©áŠ• áˆˆáŒ“á‹°áŠá‰½á‹ Share á‰ áˆ›á‹µáˆ¨áŒ áŠ¥áŠ•á‹²á‰€áˆ‹á‰€áˆ‰ á‹­áŒ‹á‰¥á‹™!',
            'msg_task_completed': 'âœ… á‹­áˆ…áŠ• á‰°áŒá‰£áˆ­ áŠ áˆµá‰€á‹µáˆ˜á‹ áŠ áŒ áŠ“á‰€á‹‹áˆá¢',
            'msg_wait_15': 'â³ áŠ¥á‰£áŠ­á‹áŠ• á‰»áŠ“áˆ‰áŠ•/á‹©á‰²á‹©á‰¥áŠ• áŠ¨á‰°á‰€áˆ‹á‰€áˆ‰ á‰ áŠ‹áˆ‹ áˆˆ15 áˆ°áŠ¨áŠ•á‹µ á‹­áŒ á‰¥á‰á¢',
            'msg_spin_won': 'ğŸ¥³ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! +{amount} Coin áŠ áˆ¸áŠ•áˆá‹‹áˆ!',
            'msg_spin_0': 'ğŸ˜¢ áŠ áˆá‰°áˆ³áŠ«áˆ! 0 coiná¢',
            'msg_jackpot': 'ğŸ‰ JACKPOT! áŠ áˆ¸áŠ•áˆá‹‹áˆ!',
            'msg_try_again_tmrw': 'á‹›áˆ¬ á‰°áŒ«á‹á‰°á‹‹áˆá¢ áŠáŒˆ á‹­áˆáŠ­áˆ©á¢',
            'msg_wrong_code': 'âŒ á‹¨á‰°áˆ³áˆ³á‰° áŠ®á‹µ! áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢',
            'msg_correct_code': 'ğŸ‰ á‰µáŠ­áŠ­áˆ! Coin áŠ áŒáŠá‰°á‹‹áˆ!',
            'msg_insufficient': 'âŒ á‹­á‰…áˆ­á‰³á£ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢',
            'msg_swap_success': 'âœ… áˆá‹á‹áŒ¥ á‰°áˆ³áŠ­á‰·áˆ!',
            'msg_withdraw_pending': 'âš ï¸ áŒ¥á‹«á‰„á‹ á‰°áˆ˜á‹áŒá‰§áˆ (Pending)!',
            'msg_select_method': 'âš ï¸ áŠ¥á‰£áŠ­á‹ á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡á¢',
'msg_withdraw_fee_calc': 'Fee: {fee} | Total: {total} (To receive: {amount})',
'msg_withdraw_success_pending': 'âš ï¸ áŒ¥á‹«á‰„á‹ á‰°áˆ˜á‹áŒá‰§áˆ (Pending)! á‰ á‰…áˆ­á‰¥ á‰€áŠ• á‹­áŒ á‰¥á‰á¢',
'msg_exchange_min_error': 'âŒ áˆá‹á‹áŒ¡ á‰¢á‹«áŠ•áˆµ {amount} Coin á‹ˆá‹­áˆ á‰¥á‹œá‰¶á‰¹ áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µá¢',
            'msg_game_over': 'áŒ¨á‹‹á‰³á‹ á‰°áŒ áŠ“á‰‹áˆ!',
            'msg_too_early': 'âŒ á‰ áŒ£áˆ á‰€á‹µáˆ˜á‹‹áˆ! áŠ áˆ¨áŠ•áŒ“á‹´ áŠ¥áˆµáŠªáˆ†áŠ• áˆ˜áŒ á‰ á‰… áŠá‰ áˆ¨á‰¥á‹á¢',
            'msg_slot_no_spins': 'âŒ áˆáŠ•áˆ á‰€áˆª Spin á‹¨áˆˆá‹á‰µáˆá¢',
            'msg_mystery_fail': 'ğŸ˜¢ áŠ áˆá‰°áˆ³áŠ«áˆá¢ á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆ³áŒ¥áŠ• áˆŒáˆ‹ áŠá‰ áˆ­á¢',
            'msg_reflex_wait': 'á‰€á‹­ áŠ¥áˆµáŠªáˆ†áŠ• á‹­áŒ á‰¥á‰...',
            'msg_reflex_tap': 'áŠáŠ« á‹«á‹µáˆ­áŒ‰áŠ!',
            'msg_reflex_fail': 'âŒ áŒŠá‹œá‹ áŠ áˆááˆ! 0 coin',
            'msg_scratch_win': 'ğŸ‰ áŠ áˆ¸áŠ•áˆá‹‹áˆ!',
            'msg_keno_bet_placed': 'á‹áˆ­áˆ­á‹µá‹ á‰°á‰€á‰£á‹­áŠá‰µ áŠ áŒáŠá‰·áˆá¢ áŠ¥áŒ£á‹ á‰ áˆ‚á‹°á‰µ áˆ‹á‹­ áŠá‹á¢',
            'msg_keno_win': 'ğŸ‘ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! áŠ áˆ¸áŠ•áˆá‹‹áˆ!',
            'msg_keno_loss': 'ğŸ™ áŠ áˆá‰°áˆ³áŠ«áˆá¢ á‹áˆ­áˆ­á‹µ áŒ áá‰·áˆá¢',
            'msg_stake_success': 'âœ… á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ Stake á‰°á‹°áˆ­áŒ“áˆ!',
            'msg_stake_claim_success': 'ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! Coin á‹ˆá‹° áˆ‚áˆ³á‰¥á‹ áŒˆá‰¥á‰·áˆ!',      
            'msg_memory_win': 'ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆá‹á‰µ! áŠ áˆ¸áŠ•áˆá‹‹áˆ! +{amount} Coin áŠ áŒáŠá‰°á‹‹áˆ!', 
            'msg_memory_fail': 'ğŸ˜¢ áŒŠá‹œá‹ áŠ áˆˆá‰€! áŠ áˆá‰°áˆ³áŠ«áˆá¢',
            'msg_daily_gift': 'ğŸ á‹•áˆˆá‰³á‹Š áˆµáŒ¦á‰³',
            'msg_social_db_error': 'âŒ á‹¨á‹³á‰³á‰¤á‹ áˆµáˆ…á‰°á‰µ! áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢',
'msg_social_share_text': 'â€‹ğŸ¤« áˆšáˆµáŒ¥áˆ©áŠ• áˆáŠ•áŒˆáˆ­áˆ…?\nâ€‹á‰´áˆŒáŒáˆ«áˆ áˆ‹á‹­ á‰¥á‹™ áˆ°á‹á‰½ á‹¨áˆ›á‹«á‹á‰á‰µ Coin áˆ˜ááˆˆá‰‚á‹« áˆšáŠ’-áŠ á• áŠ áŒáŠá‰»áˆˆáˆ!\nâ€‹á‹­áˆ„ áŒŒáˆ áŠ á‹­á‹°áˆˆáˆâ€”áŠ¥á‹áŠá‰°áŠ› á‹•á‹µáˆ áŠá‹!\nâ€‹ğŸ’¡ áŠ¥áŠ”áŠ“ áŒ“á‹°áŠá‰¼ áŠ áˆáŠ• á‰ áŒáŠ•á‰£áˆ­ á‰€á‹°áˆá‰µáŠá‰µ áŒ€áˆáˆ¨áŠ“áˆ! á‰ áŠ‹áˆ‹ áŠ¥áŠ•á‹³á‰µá‰†áŒ­! \nâ€‹áŠ áˆáŠ‘áŠ‘ á‰°á‰€áˆ‹á‰…áˆˆáˆ… á‹¨á‹µáˆ áˆ˜áŠ•áŒˆá‹±áŠ• áŒ€áˆáˆ­:',
            
            
'msg_wait_loading': 'áŠ¥á‰£áŠ­á‹áŠ• á‰µáŠ•áˆ½ á‹­áŒ á‰¥á‰...',
'msg_no_players': 'áˆáŠ•áˆ á‰°áŒ«á‹‹á‰½ á‹¨áˆˆáˆá¢',
'msg_data_load_error': 'áˆ˜áˆ¨áŒƒá‹áŠ• áˆ›áˆáŒ£á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢',
'msg_referral_link_missing': 'áˆ˜áˆ¨áŒƒá‹ áŒˆáŠ“ áŠ áˆá‰°áŒ«áŠáˆá¢ áŠ¥á‰£áŠ­á‹ á‰µáŠ•áˆ½ á‰†á‹­á‰°á‹ á‹­áˆáŠ­áˆ©á¢',
'msg_support_telegram_only': 'Support á‹¨áˆšáˆ°áˆ«á‹ á‰ á‰´áˆŒáŒáˆ«áˆ á‹áˆµáŒ¥ á‰¥á‰» áŠá‹á¢',
'msg_close_telegram_only': 'á‹­áˆ… á‹¨áˆšáˆ°áˆ«á‹ á‰ á‰´áˆŒáŒáˆ«áˆ á‹áˆµáŒ¥ á‰¥á‰» áŠá‹á¢',
'msg_wallet_disconnect_confirm': 'Walletá‹áŠ• áˆ›á‰‹áˆ¨áŒ¥ á‹­áˆáˆáŒ‹áˆ‰?',
'msg_press_spin': 'Spin áˆˆáˆ›á‹µáˆ¨áŒ á‹­áŒ«áŠ‘á¢',
'msg_reset_ready': 'Ready to Reset!',
'msg_slot_finished_reset': 'Spin áŠ áˆá‰‹áˆ! áŠ á‹²áˆµ áˆ™áŠ¨áˆ« áˆˆáˆ˜áŒ€áˆ˜áˆ­ RESET & SPIN á‹­áŒ«áŠ‘á¢',
'msg_reset_timer': 'Reset in: {time}',
'msg_ready_to_reset_click': 'Ready to Reset! Click SPIN to get 10 more.',
'msg_pick_box': 'áˆ³áŒ¥áŠ• á‹­áˆáˆ¨áŒ¡!',
'msg_game_reset': 'áŒ¨á‹‹á‰³á‹ á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ!',
'msg_reflex_start_btn': 'áˆˆáˆ˜áŒ€áˆ˜áˆ­ áŠ¨á‰³á‰½ á‹«áˆˆá‹áŠ• á‰áˆá á‹­áŒ«áŠ‘á¢',
'msg_scratch_instruction': 'áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆá‰…áˆá‰… áˆ½áˆáˆ›á‰µá‹áŠ• á‹«áŒáŠ™!',
'msg_scratch_done': 'ğŸš«<br>áˆˆá‹›áˆ¬ á‰°áŒ áŠ“á‰‹áˆ',
'msg_scratch_wait': 'áŒŠá‹œá‹ áŠ¥áˆµáŠªá‹«áˆá‰… á‹­áŒ á‰¥á‰á¢',
'msg_stake_error_balance': 'âŒ á‹­áˆ…áŠ• á•áˆ‹áŠ• áˆˆáˆ˜áŒ á‰€áˆ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢',
'msg_stake_staked': 'Staking...',
'msg_stake_no_stake': 'Error: No Stake',
'msg_timer_completed': 'âœ… Completed!',
'msg_cipher_enter': 'âš ï¸ áŠ¥á‰£áŠ­á‹ áŠ®á‹µ á‹«áˆµáŒˆá‰¡á¢',
'msg_cipher_done_today': 'âŒ áˆˆá‹›áˆ¬ áŒ¨áˆ­áˆ°á‹‹áˆ! áŠáŒˆ á‹­áˆ˜áˆˆáˆ±á¢',
'msg_cipher_checking': 'Code á‰ áˆ›áˆ¨áŒ‹áŒˆáŒ¥ áˆ‹á‹­...',
'msg_cipher_limit': 'ğŸ›‘ á‹­á‰…áˆ­á‰³! á‹¨á‹›áˆ¬á‹ áˆ½áˆáˆ›á‰µ áŠ áˆá‰‹áˆá¢',
'msg_keno_no_coin': 'ğŸ˜” Coin áŠ áˆá‰‹áˆ! áˆˆáˆ˜áŒ«á‹ˆá‰µ á‰¢á‹«áŠ•áˆµ 100 Coin á‹«áˆµáˆáˆáŒá‹á‰³áˆá¢',
'msg_keno_high_bet': 'âš ï¸ á‹¨á‹áˆ­áˆ­á‹µ áˆ˜áŒ áŠ•á‹ áŠ¨Coiná‹ á‹­á‰ áˆáŒ£áˆá¢',
'msg_keno_select_one': 'â–¶ï¸ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ á‰áŒ¥áˆ­ á‹­áˆáˆ¨áŒ¡á¢',
'msg_keno_ready': 'âœ… á‰áŒ¥áˆ®á‰½ á‰°áˆ˜áˆ­áŒ á‹‹áˆ! áŠ áˆáŠ• BET á‹­áŒ«áŠ‘á¢',


            // Task Descriptions
            'task_scratch_desc': 'áŠ¥áˆˆá‰³á‹Š áŠ®á‹­áŠ•',
            'task_streak_desc': 'á‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ',
            'task_keno_desc': 'á‹­áŒ«á‹ˆá‰± & á‹«áˆ¸áŠ•á‹áˆ‰',
            'card_cipher_title': 'áŠ¥áˆˆá‰³á‹Š áˆšáˆµáŒ¥áˆ­ áŒ¨á‹‹á‰³',
            'card_cipher_desc': 'á‹¨á‹•áˆˆá‰±áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áŠ®á‹µ á‹­áá‰± (+50,000 Coin)',
            'card_memory_title': 'á‹¨áˆ›áˆµá‰³á‹ˆáˆµ áŒ¨á‹‹á‰³',
            'card_memory_desc': 'áŒ¥áŠ•á‹µ áŠ«áˆ­á‹¶á‰½áŠ• á‰ áˆ›áŒˆáŠ“áŠ˜á‰µ áŠ áŠ¥áˆáˆ®á‹áŠ• á‹­áˆá‰µáŠ‘!',
            'card_mystery_title': 'á‹¨áŠ¥á‹µáˆ áˆ³áŒ¥áŠ–á‰½',
            'card_mystery_desc': 'áˆšáˆµáŒ¥áˆ«á‹Š áˆ£áŒ¥áŠ• áŠ­áˆá‰µ áŠ¥áŠ“ á‹¨á‹˜áˆá‰€á‹° coin áŠ áŒáŠá¢',
            'card_spin_title': 'áŠ¥áˆˆá‰³á‹Š áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ',
            'card_spin_desc': 'á‹•áˆˆá‰³á‹Š áˆ½áŠ­áˆ­áŠ­áˆ­ (Spin) á‹«áˆ½áŠ¨áˆ­áŠ­áˆ©áŠ“ coin á‹«áˆ¸áŠ•á‰á¢',
            'card_reflex_title': 'á‹¨ááŒ¥áŠá‰µ áˆáˆ‹áˆ½ áŒ¨á‹‹á‰³',
            'card_reflex_desc': 'á‰ ááŒ¥áŠá‰µ áˆáˆ‹áˆ½ áˆ°áŒ¥á‰°á‹ coin á‹«áŒáŠ™á¢',
            'card_social_title': 'áˆ›áˆ…á‰ áˆ«á‹Š áŒ¨á‹‹á‰³',
            'card_social_desc': 'áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µáŠ• á‰ áˆ›áŒ áŠ“á‰€á‰… á‰°áŒ¨áˆ›áˆª coin á‹«áŒáŠ™!',
            'card_slots_title': 'á‹¨áŠ¥á‹µáˆ áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ',
            'card_slots_desc': 'áŠ¥áˆˆá‰³á‹Š áŠ¥áˆ½áŠ­áˆ­áŠ­áˆªá‰µ áŠ áˆ¸áŠ•áˆá‹ coin á‹«áŒáŠ™!',

            // Tabs & Rules
            'tab_live': 'Live',
            'tab_history': 'á‹¨áŒ¨á‹‹á‰³ á‰³áˆªáŠ­',
            'tab_results': 'Results',
            'title_keno_history': 'ğŸ“œ á‹«áˆˆá‰á‰µ áŒ¨á‹‹á‰³á‹á‰½ á‰³áˆªáŠ­ (Last 10 Games)',
            'title_keno_payout': 'ğŸ’° á‹¨áˆ½áˆáˆ›á‰µ áˆ°áŠ•áŒ áˆ¨á‹¥ (Payout Table)',
            'desc_keno_payout': 'á‰ áˆ˜áˆ¨áŒ¡á‰µ á‹¨á‰áŒ¥áˆ®á‰½ á‰¥á‹›á‰µ (Picks) áˆ˜áˆ áˆ¨á‰µ á‹¨áˆ›áˆ¸áŠá á‰¥á‹œá‰µ (Multiplier) á‹­áˆˆá‹«á‹«áˆá¢',
            'title_choose_stake': 'á‹¨ Stake áŠ áˆ›áˆ«áŒ­ á‹­áˆáˆ¨áŒ¡',
            'title_current_stake': 'áŠ áˆáŠ• á‹«áˆˆá‹ Stake',
            'rule_1': '"Stake" áˆ›áˆˆá‰µ áˆ³áŠ•á‰²áˆá‹áŠ• áˆˆá‰°á‹ˆáˆ°áŠ áŒŠá‹œ á‰ áˆ˜á‰†áˆˆá á‹ˆáˆˆá‹µ (á‰µáˆ­á) áˆ›áŒáŠ˜á‰µ áˆ›áˆˆá‰µ áŠá‹á¢',
            'rule_2': 'áŠ áŠ•á‹´ "Stake" áŠ«á‹°áˆ¨áŒ‰ á‰ áŠ‹áˆ‹á£ á‹«áˆµá‰€áˆ˜áŒ¡á‰µ áŒŠá‹œ (áˆˆáˆáˆ³áˆŒ 24 áˆ°á‹“á‰µ) áŠ¥áˆµáŠªá‹«áˆá‰… á‹µáˆ¨áˆµ áˆ³áŠ•á‰²áˆá‹áŠ• áˆ›á‹áŒ£á‰µ áŠ á‹­á‰½áˆ‰áˆá¢',
            'rule_3': 'áŒŠá‹œá‹ áˆ²á‹«áˆá‰… "Claim" á‹¨áˆšáˆˆá‹áŠ• á‰áˆá á‰ áˆ˜áŒ«áŠ• á‹‹áŠ“á‹áŠ• áˆ³áŠ•á‰²áˆ áŠ¨áŠá‹ˆáˆˆá‹± áˆ˜á‹áˆ°á‹µ áŠ áˆˆá‰¥á‹á‰µá¢', 
         
            // ğŸ›‘ áŠ á‹²áˆµ á‹¨á‰°áŒ¨áˆ˜áˆ© (áˆˆ Alerts áŠ¥áŠ“ JS Logic)
            'alert_invite_copied': 'âœ… á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ­ á‰°á‰€á‹µá‰·áˆ!',
            'alert_invite_fail': 'âŒ áˆŠáŠ•áŠ©áŠ• áˆ˜á‰…á‹³á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢',
            'alert_invite_share': 'âœ… áŠ¥á‰£áŠ­á‹ áˆŠáŠ•áŠ©áŠ• áˆˆáŒ“á‹°áŠá‰½á‹ Share á‰ áˆ›á‹µáˆ¨áŒ áŠ¥áŠ•á‹²á‰€áˆ‹á‰€áˆ‰ á‹­áŒ‹á‰¥á‹™!',
            'alert_task_completed': 'âœ… á‹­áˆ…áŠ• á‰°áŒá‰£áˆ­ áŠ áˆµá‰€á‹µáˆ˜á‹ áŠ áŒ áŠ“á‰€á‹‹áˆá¢',
            'alert_wait_15': 'â³ áŠ¥á‰£áŠ­á‹áŠ• á‰»áŠ“áˆ‰áŠ•/á‹©á‰²á‹©á‰¥áŠ• áŠ¨á‰°á‰€áˆ‹á‰€áˆ‰ á‰ áŠ‹áˆ‹ áˆˆ15 áˆ°áŠ¨áŠ•á‹µ á‹­áŒ á‰¥á‰á¢',
            'alert_coin_success': 'ğŸ‰ Coin á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ¨áˆ˜áˆ¨!',
            'alert_login_fail': 'áŠ¥á‰£áŠ­á‹ áˆ˜á‰°áŒá‰ áˆªá‹«á‹ áŠ¥áˆµáŠªáŒ«áŠ• á‹­áŒ á‰¥á‰ (Login Failed).',
            'alert_cooldown': 'âŒ á‹­áˆ… á‰°áŒá‰£áˆ­ áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢ áŠ¥á‰£áŠ­á‹ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢',
            
            // Slots Game
            'slot_jackpot': 'ğŸ‰ JACKPOT! +{amount} coin áŠ áˆ¸áŠ•áˆá‹‹áˆ!',
            'slot_win_3': 'ğŸ¥³ áˆ¶áˆµá‰µ á‰°áˆ˜áˆ³áˆ³á‹­! +{amount} coin áŠ áˆ¸áŠ•áˆá‹‹áˆá¢',
            'slot_win_2': 'á‰µáŠ•áˆ½ á‰€áˆ¨! +{amount} coin áŠ áˆ¸áŠ•áˆá‹‹áˆá¢',
            'slot_fail': 'ğŸ˜¢ áŠ áˆá‰°áˆ³áŠ«áˆ! 0 coiná¢',
            'slot_no_spins': 'âŒ áˆáŠ•áˆ á‰€áˆª Spin á‹¨áˆˆá‹á‰µáˆá¢',
            'slot_reset_success': 'âœ… Slot Game á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ! 10 Spin áŠ áŒáŠá‰°á‹‹áˆá¢',

            // Keno Game
            'keno_bet_error': 'á‰µáŠ­áŠ­áˆˆáŠ› á‹¨á‹áˆ­áˆ­á‹µ áˆ˜áŒ áŠ• á‹«áˆµáŒˆá‰¡ (Min 100 Coin)!',
            'keno_select_error': 'áŠ¥á‰£áŠ­á‹áŠ• á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ á‰áŒ¥áˆ­ á‹­áˆáˆ¨áŒ¡á¢',
            'keno_bet_placed': 'á‹áˆ­áˆ­á‹µ á‰ áˆ›áˆµáŒˆá‰£á‰µ áˆ‹á‹­...',
            'keno_low_balance': 'âŒ á‹áˆ­áˆ­á‹µ áŠ áˆá‰°áˆ³áŠ«áˆá¢ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢',
            'keno_win_msg': 'ğŸ‘ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! {matches} á‰°áˆ˜áˆ³áˆ³á‹­! {multiplier}x á‹«áˆ¸áŠ•á‰: +{amount} Coin',
            'keno_loss_msg': 'ğŸ™ áŠ áˆá‰°áˆ³áŠ«áˆá¢ {matches} á‰°áˆ˜áˆ³áˆ³á‹­á¢ á‹áˆ­áˆ­á‹µ áŒ áá‰·áˆá¢ (-{amount} Coin)',
            
            // Mystery Box
            'mystery_win': 'ğŸ¥³ áŠ áˆ¸áŠ•áˆá‹‹áˆ! {amount} coin!',
            'mystery_loss': 'ğŸ˜¢ áŠ áˆá‰°áˆ³áŠ«áˆá¢ á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆ³áŒ¥áŠ• á‰áŒ¥áˆ­ {box} áŠá‰ áˆ­á¢',

            // Reflex Game
            'reflex_too_early': 'âŒ á‰ áŒ£áˆ á‰€á‹µáˆ˜á‹‹áˆ! áŠ áˆ¨áŠ•áŒ“á‹´ áŠ¥áˆµáŠªáˆ†áŠ• áˆ˜áŒ á‰ á‰… áŠá‰ áˆ¨á‰¥á‹á¢',
            'reflex_timeout': 'âŒ áŒŠá‹œá‹ áŠ áˆááˆ! 0 coin',
            'reflex_win': 'ááŒ¥áŠá‰µá‹: {time}ms. áˆ½áˆáˆ›á‰µ: +{amount} coin!',

            // Staking
            'stake_insufficient': 'âŒ á‹­áˆ…áŠ• á•áˆ‹áŠ• áˆˆáˆ˜áŒ á‰€áˆ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢',
            'stake_processing': 'Staking...',
            'stake_success': 'âœ… {amount} Coin á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ Stake á‰°á‹°áˆ­áŒ“áˆ!',
            'stake_claim_success': 'ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! {amount} Coin á‹ˆá‹° áˆ‚áˆ³á‰¥á‹ áŒˆá‰¥á‰·áˆ!',

            // Withdraw & Exchange
            'withdraw_min_error': 'âš ï¸ á‹á‰…á‰°áŠ›á‹ á‹¨áˆ›á‹áŒ« áˆ˜áŒ áŠ• 100 áŠá‹á¢',
            'withdraw_balance_error': 'âš ï¸ á‰ á‰‚ Smart Coin á‹¨áˆˆá‹á‰µáˆá¢ (áŠ­áá‹«áŠ• áŒ¨áˆáˆ® {amount} á‹«áˆµáˆáˆáŒ‹áˆ)',
            'withdraw_pending': 'âš ï¸ áŒ¥á‹«á‰„á‹ á‰°áˆ˜á‹áŒá‰§áˆ (Pending)! á‰ á‰…áˆ­á‰¥ á‰€áŠ• á‹­áŒ á‰¥á‰á¢',
            'exchange_success': 'âœ… áˆá‹á‹áŒ¥ á‰°áˆ³áŠ­á‰·áˆ! +{amount} Smart Coin áŠ áŒáŠá‰°á‹‹áˆá¢',
            'exchange_fail': 'âŒ á‹­á‰…áˆ­á‰³á£ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢',
            
            // Buttons dynamic states
            'btn_processing': 'á‰ áˆ›áŠ«áˆ„á‹µ áˆ‹á‹­...',
            'btn_claimed': 'á‰°á‹ˆáˆµá‹·áˆ!',
            'btn_checking': 'Checking...',
            'btn_come_back': 'áŠáŒˆ á‹­áˆ˜áˆˆáˆ± ({time} á‰€áˆª)',
            'btn_locked': 'ğŸ”’ á‰°á‰†áˆááˆ',
            'msg_wait_loading': 'áŠ¥á‰£áŠ­á‹áŠ• á‰µáŠ•áˆ½ á‹­áŒ á‰¥á‰...',
'msg_no_players': 'áˆáŠ•áˆ á‰°áŒ«á‹‹á‰½ á‹¨áˆˆáˆá¢',
'msg_data_load_error': 'áˆ˜áˆ¨áŒƒá‹áŠ• áˆ›áˆáŒ£á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢',
'msg_referral_link_missing': 'áˆ˜áˆ¨áŒƒá‹ áŒˆáŠ“ áŠ áˆá‰°áŒ«áŠáˆá¢ áŠ¥á‰£áŠ­á‹ á‰µáŠ•áˆ½ á‰†á‹­á‰°á‹ á‹­áˆáŠ­áˆ©á¢',
'msg_support_telegram_only': 'Support á‹¨áˆšáˆ°áˆ«á‹ á‰ á‰´áˆŒáŒáˆ«áˆ á‹áˆµáŒ¥ á‰¥á‰» áŠá‹á¢',
'msg_close_telegram_only': 'á‹­áˆ… á‹¨áˆšáˆ°áˆ«á‹ á‰ á‰´áˆŒáŒáˆ«áˆ á‹áˆµáŒ¥ á‰¥á‰» áŠá‹á¢',
'msg_wallet_disconnect_confirm': 'Walletá‹áŠ• áˆ›á‰‹áˆ¨áŒ¥ á‹­áˆáˆáŒ‹áˆ‰?',
'msg_press_spin': 'Spin áˆˆáˆ›á‹µáˆ¨áŒ á‹­áŒ«áŠ‘á¢',
'msg_reset_ready': 'Ready to Reset!',
'msg_slot_finished_reset': 'Spin áŠ áˆá‰‹áˆ! áŠ á‹²áˆµ áˆ™áŠ¨áˆ« áˆˆáˆ˜áŒ€áˆ˜áˆ­ RESET & SPIN á‹­áŒ«áŠ‘á¢',
'msg_reset_timer': 'Reset in: {time}',
'msg_ready_to_reset_click': 'Ready to Reset! Click SPIN to get 10 more.',
'msg_pick_box': 'áˆ³áŒ¥áŠ• á‹­áˆáˆ¨áŒ¡!',
'msg_game_reset': 'áŒ¨á‹‹á‰³á‹ á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ!',
'msg_reflex_start_btn': 'áˆˆáˆ˜áŒ€áˆ˜áˆ­ áŠ¨á‰³á‰½ á‹«áˆˆá‹áŠ• á‰áˆá á‹­áŒ«áŠ‘á¢',
'msg_scratch_instruction': 'áŠ«áˆ­á‹±áŠ• á‰ áˆ˜áˆá‰…áˆá‰… áˆ½áˆáˆ›á‰µá‹áŠ• á‹«áŒáŠ™!',
'msg_scratch_done': 'ğŸš«<br>áˆˆá‹›áˆ¬ á‰°áŒ áŠ“á‰‹áˆ',
'msg_scratch_wait': 'áŒŠá‹œá‹ áŠ¥áˆµáŠªá‹«áˆá‰… á‹­áŒ á‰¥á‰á¢',
'msg_stake_error_balance': 'âŒ á‹­áˆ…áŠ• á•áˆ‹áŠ• áˆˆáˆ˜áŒ á‰€áˆ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢',
'msg_stake_staked': 'Staking...',
'msg_stake_no_stake': 'Error: No Stake',
'msg_timer_completed': 'âœ… Completed!',
'msg_cipher_enter': 'âš ï¸ áŠ¥á‰£áŠ­á‹ áŠ®á‹µ á‹«áˆµáŒˆá‰¡á¢',
'msg_cipher_done_today': 'âŒ áˆˆá‹›áˆ¬ áŒ¨áˆ­áˆ°á‹‹áˆ! áŠáŒˆ á‹­áˆ˜áˆˆáˆ±á¢',
'msg_cipher_checking': 'Code á‰ áˆ›áˆ¨áŒ‹áŒˆáŒ¥ áˆ‹á‹­...',
'msg_cipher_limit': 'ğŸ›‘ á‹­á‰…áˆ­á‰³! á‹¨á‹›áˆ¬á‹ áˆ½áˆáˆ›á‰µ áŠ áˆá‰‹áˆá¢',
'msg_keno_no_coin': 'ğŸ˜” Coin áŠ áˆá‰‹áˆ! áˆˆáˆ˜áŒ«á‹ˆá‰µ á‰¢á‹«áŠ•áˆµ 100 Coin á‹«áˆµáˆáˆáŒá‹á‰³áˆá¢',
'msg_keno_high_bet': 'âš ï¸ á‹¨á‹áˆ­áˆ­á‹µ áˆ˜áŒ áŠ•á‹ áŠ¨Coiná‹ á‹­á‰ áˆáŒ£áˆá¢',
'msg_keno_select_one': 'â–¶ï¸ áˆˆáˆ˜áŒ€áˆ˜áˆ­ á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ á‰áŒ¥áˆ­ á‹­áˆáˆ¨áŒ¡á¢',
'msg_keno_ready': 'âœ… á‰áŒ¥áˆ®á‰½ á‰°áˆ˜áˆ­áŒ á‹‹áˆ! áŠ áˆáŠ• BET á‹­áŒ«áŠ‘á¢',
    'keno_game_title': 'KENO GAME',
'label_picks_count': '{current} á‹¨á‰°áˆ˜áˆ¨áŒ¡ | áŠ¥áˆµáŠ¨ {max} áˆ˜áˆáˆ¨áŒ¥ á‹­á‰½áˆ‹áˆ‰',
'label_your_picks': 'á‹¨áˆ˜áˆ¨áŒ§á‰¸á‹ á‰áŒ¥áˆ®á‰½:',
'msg_keno_max_picks_reached': 'á‰¢á‰ á‹› {count} á‰áŒ¥áˆ®á‰½ á‰¥á‰» áˆ˜áˆáˆ¨áŒ¥ á‹­á‰½áˆ‹áˆ‰á¢',
'msg_keno_random_selected': 'á‰ á‹˜áˆá‰€á‹° {count} á‰áŒ¥áˆ®á‰½ á‰°áˆ˜áˆ­áŒ á‹‹áˆá¢ BET á‹­áŒ«áŠ‘á¢',
'status_in_progress': 'á‰ áˆ‚á‹°á‰µ áˆ‹á‹­...',
'status_drawing': 'áŠ¥áŒ£á‹ á‰ áˆ‚á‹°á‰µ áˆ‹á‹­ áŠá‹á¢',
'status_completed': 'á‹áŒ¤á‰µ: á‰°áŒ áŠ“á‰‹áˆ',
'status_waiting': 'Waiting...',
'label_matches': 'Matches',
'label_multiplier': 'Multiplier (x)',
'label_hit': 'Hit',
'label_hits': 'Hits',
'label_pick': 'Pick',
'label_picks': 'Picks',
'label_game_num': 'Game #',
'label_result': 'Result',
'label_won': 'Won',
'label_lost': 'Lost',
'btn_show_drawn': 'á‹¨á‹ˆáŒ¡ á‰áŒ¥áˆ®á‰½áŠ• áŠ áˆ³á‹­',
'msg_no_list': 'á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢',
'alert_mystery_cooldown': 'âŒ á‹­áˆ… áˆ³áŒ¥áŠ• áˆˆ24 áˆ°á‹“á‰µ á‰°á‹˜áŒá‰·áˆá¢',
            'alert_mystery_loss_try_again': 'ğŸ˜¢ á‰£á‹¶ áˆ³áŒ¥áŠ•! áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢',
            'btn_go_home': 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ',
            'msg_wait_cooldown': 'áŒŠá‹œá‹ áŠ¥áˆµáŠªá‹«áˆá‰… á‹­áŒ á‰¥á‰á¢',
            'scratch_text': 'á‹­áˆá‰…áá‰',
            'scratch_daily_limit_reached': 'á‹¨á‹›áˆ¬á‹ áŠ áˆá‰‹áˆ!',
            'scratch_win_msg': 'ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! +{amount} Coin áŠ áŒáŠá‰°á‹‹áˆ!',
            'scratch_error_giving_prize': 'âŒ áˆ½áˆáˆ›á‰±áŠ• áˆ˜áˆµáŒ á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢',
            'alert_memory_cooldown': 'âŒ á‹¨áˆ›áˆµá‰³á‹ˆáˆµ áŒ¨á‹‹á‰³ áˆˆ24 áˆ°á‹“á‰µ á‰°á‹˜áŒá‰·áˆá¢',
            'msg_timer_display': 'á‰€áˆª áŒŠá‹œ: {time} áˆ°áŠ¨áŠ•á‹µ',
            'msg_memory_timeout': 'âŒ áŒŠá‹œá‹ áŠ áˆá‰‹áˆ! áŠ áˆá‰°áˆ³áŠ«áˆá¢',
            'alert_config_error': 'âŒ á‹¨áˆ²áˆµá‰°áˆ áˆµáˆ…á‰°á‰µ (Config Missing)',
            'msg_checking_code': 'áŠ®á‹±áŠ• á‰ áˆ›áˆ¨áŒ‹áŒˆáŒ¥ áˆ‹á‹­...',
            'alert_db_error': 'âŒ á‹¨á‹³á‰³á‰¤á‹ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆá¢',

'label_bet_amount': 'áˆ˜á‹ˆáˆ«áˆ¨áŒƒ áˆ˜áŒ áŠ•',
'label_mines_count': 'á‹¨á‰¦áˆá‰¥ á‰¥á‹›á‰µ (1-20)',
'btn_bet_start': 'BET & START',
'btn_cashout': 'ğŸ’° áŒˆáŠ•á‹˜á‰¥ á‹­á‹áˆ°á‹± (CASHOUT)',
'plan_bronze': 'á‹¨áŠáˆáˆµ áŠ¥á‰…á‹µ (Bronze)',
'plan_silver': 'á‹¨á‰¥áˆ­ áŠ¥á‰…á‹µ (Silver)',
'plan_gold': 'á‹¨á‹ˆáˆ­á‰… áŠ¥á‰…á‹µ (Gold)',
'placeholder_code': 'áŠ®á‹±áŠ• áŠ¥á‹šáˆ… á‹«áˆµáŒˆá‰¡',
'btn_start_game': 'áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­',
'mines_info': 'áˆáŠ•áŒ‚á‹áŠ• áˆ³á‹­áŠáŠ© áŠ áˆáˆ›á‹á‰½áŠ• á‹­áˆ°á‰¥áˆµá‰¡! á‰¥á‹™ áŠ áˆáˆ›á‹ á‰£áŒˆáŠ™ á‰áŒ¥áˆ­á£ áˆ½áˆáˆ›á‰± á‹­áŒ¨áˆáˆ«áˆá¢',
'label_next_multi': 'á‰€áŒ£á‹­ á‰¥á‹œá‰µ:',
'label_current_win': 'á‹«áˆ¸áŠá‰á‰µ:',
'btn_take_money': 'ğŸ’° áŒˆáŠ•á‹˜á‰¥ á‹­á‹áˆ°á‹±',
'msg_mines_bomb': 'ğŸ’£ á‰¦áˆá‰¥! á‰°áˆ¸áŠ•áˆá‹‹áˆá¢',
'msg_mines_win': 'ğŸ‰ áŠ áˆ¸áŠ•áˆá‹‹áˆ! +{amount} Coin',
'msg_memory_win': 'ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆá‹á‰µ! áŠ áˆ¸áŠ•áˆá‹‹áˆ! +{amount} Coin áŠ áŒáŠá‰°á‹‹áˆ!',
'msg_memory_timeout': 'ğŸ˜¢ áŒŠá‹œá‹ áŠ áˆˆá‰€! áŠ áˆá‰°áˆ³áŠ«áˆá¢',
'msg_timer_display': 'á‰€áˆª áŒŠá‹œ: {time} áˆ°áŠ¨áŠ•á‹µ',
'cipher_info': 'á‹¨á‹›áˆ¬á‹áŠ• áˆšáˆµáŒ¥áˆ«á‹Š áŠ®á‹µ (Morse/Text) á‹«áˆµáŒˆá‰¡!',
        'cipher_hint': 'áŠ®á‹±áŠ• áˆˆáˆ›áŒáŠ˜á‰µ á‹¨á‰´áˆŒáŒáˆ«áˆ á‰»áŠ“áˆ‹á‰½áŠ•áŠ• á‹­áŠ¨á‰³á‰°áˆ‰á¢',
        'spin_info': 'á‹•á‹µáˆˆáŠ›á‹ áˆ½áŠ­áˆ­áŠ­áˆªá‰µ (Spin) á‹«áˆ½áŠ¨áˆ­áŠ­áˆ© áŠ¥áŠ“ coin á‹«áŒáŠ™!',
        'status_ready': 'áˆˆáˆ˜áŒ«á‹ˆá‰µ á‹áŒáŒ! (Ready)',
        'placeholder_code': 'áŠ®á‹±áŠ• áŠ¥á‹šáˆ… á‹«áˆµáŒˆá‰¡'
   },
        
        'en': {
            // Nav
            'nav_tasks': 'Tasks',
            'nav_stake': 'Stake',
            'nav_top': 'Top',
            'nav_profile': 'Profile',

            // Titles & Headers
            'title_daily_tasks': 'Daily Tasks',
            'loading_text': 'SMART AIRDROP Loading...',
            'invite_bonus_title': '+500 Coin Gift',
            'title_slots': 'Lucky Slot Machine',
            'slots_main_title': 'Lucky',
            'slots_sub_title': 'Daily Spin',
            'title_top_users': 'TOP USERS',
            'title_leaderboard': 'ğŸ¥‡ Top Users (Top 50)',
            'title_settings': 'Settings',
            'title_withdraw_page': 'ğŸ’¸ Withdrawal',
            'title_exchange': 'âš¡ï¸ SMART COIN EXCHANGE âš¡ï¸',
            'title_history': 'ğŸ“œ Transaction History',
            'title_stake': 'ğŸ’° Stake & Earn ğŸ’°',
            'title_stake_history': 'ğŸ“œ Stake History',
            'title_stake_rules': 'âš–ï¸ Rules',

            // Labels
            'label_total_coin': 'Total coin :',
            'label_spins_left': 'Spins Left',
            'label_your_rank': 'ğŸ‘¤ Your Rank',
            'label_your_coin': 'Your coin',
            'label_your_rank_val': 'Your Rank',
            'label_total_asset': 'Total Coin',
            'label_withdrawable_balance': 'Withdrawable Balance',
            'label_withdraw_amount': 'Amount to Withdraw',
            'label_withdraw_method': 'Select Method',
            'label_owned_coin': 'Your coin',
            'label_exchange_rate': 'Exchange Rate',
            'label_exchange_amount': 'Amount to Exchange',
            'label_selected_nums': 'Selected Numbers: [ ]',
            'label_accrued': 'Accrued Interest:',
            'label_total_reward': 'Total Reward:',
'label_wallet_connected': 'Wallet Connected',
'label_connect_wallet': 'Connect Wallet',
'label_connect_prompt': 'Connect >',
            // Buttons
            'btn_invite': 'Invite Friends',
            'btn_claim_coin': 'Claim coin',
            'btn_spin_start': 'Press to Spin <br> SPIN',
            'btn_back_home': 'â† Back to Home',
            'btn_history': 'History',
            'btn_withdraw': 'Withdraw',
            'btn_swap': 'Swap',
            'btn_airdrop': 'Airdrop',
            'btn_change_lang': 'Change Language',
            'btn_connect_wallet': 'Connect to Wallet',
            'btn_support': 'Support',
            'btn_close_app': 'Close App',
            'btn_withdraw_now': 'WITHDRAW NOW',
            'btn_back_profile': 'â† Back to Profile',
            'btn_exchange_now': 'EXCHANGE NOW',
            'btn_random_pick': 'Random Pick (10 Numbers)',
            'btn_start_game': 'Start Game',
            'btn_retry': 'Try Again',
            'btn_check_code': 'CHECK CODE',
            'btn_claim_reward': 'CLAIM REWARD',
            'btn_spin': 'Spin',
            'btn_loading': 'Loading...',
            'btn_processing': 'Processing...', 
            'btn_claimed': 'CLAIMED!',
            'btn_reset_spin': 'RESET & SPIN',
            'btn_completed': 'Completed âœ…',
            'btn_checking': 'Checking...',
            'btn_join': 'Join',
           'btn_exchanging': 'Exchanging...',
            'btn_subscribe': 'Subscribe',
'btn_claiming': 'Claiming...',
'btn_claim_reward_social': 'Claim Reward',
'msg_checking_timer': 'Checking... ({seconds}s)',
'msg_claiming': 'Claiming...',
'msg_completed': 'Completed âœ…',

 'btn_spin_default': 'Press to Start \n SPIN',
    'btn_spinning': 'SPINNING...',
   'btn_back_home': 'Back to Home',
  'btn_processing_stake': 'Processing... ğŸ”„',
'btn_retry_claim': 'RETRY CLAIM',
'btn_withdraw_processing': 'PROCESSING...',
  // Status & Messages
            'status_ready': 'Ready to Play!',
            'status_cooldown': 'Wait for cooldown',
            'msg_cooldown_24': 'Available only every 24 hours. Please wait for the cooldown.',
            'msg_coin_success': 'coins added successfully!',
            'msg_login_failed': 'Please wait for the app to load (Login Failed).',
            'msg_new_data': 'New data created and coins added!',
            'msg_error_update': 'Error updating coins.',
            'msg_invite_copied': 'âœ… Invite link copied!',
            'msg_invite_fail': 'âŒ Failed to copy link.',
            'msg_invite_share': 'âœ… Please share the link to invite friends!',
            'msg_task_completed': 'âœ… You have already completed this task.',
            'msg_wait_15': 'â³ Please wait 15 seconds after joining.',
            'msg_spin_won': 'ğŸ¥³ Congratulations! You won +{amount} coins!',
            'msg_spin_0': 'ğŸ˜¢ Failed! 0 coins.',
            'msg_jackpot': 'ğŸ‰ JACKPOT! You won!',
            'msg_try_again_tmrw': 'You played today. Come back tomorrow.',
            'msg_wrong_code': 'âŒ Wrong code! Try again.',
            'msg_correct_code': 'ğŸ‰ Correct! Coins received!',
            'msg_insufficient': 'âŒ Sorry, insufficient coins.',
            'msg_swap_success': 'âœ… Swap successful!',
            'msg_withdraw_pending': 'âš ï¸ Request Registered (Pending)!',
            'msg_game_over': 'Game Over!',
            'msg_too_early': 'âŒ Too early! Wait for green.',
            'msg_slot_no_spins': 'âŒ No spins left.',
            'msg_mystery_fail': 'ğŸ˜¢ Failed. The correct box was different.',
            'msg_reflex_wait': 'Wait for red...',
            'msg_reflex_tap': 'TAP ME!',
            'msg_reflex_fail': 'âŒ Time out! 0 coin',
            'msg_scratch_win': 'ğŸ‰ You Won!',
            'msg_keno_bet_placed': 'Bet placed. Draw in progress...',
            'msg_keno_win': 'ğŸ‘ Congratulations! You Won!',
            'msg_keno_loss': 'ğŸ™ Failed. Bet lost.',
            'msg_stake_success': 'âœ… Staked successfully!',
            'msg_stake_claim_success': 'ğŸ‰ Claimed successfully!',
            'msg_memory_win': 'ğŸ‰ You Won! +{amount} Coins!',
            'msg_memory_fail': 'ğŸ˜¢ Time up! Failed.',
            'msg_daily_gift': 'ğŸ Daily Gift',
'msg_wait_loading': 'Please wait a moment...',
'msg_no_players': 'No players found.',
'msg_data_load_error': 'Could not load data.',
'msg_referral_link_missing': 'Data not loaded yet. Please try again later.',
'msg_support_telegram_only': 'Support can only be accessed within Telegram.',
'msg_close_telegram_only': 'This can only be closed from within Telegram.',
'msg_wallet_disconnect_confirm': 'Do you want to disconnect your wallet?',
      'msg_social_db_error': 'âŒ Database Error! Please try again.',
'msg_social_share_text': 'ğŸ¤« Want to know a secret?\nI found a Coin mining Mini-App on Telegram that many don\'t know about yet!\n?? Join now and start winning!',
'msg_press_spin': 'Press to Spin.',
'msg_reset_ready': 'Ready to Reset!',
'msg_slot_finished_reset': 'No Spins! Press RESET & SPIN to get more.',
'msg_reset_timer': 'Reset in: {time}',
'msg_ready_to_reset_click': 'Ready to Reset! Click SPIN to get 10 more.',
'msg_pick_box': 'Pick a box!',
'msg_game_reset': 'Game has been reset!',
'msg_reflex_start_btn': 'Press the button below to start.',
'msg_scratch_instruction': 'Scratch the card to reveal your prize!',
'msg_scratch_done': 'ğŸš«<br>Done for today',
'msg_scratch_wait': 'Please wait for cooldown.',
'msg_stake_error_balance': 'âŒ Insufficient Coins for this plan.',
'msg_stake_staked': 'Staking...',
'msg_stake_no_stake': 'Error: No Stake',
'msg_timer_completed': 'âœ… Completed!',
'msg_cipher_enter': 'âš ï¸ Please enter a code.',
'msg_cipher_done_today': 'âŒ Done for today! Come back tomorrow.',
'msg_cipher_checking': 'Verifying Code...',
'msg_cipher_limit': 'ğŸ›‘ Sorry! Today\'s limit reached.',
'msg_keno_no_coin': 'ğŸ˜” Out of Coins! Minimum 100 Coins needed.',
'msg_keno_high_bet': 'âš ï¸ Bet amount exceeds your balance.',
'msg_keno_select_one': 'â–¶ï¸ Select at least one number to start.',
'msg_keno_ready': 'âœ… Numbers selected! Press BET now.',
'msg_select_method': 'âš ï¸ Please select a withdrawal method.',
'msg_withdraw_fee_calc': 'Fee: {fee} | Total: {total} (To receive: {amount})',
'msg_withdraw_success_pending': 'âš ï¸ Request Registered (Pending)! Stay tuned.',
'msg_exchange_min_error': 'âŒ Exchange must be at least {amount} Coins or multiples.',
'msg_wait_loading': 'Please wait a moment...',
'msg_no_players': 'No players found.',
'msg_data_load_error': 'Could not load data.',
'msg_referral_link_missing': 'Data not loaded yet. Please try again later.',
'msg_support_telegram_only': 'Support can only be accessed within Telegram.',
'msg_close_telegram_only': 'This can only be closed from within Telegram.',
'msg_wallet_disconnect_confirm': 'Do you want to disconnect your wallet?',
'msg_press_spin': 'Press to Spin.',
'msg_reset_ready': 'Ready to Reset!',
'msg_slot_finished_reset': 'No Spins! Press RESET & SPIN to get more.',
'msg_reset_timer': 'Reset in: {time}',
'msg_ready_to_reset_click': 'Ready to Reset! Click SPIN to get 10 more.',
'msg_pick_box': 'Pick a box!',
'msg_game_reset': 'Game has been reset!',
'msg_reflex_start_btn': 'Press the button below to start.',
'msg_scratch_instruction': 'Scratch the card to reveal your prize!',
'msg_scratch_done': 'ğŸš«<br>Done for today',
'msg_scratch_wait': 'Please wait for cooldown.',
'msg_stake_error_balance': 'âŒ Insufficient Coins for this plan.',
'msg_stake_staked': 'Staking...',
'msg_stake_no_stake': 'Error: No Stake',
'msg_timer_completed': 'âœ… Completed!',
'msg_cipher_enter': 'âš ï¸ Please enter a code.',
'msg_cipher_done_today': 'âŒ Done for today! Come back tomorrow.',
'msg_cipher_checking': 'Verifying Code...',
'msg_cipher_limit': 'ğŸ›‘ Sorry! Today\'s limit reached.',
'msg_keno_no_coin': 'ğŸ˜” Out of Coins! Minimum 100 Coins needed.',
'msg_keno_high_bet': 'âš ï¸ Bet amount exceeds your balance.',
'msg_keno_select_one': 'â–¶ï¸ Select at least one number to start.',
'msg_keno_ready': 'âœ… Numbers selected! Press BET now.',


      // Task Descriptions
            'task_scratch_desc': 'Daily Coin',
            'task_streak_desc': 'Daily Reward',
            'task_keno_desc': 'Play & Win',
            'card_cipher_title': 'Daily Cipher',
            'card_cipher_desc': 'Crack the code (+50,000 Coin)',
            'card_memory_title': 'Memory Match',
            'card_memory_desc': 'Challenge your mind by matching cards!',
            'card_mystery_title': 'Mystery Box Game',
            'card_mystery_desc': 'Open a box and get random coins.',
            'card_spin_title': 'Daily Spin',
            'card_spin_desc': 'Spin the wheel and win coins.',
            'card_reflex_title': 'Reflex Game',
            'card_reflex_desc': 'React fast and earn coins.',
            'card_social_title': 'Social Tasks',
            'card_social_desc': 'Complete social tasks for big coins!',
            'card_slots_title': 'Lucky Slot Game',
            'card_slots_desc': 'Win daily spin coins!',

            // Tabs & Rules
            'tab_live': 'Live',
            'tab_history': 'History',
            'tab_results': 'Results',
            'title_keno_history': 'ğŸ“œ Past Games History (Last 10)',
            'title_keno_payout': 'ğŸ’° Payout Table',
            'desc_keno_payout': 'Multiplier varies based on number of Picks.',
            'title_choose_stake': 'Choose Staking Option',
            'title_current_stake': 'Current Stake',
            'rule_1': '"Stake" means locking your coins for a period to earn interest.',
            'rule_2': 'Once staked, you cannot withdraw until the duration (e.g., 24h) ends.',
            'rule_3': 'When time is up, press "Claim" to get your principal plus interest.', 
            
            // ğŸ›‘ NEW ADDITIONS (Must match Amharic keys)
            'alert_invite_copied': 'âœ… Invite link copied!',
            'alert_invite_fail': 'âŒ Failed to copy link.',
            'alert_invite_share': 'âœ… Please share the link to invite friends!',
            'alert_task_completed': 'âœ… You have already completed this task.',
            'alert_wait_15': 'â³ Please wait 15 seconds after joining.',
            'alert_coin_success': 'ğŸ‰ Coins added successfully!',
            'alert_login_fail': 'Please wait for app to load (Login Failed).',
            'alert_cooldown': 'âŒ Available only every 24 hours. Please wait.',

            // Slots Game
            'slot_jackpot': 'ğŸ‰ JACKPOT! You won +{amount} coins!',
            'slot_win_3': 'ğŸ¥³ Three Match! You won +{amount} coins.',
            'slot_win_2': 'So Close! You won +{amount} coins.',
            'slot_fail': 'ğŸ˜¢ Failed! 0 coins.',
            'slot_no_spins': 'âŒ No spins left.',
            'slot_reset_success': 'âœ… Slot Game Reset! You got 10 Spins.',

            // Keno Game
            'keno_bet_error': 'Enter valid bet amount (Min 100 Coin)!',
            'keno_select_error': 'Please select at least one number.',
            'keno_bet_placed': 'Placing bet...',
            'keno_low_balance': 'âŒ Bet failed. Insufficient Coins.',
            'keno_win_msg': 'ğŸ‘ Congratulations! {matches} Matches! {multiplier}x Win: +{amount} Coin',
            'keno_loss_msg': 'ğŸ™ Failed. {matches} Matches. Bet Lost. (-{amount} Coin)',

            // Mystery Box
            'mystery_win': '?? You won! {amount} coins!',
            'mystery_loss': 'ğŸ˜¢ Failed. The correct box was number {box}.',

            // Reflex Game
            'reflex_too_early': 'âŒ Too early! Wait for green.',
            'reflex_timeout': 'âŒ Time out! 0 coin',
            'reflex_win': 'Speed: {time}ms. Reward: +{amount} coins!',

            // Staking
            'stake_insufficient': 'âŒ Insufficient coins for this plan.',
            'stake_processing': 'Staking...',
            'stake_success': 'âœ… {amount} Coins staked successfully!',
            'stake_claim_success': 'ğŸ‰ Congratulations! {amount} Coins claimed!',

            // Withdraw & Exchange
            'withdraw_min_error': 'âš ï¸ Minimum withdrawal is 100.',
            'withdraw_balance_error': 'âš ï¸ Insufficient Smart Coins. (Need {amount} including fee)',
            'withdraw_pending': 'âš ï¸ Request Registered (Pending)! Stay tuned.',
            'exchange_success': 'âœ… Swap Successful! +{amount} Smart Coins received.',
            'exchange_fail': 'âŒ Sorry, insufficient Coins.',

            // Buttons dynamic states
            'btn_processing': 'Processing...',
            'btn_claimed': 'CLAIMED!',
            'btn_checking': 'Checking...',
            'btn_come_back': 'Come back tomorrow ({time} left)',
            'btn_locked': 'ğŸ”’ Locked',
'keno_game_title': 'KENO GAME',
'label_picks_count': '{current} Picks | Select up to {max} numbers',
'label_your_picks': 'Your Picks:',
'msg_keno_max_picks_reached': 'You can select max {count} numbers.',
'msg_keno_random_selected': 'Random {count} numbers selected. Press BET.',
'status_in_progress': 'In Progress...',
'status_drawing': 'Drawing in progress...',
'status_completed': 'Result: Completed',
'status_waiting': 'Waiting...',
'label_matches': 'Matches',
'label_multiplier': 'Multiplier (x)',
'label_hit': 'Hit',
'label_hits': 'Hits',
'label_pick': 'Pick',
'label_picks': 'Picks',
'label_game_num': 
'Game #',
'label_result': 'Result:',
'label_won': 'Won',
'label_lost': 'Lost',
'btn_show_drawn':
 'Show Drawn Numbers',
'msg_no_list': 'No history list',
'alert_mystery_cooldown': 'âŒ This box is on cooldown for 24h.',
            'alert_mystery_loss_try_again': 'ğŸ˜¢ Empty box! Please try again.',
            'btn_go_home': 'Go to Home',
            'msg_wait_cooldown': 'Please wait for cooldown.',
            'scratch_text': 'SCRATCH HERE',
            'scratch_daily_limit_reached': 'Daily Limit Reached!',
            'scratch_win_msg': 'ğŸ‰ Congratulations! You won +{amount} Coins!',
            'scratch_error_giving_prize': 'âŒ Error giving prize.',
            'alert_memory_cooldown': 'âŒ Memory game is on cooldown for 24h.',
            'msg_timer_display': 'Time Left: {time}s',
            'msg_memory_timeout': 'âŒ Time is up! Failed.',
            'alert_config_error': 'âŒ System Error (Config Missing)',
            'msg_checking_code': 'Verifying code...',
            'alert_db_error': 'âŒ Database Error occurred.',
            // á‰  translations['en'] á‹áˆµáŒ¥ á‹­áˆ…áŠ• áŒ¨áˆáˆ­:
'label_bet_amount': 'Bet Amount',
'label_mines_count': 'Mines Count (1-20)',
'btn_bet_start': 'BET & START',
'btn_cashout': 'ğŸ’° CASHOUT',
'plan_bronze': 'Bronze Plan',
'plan_silver': 'Silver Plan',
'plan_gold': 'Gold Plan',
'placeholder_code': 'CODE HERE',
'btn_start_game': 'Start Game',
'mines_info': 'Collect diamonds without hitting mines! The more you find, the more you win.',
'label_next_multi': 'Next Multiplier:',
'label_current_win': 'Current Win:',
'btn_take_money': 'ğŸ’° TAKE',
'msg_mines_bomb': 'ğŸ’£ BOMB! You lost.',
'msg_mines_win': 'ğŸ‰ You Won! +{amount} Coins',
'msg_memory_win': 'ğŸ‰ You Won! +{amount} Coins!',
'msg_memory_timeout': 'ğŸ˜¢ Time up! Failed.',
'msg_timer_display': 'Time Left: {time}s',
'cipher_info': 'Enter today\'s secret code (Morse/Text)!',
        'cipher_hint': 'Join our Telegram channel to get the code.',
        'spin_info': 'Spin the lucky wheel and win coins!',
        'status_ready': 'Ready to Play!',
        'placeholder_code': 'ENTER CODE HERE'
    


   }
    };

    let currentLanguage = localStorage.getItem('selectedLanguage') || 'en';
// á‹­áˆ…áŠ•áŠ• áˆ˜áˆµáˆ˜áˆ­ updateAppLanguage áˆáŠ•áŠ­áˆ½áŠ• áŠ«áˆˆá‰ á‰µ á‰¦á‰³ á‰ á‰³á‰½ áŒ¨áˆáˆ­
window.changeLanguage = updateAppLanguage;

// á‹­áˆ…áŠ•áŠ• á‰°áŒá‰£áˆ­ áˆµáŠ­áˆªá•á‰± áŠ áŠ“á‰µ áˆ‹á‹­ áŠ áˆµá‰€áˆáŒ¥
function t(key, params = {}) {
    let text = translations[currentLanguage][key] || key;
    
    // áˆˆá‰°áˆˆá‹‹á‹‹áŒ­ á‰áŒ¥áˆ®á‰½ (Example: {amount} -> 500)
    Object.keys(params).forEach(param => {
        text = text.replace(`{${param}}`, params[param]);
    });
    
    return text;
}

function updateAppLanguage(lang) { // Function á‰ á‰µáŠ•áˆ½ f á‰°áˆµá‰°áŠ«áŠ­áˆáˆ
    if (lang) {
        currentLanguage = lang;
        localStorage.setItem('selectedLanguage', lang);
    }

    // 1. HTML áˆ‹á‹­ data-lang á‹«áˆ‹á‰¸á‹áŠ• á‰ áˆ™áˆ‰ áˆ˜á‰€á‹¨áˆ­
    const elements = document.querySelectorAll('[data-lang]');
    
    elements.forEach(el => {
        const key = el.getAttribute('data-lang');
        
        // ğŸ›‘ áŠ á‹²áˆ± áˆ›áˆµá‰°áŠ«áŠ¨á‹«: á‰áˆá‰ áˆ˜áŠ–áˆ©áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            const translatedText = translations[currentLanguage][key]; // á‹‹áŒ‹á‹áŠ• á‹­á‹ áˆ˜áŠáˆ³á‰µ

            if (el.tagName === 'INPUT') {
                // áŠ¤áˆˆáˆ˜áŠ•á‰± INPUT áŠ¨áˆ†áŠ placeholder áŠá‹ á‹¨áˆáŠ•á‰€á‹­áˆ¨á‹
                el.placeholder = translatedText; 
            } else if (key === 'btn_spin_start') {
                // áˆá‹© HTML á‹«áˆ‹á‰¸á‹ (áˆˆáˆáˆ³áˆŒ <br>) áŠ«áˆ‰
                el.innerHTML = translatedText; // ğŸ›‘ t(key) á‰  translatedText á‰°á‰°áŠ­á‰·áˆ
            } else {
                // áˆˆáˆŒáˆá‰½ á‰°áˆ« áŒ½áˆáá‰½ (p, h1, span, button)
                el.innerText = translatedText; 
            }
        } // ğŸ›‘ áˆˆ if condition á‹¨á‰°á‹˜áŒ‹ Ù‚ÙˆØ³ (Bracket) á‰ á‰µáŠ­áŠ­áˆ á‰°á‰€áˆáŒ§áˆ
    });

    // 2. Dropdown á‹‹áŒ‹áŠ• áˆ›áˆµá‰°áŠ«áŠ¨áˆ
    const dropdown = document.getElementById('language-dropdown');
    if (dropdown) {
        dropdown.value = currentLanguage;
    }
    
    // 3. á‹¨áŒ¨á‹‹á‰³ UI áˆ›á‹˜áˆ˜áŠ•
    if (currentUserDocData) { 
        if (typeof renderPageContent === 'function') renderPageContent();
        if (typeof window.kenoUpdateUI === 'function') window.kenoUpdateUI();
        if (typeof window.updateStakingUI === 'function') window.updateStakingUI();
        if (typeof window.updateSlotGameUI === 'function') window.updateSlotGameUI();
        
        if (typeof window.updateDailyRewardModal === 'function' && document.getElementById('daily-reward-modal').style.display === 'flex') {
            window.updateDailyRewardModal();
        }
    }
}


        
        // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ (Daily Streak) á‹¨áˆšá‹«áŒˆáˆˆáŒáˆ á‹áˆ­á‹áˆ­
   const dailyStreakRewards = [
    { day: 1, coins: 700, field: 'day_1_claimed' },
    { day: 2, coins: 1500, field: 'day_2_claimed' },
    { day: 3, coins: 3000, field: 'day_3_claimed' },
    { day: 4, coins: 7000, field: 'day_4_claimed' },
    { day: 5, coins: 15000, field: 'day_5_claimed' },
    { day: 6, coins: 30000, field: 'day_6_claimed' },
    { day: 7, coins: 100000, field: 'day_7_claimed' },
    
    // ğŸ‘‡ğŸ‘‡ğŸ‘‡ áŠ¥áŠá‹šáˆ… 3á‰± áˆ‹á‹­ locked: true á‰°áŒ¨áˆáˆ¯áˆ ğŸ‘‡ğŸ‘‡ğŸ‘‡
    { day: 8, coins: 500000, field: 'day_8_claimed', locked: true },
    { day: 9, coins: 1000000, field: 'day_9_claimed', locked: true },
    { day: 10, coins: 2000000, field: 'day_10_claimed', locked: true },
];
     
        // ======================================================================
        // ğŸ›‘ UPDATED: áˆˆ Slot Game á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ áˆ˜áˆ¨áŒƒá‹á‰½
        // ======================================================================
        const SLOTS_MAX_SPINS = 10;
        const SLOTS_COOLDOWN_FIELD = 'last_slot_reset_time';
        // ğŸ›‘ TICKET_REWARD á‹ˆá‹° COIN_REWARD á‰°á‰€á‹­áˆ¯áˆ áŠ¥áŠ“ á‹ˆá‹²á‹«á‹áŠ‘ á‹ˆá‹° coin á‹­á‹°áˆ˜áˆ«áˆ
        const COIN_REWARD = 1000; 
        let currentSpinsLeft = SLOTS_MAX_SPINS;
        // ğŸ›‘ slot_teto_wins á‰°á‹ˆáŒá‹·áˆ
        const slotItems = [
            'ğŸ’', // Diamond (á‰µáˆá‰… áŠ áˆ¸áŠ“áŠ)
            'â­', // Star
            'ğŸ’°', // Money Bag
            'ğŸ’', // Cherry
        ];




        // ======================================================================
        //                             UTILITY FUNCTIONS
        // ======================================================================
        
        function getAvatarHtml(username, photoUrl) {
            if (photoUrl) {
                return `<img src="${photoUrl}" alt="Profile Photo" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                const initial = username ? username.charAt(0).toUpperCase() : 'ğŸ‘¤';
                return initial;
            }
        }
        
        // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆ: á‹¨ Streak áŠ¥áŠ“ Slot áŠ áˆ˜áŠ­áŠ•á‹® á‰ áˆá‹© áˆáŠ”á‰³ á‰°á‹­á‹Ÿáˆ
        function checkDailyLimit(taskField) {
            if (!currentUserDocData || !currentUserDocData[taskField]) {
                // áˆˆáˆ˜áŒ€áˆ˜áˆªá‹« áŒŠá‹œ áˆ²áŒ áˆ« (á‹ˆá‹­áŠ•áˆ á‹³á‰³ á‹¨áˆŒáˆˆá‹ áŠ¨áˆ†áŠ)
                return { isReady: true, remainingMs: 0, hasCompleted: false };
            }

            const lastUsedTimestamp = currentUserDocData[taskField];
            let lastUsedDate;

            if (lastUsedTimestamp && lastUsedTimestamp.toDate) {
                lastUsedDate = lastUsedTimestamp.toDate();
            } else {
                // áŒŠá‹œ áˆ›áˆ…á‰°áˆ™ á‰µáŠ­áŠ­áˆ áŠ«áˆáˆ†áŠ á‹ˆá‹­áˆ null áŠ¨áˆ†áŠ, á‹áŒáŒ áŠá‹
                return { isReady: true, remainingMs: 0, hasCompleted: false };
            }

            // áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µ áŠ áŠ•á‹µ áŒŠá‹œ á‰¥á‰» á‹¨áˆšáˆ°áˆ© áŠ“á‰¸á‹ (á‹•áˆˆá‰³á‹Š áŒˆá‹°á‰¥ á‹¨áˆ‹á‰¸á‹áˆ)
            if (taskField.startsWith('last_social_')) {
                 // á‹¨"social" á‰°áŒá‰£áˆ«á‰µ áŠ áŠ•á‹´ áŠ¨á‰°áˆ°áˆ© á‰ áŠ‹áˆ‹ áˆáˆáŒŠá‹œ "hasCompleted" á‹­áˆ†áŠ“áˆ‰
                 return { isReady: false, remainingMs: 0, hasCompleted: true };
            }
            
            // áˆˆáˆáˆ‰áˆ á‹•áˆˆá‰³á‹Š áŒˆá‹°á‰¦á‰½ (24-áˆ°á‹“á‰µ)
            const now = new Date();
            const twentyFourHours =  24 * 60 * 60 * 1000; // ğŸ›‘ 12 áˆ°á‹“á‰µ áŠá‹ (24 áˆ˜áˆ†áŠ• á‹¨áˆˆá‰ á‰µáˆ?) - áŠ¥áŠ•á‹° áŠ®á‹µá‹ 12 áˆ°á‹“á‰µ áˆ†áŠ—áˆ
            const elapsed = now.getTime() - lastUsedDate.getTime();
            
            if (elapsed >= twentyFourHours) {
                return { isReady: true, remainingMs: 0, hasCompleted: false };
            } else {
                const remainingMs = twentyFourHours - elapsed;
                return { isReady: false, remainingMs: remainingMs, hasCompleted: false };
            }
        }
        
        function formatTime(ms) {
            if (ms <= 0) return "Ready!";
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
    // âœ… áŠ áˆ›áˆ«áŒ­ 2: áŠ®á‹µ - áˆáˆáŒŠá‹œ áˆ˜áŒ«áŠ• á‹­á‰»áˆ‹áˆá£ áˆ°á‹“á‰±áŠ• á‹áŒª áŠ á‹«áˆ³á‹­áˆ
function updateTaskCardStatus(cardId, badgeId, cooldownField) {
    const card = document.getElementById(cardId);
    const badge = document.getElementById(badgeId);
    
    if (!card || !badge) return;

    // ğŸ›‘ á‹‹áŠ“á‹ áˆˆá‹áŒ¥: áˆáˆáŒŠá‹œ áˆ˜áŒ«áŠ• á‹­áˆá‰€á‹³áˆ (Clickable)
    card.style.pointerEvents = 'auto'; 
    card.classList.remove('cooldown-style');

    // 1. áˆˆ Slot Game áˆá‹© áˆáŠ”á‰³
    if (cardId === 'slots-game-card') {
         const { isReady: resetReady } = checkDailyLimit(cooldownField); 
         
         if (currentSpinsLeft > 0) {
             badge.innerText = `Spins: ${currentSpinsLeft}`;
             badge.className = 'status-badge ready'; 
         } else if (!resetReady) {
             // Cooldown áˆ‹á‹­ áŠ¨áˆ†áŠ á‰£á‹¶ áŒ½áˆá
             badge.innerText = ''; 
             badge.className = 'status-badge'; 
         } else {
             badge.innerText = 'Reset Ready!';
             badge.className = 'status-badge ready'; 
         }
         return; 
    }
    
    // 2. áˆˆáˆŒáˆá‰½ áŒ¨á‹‹á‰³á‹á‰½ (Mystery, Daily Spin, Reflex)
    const { isReady } = checkDailyLimit(cooldownField);

    if (isReady) {
        badge.innerText = 'PLAY ğŸ”¥'; 
        badge.className = 'status-badge ready'; 
    } else {
        // Ready áŠ«áˆáˆ†áŠ á‰£áŒ á‰£á‹¶ á‹­áˆ†áŠ“áˆ
        badge.innerText = ''; 
        badge.className = 'status-badge';
    }
}
    
        function updateSocialTaskStatus(taskElementId, link, coins, field, actionType) { 
    const button = document.getElementById(taskElementId);
    if (!button) return;

    const { hasCompleted } = checkDailyLimit(field);

    if (hasCompleted) {
        // âœ… t() á‹áŠ•áŠ­áˆ½áŠ•áˆ…áŠ• á‰ áˆ˜áŒ á‰€áˆ 'btn_completed' á‹¨áˆšáˆˆá‹áŠ• á‰µáˆ­áŒ‰áˆ áŒ¥áˆ«
        button.innerText = t('btn_completed'); 
        button.classList.remove('join-style');
        button.classList.add('completed-style');
        button.onclick = null;
        button.disabled = true;
        button.removeAttribute('data-state'); 
    } else {
        // 'btn_subscribe' á‹ˆá‹­áˆ 'btn_join' á‹¨áˆšáˆˆá‹áŠ• á‰µáˆ­áŒ‰áˆ áŒ¥áˆ«
        const actionKey = actionType === 'subscribe' ? 'btn_subscribe' : 'btn_join';
        
        // áŠ á‹áˆ«áˆ© "Checking" áˆ‹á‹­ áŠ«áˆáˆ†áŠ á‰¥á‰» áŒ½áˆá‰áŠ• á‰€á‹­áˆ­
        if (!button.innerText.includes('Checking') && !button.innerText.includes('áˆ›áˆ¨áŒ‹áŒˆáŒ¥')) {
             button.innerText = t(actionKey);
             button.classList.remove('completed-style');
             button.classList.add('join-style');
             button.disabled = false;
             button.onclick = () => window.handleSocialTaskClick(button, actionType);
             button.removeAttribute('data-state');
        }
    }
}



        function startCooldownTimer(taskField, timerElementId, actionButtonId) {
            if (timerIntervals[taskField]) {
                clearInterval(timerIntervals[taskField]);
            }

            const timerEl = document.getElementById(timerElementId);
            const actionButton = document.getElementById(actionButtonId);
            
            if (!timerEl && !actionButton) return; 
            
            // ğŸ›‘ UPDATED: áˆˆ Slot Game Timer áˆá‹© áŠ áˆ˜áŠ­áŠ•á‹®
             if (taskField === SLOTS_COOLDOWN_FIELD) {
                 const { isReady, remainingMs } = checkDailyLimit(taskField);
                 const timerContainer = document.getElementById('reset-timer-container');
                 const spinBtn = document.getElementById('spin-btn');
                 const messageEl = document.getElementById('game-message');

                 if (isReady) {
                      if(currentSpinsLeft <= 0) {
                          // á‹³áŒáˆ á‹¨áˆ›áˆµáŒ€áˆ˜áˆ­ áŒŠá‹œ á‹°áˆ­áˆ·áˆ (áŒáŠ• áŒˆáŠ“ á‹³áŒáˆ áŠ áˆá‰°áŒ€áˆ˜áˆ¨áˆ)
                          if(timerContainer) timerContainer.style.display = 'block';
                          if(timerEl) timerEl.innerText = "Ready to Reset! Click SPIN to get 10 more.";
                          if (spinBtn) {
                              spinBtn.disabled = false;
                              spinBtn.innerText = "RESET & SPIN";
                              spinBtn.onclick = () => window.resetSlotGameAndSpin(true); // á‹³áŒáˆ áŠ áˆµáŒ€áˆáˆ­áŠ“ áˆµá’áŠ• áŠ á‹µáˆ­áŒ
                          }
                      } else {
                           if (timerContainer) timerContainer.style.display = 'none';
                      }
                      
                      // á‹­áˆ…áŠ•áŠ• á‹¨24-áˆ°á‹“á‰µ á‰†áŒ£áˆª á‰ á‹¨áˆ°áŠ¨áŠ•á‹± áˆ›áˆ„á‹µ áŠ á‹«áˆµáˆáˆáŒáˆ - á‰ áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ­á‰ á‰µ áŒŠá‹œ á‰¥á‰» áŠá‹ á‹¨áˆšá‹«áˆµáˆáˆáŒˆá‹
                      if (timerIntervals[taskField]) {
                           clearInterval(timerIntervals[taskField]);
                           delete timerIntervals[taskField];
                      }
                      return; 
                 } else if (currentSpinsLeft <= 0) {
                      // áŒˆá‹°á‰¡ áŠ áˆˆá‰€ áŠ¥áŠ“ áŒŠá‹œá‹ áŒˆáŠ“ áŠ áˆá‹°áˆ¨áˆ°áˆ
                      if (timerContainer) timerContainer.style.display = 'block';
                      if (spinBtn) spinBtn.disabled = true;
                      if (messageEl) messageEl.innerText = "Spin áŠ áˆá‰‹áˆá¢ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢";
                      
                      const updateSlotTimer = () => {
                           const { isReady: checkAgain, remainingMs: remainingAgain } = checkDailyLimit(taskField);
                           if(checkAgain) {
                               window.startCooldownTimer(taskField, timerElementId, actionButtonId); // áˆ«áˆ±áŠ• á‹³áŒáˆ áŒ áˆ­á‰¶ á‹áŒáŒ á‹«á‹°áˆ­áŒ‹áˆ
                           } else if (timerEl) {
                               timerEl.innerText = `Reset in: ${formatTime(remainingAgain)}`;
                           }
                      };
                      updateSlotTimer(); 
                      timerIntervals[taskField] = setInterval(updateSlotTimer, 1000);
                      return; // áŠ¨ Slot Logic á‰ áŠ‹áˆ‹ áˆ˜á‹áŒ£á‰µ
                 } else {
                      // áŠ¥á‹¨á‰°áŒ«á‹ˆá‰° áŠ¨áˆ†áŠ
                      if (timerContainer) timerContainer.style.display = 'none';
                      // Slot Game á‹¨áˆ«áˆ± á‹¨áˆ†áŠ áŒŠá‹œ á‰†áŒ£áˆª áŠ á‹«áˆµáˆáˆáŒˆá‹áˆ
                      return;
                 }
             }
             
             // ğŸ›‘ áˆˆáˆáˆ‰áˆ áˆŒáˆá‰½ áŒ¨á‹‹á‰³á‹á‰½
             const updateTimer = () => {
                 const { isReady, remainingMs } = checkDailyLimit(taskField);
                 
                 if (isReady) {
                     if (timerEl) timerEl.innerText = "Ready to Play!";
                     if(actionButton) {
                         actionButton.classList.remove('cooldown');
                         actionButton.disabled = false;
                     }
                     if (taskField === 'last_invite_time') { 
                         const inviteButton = document.getElementById('invite-button');
                         if(inviteButton) inviteButton.classList.remove('cooldown');
                         if(inviteButton) inviteButton.disabled = false;
                     }
                     if (timerIntervals[taskField]) {
                         clearInterval(timerIntervals[taskField]);
                         delete timerIntervals[taskField];
                     }

                 } else {
                     if (timerEl) timerEl.innerText = `Remaining Cooldown: ${formatTime(remainingMs)}`;
                     
                     if(actionButton) {
                         actionButton.classList.add('cooldown');
                         actionButton.disabled = true;
                     }
                     if (taskField === 'last_invite_time') { 
                         const inviteButton = document.getElementById('invite-button');
                         if(inviteButton) inviteButton.classList.add('cooldown');
                         if(inviteButton) inviteButton.disabled = true;
                     }
                 }
             };
            
            updateTimer(); 
            timerIntervals[taskField] = setInterval(updateTimer, 1000);
        }
        
        function getTelegramUsername() {
            let username = 'á‰°áŒ«á‹‹á‰½-' + (telegramUserId ? telegramUserId.slice(-4) : Math.floor(Math.random() * 10000)); 
            if (WebApp.initDataUnsafe && WebApp.initDataUnsafe.user) {
                const user = WebApp.initDataUnsafe.user;
                if (user.username) {
                    username = `@${user.username}`; 
                } else if (user.first_name) {
                    username = user.first_name;
                    if (user.last_name) {
                        username += ` ${user.last_name}`;
                    }
                }
            }
            return username;
        }


        // ======================================================================
        //                          FIREBASE FUNCTIONS
        // ======================================================================
        
        
        
        
// Function setupCurrentUserListener(userId)
function setupCurrentUserListener(userId) {
    
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: áŠ¥á‹šáˆ… áŒ‹áˆ­ Username á‰¥á‰» á‹«áˆµáŒˆá‰¡ (https://t.me/ áŠ á‹«áˆµáˆáˆáŒáˆ)
    const ADMIN_TELEGRAM_USERNAME = 'smartgameSupporter_bot'; 
    
    const userRef = doc(db, 'users', userId);
    
    onSnapshot(userRef, (docSnapshot) => {
        if (docSnapshot.exists()) {
            const data = docSnapshot.data();

            // =============================================================
            // ğŸ›‘ğŸ›‘ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ á‹¨ BAN á‰¼áŠ­ áˆáŒ‚áŠ­ (FIXED BAN LOGIC) ğŸ›‘ğŸ›‘ğŸ›‘
            // =============================================================
            if (data.is_banned === true) {
                console.warn("User is banned. Access blocked.");
                
                // 1. áˆ˜á‰°áŒá‰ áˆªá‹«á‹áŠ• áˆ™áˆ‰ á‰ áˆ™áˆ‰ áŠ¨áˆ›áŒ¥á‹á‰µ á‹­áˆá‰… áŠ¥áŠ•á‹°á‰¥á‰€á‹‹áˆˆáŠ• (Safe Hide)
                const rootElement = document.getElementById('root');
                const navBar = document.getElementById('nav-bar');
                const loadingContainer = document.getElementById('loading-container');
                
                if (rootElement) rootElement.style.display = 'none';
                if (navBar) navBar.style.display = 'none';
                
                // áˆá‹²áŠ•áŒ áˆµáŠ­áˆªáŠ‘ áŠ«áˆˆ áŠ¥áˆ±áŠ•áˆ áŠ¥áŠ•á‹°á‰¥á‰ƒáˆˆáŠ•
                if (loadingContainer) {
                    loadingContainer.style.display = 'none';
                }
                
                // 2. Ban Screen áŠ áˆµá‰€á‹µáˆ áˆ˜áˆáŒ áˆ©áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥ (á‹°áŒ‹áŒáˆ áŠ¥áŠ•á‹³á‹­áˆáŒ¥áˆ­)
                let banScreen = document.getElementById('ban-overlay-screen');
                
                if (!banScreen) {
                    const banReason = data.ban_reason || 'Unusual point accumulation (Suspicious Activity)';

                    banScreen = document.createElement('div');
                    banScreen.id = 'ban-overlay-screen'; // ID áŠ¥áŠ•áˆ°áŒ á‹‹áˆˆáŠ•
                    banScreen.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                        background-color: #0f0f0f; color: white; display: flex;
                        flex-direction: column; align-items: center; justify-content: center;
                        z-index: 99999999; text-align: center; padding: 20px; font-family: sans-serif;
                        box-sizing: border-box;
                    `;
                    
                    banScreen.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 20px;">ğŸš«</div>
                        <h1 style="color: #ff4444; margin-bottom: 10px;">ACCOUNT SUSPENDED</h1>
                        
                        <div style="margin-top: 15px; padding: 15px; background: #222; border-radius: 8px; max-width: 300px; width: 100%;">
                            <p style="font-size: 14px; color: #ffeb3b; margin-bottom: 5px; font-weight: bold;">
                                Reason for ban:
                            </p>
                            <p style="font-size: 14px; color: #ccc;">
                                ${banReason}
                            </p>
                        </div>

                        <p style="font-size: 15px; color: #ccc; line-height: 1.5; margin-top: 20px;">
                            This account has been permanently banned If you think this is a mistake, please report it
                        </p>

                        <div style="margin-top: 30px; display: flex; gap: 15px;">
                            
                            <a href="https://t.me/${ADMIN_TELEGRAM_USERNAME}?start=appeal_${userId}" 
                               target="_blank"
                               style="text-decoration: none; padding: 12px 25px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                ğŸ“ Request an appeal
                            </a>
                            
                            <button onclick="window.Telegram.WebApp.close()" 
                                style="padding: 12px 25px; background: #333; color: white; border: 1px solid #555; border-radius: 8px; cursor: pointer;">
                                Close App
                            </button>
                        </div>

                        <div style="margin-top: 30px; padding: 10px; font-family: monospace; color: #777; font-size: 12px;">
                            User ID: ${userId}
                        </div>
                    `;
                    
                    document.body.appendChild(banScreen);
                }
                return; // ğŸ›‘ áŠ¥á‹šáˆ… áˆ‹á‹­ áŠ¥áŠ•á‹ˆáŒ£áˆˆáŠ•á¢ áŠ¨á‹šáˆ… á‰ á‰³á‰½ á‹«áˆˆá‹ áŠ®á‹µ áŠ á‹­áˆ°áˆ«áˆá¢
            }
            // =============================================================
            
            // á‰°áŒ á‰ƒáˆšá‹ Ban áŠ«áˆáˆ†áŠ á‰¥á‰» áŠ¥áŠá‹šáˆ… á‹­áˆ°áˆ«áˆ‰á¡
            
            // Global á‰°áˆˆá‹‹á‹‹áŒ®á‰½áŠ• áˆ›á‹˜áˆ˜áŠ•
            currentScore = data.total_score || 0;
            currentSmartCoinBalance = data.smart_coin_balance || 0;
            currentTickets = data.tickets || 0;
            currentUserDocData = data;
            
            // á‹¨ Slot Game áˆáŠ”á‰³áŠ• áˆ›á‹˜áˆ˜áŠ•
            currentSpinsLeft = data.slot_spins_left !== undefined ? data.slot_spins_left : SLOTS_MAX_SPINS;

            // á‹°áˆ¨áŒƒá‹ áŠ¥áˆµáŠªáˆ˜áŒ£ á‹µáˆ¨áˆµ '...' á‰°á‰¥áˆ á‹­á‰€áˆ˜áŒ£áˆ
            if (currentRank === 'N/A' || currentRank === '0' || currentRank === '...') {
                currentRank = '...';
            }
            
            // á‹¨ Top áŒˆáŒ½ áˆ‹á‹­ á‹«áˆˆá‹áŠ• á‹¨áŒáˆ áŠáŒ¥á‰¥ áˆ›á‹˜áˆ˜áŠ•
            const topScoreDisplay = document.getElementById('top-score-display');
            if (topScoreDisplay) {
                topScoreDisplay.innerText = `${currentScore.toLocaleString()} ğŸ’°`;
            }

            // á‹¨ Exchange áŒˆáŒ½áŠ• á‰£áˆ‹áŠ•áˆµ áˆ›á‹˜áˆ˜áŠ•
            const exchangeBalanceElement = document.getElementById('currentCoinBalance');
            if (exchangeBalanceElement) {
                exchangeBalanceElement.innerText = currentScore.toLocaleString();
            }

            // UI áˆ›á‹˜áˆ˜áŠ•
            renderPageContent();

            // Loading Screen áˆ˜á‹°á‰ á‰… (Ban áŠ«áˆáˆ†áŠ)
            const loadingContainer = document.getElementById('loading-container');
            if (loadingContainer && loadingContainer.style.display !== 'none') {
                 loadingContainer.style.opacity = '0';
                setTimeout(() => {
                    loadingContainer.style.display = 'none';
                    if (!hasLaunchAdShown) {
            initLaunchAd(); 
            hasLaunchAdShown = true; // á‹°áŒ‹áŒáˆ áŠ¥áŠ•á‹³á‹­áˆ˜áŒ£ áŠ¥áŠ•á‹˜áŒ‹á‹‹áˆˆáŠ•
        }
                }, 500); 
            }
            
        } else {
            console.warn("á‹¨áŠ áˆáŠ‘ á‰°áŒ á‰ƒáˆš áˆ˜áˆ¨áŒƒ (document) áŠ áˆá‰°áŒˆáŠ˜áˆ!");
        }
    }, (error) => {
        console.error("Error listening to user document:", error);
        WebApp.showAlert("Error: Could not load your profile.");
    });
}

function setupMiniAppMaintenance() {
    const configRef = doc(db, 'settings', 'miniapp_config');
    onSnapshot(configRef, (docSnapshot) => {
    if (Number(telegramUserId) === 403001547) { 
    removeMiniAppMaintenanceScreen();
    return; 
}
        if (docSnapshot.exists()) {
            const data = docSnapshot.data();
            
            if (data.maintenance_mode === true) {
                // áŠ¥á‹šáˆ… áŒ‹áˆ­ until á‹¨áˆšáˆˆá‹áŠ•áˆ áŠ á‰¥áˆ¨áŠ• áŠ¥áŠ•áˆáŠ«áˆˆáŠ•
                showMiniAppMaintenanceScreen(data.maintenance_message, data.maintenance_until);
            } else {
                removeMiniAppMaintenanceScreen();
            }
        }
    });
}
function showMiniAppMaintenanceScreen(message, maintenanceUntilTimestamp) {
    const rootElement = document.getElementById('root');
    const navBar = document.getElementById('nav-bar');
   WebApp.MainButton.hide(); 
    if (rootElement) rootElement.style.display = 'none';
    if (navBar) navBar.style.display = 'none';

    let maintScreen = document.getElementById('miniapp-maint-overlay');
    
    // áˆµáŠ­áˆªáŠ‘ áŠ¨áˆŒáˆˆ ááŒ áˆ¨á‹
    if (!maintScreen) {
        maintScreen = document.createElement('div');
        maintScreen.id = 'miniapp-maint-overlay';
        maintScreen.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #0f0f0f; color: white; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 999999999; text-align: center; padding: 25px; font-family: sans-serif;
            box-sizing: border-box;
            overflow: hidden;
        `;
        
        const channelLink = "https://t.me/Smart_Airdropss"; 

        maintScreen.innerHTML = `
            <div style="font-size: 80px; margin-bottom: 20px;">ğŸ› ï¸</div>
            <h1 style="color: #ffca28; font-size: 26px; margin-bottom: 10px;">SYSTEM UPDATE</h1>
            
            <p style="color: #ccc; font-size: 16px; line-height: 1.5; margin-bottom: 15px;">
                ${message || "áˆ²áˆµá‰°áˆ™áŠ• á‰ áˆ›áˆ»áˆ»áˆ áˆ‹á‹­ áŠáŠ•á¢ áˆˆáŒ¥á‰‚á‰µ á‹°á‰‚á‰ƒá‹á‰½ á‹­áŒ á‰¥á‰áŠ•á¢"}
            </p>

            <div id="maint-timer-display" style="
                font-size: 32px; font-weight: bold; color: #ff5252; 
                margin-bottom: 25px; background: #1a1a1a; 
                padding: 10px 30px; border-radius: 15px; border: 1px solid #333;
                min-width: 200px;">
                -- : -- : --
            </div>

            <a href="${channelLink}" target="_blank" style="
                background-color: #ffca28; color: black; padding: 12px 25px; 
                text-decoration: none; border-radius: 25px; font-weight: bold; 
                font-size: 14px; display: inline-block;">
                áˆˆá‰ áˆˆáŒ  áˆ˜áˆ¨áŒƒ á‰»áŠ“áˆ‹á‰½áŠ•áŠ• á‹­á‰€áˆ‹á‰€áˆ‰
            </a>
        `;
        document.body.appendChild(maintScreen);
    }

    // --- á‹¨á‰†áŒ£áˆªá‹ (Countdown) áˆµáˆŒá‰µ ---
    if (maintenanceUntilTimestamp) {
        // á‹¨á‹µáˆ® á‰†áŒ£áˆª áŠ«áˆˆ áŠ¥áŠ“áŒ á‹á‹‹áˆˆáŠ• (áŠ¥áŠ•á‹³á‹­á‹°áˆ«áˆ¨á‰¥)
        if (maintenanceInterval) clearInterval(maintenanceInterval);

        const timerElement = document.getElementById('maint-timer-display');
        
        // áŠ¨ Firebase á‹¨áˆšáˆ˜áŒ£á‹ Timestamp á‹ˆá‹° áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ á‹­á‰€á‹¨áˆ«áˆ
        // .toDate() á‹¨áˆŒáˆˆá‹ áŠ¨áˆ†áŠ (string áŠ¨áˆ†áŠ) á‰  new Date() áŠ¥áŠ•á‰€á‹­áˆ¨á‹‹áˆˆáŠ•
        const targetDate = maintenanceUntilTimestamp.toDate 
            ? maintenanceUntilTimestamp.toDate().getTime() 
            : new Date(maintenanceUntilTimestamp).getTime();

        // á‰ á‹¨ 1 áˆ°áŠ¨áŠ•á‹± á‹¨áˆšáˆ°áˆ« á‰°áŒá‰£áˆ­
        maintenanceInterval = setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;

            // áŒŠá‹œá‹ áŠ«áˆˆá‰€ (áŠ¨ 0 á‰ á‰³á‰½ áŠ¨áˆ†áŠ)
            if (distance < 0) {
                clearInterval(maintenanceInterval);
                if (timerElement) {
                    timerElement.innerHTML = "Opening...";
                    timerElement.style.color = "#4caf50"; // áŠ áˆ¨áŠ•áŒ“á‹´ á‹­áˆáŠ•
                }
                // áŒŠá‹œá‹ áˆ²á‹«áˆá‰… áŠ á‘áŠ• áˆªááˆ¬áˆ½ áŠ¥áŠ•á‹²á‹«á‹°áˆ­áŒ áŠ¨áˆáˆˆáŒáŠ­ á‹­áˆ…áŠ• áŠ­áˆá‰µá¡
                // setTimeout(() => window.location.reload(), 2000);
                return;
            }

            // áˆ°á‹“á‰µá£ á‹°á‰‚á‰ƒ áŠ¥áŠ“ áˆ°áŠ¨áŠ•á‹µ áˆµáˆŒá‰µ
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // áŠ á‰€áˆ«áˆ¨á‰¥ (Formatting): 02h : 15m : 30s
            // áŠ¨ 10 á‰ á‰³á‰½ áˆ²áˆ†áŠ‘ 0 áˆ˜áŒ¨áˆ˜áˆ­ (áˆˆáˆáˆ³áˆŒ 9 áˆ³á‹­áˆ†áŠ• 09)
            const h = hours < 10 ? "0" + hours : hours;
            const m = minutes < 10 ? "0" + minutes : minutes;
            const s = seconds < 10 ? "0" + seconds : seconds;

            if (timerElement) {
                timerElement.innerHTML = `${h}h : ${m}m : ${s}s`;
            }

        }, 1000);
    } else {
        // áŒŠá‹œá‹ áŠ¨áˆŒáˆˆ á‰†áŒ£áˆªá‹áŠ• á‹°á‰¥á‰…
        const timerElement = document.getElementById('maint-timer-display');
        if (timerElement) timerElement.style.display = 'none';
    }
}

function removeMiniAppMaintenanceScreen() {
    // 1. áŠ¥á‹¨á‰†áŒ áˆ¨ á‹«áˆˆá‹áŠ• áˆ°á‹“á‰µ áŠ á‰áˆ (Stop the timer)
    if (maintenanceInterval) {
        clearInterval(maintenanceInterval);
        maintenanceInterval = null;
    }

    const maintScreen = document.getElementById('miniapp-maint-overlay');
    
    // 2. áˆµáŠ­áˆªáŠ‘áŠ• áŠ áŒ¥á‹áŠ“ á‹ˆá‹° á‹‹áŠ“á‹ áŒˆáŒ½ áˆ˜áˆáˆµ
    if (maintScreen) {
        maintScreen.remove();
        const rootElement = document.getElementById('root');
        const navBar = document.getElementById('nav-bar');
        
        if (rootElement) rootElement.style.display = 'block';
        if (navBar) navBar.style.display = 'flex';
        
        // áŒˆáŒ¹áŠ• áˆªááˆ¬áˆ½ á‰ áˆ›á‹µáˆ¨áŒ áŠ á‘áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ (áŠ áˆµáˆáˆ‹áŒŠ áŠ¨áˆ†áŠ)
        window.location.reload();
    }
}
async function firebaseLogin() {
    try {
        window.Telegram.WebApp.ready(); 
        setupMiniAppMaintenance();

        // 1. Telegram User ID áˆ›áˆ¨áŒ‹áŒˆáŒ¥
        if (!telegramUserId) {
            console.error("Telegram User ID áŠ áˆá‰°áŒˆáŠ˜áˆ!");
            // ID áŠ¨áˆŒáˆˆ Loading áˆ›áŒ¥á‹á‰µ áŠ áˆˆá‰¥áŠ•
            const ld = document.getElementById('loading-container');
            if (ld) ld.style.display = 'none';
            return;
        }

        // 2. Session Check (á‹¨á‰°áŒ á‰ƒáˆš áˆˆá‹áŒ¥ áŠ«áˆˆ áˆ›á…á‹³á‰µ)
        const savedTelegramId = localStorage.getItem('last_telegram_id');
        if (savedTelegramId && savedTelegramId !== telegramUserId.toString()) {
            await auth.signOut();
            localStorage.clear();
            window.location.reload();
            return;
        }
        localStorage.setItem('last_telegram_id', telegramUserId.toString());

        // 3. Anonymous Login
        await signInAnonymously(auth);

        const strTelegramId = telegramUserId.toString();
        const numTelegramId = Number(telegramUserId);
        
        let currentDocId = strTelegramId;
        let userExists = false;

        // ============================================================
        // ğŸ”¥ á‰°áŒ á‰ƒáˆšáŠ• áˆ˜áˆáˆˆáŒ (HYBRID SEARCH - áˆˆá‹µáˆ® áŠ¥áŠ“ áŠ á‹²áˆµ) ğŸ”¥
        // ============================================================
        
        // áˆ€. áˆ˜áŒ€áˆ˜áˆªá‹« á‰ á‰€áŒ¥á‰³ ID (áˆˆáŠ á‹²áˆµ á‰°áŒ á‰ƒáˆšá‹á‰½ áŠ á‹ˆá‰ƒá‰€áˆ­)
        const directDocRef = doc(db, "users", strTelegramId);
        const directDocSnap = await getDoc(directDocRef);

        if (directDocSnap.exists()) {
            userExists = true;
            currentDocId = strTelegramId;
        } else {
            // áˆˆ. áŠ«áˆá‰°áŒˆáŠ˜á£ á‰  telegram_id field áˆ˜áˆáˆˆáŒ (áˆˆá‹µáˆ® Auto-ID á‰°áŒ á‰ƒáˆšá‹á‰½)
            const usersRef = collection(db, "users");
            const q = query(usersRef, where("telegram_id", "in", [numTelegramId, strTelegramId]));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                userExists = true;
                currentDocId = querySnapshot.docs[0].id;
            }
        }

        // ============================================================
        // âœ… LOGIN or REGISTER ACTION
        // ============================================================

        if (userExists) {
            // --- áŠá‰£áˆ­ á‰°áŒ á‰ƒáˆš (LOGIN) ---
            currentFirebaseUserId = currentDocId; 
            const userDocRef = doc(db, 'users', currentDocId);
            
            // áˆ˜áˆ¨áŒƒ áˆ›á‹°áˆµ (Update Info)
            try {
                await updateDoc(userDocRef, {
                    first_name: window.Telegram.WebApp.initDataUnsafe.user?.first_name || 'User',  
                    username: window.Telegram.WebApp.initDataUnsafe.user?.username || '',
                    photo_url: window.Telegram.WebApp.initDataUnsafe.user?.photo_url || null,
                    last_active: serverTimestamp()
                });
            } catch (e) { console.warn("Update failed", e); }
            
        } else {
            // --- áŠ á‹²áˆµ á‰°áŒ á‰ƒáˆš (REGISTER) ---
            currentFirebaseUserId = strTelegramId;
            const initData = window.Telegram.WebApp.initDataUnsafe;
            
            const urlParams = new URLSearchParams(window.location.search);
            let rawReferrerId = initData.start_param || urlParams.get('tgWebAppStartParam');
            
            // áˆ«áˆµáŠ• áŠ¨áˆ˜áŒ‹á‰ á‹ áˆ˜áŒ á‰ á‰… (Anti-Self-Referral)
            if (rawReferrerId && String(rawReferrerId) === strTelegramId) {
                rawReferrerId = null;
            }

            // -----------------------------------------------------
            // ğŸ•µï¸â€â™‚ï¸ áŒ‹á‰£á‹¥ áˆ˜áˆáˆˆáŒ (REFERRER SEARCH)
            // -----------------------------------------------------
            let finalReferrerDocId = null; // á‹­áˆ… áˆˆá‹³á‰³á‰¤á‹ Update á‹¨áˆáŠ•áŒ á‰€áˆá‰ á‰µ ID áŠá‹

            if (rawReferrerId) {
                // 1. áˆ˜áŒ€áˆ˜áˆªá‹« áŠ¥áŠ•á‹° áŠ á‹²áˆµ á‰°áŒ á‰ƒáˆš (Direct ID Check)
                const tryDirectRef = doc(db, "users", String(rawReferrerId));
                const tryDirectSnap = await getDoc(tryDirectRef);

                if (tryDirectSnap.exists()) {
                    finalReferrerDocId = String(rawReferrerId);
                } else {
                    // 2. áŠ«áˆá‰°áŒˆáŠ˜á£ á‹¨á‹µáˆ® á‰°áŒ á‰ƒáˆš áˆŠáˆ†áŠ• áˆµáˆˆáˆšá‰½áˆ á‰  Query áŠ¥áŠ•áˆáˆáŒ (Auto-ID Check)
                    const usersRef = collection(db, "users");
                    const qRef = query(usersRef, where("telegram_id", "in", [Number(rawReferrerId), String(rawReferrerId)]));
                    const qSnap = await getDocs(qRef);

                    if (!qSnap.empty) {
                        finalReferrerDocId = qSnap.docs[0].id; // á‹¨á‹µáˆ® á‰°áŒ á‰ƒáˆš Auto-ID á‰°áŒˆáŠ˜
                    }
                }
            }

            const newUserRef = doc(db, 'users', strTelegramId);
            let startBonus = 0;
            let updatedInviteCount = 0;
            // -----------------------------------------------------
            // ğŸ’¾ á‹³á‰³á‰¤á‹ áˆ˜áˆ˜á‹áŒˆá‰¥ (TRANSACTION)
            // -----------------------------------------------------
            await runTransaction(db, async (transaction) => {
                // áŒ‹á‰£á‹¥ áŠ¨á‰°áŒˆáŠ˜ á‰¦áŠáˆµ áˆ˜áˆµáŒ á‰µ
                if (finalReferrerDocId) {
                    const referrerRef = doc(db, 'users', finalReferrerDocId);
                    const referrerDoc = await transaction.get(referrerRef);

                    if (referrerDoc.exists()) {
                        const refData = referrerDoc.data();
                        const currentInvites = Number(refData.invite_count) || 0;
                        const currentScore = Number(refData.total_score) || 0;
                        updatedInviteCount = currentInvites + 1;
                        transaction.update(referrerRef, {
                            invite_count: currentInvites + 1,
                            total_score: currentScore + 500
                        });
                        startBonus = 500;
                    }
                }

                // áŠ á‹²áˆ±áŠ• á‰°áŒ á‰ƒáˆš áˆ˜áˆ˜á‹áŒˆá‰¥
                transaction.set(newUserRef, {
                    telegram_id: numTelegramId, 
                    first_name: initData.user?.first_name || initData.user?.username || 'user', 
                    username: initData.user?.username || '',
                    photo_url: initData.user?.photo_url || null,
                    total_score: startBonus,
                    smart_coin_balance: 0,
                    tickets: 3,
                    slot_spins_left: 10,
                    invite_count: 0,
                    referrer_id: finalReferrerDocId || null, 
                    created_at: serverTimestamp(),
                    is_banned: false
                });
            });

            // -----------------------------------------------------
            // ğŸ”” áˆ›áˆ³á‹ˆá‰‚á‹«á‹á‰½ (NOTIFICATIONS)
            // -----------------------------------------------------
            if (startBonus > 0) {
                WebApp.showAlert(`ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! á‰ áŒá‰¥á‹£ áˆµáˆˆáˆ˜áŒ¡ ${startBonus} coin áŠ áŒáŠá‰°á‹‹áˆ!`);
                
                // áˆˆáŒ‹á‰£á‹¡ áˆ˜áˆá‹•áŠ­á‰µ áˆ˜áˆ‹áŠ­ (áˆˆá‹šáˆ…áŠ›á‹ rawReferrerId áˆ˜áŒ á‰€áˆ áŠ áˆˆá‰¥áŠ• - áˆáŠ­áŠ•á‹«á‰±áˆ á‹¨Telegram ID áˆµáˆˆáˆ†áŠ)
                if (rawReferrerId) {
                    const botUrl = "https://newsmartgame.netlify.app/.netlify/functions/send_alert";
                    
                    fetch(botUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            custom_chat_id: String(rawReferrerId), // áˆˆá‰¦á‰± á‹¨áˆšáˆ‹áŠ¨á‹ á‹¨Telegram ID áŠá‹
                            message: `ğŸ‰ <b>áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ!</b>\n\n` +
         `ğŸ‘¥ áŒ“á‹°áŠ›á‹ <b>${window.Telegram.WebApp.initDataUnsafe.user.first_name || 'áŒ“á‹°áŠ›á‹'}</b> á‹¨áŠ¥áˆ­áˆµá‹áŠ• áŒá‰¥á‹£ á‰°á‰€á‰¥áˆ áˆá‹áŒˆá‰£á‹áŠ• áŠ áŒ áŠ“á‰‹áˆá¢\n\n` +
         `ğŸ’° áˆˆá‹šáˆ… áŒá‰¥á‹£ <b>+500 Coins</b> áˆ½áˆáˆ›á‰µ á‹ˆá‹° áŠ áŠ«á‹áŠ•á‰µá‹ á‰°áŒ¨áˆáˆ¯áˆ!\n\n` +
         `ğŸ“Š <b>áŠ¥áˆµáŠ«áˆáŠ• á‹¨áŒ‹á‰ á‹™á‰µ:</b> ${updatedInviteCount} áˆ°á‹á‰½\n\n` +
         `ğŸ”— áˆ˜áŒ‹á‰ á‹á‹áŠ• á‹­á‰€áŒ¥áˆ‰á£ á‰¥á‹™ á‹«áŒáŠ™! ğŸš€`
   
                        })
                    }).catch(e => console.error("Notification trigger failed:", e));
                }
            }
        } 

        // 4. Listener Setup (Real-time update áˆˆáˆ˜áŒ€áˆ˜áˆ­)
        if (currentFirebaseUserId) {
            setupCurrentUserListener(currentFirebaseUserId);
        }

    } catch (error) {
        // ğŸ›‘ ERROR HANDLING (áŠ¥á‹šáˆ… áŒ‹áˆ­ áŠá‹ Loading Screen áˆ›áŒ¥áŠá‹«á‹ á‹¨á‰°áŒ¨áˆ˜áˆ¨á‹)
        console.error("Login Error:", error);
        WebApp.showAlert("Login Error: " + error.message);
        
        const ld = document.getElementById('loading-container');
        if(ld) ld.style.display = 'none'; // ğŸ”¥ á‹­áˆ„ áŠ áˆáŠ• á‰°áŒ¨áˆáˆ¯áˆ
    }
}

        async function updateScore(coinsToAdd, source, timestampField = null, extraUpdateData = {}) { 
            if (!currentFirebaseUserId) {
                WebApp.showAlert("áŠ¥á‰£áŠ­á‹ áˆ˜á‰°áŒá‰ áˆªá‹«á‹ áŠ¥áˆµáŠªáŒ«áŠ• á‹­áŒ á‰¥á‰ (Login Failed).");
                return false;
            }
            
            const userRef = doc(db, "users", currentFirebaseUserId); 
            
            const updateData = {
                total_score: increment(coinsToAdd), 
                last_played: serverTimestamp(), 
                last_reward_source: source,
                ...extraUpdateData // áŠ¨á‹áŒ­ á‹¨áˆ˜áŒ¡ á‰°áŒ¨áˆ›áˆª áˆ›áˆ»áˆ»á‹«á‹á‰½
            };

            if (timestampField) {
                // áˆ›áˆ…á‰ áˆ«á‹Š á‰°áŒá‰£áˆ«á‰µ áŠ áŠ•á‹µ áŒŠá‹œ á‰¥á‰» á‹¨áˆšáˆ°áˆ© á‰ áˆ˜áˆ†áŠ“á‰¸á‹:
                 if (timestampField.startsWith('last_social_')) {
                    // áˆ°á‹“á‰±áŠ• áŠ«áˆµá‰€áˆ˜áŒ¥áŠ• á‰ áŠ‹áˆ‹ á‹³áŒáˆ áŠ á‹­áˆ°áˆ«áˆ
                    updateData[timestampField] = serverTimestamp(); 
                 } else {
                    // áˆˆá‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ (Daily Tasks) á‹¨áŒŠá‹œ áˆ›áˆ…á‰°áˆ áˆ›áˆµá‰€áˆ˜áŒ¥
                    updateData[timestampField] = serverTimestamp();
                 }
            }
            
            try {
                await updateDoc(userRef, updateData); 
                // ğŸ›‘ áŠáŒ¥á‰¡ á‹œáˆ® á‹ˆá‹­áˆ áŠ áˆ‰á‰³á‹Š áŠ¨áˆ†áŠ áˆ›áŠ•á‰‚á‹« áˆ›áˆ³á‹¨á‰µ á‹¨áˆˆá‰¥áŠ•áˆ
                if(coinsToAdd > 0) WebApp.showAlert(t('alert_coin_success', { amount: coinsToAdd.toLocaleString() })); 
                // ğŸ›‘ UPDATED: áŠ®áŠ•áŒá‰²á‹áŠ• áˆ˜á‰°áŠ®áˆµ
                window.triggerConfetti(coinsToAdd); 
                return true;

            } catch (error) {
                if (error.code === 'not-found' || error.message.includes('No document to update')) {
                    const username = getTelegramUsername();
                    const photo_url = WebApp.initDataUnsafe.user?.photo_url || null;
                    
                    const setData = {
                        total_score: coinsToAdd, 
                        username: username,
                        telegram_id: telegramUserId,
                        photo_url: photo_url,
                        last_played: serverTimestamp(), 
                        last_reward_source: source,
                        created_at: serverTimestamp(),
                        tickets: 0, 
                        daily_streak: 0, // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ
                        last_streak_claim_time: null, // ğŸ›‘ NEW: áˆˆá‹•áˆˆá‰³á‹Š áˆ½áˆáˆ›á‰µ
                        slot_spins_left: SLOTS_MAX_SPINS, // ğŸ›‘ NEW: áˆˆ Slot Game
                        last_slot_reset_time: null, // ğŸ›‘ NEW: áˆˆ Slot Game
                        // referrer_id áŠ á‹­áŠ«á‰°á‰µáˆ - á‰ áˆ˜áŒ€áˆ˜áˆªá‹«á‹ firebaseLogin á‹áˆµáŒ¥ á‰¥á‰» áˆµáˆˆáˆšáˆ˜á‹˜áŒˆá‰ á‹
                        smart_coin_balance: 0, // <--- âœ… áŠ®áˆ› (,) áŠ¥á‹šáˆ… á‰°áŒ¨áˆáˆ¯áˆ
                       
                        // âœ… ğŸ›‘ áŠ á‹²áˆµ á‹¨ Staking áˆ˜áˆµáŠ®á‰½ áŠ¥á‹šáˆ…áˆ áˆ˜áŒá‰£á‰µ áŠ áˆˆá‰£á‰¸á‹
                        staked_amount: 0,
                        stake_start_time: null
                    };

                    if (timestampField) {
                         if (timestampField.startsWith('last_social_')) {
                            setData[timestampField] = serverTimestamp(); 
                        } else {
                            setData[timestampField] = serverTimestamp();
                        }
                    }

                    await setDoc(userRef, setData);
                    if(coinsToAdd > 0) WebApp.showAlert(`ğŸ‰ áŠ á‹²áˆµ áˆ˜áˆ¨áŒƒ á‰°áˆáŒ áˆ¨ áŠ¥áŠ“ ${coinsToAdd.toLocaleString()} coin á‰°áŒ¨áˆ˜áˆ¨!`); 
                    // ğŸ›‘ UPDATED: áŠ®áŠ•áŒá‰²á‹áŠ• áˆ˜á‰°áŠ®áˆµ
                    window.triggerConfetti(coinsToAdd); 
                    return true;
                } else {
                    WebApp.showAlert(t('msg_error_update'));
                    console.error("Error updating score:", error);
                    return false;
                }
            }
        }

// âœ… áŠ á‹²áˆµ: áˆˆáˆ˜áˆªá‹á‰½ áˆ°áˆŒá‹³ áˆ˜áˆ¨áŒƒ áˆ›áˆµá‰€áˆ˜áŒ« á‰áˆá
const LEADERBOARD_STORAGE_KEY = 'smart_drop_leaderboard_cache';

/**
 * âœ… á‹¨á‰°áˆ»áˆ»áˆˆ fetchLeaderboard: localStorage Caching á‹­áŒ á‰€áˆ›áˆ
 * á‹­áˆ… á‹˜á‹´ á‹ˆáŒªáŠ• (Cost) áŠ¥áŠ“ á‹¨á‹³á‰³ áŠ áŒ á‰ƒá‰€áˆáŠ• á‰ áŠ¥áŒ…áŒ‰ á‹­á‰€áŠ•áˆ³áˆá¢
 */
async function fetchLeaderboard() {
    console.log("DEBUG: fetchLeaderboard á‰°áŒá‰£áˆ­ á‰°áŒ€áˆáˆ¯áˆá¢");
    const leaderboardContainer = document.getElementById('leaderboard-container');
    
    // áˆ˜áŒ«áŠ‘áŠ• áˆˆáˆ›áˆ³á‹¨á‰µ (áŠ¨á‹šáˆ… á‰ áŠá‰µ á‹³á‰³ áŠ¨áˆŒáˆˆ á‰¥á‰»)
    if (!leaderboardContainer.innerHTML.includes('leaderboard-item')) {
        leaderboardContainer.innerHTML = '<p style="text-align: center; color: var(--tg-hint); padding: 10px;">loading...</p>';
    }

    const now = Date.now();

    // ============================================================
    // 1. áˆ˜áŒ€áˆ˜áˆªá‹« áŠ¨ localStorage áˆ˜áˆ¨áŒƒ áŠ«áˆˆ áŠ¥áŠ•áˆá‰µáˆ½ (CACHE CHECK)
    // ============================================================
    const cachedDataString = localStorage.getItem(LEADERBOARD_STORAGE_KEY);
    
    if (cachedDataString) {
        try {
            const cachedObj = JSON.parse(cachedDataString);
            // áˆ˜áˆ¨áŒƒá‹ áŠ«áˆˆ áŠ¥áŠ“ áŠ¨ 3 á‹°á‰‚á‰ƒ (CACHE_LIFETIME) á‰ á‰³á‰½ áŠ¨áˆ†áŠ
            if (now - cachedObj.timestamp < CACHE_LIFETIME) {
                console.log("DEBUG: áˆ˜áˆ¨áŒƒ áŠ¨ localStorage (Cache) áŠ¥á‹¨á‰°áŒ«áŠ áŠá‹á¢ (Firebase áŠ á‹­áŠá‰ á‰¥áˆ)");
                
                // á‰  Cache á‹áˆµáŒ¥ á‹«áˆˆá‹áŠ• á‹¨áˆ«áˆ±áŠ• á‹°áˆ¨áŒƒ (Rank) áŠ áˆáŠ• áŠ«áˆˆá‹ User ID áŒ‹áˆ­ áŠ¥áŠ“áˆµá‰°áŠ«áŠ­áˆ
                // (áˆáŠ“áˆá‰£á‰µ á‰°áŒ á‰ƒáˆšá‹ áŠ áŠ«á‹áŠ•á‰µ á‰€á‹­áˆ® áŠ¨áˆ†áŠ)
                const currentUserEntry = cachedObj.data.players.find(p => p.id === currentFirebaseUserId);
                cachedObj.data.foundUserRank = currentUserEntry ? currentUserEntry.rank : 0;

                renderLeaderboard(cachedObj.data);
                return; // ğŸ›‘ áŠ¨ Firebase áˆ³áŠ•áŒ á‹­á‰… áŠ¥á‹šáˆ áŠ¥áŠ“á‰†áˆ›áˆˆáŠ• (Cost Saved!)
            }
        } catch (e) {
            console.warn("Cache parsing error, fetching fresh data.");
            // áˆµáˆ…á‰°á‰µ áŠ«áˆˆ á‰½áŒáˆ­ á‹¨áˆˆá‹áˆá£ áŠ¨á‰³á‰½ áŠ á‹²áˆµ áŠ¥áŠ“á‹ˆáˆ­á‹³áˆˆáŠ•
        }
    }

    // ============================================================
    // 2. Cache áŠ¨áˆŒáˆˆ á‹ˆá‹­áˆ áŒŠá‹œá‹ áŠ«áˆˆáˆá‰ á‰µá£ áŠ¨ Firebase áŠ¥áŠ•áŒ á‹­á‰…
    // ============================================================
    try {
        console.log("DEBUG: áŠ á‹²áˆµ áˆ˜áˆ¨áŒƒ áŠ¨ Firebase áŠ¥á‹¨á‰°áˆ³á‰  áŠá‹á¢");
        
        const usersCollectionRef = collection(db, "users");
        // Top 100 á‰°áŒ á‰ƒáˆšá‹á‰½áŠ• á‰ áŠáŒ¥á‰¥ á‰¥á‹›á‰µ (descending) áŠ áˆáŒ£
        const q = query(usersCollectionRef, orderBy('total_score', 'desc'), limit(100)); 
        
        const snapshot = await getDocs(q); 
        
        let players = [];
        let foundUserRank = 0; 
        let rankCounter = 0;
        
        snapshot.forEach((doc) => {
            rankCounter++;
            const data = doc.data();
            const rank = rankCounter;
            
            // áˆ˜áˆ¨áŒƒá‹áŠ• á‹ˆá‹° array áŠ¥áŠ•áŒ¨áˆáˆ­
            players.push({ id: doc.id, ...data, rank: rank });

            // á‹¨áŠ áˆáŠ‘áŠ• á‰°áŒ á‰ƒáˆš á‹°áˆ¨áŒƒ áŠ¥áŠ•áˆáˆáŒ
            if (doc.id === currentFirebaseUserId) {
                foundUserRank = rank; 
            }
        });
        
        const leaderboardData = { players, foundUserRank };

        // ============================================================
        // 3. áŠ á‹²áˆ±áŠ• áˆ˜áˆ¨áŒƒ á‹ˆá‹° localStorage áŠ¥áŠ“áˆµá‰€áˆáŒ¥ (SAVE CACHE)
        // ============================================================
        try {
            localStorage.setItem(LEADERBOARD_STORAGE_KEY, JSON.stringify({
                data: leaderboardData,
                timestamp: now
            }));
        } catch (e) {
            console.warn("localStorage is full or disabled", e);
        }

        // áˆ˜áˆ¨áŒƒá‹áŠ• á‹ˆá‹° UI áˆ˜áˆ‹áŠ­
        renderLeaderboard(leaderboardData);
        
        console.log("DEBUG: fetchLeaderboard á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ áŠ“á‰€á‰€ (Updated Cache).");

    } catch (error) {
        leaderboardContainer.innerHTML = `<p style="text-align: center; color: var(--et-red); padding: 10px;">ğŸ›‘ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ áˆ¨! ${error.message}</p>`;
        console.error("CRITICAL ERROR in fetchLeaderboard:", error);
        WebApp.showAlert("ğŸ›‘ áˆµáˆ…á‰°á‰µ: LeaderboardáŠ• áˆ›áˆáŒ£á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢");
    }
}


/**
 * LeaderboardáŠ• áˆ˜áˆ¨áŒƒá‹áŠ• á‰°á‰€á‰¥áˆ á‹ˆá‹° HTML á‹¨áˆšá‰€á‹­áˆ­ á‰°áŒá‰£áˆ­ (áŠ¨ fetchLeaderboard á‹ˆáŒ¥á‰·áˆ)
 */
function renderLeaderboard(data) {
    const { players, foundUserRank } = data;
    const leaderboardContainer = document.getElementById('leaderboard-container');
    
    // á‹¨á‹°áˆ¨áŒƒ áŠ áˆ˜áŠ­áŠ•á‹® (Rank Logic)
    if (foundUserRank > 0) {
        currentRank = `#${foundUserRank}`;
    } else {
        currentRank = 'Top 100+'; 
    }
    
    // UI áˆ›áˆ»áˆ»á‹« (Rank Update)
    const rankDisplayEl = document.getElementById('top-rank-display');
    if(rankDisplayEl) {
         rankDisplayEl.innerText = currentRank;
    }

    // Leaderboard HTML áˆ˜áŒˆáŠ•á‰£á‰µ áŠ¥áŠ“ áˆ›áˆ³á‹¨á‰µ
    let leaderboardHTML = `<div id="leaderboard-list">`;
    
    if (players.length === 0) {
         leaderboardHTML += '<p style="text-align: center; color: var(--tg-hint); padding: 10px;">áˆáŠ•áˆ á‰°áŒ«á‹‹á‰½ á‹¨áˆˆáˆá¢</p>';
    } else {
         players.forEach((player) => {
             const isCurrentUser = player.id === currentFirebaseUserId;
             const avatarHtml = getAvatarHtml(player.username, player.photo_url); 
             const score = player.total_score || 0;
             let borderColor = 'transparent';
             if (score > 1000000) borderColor = '#ffd700'; // Gold
             else if (score > 100000) borderColor = '#c0c0c0'; // Silver

             let rankClass = '';
             let rankDisplay; 
             const rankNumber = Number(player.rank); 
              
             if (isNaN(rankNumber) || rankNumber < 1) {
                 rankDisplay = '#?';
                 rankClass = '';
             } else if (rankNumber === 1) {
                 rankClass = 'gold-highlight';
                 rankDisplay = 'ğŸ¥‡'; 
             } else if (rankNumber === 2) {
                 rankClass = 'silver-highlight';
                 rankDisplay = 'ğŸ¥ˆ'; 
             } else if (rankNumber === 3) {
                 rankClass = 'bronze-highlight';
                 rankDisplay = 'ğŸ¥‰'; 
             } else {
                 rankDisplay = rankNumber.toString() + '.'; 
                 rankClass = ''; 
             }
             // á‰ á‹°áˆ¨áŒƒ (Rank) áˆ‹á‹­ á‰°áˆ˜áˆµáˆ­á‰¶ á‹¨áŠ­áˆá áŠ¨áˆˆáˆ­ áˆ˜á‰€á‹¨áˆ­
if (rankNumber === 1) {
    borderColor = '#ffd700'; // á‹ˆáˆ­á‰…
} else if (rankNumber === 2) {
    borderColor = '#c0c0c0'; // á‰¥áˆ­
} else if (rankNumber === 3) {
    borderColor = '#cd7f32'; // áŠáˆƒáˆµ
}

              
             const itemClasses = `${isCurrentUser ? 'current-user-highlight' : ''} ${rankClass}`;
             const rankHtmlClass = (rankNumber === 1) ? 'gold' : (rankNumber === 2) ? 'silver' : (rankNumber === 3) ? 'bronze' : '';


            // 1. áˆ˜áŒ€áˆ˜áˆªá‹« Logic (áˆµáˆŒá‰±áŠ•) áŠ¨ HTML á‹áŒ­ á‹­áˆµáˆ© (Move Logic Here)
const isVerified = player.is_verified === true;

const verifiedIconSVG = `
<div class="verified-animated">
    <svg style="width: 14px; height: 14px; margin-left: 5px; vertical-align: middle;" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.9664 2.8095C11.5164 2.14666 12.4836 2.14666 13.0336 2.8095L13.886 3.83709C14.1561 4.1627 14.5969 4.31295 15.0116 4.22097L16.3204 3.9306C17.1648 3.74326 17.9622 4.37989 17.9254 5.21129L17.8683 6.5001C17.8502 6.9085 18.0694 7.29176 18.4281 7.47953L19.5601 8.07223C20.2905 8.45465 20.5232 9.39055 20.0287 10.0515L19.2623 11.0759C19.0194 11.4005 19.0194 11.8415 19.2623 12.1661L20.0287 13.1904C20.5232 13.8514 20.2905 14.7873 19.5601 15.1697L18.4281 15.7624C18.0694 15.9502 17.8502 16.3335 17.8683 16.7419L17.9254 18.0307C17.9622 18.8621 17.1648 19.4987 16.3204 19.3114L15.0116 19.021C14.5969 18.929 14.1561 19.0793 13.886 19.4049L13.0336 20.4325C12.4836 21.0953 11.5164 21.0953 10.9664 20.4325L10.114 19.4049C9.84392 19.0793 9.4031 18.929 8.98842 19.021L7.67959 19.3114C6.83517 19.4987 6.03781 18.8621 6.07461 18.0307L6.13167 16.7419C6.14975 16.3335 5.93059 15.9502 5.57187 15.7624L4.43993 15.1697C3.70953 14.7873 3.47679 13.8514 3.97131 13.1904L4.73771 12.1661C4.98061 11.8415 4.98061 11.4005 4.73771 11.0759L3.97131 10.0515C3.47679 9.39055 3.70953 8.45465 4.43993 8.07223L5.57187 7.47953C5.93059 7.29176 6.14975 6.9085 6.13167 6.5001L6.07461 5.21129C6.03781 4.37989 6.83517 3.74326 7.67959 3.9306L8.98842 4.22097C9.4031 4.31295 9.84392 4.1627 10.114 3.83709L10.9664 2.8095Z" fill="#29B6F6"/>
        <path d="M15.2071 9.29289C15.5976 9.68342 15.5976 10.3166 15.2071 10.7071L11.2071 14.7071C10.8166 15.0976 10.1834 15.0976 9.79289 14.7071L7.79289 12.7071C7.40237 12.3166 7.40237 11.6834 7.79289 11.2929C8.18342 10.9024 8.81658 10.9024 9.20711 11.2929L10.5 12.5858L13.7929 9.29289C14.1834 8.90237 14.8166 8.90237 15.2071 9.29289Z" fill="white"/>
    </svg>
</div>`;

const badgeHtml = isVerified ? verifiedIconSVG : '';



// 2. áŠ¨á‹šá‹« á‰ áŠ‹áˆ‹ HTML á‹­áŒˆáŠ•á‰¡
leaderboardHTML += `
    <div class="leaderboard-item ${itemClasses}">
        <span class="leaderboard-item-rank ${rankHtmlClass}">
            ${rankDisplay}
        </span>
     <div class="leaderboard-item-photo" style="border: 3px solid ${borderColor}; border-radius: 50%; padding: 2px; display: flex; align-items: center; justify-content: center; width: 45px; height: 45px; overflow: hidden; flex-shrink: 0;">
    ${avatarHtml}
</div>
   

    <span class="leaderboard-item-name" style="display: flex; align-items: center;gap: 5px;">
    ${player.first_name || player.username || 'á‹«áˆá‰³á‹ˆá‰€ á‰°áŒ«á‹‹á‰½'} ${badgeHtml}
</span>


        <span class="leaderboard-item-score">
            ${(player.total_score || 0).toLocaleString()} ğŸ’°
        </span>
    </div>
`;

         });
    }
      
    leaderboardHTML += `</div>`;
    leaderboardContainer.innerHTML = leaderboardHTML;
}





// ======================================================================
// âœ… ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: áˆˆáŒ¨á‹‹á‰³ áŒˆáŒ¾á‰½ (á‰€áˆ‹áˆ) Loading Screen á‰°áŒá‰£áˆ­
// ======================================================================

/**
 * á‹­áˆ… á‰°áŒá‰£áˆ­ áŠ á‹²áˆ±áŠ• "á‰€áˆ‹áˆ" áˆá‹°áˆ­ á‹«áˆ³á‹«áˆ
 */
window.showGameWithLoading = (pageId) => {
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: áŠ á‹²áˆ±áŠ• 'game-loading-overlay' áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•
    const loadingContainer = document.getElementById('game-loading-overlay'); 

    if (!loadingContainer) {
        switchPage(pageId);
        return;
    }

    // 1. Loading áˆµáŠ­áˆªáŠ‘áŠ• áŠ áˆ³á‹­
    loadingContainer.style.display = 'flex';
    // (á‰µáŠ•áˆ½ áŠ­áá‰°á‰µ áŠ¥áŠ•áˆ°áŒ£áˆˆáŠ• opacity áŠ¥áŠ•á‹²áˆ°áˆ«)
    setTimeout(() => {
        loadingContainer.style.opacity = '1';
    }, 10); 

    // 2. á‹¨áŒˆáŒ½ áˆ˜á‰€á‹¨áˆªá‹«á‹ áŠ¥áŠ•á‹²áˆ°áˆ« áŠ¥áŠ“ UI áŠ¥áŠ•á‹²á‹«áˆ­á á‰µáŠ•áˆ½ áŒŠá‹œ áˆµáŒ á‹
    setTimeout(() => {

        // 3. á‹‹áŠ“á‹áŠ• á‹¨áŒˆáŒ½ áˆ˜á‰€á‹¨áˆªá‹« á‰°áŒá‰£áˆ­ áŒ¥áˆ«
        switchPage(pageId);

        // 4. á‹¨áŒ¨á‹‹á‰³á‹ áŒˆáŒ½ áŠ¨á‰³á‹¨ á‰ áŠ‹áˆ‹ Loading áˆµáŠ­áˆªáŠ‘áŠ• á‹°á‰¥á‰…
        // âœ… áˆˆá‹áŒ¥: áŠ¨ 100 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ á‹ˆá‹° 2000 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ (2 áˆ°áŠ¨áŠ•á‹µ) á‰°á‰€á‹­áˆ¯áˆ
        setTimeout(() => { 
            loadingContainer.style.opacity = '0';
            // á‹¨ CSS transition (0.3s) áŠ¥áŠ•á‹²á‹«áˆá‰… áŒ á‰¥á‰…
            setTimeout(() => {
                loadingContainer.style.display = 'none';
            }, 300); 
        }, 2000); // ğŸ›‘ áŠ áˆáŠ• 2000ms (2 áˆ°áŠ¨áŠ•á‹µ) á‹­á‰†á‹«áˆ

    }, 100); // áˆá‹°áˆ© áŠ¥áŠ•á‹²á‰³á‹­ 100ms áŠ¥áŠ•áˆ°áŒ£áˆˆáŠ•
}

/**
 * á‹­áˆ… á‰°áŒá‰£áˆ­ áˆˆ Daily Streak (Modal) á‹«áŒˆáˆˆáŒáˆ‹áˆ
 */
window.showStreakWithLoading = () => {
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: áŠ á‹²áˆ±áŠ• 'game-loading-overlay' áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•
    const loadingContainer = document.getElementById('game-loading-overlay'); 

    if (!loadingContainer) {
        window.openDailyRewardModal(); // Fallback
        return;
    }

    // 1. Loading áˆµáŠ­áˆªáŠ‘áŠ• áŠ áˆ³á‹­
    loadingContainer.style.display = 'flex';
    setTimeout(() => {
        loadingContainer.style.opacity = '1';
    }, 10);

    setTimeout(() => {
        // 2. áˆá‹³áˆ‰áŠ• á‹¨áˆšáŠ¨áá‰°á‹áŠ• á‹‹áŠ“ á‰°áŒá‰£áˆ­ áŒ¥áˆ«
        window.openDailyRewardModal();

        // 3. áˆá‹³áˆ‰ áˆáŒ£áŠ• áˆµáˆˆáˆ†áŠ Loading áˆµáŠ­áˆªáŠ‘áŠ• á‹ˆá‹²á‹«á‹ á‹°á‰¥á‰…
        // âœ… áˆˆá‹áŒ¥: áŠ¨ 100 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ á‹ˆá‹° 2000 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ (2 áˆ°áŠ¨áŠ•á‹µ) á‰°á‰€á‹­áˆ¯áˆ
        setTimeout(() => { 
            loadingContainer.style.opacity = '0';
            setTimeout(() => {
                loadingContainer.style.display = 'none';
            }, 300); // á‹¨ CSS transition áŒŠá‹œ
        }, 2000); // ğŸ›‘ áŠ áˆáŠ• 2000ms (2 áˆ°áŠ¨áŠ•á‹µ) á‹­á‰†á‹«áˆ
    }, 100);
}
     

 
// ======================================================================
//                          PAGE NAVIGATION FUNCTIONS
// ======================================================================

        window.switchPage = (pageIdToShow) => {
        window.removeSelfAd();
            // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: 'staking-page' áŠ¥á‹šáˆ… á‰ á‹‹áŠ“ áŒˆáŒ¾á‰½ áˆ‹á‹­ á‰°áŒ¨áˆáˆ¯áˆ
            const mainPages = ['tasks-page', 'top-page', 'profile-page', 'staking-page'];
            const gamePages = [
                'mystery-box-page',
                'daily-spin-page',
                'reflex-game-page',
                'withdraw-page',
                'exchange-page',
                'social-tasks-page',
                'slots-game-page',
                'scratch-card-page',
                'keno-game-page',
                'daily-cipher-page', 
                'memory-game-page',  
                 'mines-game-page',
                 'transaction-history-page', 'p2p-page',
                'transaction-history-page'
                // 'staking-page' áŠ¨á‹šáˆ… á‰°á‹ˆáŒá‹·áˆ
            ];
            const allPages = [...mainPages, ...gamePages];
            
            allPages.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            const targetPage = document.getElementById(pageIdToShow);
            if (targetPage) {
                targetPage.style.display = 'block';
            }

            mainPages.forEach(id => {
                let navId = id.split('-')[0];
                // 'staking-page' á‹¨ nav-stake ID áˆµáˆ‹áˆˆá‹
                if (id === 'staking-page') navId = 'stake'; 
                
                const navItem = document.getElementById(`nav-${navId}`);
                if (navItem) {
                    navItem.classList.remove('active');
                }
            });
            
            if (mainPages.includes(pageIdToShow)) {
                // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: 'staking-page' á‹¨ nav-stake ID áˆµáˆ‹áˆˆá‹
                let navId = pageIdToShow.split('-')[0];
                if (pageIdToShow === 'staking-page') navId = 'stake'; 
                
                const navItem = document.getElementById(`nav-${navId}`);
                if (navItem) {
                    navItem.classList.add('active');
                }
                 // á‰ á‹‹áŠ“ áŒˆáŒ¾á‰½ áˆ‹á‹­ á‹¨áŠ‹áˆ‹ á‰áˆá áŠ á•áˆŠáŠ¬áˆ½áŠ‘áŠ• áŠ¥áŠ•á‹²á‹˜áŒ‹ á‹«á‹°áˆ­áŒ‹áˆ
                 WebApp.BackButton.hide();
                 WebApp.BackButton.onClick(() => WebApp.close()); 

            } else {
                // á‰ áŠ•áŠ¡áˆµ áŒˆáŒ¾á‰½ áˆ‹á‹­ á‹¨áŠ‹áˆ‹ á‰áˆá á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‹­áˆ˜áˆáˆ³áˆ
                WebApp.BackButton.show();
                WebApp.BackButton.onClick(window.showMainPage);
            }
            
            if (pageIdToShow === 'tasks-page') {
                 // ğŸ›‘ NEW: á‹¨áˆ˜áŒ‹á‰ á‹£ á‰áˆá á‰†áŒ£áˆªáŠ• áˆ›áˆµáŒ€áˆ˜áˆ­
                 startCooldownTimer('last_invite_time', null, 'invite-button'); 
                window.loadSelfAd('tasks-ad-container'); 
                // á‹¨áŠ«áˆ­á‹µ á‰£áŒ… áˆ›á‹˜áˆ˜áŠ•
                updateTaskCardStatus('mystery-box-card', 'mystery-box-badge', 'last_mystery_time');
                updateTaskCardStatus('daily-spin-card', 'daily-spin-badge', 'last_spin_time');
                updateTaskCardStatus('reflex-game-card', 'reflex-game-badge', 'last_reflex_time');
                updateTaskCardStatus('slots-game-card', 'slots-game-badge', SLOTS_COOLDOWN_FIELD);
                updateTaskCardStatus('memory-game-card', 'memory-game-badge', 'last_memory_game_time'); 
                // á‹¨áŠ«áˆ­á‹µ á‰£áŒ†á‰½áŠ• á‰ á‹¨áŒŠá‹œá‹ áŠ¥áŠ•á‹²á‹«á‹˜áˆáŠ• áˆ›á‹µáˆ¨áŒ
                if (!timerIntervals['card_status_update']) {
                    timerIntervals['card_status_update'] = setInterval(() => {
                        updateTaskCardStatus('mystery-box-card', 'mystery-box-badge', 'last_mystery_time');
                        updateTaskCardStatus('daily-spin-card', 'daily-spin-badge', 'last_spin_time');
                        updateTaskCardStatus('reflex-game-card', 'reflex-game-badge', 'last_reflex_time');
                        updateTaskCardStatus('slots-game-card', 'slots-game-badge', SLOTS_COOLDOWN_FIELD);
                        updateTaskCardStatus('memory-game-card', 'memory-game-badge', 'last_memory_game_time'); 

                    }, 5000); 
                }

            } else {
                 // á‹¨áŠ«áˆ­á‹µ á‰£áŒ… áˆ›áˆ»áˆ»á‹«á‹áŠ• áŠ á‰áˆ
                if (timerIntervals['card_status_update']) {
                    clearInterval(timerIntervals['card_status_update']);
                    delete timerIntervals['card_status_update'];
                }
// ----------------------------------------------------
                // --- âœ… áŠ á‹²áˆ± á‰µáŠ­áŠ­áˆˆáŠ› á‹¨ 'else' á‰¥áˆáŠ­ á‹­áˆ„ áŠá‹ ---
                // ----------------------------------------------------
                if (pageIdToShow === 'top-page') { 
                    fetchLeaderboard(); 
                
                // âœ… ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: 'staking-page' áŠ¥á‹šáˆ… áŒˆá‰¥á‰·áˆ (áŠ¨ 'mainPages' áŒ‹áˆ­)
                } else if (pageIdToShow === 'staking-page') {
                    window.initStakingPage();
                 } else if (pageIdToShow === 'p2p-page') { 
    window.switchP2PTab('market'); // áˆ˜áŒ€áˆ˜áˆªá‹« á‹¨áŒˆá‰ á‹« á‹áˆ­á‹áˆ­ áŠ¥áŠ•á‹²áˆ˜áŒ£
    document.getElementById('p2p-user-balance').innerText = currentScore.toLocaleString() + ' ğŸ’°';

                                } else if (pageIdToShow === 'mystery-box-page') { 
                    startCooldownTimer('last_mystery_time', 'mystery-box-timer', 'mystery-box-action');
                    window.resetMysteryBox(false);
                } else if (pageIdToShow === 'daily-spin-page') {
                    startCooldownTimer('last_spin_time', 'daily-spin-timer', 'daily-spin-action');
                } else if (pageIdToShow === 'reflex-game-page') {
                    startCooldownTimer('last_reflex_time', 'reflex-game-timer', 'reflex-game-action');
                    window.resetReflexGame(false); 
                    isReflexGameRunning = false; 
                    window.document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick;
                } else if (pageIdToShow === 'social-tasks-page') {
                    updateSocialTaskStatus('channel-action', 'https://t.me/Smart_Airdropss', 1500, 'last_social_tg_channel_time', 'join');
                    updateSocialTaskStatus('group-action', 'https://t.me/school_library2012', 1000, 'last_social_tg_group_time', 'join');
                    updateSocialTaskStatus('youtube-action', 'https://www.youtube.com/', 3000, 'last_social_youtube_time', 'subscribe');
                } else if (pageIdToShow === 'exchange-page') {
                    const pointsInput = document.getElementById('exchangePointsInput');
                    if (pointsInput) pointsInput.value = EXCHANGE_RATE.toString(); // á‹ˆá‹° 10,000 á‹­áˆ˜áˆáˆ°á‹‹áˆ
                    const coinBalanceEl = document.getElementById('currentCoinBalance');
                    if (coinBalanceEl) {
                        coinBalanceEl.innerText = currentScore.toLocaleString();
                    }
                    window.calculateSmartCoin(); // áŠ á‹áˆ«áˆ©áŠ• áŠ¥áŠ“ á‹áŒ¤á‰±áŠ• á‹«áˆ°áˆ‹áˆ
                } else if (pageIdToShow === 'withdraw-page') {
                    document.getElementById('currentWithdrawBalance').innerText = currentSmartCoinBalance.toLocaleString();
                    document.querySelectorAll('#withdraw-page .method-wrapper').forEach(wrapper => {
                        wrapper.classList.remove('active');
                    });
                    selectedWithdrawMethod = null;
                    document.getElementById('withdrawAmountInput').value = MIN_WITHDRAWAL;
                    const messageEl = document.getElementById('withdrawMessage');
                    if (messageEl) messageEl.innerText = "âš ï¸ áŠ¥á‰£áŠ­á‹ á‹¨áˆ˜á‹áŒ« á‹˜á‹´ á‹­áˆáˆ¨áŒ¡á¢";
                    if (messageEl) messageEl.style.color = 'var(--et-red, #F44336)';
                    const buttonEl = document.getElementById('finalWithdrawButton');
                    if (buttonEl) {
                        buttonEl.classList.add('disabled-btn');
                        buttonEl.disabled = true;
                        buttonEl.innerText = "WITHDRAW NOW";
                    }
                    window.validateWithdrawal();
                
                } else if (pageIdToShow === 'mines-game-page') {
    window.initMinesGame();

                
                } else if (pageIdToShow === 'slots-game-page') {
                     window.updateSlotGameUI();
                     startCooldownTimer(SLOTS_COOLDOWN_FIELD, 'reset-timer', 'spin-btn');
                
            } else if (pageIdToShow === 'scratch-card-page') { 
    window.initScratchCard(false); 
                
} else if (pageIdToShow === 'keno-game-page') { 
    window.initKenoGame();
        
} else if (pageIdToShow === 'daily-cipher-page') {
    setTimeout(() => { 
        window.startCooldownTimer('last_daily_cipher_time', 'daily-cipher-timer', 'cipher-submit-btn');
    }, 100); 

} else if (pageIdToShow === 'memory-game-page') {
    setTimeout(() => { 
        window.startCooldownTimer('last_memory_game_time', 'memory-game-timer-display', 'memory-start-btn');            
    }, 100); 
}
        
     

    renderPageContent(); 

}
                
        } // <-- á‹­áˆ„ 'window.switchPage'áŠ• á‹­á‹˜áŒ‹áˆ

        // âœ…âœ…âœ… === á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (áˆµáˆ…á‰°á‰µ 2) === âœ…âœ…âœ…
        // ğŸ›‘ á‹¨á‰°áˆ³áˆ³á‰°á‹ 'renderPageContent();' áŠ¨á‹šáˆ… á‰°á‹ˆáŒá‹·áˆ
        

        // ğŸ›‘ showMainPage() á‹ˆá‹° áˆµáŠ­áˆªá•á‰µ áˆ˜áŒ€áˆ˜áˆªá‹« (áŠ¨ module á‹áŒª) á‰°áŠ•á‰€áˆ³á‰…áˆ·áˆ

        window.handleCardClick = (pageId) => {
            switchPage(pageId);
        }

        window.handleTaskClick = async (taskName, coins, timestampField) => { // ğŸ›‘ points á‹ˆá‹° coins
            const { isReady } = checkDailyLimit(timestampField);
            if (!isReady) {
                WebApp.showAlert(`âŒ ${taskName} áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢ áŠ¥á‰£áŠ­á‹ áŒŠá‹œ áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢`);
                return;
            }
            await updateScore(coins, taskName, timestampField); // ğŸ›‘ points á‹ˆá‹° coins
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        }
window.handleSocialTaskClick = async (button, actionType) => {
    const link = button.getAttribute('data-link');
    const coins = parseInt(button.getAttribute('data-points')); 
    const field = button.getAttribute('data-field');
    const taskName = button.getAttribute('data-name');
    
    // 1. á‹¨áˆ™áˆŒá‰µ áá‰°áˆ»
    const { hasCompleted } = checkDailyLimit(field);

    if (hasCompleted) {
        WebApp.showAlert(t('alert_task_completed')); // ğŸŸ¢ Translated
        return;
    }

    // 2. áˆ½áˆáˆ›á‰µ áˆˆáˆ˜áŒ á‹¨á‰… á‹áŒáŒ áŠ¨áˆ†áŠ
    if (button.getAttribute('data-state') === 'ready-to-claim') {
        button.innerText = t('msg_claiming'); // ğŸŸ¢ Translated
        button.disabled = true;

        if (await updateScore(coins, taskName, field)) {
            // á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ¨á‰°áˆ°áŒ  á‰ áŠ‹áˆ‹ áˆáŠ”á‰³á‹áŠ• áˆ˜á‰€á‹¨áˆ­
            button.innerText = t('msg_completed'); // ğŸŸ¢ Translated
            button.classList.remove('join-style');
            button.classList.add('completed-style');
            button.onclick = null;
            button.disabled = true;
            renderPageContent(); 
        } else {
            WebApp.showAlert(t('alert_db_error')); // ğŸŸ¢ Translated
            button.innerText = t('btn_claim_reward_social'); // ğŸŸ¢ Translated
            button.disabled = false;
        }
        return;
    }

    // 3. á‹¨áˆ˜áŒ€áˆ˜áˆªá‹« áŠ­áˆŠáŠ­ (Timer á‹­áŒ€áˆáˆ«áˆ)
    if (button.innerText.includes('Join') || button.innerText.includes('Subscribe') || button.innerText.includes('Claim')) {
        
        if (link.includes('t.me/')) {
             WebApp.openTelegramLink(link);
        } else {
             WebApp.openLink(link);
        }
        
        button.disabled = true;
        button.onclick = null;

        let timeLeft = 15; 
        
        const countdown = setInterval(() => {
            timeLeft--;
            // ğŸŸ¢ Translated with parameter
            button.innerText = t('msg_checking_timer', { seconds: timeLeft });
            
            if (timeLeft <= 0) {
                clearInterval(countdown);
                button.innerText = t('btn_claim_reward_social'); // ğŸŸ¢ Translated
                button.disabled = false;
                button.setAttribute('data-state', 'ready-to-claim'); 
                button.onclick = () => window.handleSocialTaskClick(button, actionType);
            }
        }, 1000);

        WebApp.showAlert(t('alert_wait_15')); // ğŸŸ¢ Translated
    }
};
      // ======================================================================
        // ğŸ›‘ UPDATED: á‹¨á‰°áˆ»áˆ»áˆˆá‹ á‹¨áŒ“á‹°áŠ› áŒ‹á‰¥á‹ á‰°áŒá‰£áˆ­ (Telegram Share Integration)
        // ======================================================================
    // ... (áˆŒáˆá‰½ á‰°áŒá‰£áˆ«á‰µ áŠ¥áŠ•á‹° formatTime, checkDailyLimit, updateScore, startCooldownTimer, renderPageContent áŠ¥á‹šáˆ… áˆ˜áŒˆáˆˆáŒ½ áŠ áˆˆá‰£á‰¸á‹)

// á‹¨á‰´áˆŒáŒáˆ«áˆ á‰¦á‰µ á‹©á‹˜áˆ­áŠ”áˆ (á‰ áŠ¥áˆ­áˆµá‹ á‰µáŠ­áŠ­áˆˆáŠ› á‹¨á‰¦á‰µ áˆµáˆ áˆ˜á‰°áŠ«á‰µá‹áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡!)
const BOT_USERNAME = 'Smartgame21_bot'; 

// ============================================================
// ğŸ’¼ WALLET CONNECT LOGIC (TON CONNECT)
// ============================================================

// Manifest URL: áŠ¥áˆ­áˆµá‹ á‹¨áˆáŒ áˆ©á‰µ á‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆŠáŠ•áŠ­ áŠ¥á‹šáˆ… á‰°á‰€áˆáŒ§áˆ
const manifestUrl = 'https://gist.githubusercontent.com/tame3232/ae2716a46705d31ed7596f34e11c4147/raw/a526a858fbd73c9579541d584992c0e0c112b6b4/tonconnect-manifest.json'; 

// TonConnectUI áˆ˜ááŒ áˆ­
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: manifestUrl,
});

// Wallet áˆ²áŒˆáŠ“áŠ á‹ˆá‹­áˆ áˆ²á‰‹áˆ¨áŒ¥ UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
tonConnectUI.onStatusChange(wallet => {
    const btnText = document.getElementById('wallet-btn-text');
    const btnStatus = document.getElementById('wallet-btn-status');
    
    if (wallet) {
        // á‰°áŒˆáŠ“áŠá‰·áˆ (Connected)
        const rawAddress = wallet.account.address;
        const shortAddress = rawAddress.slice(0, 4) + '...' + rawAddress.slice(-4);
        
        console.log("Wallet Connected:", rawAddress);

        // UI áˆ›á‹˜áˆ˜áŠ•
        if (btnText) btnText.innerText = "Wallet Connected";
        if (btnStatus) {
            btnStatus.innerText = shortAddress;
            btnStatus.style.color = "var(--et-green)"; 
            btnStatus.style.fontWeight = "bold";
        }

        // áŠ¥á‹šáˆ… áŒ‹áˆ­ saveWalletToFirebase(rawAddress) áˆ˜áŒ¨áˆ˜áˆ­ á‹­á‰½áˆ‹áˆ‰á¢

    } else {
        // áŠ áˆá‰°áŒˆáŠ“áŠ˜áˆ (Disconnected)
        if (btnText) btnText.innerText = t('label_wallet_connected');
      
        if (btnStatus) {
            btnStatus.innerText = t('label_connect_prompt');
            btnStatus.style.color = "var(--tg-hint)";
            btnStatus.style.fontWeight = "normal";
        }
    }
});

// áŠ á‹áˆ«áˆ© áˆ²áŒ«áŠ• á‹¨áˆšáˆ°áˆ«á‹ á‰°áŒá‰£áˆ­
window.handleWalletConnect = async () => {
    try {
        if (tonConnectUI.connected) {
            const confirmDisconnect = confirm(t('msg_wallet_disconnect_confirm'));
            if (confirmDisconnect) {
                await tonConnectUI.disconnect();
            }
        } else {
            // á‹¨áˆ›áŒˆáŠ“áŠ› áˆ³áŒ¥áŠ‘áŠ• (Modal) á‹­áŠ­áˆá‰µ
            await tonConnectUI.openModal();
        }
    } catch (error) {
        console.error("Wallet connection error:", error);
    }
};
// ============================================================

// ======================================================================
// 2. ğŸ”— á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ­ áˆ˜á‰…áŒƒ á‰°áŒá‰£áˆ­ (Handle Copy Invite Link)
// ğŸ›‘ FIX 1: áŠ áˆáŠ• á‹­áˆ°áˆ«áˆ (á‰  firebaseLogin() á‹áˆµáŒ¥ á‰£áˆˆá‹ áˆ›áˆµá‰°áŠ«áŠ¨á‹«)
// ======================================================================

window.handleCopyInviteLink = () => {
    // telegramUserId á‹¨áˆšáˆˆá‹ á‰°áˆˆá‹‹á‹‹áŒ­ áˆ˜áŒ«áŠ‘áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ (á‰ áŠ¥áˆ­áˆµá‹ áŠ®á‹µ á‹áˆµáŒ¥ global áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µ)
    if (!window.telegramUserId) { // ğŸ›‘ FIX 1: á‹­áˆ… áŠ áˆáŠ• á‰  firebaseLogin() áˆáŠ­áŠ•á‹«á‰µ á‰ á‰µáŠ­áŠ­áˆ á‹­áˆ°áˆ«áˆ
        WebApp.showAlert(t('msg_referral_link_missing')); 
        return;
    }
    
    // á‹¨áˆ˜áŒ‹á‰ á‹£ áˆŠáŠ•áŠ©áŠ• á‹­áˆáŒ¥áˆ«áˆ
    const referralLink = `https://t.me/${BOT_USERNAME}?start=${window.telegramUserId}`;

    // áˆŠáŠ•áŠ©áŠ• á‹ˆá‹° Clipboard áˆ˜á‰…á‹³á‰µ
    navigator.clipboard.writeText(referralLink).then(() => {
        WebApp.showAlert(t('alert_invite_copied'));
    }).catch(err => {
        console.error('Failed to copy link: ', err);
        WebApp.showAlert(t('alert_invite_fail')); 
    });
};



// ======================================================================
// 3. ğŸ‘¥ á‹¨á‰°áˆ»áˆ»áˆˆá‹ á‹¨áŒ“á‹°áŠ› áŒ‹á‰¥á‹/Share á‰°áŒá‰£áˆ­ (Handle Invite Click) ğŸ›‘ áˆ½áˆáˆ›á‰µ á‰°á‹ˆáŒá‹·áˆ
// ======================================================================

window.handleInviteClick = (inviteLink, coins, timestampField) => { 
    // áˆ½áˆáˆ›á‰± á‰ á‰¦á‰µ/áˆ°áˆ­á‰¨áˆ­ Logic áˆµáˆˆáˆšáˆ°áŒ¥á£ á‹¨ 24-áˆ°á‹“á‰µ á‰†áŒ£áˆª áŠ¥áŠ“ updateScore á‰°á‹ˆáŒá‹·áˆ
    
    // ğŸ›‘ FIX 1: window.telegramUserId áŠ áˆáŠ• á‰ á‰µáŠ­áŠ­áˆ á‹­áˆ°áˆ«áˆ
    const currentUserId = window.telegramUserId || 'MOCK_USER';
    
    // á‹¨á‰´áˆŒáŒáˆ«áˆ Referral áˆŠáŠ•áŠ­ áˆ˜ááŒ áˆ­
    const referralLink = `https://t.me/${BOT_USERNAME}?start=${currentUserId}`; 

    const messageText = encodeURIComponent(`â€‹ğŸ¤« áˆšáˆµáŒ¥áˆ©áŠ• áˆáŠ•áŒˆáˆ­áˆ…?
â€‹á‰´áˆŒáŒáˆ«áˆ áˆ‹á‹­ á‰¥á‹™ áˆ°á‹á‰½ á‹¨áˆ›á‹«á‹á‰á‰µ Coin áˆ˜ááˆˆá‰‚á‹« áˆšáŠ’-áŠ á• áŠ áŒáŠá‰»áˆˆáˆ!
â€‹á‹­áˆ„ áŒŒáˆ áŠ á‹­á‹°áˆˆáˆâ€”áŠ¥á‹áŠá‰°áŠ› á‹•á‹µáˆ áŠá‹!
â€‹ğŸ’¡ áŠ¥áŠ”áŠ“ áŒ“á‹°áŠá‰¼ áŠ áˆáŠ• á‰ áŒáŠ•á‰£áˆ­ á‰€á‹°áˆá‰µáŠá‰µ áŒ€áˆáˆ¨áŠ“áˆ! á‰ áŠ‹áˆ‹ áŠ¥áŠ•á‹³á‰µá‰†áŒ­!
â€‹áŠ áˆáŠ‘áŠ‘ á‰°á‰€áˆ‹á‰…áˆˆáˆ… á‹¨á‹µáˆ áˆ˜áŠ•áŒˆá‹±áŠ• áŒ€áˆáˆ­:`); 

    // á‹¨á‰´áˆŒáŒáˆ«áˆ áˆ¼áˆ­ á‹©áŠ áˆ­áŠ¤áˆ
    const shareLink = `https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${messageText}`;

    
    // á‰°áŒ á‰ƒáˆšá‹áŠ• á‹ˆá‹° á‰´áˆŒáŒáˆ«áˆ áˆ˜áŒ‹áˆªá‹« áˆ˜á‹áˆ°á‹µ (Share)
    WebApp.openTelegramLink(shareLink); 
    
    // á‰°áŒ á‰ƒáˆšá‹ áŠ¥áŠ•á‹²á‹«áŒ‹áˆ« áˆˆáˆ›á‰ áˆ¨á‰³á‰³á‰µ áˆ›áˆ³á‹ˆá‰‚á‹« áˆ˜áˆµáŒ á‰µ
    WebApp.showAlert(t('alert_invite_share'));
};




// ======================================================================
// ğŸ›‘ FIX 3 & 4: áˆˆ Support áŠ¥áŠ“ Close áŠ á‹áˆ«áˆ®á‰½ á‹¨á‰°áŒ¨áˆ˜áˆ© á‰°áŒá‰£áˆ«á‰µ
// ======================================================================

/**
 * 3. ğŸ’¼ Support Button Function
 * (á‹­áˆ…áŠ•áŠ• á‰°áŒá‰£áˆ­ á‰  HTML á‹áˆµáŒ¥ áŠ«áˆˆá‹á‰µ á‹¨ Support áŠ á‹áˆ«áˆ­ áŒ‹áˆ­ á‹«áŒˆáŠ“áŠ™á‰µ)
 * e.g., <button onclick="window.handleSupportClick()">Support</button>
 */
window.handleSupportClick = () => {
    // ğŸ›‘ áŠ¥á‰£áŠ­á‹áŠ• 'YourSupportUsername' á‹¨áˆšáˆˆá‹áŠ• á‰ á‰µáŠ­áŠ­áˆˆáŠ›á‹ á‹¨á‹µáŒ‹á áŠ áŠ«á‹áŠ•á‰µ áˆµáˆ á‹­á‰°áŠ©
    const SUPPORT_LINK = 'https://t.me/smartgameSupporter_bot'; // ğŸ‘ˆ áŠ¥á‰£áŠ­á‹áŠ• á‹­áˆ…áŠ•áŠ• á‹­á‰°áŠ©
    try {
        if (window.Telegram && window.Telegram.WebApp) {
            WebApp.openTelegramLink(SUPPORT_LINK);
        } else {
            alert('Support can only be accessed within the Telegram app.');
            window.open(SUPPORT_LINK, '_blank'); // Fallback for browsers
        }
    } catch (e) {
        WebApp.showAlert('Could not open support link: ' + e.message);
    }
};

/**
 * 4. âŒ Close Button Function
 * (á‹­áˆ…áŠ•áŠ• á‰°áŒá‰£áˆ­ á‰  HTML á‹áˆµáŒ¥ áŠ«áˆˆá‹á‰µ á‹¨á‹áŒ‹ áŠ á‹áˆ«áˆ­ áŒ‹áˆ­ á‹«áŒˆáŠ“áŠ™á‰µ)
 * e.g., <button onclick="window.handleCloseClick()">Close</button>
 */
window.handleCloseClick = () => {
    try {
        if (window.Telegram && window.Telegram.WebApp) {
            WebApp.close(); // áˆ˜á‰°áŒá‰ áˆªá‹«á‹áŠ• á‹­á‹˜áŒ‹áˆ
        } else {
            alert('This can only be closed from within the Telegram app.');
        }
    } catch (e) {
        WebApp.showAlert('Error closing app: ' + e.message);
    }
};


        // ======================================================================
        // ?? á‹¨áŒ“á‹°áŠ› áŒ‹á‰¥á‹ á‰°áŒá‰£áˆ­ áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================


        // ğŸ›‘ FIX 2: áŠ¥áŠá‹šáˆ… áŠ¨á‰³á‰½ á‹¨áŠá‰ áˆ©á‰µ á‹¨á‰°á‹°áŒ‹áŒ‹áˆš (Duplicate) á‰°áŒá‰£áˆ«á‰µ á‰°á‹ˆáŒá‹°á‹‹áˆ
        /*
        window.handleWalletConnect = () => { ... };
        window.handleWalletConnect = () => { ... };
        window.handleCopyInviteLink = () => { ... };
        */


   



        // ======================================================================
//                          DAILY STREAK MODAL CODE ğŸ›‘ NEW SECTION
// ======================================================================
        
// áˆ½áˆáˆ›á‰± (streak) á‹¨áˆšá‰‹áˆ¨áŒ¥á‰ á‰µáŠ• áŒŠá‹œ á‰ áˆ°á‹“á‰µ á‹­á‹ˆáˆµáŠ“áˆ (48 áˆ°á‹“á‰µ = 2 á‰€áŠ•)
const STREAK_BREAK_HOURS = 36; 

window.openDailyRewardModal = () => {
    document.getElementById('daily-reward-modal').style.display = 'flex';
    window.updateDailyRewardModal();
}
// ======================================================================
// âœ… ğŸ›‘ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: Streak Game Modal áˆ˜á‹áŒŠá‹« á‰°áŒá‰£áˆ­
// ======================================================================

/**
 * á‹­áˆ… á‰°áŒá‰£áˆ­ Daily Reward ModaláŠ• á‹­á‹˜áŒ‹áˆ.
 */
window.closeDailyRewardModal = () => { // ğŸ›‘ 'Window' á‹ˆá‹° 'window' (á‰µáŠ•áˆ½ áŠá‹°áˆ) á‰°áˆµá‰°áŠ«áŠ­áˆáˆ
    
    // 1. Modal (áˆ½áˆáˆ›á‰±áŠ•) á‹áŒ‹
    document.getElementById('daily-reward-modal').style.display = 'none';

    // áˆá‹³áˆ áˆ²á‹˜áŒ‹ á‹¨áŒŠá‹œ á‰†áŒ£áˆªá‹áŠ• áˆ›á‰†áˆ (á‹¨á‰€á‹°áˆ˜á‹ áŠ®á‹µáˆ…)
    if (typeof timerIntervals !== 'undefined' && timerIntervals['daily_streak_timer']) {
        clearInterval(timerIntervals['daily_streak_timer']);
        delete timerIntervals['daily_streak_timer'];
    }
    
    // 2. âœ… ğŸ›‘ áŠ á‹²áˆµ áŠ®á‹µ: á‹¨áŒ¨á‹‹á‰³ Loading áˆµáŠ­áˆªáŠ‘áŠ• á‹ˆá‹²á‹«á‹áŠ‘ á‹áŒ‹
    const loadingOverlay = document.getElementById('game-loading-overlay');
    
    // áˆá‹°áˆ© á‹¨áˆšá‰³á‹­ áŠ¨áˆ†áŠ á‰¥á‰» á‹áŒ‹
    if (loadingOverlay && loadingOverlay.style.display === 'flex') {
        
        // áˆá‹°áˆ©áŠ• á‰ áˆµáˆá‰µ áˆˆáˆ˜á‹áŒ‹á‰µ (Fade out áŠ¥áŠ•á‹²á‹«á‹°áˆ­áŒ)
        loadingOverlay.style.opacity = '0'; 
        
        // á‹¨ CSS transition áŠ¥áˆµáŠªá‹«áˆá‰… áŒ á‰¥á‰€áŠ• Display áŠ• Hide áŠ¥áŠ“á‹°áˆ­áŒ‹áˆˆáŠ•
        setTimeout(() => {
            loadingOverlay.style.display = 'none';
            // áˆˆáˆšá‰€áŒ¥áˆˆá‹ áŒŠá‹œ áˆµáŠ•áŠ¨áá‰µ á‰ á‰µáŠ­áŠ­áˆ áŠ¥áŠ•á‹²á‰³á‹­ opacity áŠ• á‹ˆá‹° 1 áŠ¥áŠ•áˆ˜áˆáˆ°á‹
            loadingOverlay.style.opacity = '1'; 
        }, 300); // 300ms á‹¨ CSS transition áŒŠá‹œ áŠá‹
    }
}

/**
 * á‹¨ Streak áˆ˜á‰‹áˆ¨áŒ¥áŠ• (break) á‹­áˆá‰µáˆ»áˆ
 * (á‹­áˆ… á‰°áŒá‰£áˆ­ áˆáŠ•áˆ áŠ áˆá‰°áŠáŠ«áˆ)
 */
const checkStreakBroken = (lastClaimTimestamp) => {
    if (!lastClaimTimestamp) {
        return false; // áŒˆáŠ“ áˆáŠ•áˆ claim áŠ áˆ‹á‹°áˆ¨áŒˆáˆ
    }
    const lastClaimTime = lastClaimTimestamp.toDate(); // Timestamp á‹ˆá‹° Date á‰€á‹­áˆ­
    const now = new Date();
    const hoursElapsed = (now.getTime() - lastClaimTime.getTime()) / (1000 * 60 * 60);
    
    // áŠ¨ 48 áˆ°á‹“á‰³á‰µ á‰ áˆ‹á‹­ áŠ«áˆˆáˆá‹, streak á‰°á‰‹áˆ­áŒ§áˆ
    return hoursElapsed > STREAK_BREAK_HOURS; 
}




window.updateDailyRewardModal = () => {
    const rewardGrid = document.getElementById('reward-grid');
    const claimButton = document.getElementById('daily-reward-claim-button');
    
    if (!currentUserDocData) return;

    const { isReady, remainingMs } = checkDailyLimit('last_streak_claim_time');
    const isStreakBroken = checkStreakBroken(currentUserDocData.last_streak_claim_time);
    
    let nextDayToClaim;
    if (isStreakBroken) {
        nextDayToClaim = 1;
    } else {
        nextDayToClaim = currentUserDocData.daily_streak || 1;
    }
    
    const daysAlreadyClaimed = (nextDayToClaim > 1 && !isStreakBroken) ? (nextDayToClaim - 1) : 0;

    let rewardCardsHtml = '';

    dailyStreakRewards.forEach((reward, index) => {
        const dayNumber = index + 1;
        const isClaimedToday = dayNumber <= daysAlreadyClaimed; 
        const isNextDay = dayNumber === nextDayToClaim;
        
        let cardClass = '';
        let lockIcon = '';
        let extraStyle = '';
        let numberBlur = '';

        if (reward.locked) {
            // âœ… áˆ›áˆµá‰°áŠ«áŠ¨á‹« 1: Opacity á‹ˆá‹° 1 á‰°áŒ áŒá‰·áˆ (á‰ á‹°áŠ•á‰¥ áŠ¥áŠ•á‹²á‰³á‹­)á£ áŒáŠ• á‹¨á‹³áˆ­ áˆ˜áˆµáˆ˜áˆ© (Border) á‰€á‹­ áŠ¥áŠ•á‹²áˆ†áŠ• á‰°á‹°áˆ­áŒ“áˆ
            extraStyle = 'opacity: 0.9; border: 1px solid var(--et-red); pointer-events: none; background-color: #2a2a2a;'; 
            
            // âœ… áˆ›áˆµá‰°áŠ«áŠ¨á‹« 2: á‹¨á‰áˆá áˆáˆáŠ­á‰±áŠ• á‹ˆá‹° á‰€á‹­ SVG á‰€á‹­áˆ¨áŠá‹‹áˆ (áŒáˆá‰¶ áŠ¥áŠ•á‹²á‰³á‹­)
            lockIcon = `
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; background: rgba(0,0,0,0.8); border-radius: 50%; padding: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px #000;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#FF5252" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>`;
            
            // á‹µá‰¥á‹˜á‹›á‹áŠ• (Blur) áˆ™áˆ‰ áˆˆáˆ™áˆ‰ áŠ áŒ¥áá‰°áŠá‹‹áˆ
            numberBlur = ''; 

        } else if (isClaimedToday) {
            cardClass = 'claimed';
        } else if (isNextDay && isReady) {
            cardClass = 'active-ready';
        }

        rewardCardsHtml += `
            <div class="reward-day-card ${cardClass}" id="reward-day-${dayNumber}" style="position: relative; ${extraStyle}">
                ${lockIcon}
                <p style="font-size: 10px; color: ${cardClass === 'claimed' ? 'var(--tg-hint)' : 'var(--tg-text)'}; margin: 0;">Day ${dayNumber}</p>
                <div class="reward-coin-icon">${(reward.coins / 1000).toFixed(0)}K</div> 
                <span style="${numberBlur}">${reward.coins.toLocaleString()}</span> 
            </div>
        `;
    });
    
    rewardGrid.innerHTML = rewardCardsHtml;

    // áŠ á‹áˆ«áˆ©áŠ• áˆ›áˆµá‰°áŠ«áŠ¨áˆ
    if (dailyStreakRewards[nextDayToClaim - 1].locked) {
         claimButton.disabled = true;
         claimButton.style.backgroundColor = '#333';
         claimButton.style.color = '#FF5252'; // áŒ½áˆá‰ á‰€á‹­ áŠ¥áŠ•á‹²áˆ†áŠ•
         claimButton.style.border = '1px solid #FF5252';
         claimButton.style.boxShadow = 'none';
         claimButton.innerText = `ğŸ”’ Day ${nextDayToClaim} is Locked (Coming Soon)`;
         claimButton.onclick = null;
         return;
    }

    if (isReady) {
        const rewardAmount = dailyStreakRewards[nextDayToClaim - 1].coins;
        claimButton.disabled = false;
        claimButton.style.backgroundColor = 'var(--et-green)';
        claimButton.style.color = 'white';
        claimButton.style.border = 'none';
        claimButton.style.boxShadow = '0 4px 0 #388E3C';
        claimButton.innerText = `CLAIM DAY ${nextDayToClaim} (+${rewardAmount.toLocaleString()} ğŸ’°)`; 
        claimButton.onclick = () => window.claimDailyReward(nextDayToClaim, rewardAmount); 
    
    } else {
        claimButton.disabled = true;
        claimButton.style.backgroundColor = '#555';
        claimButton.style.color = 'white';
        claimButton.style.border = 'none';
        claimButton.style.boxShadow = '0 4px 0 #333';
        claimButton.onclick = null;
        claimButton.innerText = `Come back tomorrow (${formatTime(remainingMs)} left)`;
        
        if (timerIntervals['daily_streak_timer']) {
            clearInterval(timerIntervals['daily_streak_timer']);
        }
        timerIntervals['daily_streak_timer'] = setInterval(() => {
            const { isReady: checkAgain, remainingMs: remainingAgain } = checkDailyLimit('last_streak_claim_time');
            if(checkAgain) {
                window.updateDailyRewardModal();
                clearInterval(timerIntervals['daily_streak_timer']);
            } else {
                claimButton.innerText = `Come back tomorrow (${formatTime(remainingAgain)} left)`;
            }
        }, 1000);
    }
}


window.claimDailyReward = async (dayToClaim, coins) => { 
    
    // âœ…âœ…âœ… === á‹¨ Streak áˆ›áˆ¨áŒ‹áŒˆáŒ« (Validation) === âœ…âœ…âœ…
    const isStreakBroken = checkStreakBroken(currentUserDocData.last_streak_claim_time);
    
    let expectedDayToClaim;
    if (isStreakBroken) {
        expectedDayToClaim = 1; // á‰°á‰‹áˆ­áŒ§áˆá£ á‰€áŠ• 1áŠ• áˆ˜áŒ á‰ á‰…
    } else {
        expectedDayToClaim = currentUserDocData.daily_streak || 1; // áŠ«áˆá‰°á‰‹áˆ¨áŒ  áŠ¨á‰†áˆ˜á‰ á‰µ
    }
    
    // á‰°áŒ á‰ƒáˆšá‹ claim áˆˆáˆ›á‹µáˆ¨áŒ á‹¨áˆáŠ¨áˆ¨á‹ á‰€áŠ• áŠ¥áŠ“ áŠ¥áŠ› á‹¨áˆáŠ•áŒ á‰¥á‰€á‹ á‰€áŠ• á‹­á‹›áˆ˜á‹³áˆ‰?
    if (dayToClaim !== expectedDayToClaim) {
        WebApp.showAlert("âŒ á‰µáŠ­áŠ­áˆˆáŠ›á‹áŠ• á‰€áŠ• áŠ¥á‹¨áŒ á‹¨á‰ áŠ á‹­á‹°áˆ‰áˆ! (Streak may have reset)");
        window.updateDailyRewardModal(); // UI áŠ¥áŠ•á‹²áˆµá‰°áŠ«áŠ¨áˆ
        return;
    }
    // âœ…âœ…âœ… === áˆ›áˆ¨áŒ‹áŒˆáŒ«á‹ áŠ áˆˆá‰€ === âœ…âœ…âœ…
    
    // á‹¨ streak á‰†áŒ áˆ«á‹ á‰ á‰€áŒ¥á‰³ á‹ˆá‹°áˆšá‰€áŒ¥áˆˆá‹ á‰€áŠ• á‹­á‹˜áˆ‹áˆ. 10 áŠ¨á‹°áˆ¨áˆ° á‹ˆá‹° 1 á‹­áˆ˜áˆˆáˆ³áˆ.
    const newStreakCount = dayToClaim >= dailyStreakRewards.length ? 1 : dayToClaim + 1;
    
    const extraUpdateData = {
        // áŠ á‹²áˆ± streak á‰áŒ¥áˆ­ (áŠ¨1 áŠ¥áˆµáŠ¨ 10)
        daily_streak: newStreakCount, 
        // á‹­áˆ… áŒŠá‹œ á‰†áŒ£áˆª áŠáŒˆ áŠ¥áŠ•á‹²áˆ°áˆ« á‹¨áˆšá‹«á‹°áˆ­áŒˆá‹ áŠá‹
        last_streak_claim_time: serverTimestamp(), 
    };
    
    // áŠ á‹áˆ«áˆ©áŠ• áŠ¥áŠ•á‹³á‹­áŒ«áŠ• áˆ›á‹µáˆ¨áŒ
    document.getElementById('daily-reward-claim-button').disabled = true;
    document.getElementById('daily-reward-claim-button').innerText = 'CLAIMED!';

    const success = await updateScore(coins, `Daily Streak Day ${dayToClaim}`, 'last_streak_claim_time', extraUpdateData); 

    if (success) {
        window.playSound('win'); // ğŸ›‘ á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
        // á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ¨á‰°áˆ°áŒ  á‰ áŠ‹áˆ‹ á‹¨áŠ áˆáŠ‘áŠ• á‹¨áˆá‹³áˆ áŠ¥á‹­á‰³ á‹ˆá‹²á‹«á‹áŠ‘ áˆ›á‹˜áˆ˜áŠ•
        if (timerIntervals['daily_streak_timer']) {
             clearInterval(timerIntervals['daily_streak_timer']);
             delete timerIntervals['daily_streak_timer'];
        }
        // Firebase á‹³á‰³á‹ á‰  onSnapshot áˆµáˆˆáˆšá‹˜áˆáŠ•, á‰µáŠ•áˆ½ á‰†á‹­á‰¶ updateDailyRewardModal áˆ˜áŒ¥áˆ«á‰µ
        setTimeout(window.updateDailyRewardModal, 1000); 
        renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
    }
}


        // ======================================================================
        //                          DAILY STREAK MODAL CODE áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================
     

     

// ======================================================================
//                          LUCKY SLOT GAME CODE ğŸ›‘ UPDATED SECTION
// ======================================================================

// ?? UPDATED (Problem #1 Fixed)
window.updateSlotGameUI = () => {
     const spinBtn = document.getElementById('spin-btn');
     const spinsLeftDisplay = document.getElementById('spins-left');
     const messageEl = document.getElementById('game-message');
     const resetTimerEl = document.getElementById('reset-timer');
     const resetContainer = document.getElementById('reset-timer-container');
     
     // âœ… á‹¨á‰†áŒ£áˆª á‰áˆá (timer key) áŠ¨áˆŒáˆá‰½ á‰†áŒ£áˆªá‹á‰½ áŒ‹áˆ­ áŠ¥áŠ•á‹³á‹­áŒ‹áŒ­
     const timerKey = 'slot_reset_timer';

     spinsLeftDisplay.innerText = currentSpinsLeft;
     
     const { isReady: resetReady, remainingMs: resetRemainingMs } = checkDailyLimit(SLOTS_COOLDOWN_FIELD);
     
     if (currentSpinsLeft > 0) {
         spinBtn.disabled = false;
         spinBtn.innerText = t('btn_spin_default');
         spinBtn.onclick = window.spinSlotMachine;
         resetContainer.style.display = 'none';
         messageEl.innerText = t('msg_press_spin');

         // âœ… áˆ°á‹“á‰µ á‰†áŒ£áˆªá‹ áŠ¥á‹¨áˆ°áˆ« áŠ¨áˆ†áŠ áˆ›á‰†áˆ (spin áˆµáˆ‹áŒˆáŠ˜)
         if (timerIntervals[timerKey]) {
             clearInterval(timerIntervals[timerKey]);
             delete timerIntervals[timerKey];
         }
     } else if (resetReady) {
         spinBtn.disabled = false;
         spinBtn.innerText = t('btn_reset_spin');
         spinBtn.onclick = () => window.resetSlotGameAndSpin(true);
         resetContainer.style.display = 'block';
         resetTimerEl.innerText = t('msg_reset_ready'); // ğŸŸ¢ Translated
         messageEl.innerText = t('msg_slot_finished_reset'); 

         // âœ… áˆ°á‹“á‰µ á‰†áŒ£áˆªá‹ áŠ¥á‹¨áˆ°áˆ« áŠ¨áˆ†áŠ áˆ›á‰†áˆ (á‹áŒáŒ áˆµáˆˆáˆ†áŠ)
         if (timerIntervals[timerKey]) {
             clearInterval(timerIntervals[timerKey]);
             delete timerIntervals[timerKey];
         }
     } else {
         spinBtn.disabled = true;
         spinBtn.innerText = t('slot_no_spins'); // ğŸŸ¢ Translated
         spinBtn.onclick = null;
         resetContainer.style.display = 'block';
         messageEl.innerText = t('msg_slot_no_spins'); 
     
         // ğŸ›‘ğŸ›‘ğŸ›‘ === FIX #1 ADDED === ğŸ›‘ğŸ›‘ğŸ›‘
         // áˆ°á‹“á‰± áŠ¥áŠ•á‹²á‰†áŒ¥áˆ­ áˆ›á‹µáˆ¨áŒ (Translate the text structure)
         resetTimerEl.innerText = t('msg_reset_timer', { time: formatTime(resetRemainingMs) }); 
         
         if (!timerIntervals[timerKey]) { // á‰†áŒ£áˆªá‹ áŠ áˆµá‰€á‹µáˆ áŠ«áˆá‰°áŒ€áˆ˜áˆ¨ á‰¥á‰»
             timerIntervals[timerKey] = setInterval(() => {
                 const { isReady: checkAgain, remainingMs: remainingAgain } = checkDailyLimit(SLOTS_COOLDOWN_FIELD);
                 if(checkAgain) {
                     window.updateSlotGameUI(); // áŒŠá‹œá‹ áˆ²á‹«áˆá‰… UIáŠ• á‹«á‹˜áˆáŠ“áˆ
                     clearInterval(timerIntervals[timerKey]);
                     delete timerIntervals[timerKey];
                 } else {
                     resetTimerEl.innerText = t('msg_reset_timer', { time: formatTime(remainingAgain) });
                 }
             }, 1000);
         }
         // ğŸ›‘ğŸ›‘ğŸ›‘ === END OF FIX === ğŸ›‘ğŸ›‘ğŸ›‘
     }
}

// ğŸ›‘ UPDATED (á‹­áˆ… á‰°áŒá‰£áˆ­ á‰µáŠ­áŠ­áˆ áŠá‰ áˆ­ - áŠ áˆáŠ• Alert á‰°áˆµá‰°áŠ«áŠ­áˆáˆ)
window.resetSlotGameAndSpin = async (startSpin = false) => {
    if (currentSpinsLeft > 0) return; // á‹¨áˆšáˆ°áˆ«á‹ á‹œáˆ® áˆ²áˆ†áŠ• á‰¥á‰» áŠá‹
    
    const userRef = doc(db, "users", currentFirebaseUserId); 
    
    const updateData = {
        slot_spins_left: SLOTS_MAX_SPINS,
        last_slot_reset_time: serverTimestamp(),
    };
    
    try {
        await updateDoc(userRef, updateData);
        currentSpinsLeft = SLOTS_MAX_SPINS; // á‹ˆá‹²á‹«á‹áŠ‘ UIáŠ• áˆˆáˆ›á‹˜áˆ˜áŠ•
        
        if (startSpin) {
            WebApp.showAlert(t('slot_reset_success')); // ğŸŸ¢ Translated
            await window.spinSlotMachine(); 
        } else {
            WebApp.showAlert(t('slot_reset_success')); 
        }
        
        window.updateSlotGameUI(); 
        return true;
    } catch (error) {
        WebApp.showAlert(t('alert_db_error')); // ğŸŸ¢ Translated
        console.error("Error resetting Slot Game:", error);
        return false;
    }
}
// âœ… áŠ á‹²áˆµ áŠ¥áŠ“ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ Spin Function
window.spinSlotMachine = async () => {
    if (currentSpinsLeft <= 0) {
         WebApp.showAlert("á‹­á‰…áˆ­á‰³! áˆ™áŠ¨áˆ« áŠ áˆá‰†á‰¥á‹á‰³áˆ::"); 
         window.updateSlotGameUI(); 
         return;
    }
    
    window.playSound('spin'); 
    
    const spinBtn = document.getElementById('spin-btn');
    const slots = [
        document.getElementById('slot-1'),
        document.getElementById('slot-2'),
        document.getElementById('slot-3')
    ];
    
    // áˆˆáŒ¨á‹‹á‰³á‹ á‹¨áˆšáˆ†áŠ‘ áˆáˆµáˆá‰½
    const slotItems = ['ğŸ’', 'â­ï¸', 'ğŸ’', 'ğŸ‹', 'ğŸ‰', 'ğŸ‡', 'ğŸ””', 'ğŸ’°'];
    
    spinBtn.disabled = true;
    spinBtn.innerHTML = "áŠ¥á‹¨á‰°áˆ½áŠ¨áˆ¨áŠ¨áˆ¨ áŠá‹...<br>SPINNING...";
    
    // 1. áŠ áˆ¸áŠ“áŠá‹áŠ• á‹áŒ¤á‰µ áˆ˜á‹ˆáˆ°áŠ•
    const isJackpotWinner = Math.random() < 0.08; 
    const finalPrizes = [];
    
    if (isJackpotWinner) {
        // áŒƒáŠ­á–á‰µ áŠ¨áˆ†áŠ áˆáˆ‰áˆ á‰°áˆ˜áˆ³áˆ³á‹­
        const winItem = slotItems[0]; // ğŸ’
        finalPrizes.push(winItem, winItem, winItem);
    } else {
        // áŠ«áˆáˆ†áŠ á‹¨á‹˜áˆá‰€á‹°
        for(let i=0; i<3; i++) {
            finalPrizes.push(slotItems[Math.floor(Math.random() * slotItems.length)]);
        }
    }

    // 2. áŠ áŠ’áˆœáˆ½áŠ‘áŠ• áˆ˜ááŒ áˆ­
    const slotHeight = 80; // á‹¨áˆ³áŒ¥áŠ‘ á‰áˆ˜á‰µ (CSS áˆ‹á‹­ áŠ«áˆˆá‹ áŒ‹áˆ­ áŠ¥áŠ©áˆ áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µ)
    const totalIconsPerReel = 20; // áŠ¨áˆ˜á‰†áˆ™ á‰ áŠá‰µ áˆµáŠ•á‰µ áˆáˆµáˆá‰½ á‹­áˆˆá‰?
    
    const animations = slots.map((slot, index) => {
        return new Promise(resolve => {
            // A. á‹¨á‰€á‹µáˆá‹áŠ• áˆ›áŒ½á‹³á‰µ
            slot.innerHTML = '';
            
            // B. á‹¨áˆšáˆ½áŠ¨áˆ¨áŠ¨áˆ¨á‹áŠ• áˆ°áŠ•áˆ°áˆˆá‰µ (Reel) áˆ˜ááŒ áˆ­
            const reel = document.createElement('div');
            reel.className = 'slot-reel';
            
            // C. á‹¨á‹˜áˆá‰€á‹° áˆáˆµáˆá‰½áŠ• áˆ°áŠ•áˆ°áˆˆá‰± áˆ‹á‹­ áˆ˜áŒ¨áˆ˜áˆ­ (áˆˆáŠ áŠ’áˆœáˆ½áŠ•)
            let reelContent = '';
            for (let i = 0; i < totalIconsPerReel; i++) {
                const randomItem = slotItems[Math.floor(Math.random() * slotItems.length)];
                reelContent += `<div class="reel-item">${randomItem}</div>`;
            }
            
            // D. á‰µáŠ­áŠ­áˆˆáŠ›á‹ áŠ áˆ¸áŠ“áŠ á‹áŒ¤á‰µ á‰ áˆ˜áŒ¨áˆ¨áˆ» áˆ‹á‹­ á‹­áŒ¨áˆ˜áˆ«áˆ
            reelContent += `<div class="reel-item">${finalPrizes[index]}</div>`;
            
            reel.innerHTML = reelContent;
            slot.appendChild(reel);
            
            // E. áŠ áŠ’áˆœáˆ½áŠ‘áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ (á‰µáŠ•áˆ½ á‹˜áŒá‹­á‰¶ - 10ms)
            setTimeout(() => {
                // áˆáŠ• á‹«áˆ…áˆ á‹ˆá‹° áˆ‹á‹­ áŠ¥áŠ•á‹°áˆšáŠ•áˆ¸áˆ«á‰°á‰µ áˆ›áˆµáˆ‹á‰µ
                // (áŒ á‰…áˆ‹áˆ‹ áˆáˆµáˆá‰½ * á‰áˆ˜á‰µ)
                const distance = (totalIconsPerReel) * slotHeight;
                
                // áŠ¥á‹«áŠ•á‹³áŠ•á‹± Slot á‰µáŠ•áˆ½ á‹˜áŒá‹­á‰¶ áŠ¥áŠ•á‹²á‰†áˆ (index * 500ms)
                reel.style.transition = `transform ${2 + index * 0.5}s cubic-bezier(0.25, 1, 0.5, 1)`;
                reel.style.transform = `translateY(-${distance}px)`;
            }, 50);

            // F. áŠ áŠ’áˆœáˆ½áŠ‘ áˆ²á‹«áˆá‰…
            const animationDuration = (2 + index * 0.5) * 1000;
            setTimeout(() => {
                resolve();
            }, animationDuration);
        });
    });
    
    // áˆáˆ‰áˆ áŠ¥áˆµáŠªáŒ¨áˆ­áˆ± áˆ˜áŒ á‰ á‰…
    await Promise.all(animations); 
    
    // 3. á‹áŒ¤á‰±áŠ• áˆ›áˆµáˆ‹á‰µ áŠ¥áŠ“ áˆ›áˆ³á‹¨á‰µ
     let message = "";
     let totalCoins = 0; 

     // áˆ¦áˆµá‰±áˆ áŠ áŠ•á‹µ áŠ á‹­áŠá‰µ áŠ¨áˆ†áŠ‘ (áˆˆáˆáˆ³áˆŒ ğŸ’ ğŸ’ ğŸ’)
     if (finalPrizes[0] === finalPrizes[1] && finalPrizes[1] === finalPrizes[2]) {
         if(finalPrizes[0] === 'ğŸ’') {
             totalCoins = 1000;
             message = `ğŸ‰ JACKPOT! ${totalCoins} áˆ³áŠ•á‰²áˆ áŠ áˆ¸áŠ•áˆá‹‹áˆ!`;
             window.playSound('win'); 
         } else {
             totalCoins = 500;
             message = `áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${totalCoins} áˆ³áŠ•á‰²áˆ áŠ áˆ¸áŠ•áˆá‹‹áˆ!`;
         }
     } 
     // áˆáˆˆá‰µ á‰°áˆ˜áˆ³áˆ³á‹­ áŠ¨áˆ†áŠ‘
     else if (finalPrizes[0] === finalPrizes[1] || finalPrizes[1] === finalPrizes[2] || finalPrizes[0] === finalPrizes[2]) {
         totalCoins = 100;
         message = `áŒ¥áˆ© áˆ™áŠ¨áˆ«! ${totalCoins} áˆ³áŠ•á‰²áˆ áŠ áˆ¸áŠ•áˆá‹‹áˆ!`;
     } else {
         totalCoins = 0;
         message = "áŠ áˆ‹áˆ¸áŠá‰áˆá£ á‰ á‹µáŒ‹áˆš á‹­áˆáŠ­áˆ©!";
         window.playSound('fail'); 
     }
     
     document.getElementById('game-message').innerText = message;
     
     // 4. á‹³á‰³á‰¤á‹ áˆ›á‹˜áˆ˜áŠ• (Logic áŠ¥áŠ•á‹°á‰€áŒ áˆˆ áŠá‹)
     currentSpinsLeft--;
     
     // ... (á‹¨ Firebase Update áŠ®á‹µáˆ… áŠ¥á‹šáˆ… á‹­á‰€áŒ¥áˆ‹áˆ) ...
     
     // UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
     window.updateSlotGameUI(); 
}



        
        
      // ======================================================================
//         DAILY SPIN GAME CODE (FAST SPEED & FIXED ALIGNMENT)
// ======================================================================

const spinPrizes = [
    { index: 0, coins: 5000, text: "5000 coin" }, 
    { index: 1, coins: 50,   text: "50 coin" },   
    { index: 2, coins: 20,   text: "20 coin" },   
    { index: 3, coins: 2000, text: "2000 coin" }, 
    { index: 4, coins: 5,    text: "5 coin" },    
    { index: 5, coins: 0,    text: "0 coin" },    
    { index: 6, coins: 10,   text: "10 coin" },   
    { index: 7, coins: 1000, text: "1000 coin" }, 
    { index: 8, coins: 500,  text: "500 coin" },  
    { index: 9, coins: 200,  text: "200 coin" }   
];

const segmentAngle = 36; // 360 / 10

window.spinTheWheel = async () => {
    const timestampField = 'last_spin_time';
    const actionButton = document.getElementById('daily-spin-action');
    const wheel = document.getElementById('spin-wheel');

    // Check Limit
    if (typeof checkDailyLimit === "function") {
        const { isReady } = checkDailyLimit(timestampField);
        if (!isReady) {
            WebApp.showAlert(t('msg_cooldown_24')); 
            return;
        }
    }

    actionButton.disabled = true;
    if(window.playSound) window.playSound('spin');

    // 1. Random Selection
    const randomIndex = Math.floor(Math.random() * spinPrizes.length);
    const winningPrize = spinPrizes[randomIndex];

    // ============================================================
    // ğŸ›‘ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (THE FIX)
    // 1. ááŒ¥áŠá‰µ áˆˆáˆ˜áŒ¨áˆ˜áˆ­: spinCount = 10 (á‰ áŒ£áˆ áˆáŒ£áŠ• á‹­áˆ†áŠ“áˆ)
    // 2. áŠ áˆ°áˆ‹áˆˆá áˆˆáˆ›áˆµá‰°áŠ«áŠ¨áˆ: correctionOffset = -36 (á‹ˆá‹° áŠá‰µ á‹­áŒˆá‹á‹‹áˆ)
    // ============================================================
    
    const spinCount = 10; // áŠ áˆáŠ• 10 áŒŠá‹œ á‹­áˆ½áŠ¨áˆ¨áŠ¨áˆ«áˆ (á‰ áŒ£áˆ á‹­áˆáŒ¥áŠ“áˆ)
    const correctionOffset = -36; // áŒáˆ›á‹ á‹ˆá‹° áŠ‹áˆ‹ áŠ¥áŠ•á‹³á‹­á‰€áˆ­ á‹ˆá‹°áŠá‰µ á‹­áŒˆá‹á‹‹áˆ

    // ============================================================

    const baseRotation = 360 * spinCount; 
    const targetRotation = baseRotation - (randomIndex * segmentAngle) - correctionOffset;

    // 2. Reset & Spin
    wheel.style.transition = 'none';
    wheel.style.transform = `rotate(0deg)`;

    setTimeout(async () => {
        // áŠ¥á‹šáˆ… áŒ‹áˆ­ cubic-bezier á‰°áˆµá‰°áŠ«áŠ­áˆáˆ (áˆ˜áŒ€áˆ˜áˆªá‹« áˆ‹á‹­ á‰ áŒ£áˆ áˆáŒ¥áŠ– áˆ˜áŒ¨áˆ¨áˆ» áˆ‹á‹­ á‰€áˆµ áŠ¥áŠ•á‹²áˆ)
        wheel.style.transition = 'transform 4.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
        wheel.style.transform = `rotate(${targetRotation}deg)`;

        // 4.5 áˆ°áŠ¨áŠ•á‹µ áˆ˜áŒ á‰ á‰…
        await new Promise(resolve => setTimeout(resolve, 4500));

        // áˆ½áˆáˆ›á‰µ áˆ›áˆ¨áŒ‹áŒˆáŒ¥
        console.log(`Won Index: ${randomIndex}, Prize: ${winningPrize.text}`);

        let success = true;
        if (typeof updateScore === "function") {
            success = await updateScore(winningPrize.coins, 'Daily Spin', timestampField);
        }

        if (success) {
                    let msg = t('msg_spin_won', { amount: winningPrize.coins.toLocaleString() }); 
            
            if (typeof WebApp !== 'undefined' && WebApp.showAlert) {
                WebApp.showAlert(msg);
            } else {
                alert(msg);
            }
            if(window.playSound) window.playSound('win');
        }

        if (typeof startCooldownTimer === "function") {
            startCooldownTimer(timestampField, 'daily-spin-timer', 'daily-spin-action');
        }

    }, 50);
};


              // ======================================================================
        //                          DAILY SPIN GAME CODE áˆ˜áŒ¨áˆ¨áˆ» 
        // ======================================================================
 



  // ======================================================================
//                          MYSTERY BOX GAME CODE
// ======================================================================
        const mysteryPrizes = [100, 250, 500]; 
        let hasPlayedMysteryBox = false;
        let correctBoxIndex = -1;

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.resetMysteryBox = (showSuccessMessage = true) => {
            const actionButton = document.getElementById('mystery-box-action');
            const messageEl = document.getElementById('box-message');
            const boxes = [document.getElementById('box-1'), document.getElementById('box-2'), document.getElementById('box-3')];
            
            boxes.forEach(box => {
                box.innerText = '?';
                box.classList.remove('opened', 'missed');
                box.style.pointerEvents = 'auto'; 
                box.style.backgroundColor = 'var(--et-red)';
                // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: playMysteryBox()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                box.onclick = () => window.playMysteryBox(parseInt(box.id.split('-')[1])); 
                // á‹¨3D áŒ¥áˆ‹á‹áŠ• á‹­áˆ˜áˆáˆ±
                box.style.boxShadow = '0 8px 0 #A83232';
                box.style.transform = 'translateY(0)';
            });
            
            actionButton.innerText = t('btn_retry'); 
            actionButton.disabled = false;
            actionButton.style.display = 'none'; 
            messageEl.innerText = t('msg_pick_box'); 
            
            hasPlayedMysteryBox = false;
            correctBoxIndex = Math.floor(Math.random() * 3) + 1; 
            
            const { isReady } = checkDailyLimit('last_mystery_time');
            if (!isReady) {
                 boxes.forEach(box => box.style.pointerEvents = 'none');
                 messageEl.innerText = t('msg_try_again_tmrw');
                 actionButton.style.display = 'block'; 
                 // ğŸŸ¢ Translated: á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ
                 actionButton.innerText = t('btn_go_home'); 
                 // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: showMainPage()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                 actionButton.onclick = window.showMainPage; 
            }
            
            if (showSuccessMessage) WebApp.showAlert(t('msg_game_reset'));
        }

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.playMysteryBox = async (selectedBoxIndex) => {
            const timestampField = 'last_mystery_time';
            const messageEl = document.getElementById('box-message');
            const boxes = [document.getElementById('box-1'), document.getElementById('box-2'), document.getElementById('box-3')];
            const actionButton = document.getElementById('mystery-box-action');

            if (hasPlayedMysteryBox) return; 

            const { isReady } = checkDailyLimit(timestampField);
            if (!isReady) {
                // ğŸŸ¢ Translated: Cooldown Alert
                WebApp.showAlert(t('alert_mystery_cooldown'));
                return;
            }

            hasPlayedMysteryBox = true;
            boxes.forEach(box => box.style.pointerEvents = 'none'); 

            let coinsWon = 0; 
            const winningPrize = mysteryPrizes[Math.floor(Math.random() * mysteryPrizes.length)];
            
            boxes.forEach((box, index) => {
                const boxNum = index + 1;
                if (boxNum === correctBoxIndex) {
                    box.innerText = `+${winningPrize}`;
                    box.classList.add('opened');
                    box.style.backgroundColor = 'var(--et-green)';
                    box.style.boxShadow = '0 8px 0 #388E3C';
                    if (boxNum === selectedBoxIndex) {
                        coinsWon = winningPrize; 
                        // á‹¨áˆ˜áˆ¨áŒ¥áŠá‹áŠ• áˆ³áŒ¥áŠ• á‰µáŠ•áˆ½ á‹ˆá‹°áˆ‹á‹­ áŠ¥áŠ•á‹²áŠ•á‰€áˆ³á‰€áˆµ áŠ¥áŠ“á‹µáˆ­áŒ
                        box.style.transform = 'translateY(-5px)'; 
                    }
                } else {
                    box.innerText = 'âŒ';
                    box.classList.add('missed');
                    box.style.backgroundColor = 'var(--tg-hint)';
                    box.style.boxShadow = '0 8px 0 #333';
                }
            });

            if (selectedBoxIndex === correctBoxIndex) {
                // ğŸ›‘ FIXED: coins.toLocaleString() á‹ˆá‹° coinsWon.toLocaleString() á‰°á‰€á‹­áˆ¯áˆ
                messageEl.innerText = t('mystery_win', { amount: coinsWon.toLocaleString() }); 
                window.playSound('win'); 
            } else {
                // ğŸ›‘ FIXED: Logic bug: correctBoxIndex + 1 á‹ˆá‹° correctBoxIndex á‰°á‰€á‹­áˆ¯áˆ (1, 2, á‹ˆá‹­áˆ 3 áŠá‹)
                messageEl.innerText = t('mystery_loss', { box: correctBoxIndex });
                window.playSound('fail'); 
            }
            
            if (coinsWon > 0) { 
                await updateScore(coinsWon, 'Mystery Box Game', timestampField); 
            } else {
                 // ğŸŸ¢ Translated: Loss Alert
                 WebApp.showAlert(t('alert_mystery_loss_try_again')); 
            }
            
            startCooldownTimer(timestampField, 'mystery-box-timer', 'mystery-box-action');
            actionButton.style.display = 'block'; 
            // ğŸŸ¢ Translated: á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ
            actionButton.innerText = t('btn_go_home'); 
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: showMainPage()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            actionButton.onclick = window.showMainPage;
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        }


        // ======================================================================
        //                           REFLEX GAME CODE 
        // ======================================================================
        let timeoutID = null;
        let startTime = 0;
        let isWaitingForClick = false;

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.resetReflexGame = (showSuccessMessage = true) => {
            clearTimeout(timeoutID);
            isWaitingForClick = false;
            isReflexGameRunning = false; 
            document.getElementById('reflex-button').style.display = 'none';
            document.getElementById('reflex-message').innerText = t('msg_reflex_start_btn');
            document.getElementById('reflex-result').innerText = '';
            document.getElementById('reflex-game-action').innerText = t('btn_start_game'); 
            document.getElementById('reflex-game-action').disabled = false;
            // ?? á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick; 
            
            const { isReady } = checkDailyLimit('last_reflex_time');
            if (!isReady) {
                 document.getElementById('reflex-game-action').classList.add('cooldown');
                 document.getElementById('reflex-game-action').disabled = true;
                 document.getElementById('reflex-message').innerText = 'á‹›áˆ¬ á‰°áŒ«á‹á‰°á‹‹áˆá¢ áŠáŒˆ á‹­áˆáŠ­áˆ©á¢';
            } else {
                 document.getElementById('reflex-game-action').classList.remove('cooldown');
            }
            
            if (showSuccessMessage) WebApp.showAlert('áŒ¨á‹‹á‰³á‹ á‹³áŒáˆ á‰°áŒ€áˆáˆ¯áˆ!');
        }

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.handleReflexTooEarlyClick = () => {
             if (isReflexGameRunning && !isWaitingForClick) {
                 clearTimeout(timeoutID);
                 // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexFailure()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                 window.handleReflexFailure(t('reflex_too_early')); 
                 window.playSound('fail'); // ğŸ›‘ á‹¨ Fail á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
             }
        }
        
        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.startReflexGame = () => {
            const timestampField = 'last_reflex_time';
            const actionButton = document.getElementById('reflex-game-action');

            const { isReady } = checkDailyLimit(timestampField);
            if (!isReady) {
                WebApp.showAlert(`âŒ á‹¨ááŒ¥áŠá‰µ áŒ¨á‹‹á‰³ (Reflex Game) áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢`);
                return;
            }
            
            actionButton.disabled = true;
            actionButton.innerText = 'á‰°áŒ áŠ“á‰‹áˆ...';
            isReflexGameRunning = true; 
            
            document.getElementById('reflex-message').innerText = t('msg_reflex_wait');
            document.getElementById('reflex-result').innerText = '';
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick;

            const delay = Math.random() * 3000 + 1000; 
            
            timeoutID = setTimeout(() => {
                document.getElementById('reflex-message').style.display = 'none';
                document.getElementById('reflex-button').style.display = 'flex';
                document.getElementById('reflex-button').style.backgroundColor = 'var(--et-green)'; 
                document.getElementById('reflex-button').innerText = t('msg_reflex_tap'); 
                isWaitingForClick = true;
                startTime = performance.now();
                
                timeoutID = setTimeout(() => {
                    // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: stopReflexGame()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                    window.stopReflexGame(null, true); 
                }, 3000); 
                
            }, delay);
        };
        
        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.handleReflexFailure = (message) => {
            clearTimeout(timeoutID);
            isWaitingForClick = false;
            isReflexGameRunning = false; 
            
            document.getElementById('reflex-message').innerText = message;
            document.getElementById('reflex-message').style.display = 'block';
            document.getElementById('reflex-button').style.display = 'none';
            document.getElementById('reflex-result').innerText = '0 coin'; 
            
            document.getElementById('reflex-game-action').innerText = 'áŒ¨á‹‹á‰³á‹áŠ• áŒ€áˆáˆ­';
            document.getElementById('reflex-game-action').disabled = false;
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick; 
        }

        // ğŸ›‘ window. á‰°áŒ¨áˆ˜áˆ¨
        window.stopReflexGame = async (event, isTimeout = false) => {
            if (event && event.type === 'click') {
                event.stopPropagation(); 
            }

            if (!isWaitingForClick && !isTimeout) return;
            
            clearTimeout(timeoutID);
            const endTime = performance.now();
            const reactionTime = Math.round(endTime - startTime);
            
            isWaitingForClick = false;
            isReflexGameRunning = false; 
            
            document.getElementById('reflex-button').style.display = 'none';
            document.getElementById('reflex-message').style.display = 'block';
            document.getElementById('reflex-message').innerText = t('msg_game_over'); 
            document.getElementById('reflex-play-area').onclick = null; 


            let coins = 0; 
            
            if (isTimeout) {
                document.getElementById('reflex-result').innerText = t('reflex_timeout');
                window.playSound('fail'); // ğŸ›‘ á‹¨ Fail á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
            } else {
                window.playSound('click'); // ğŸ›‘ á‹¨ Click á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
                if (reactionTime < 200) {
                    coins = 5000; 
                } else if (reactionTime < 300) {
                    coins = 2000;
                } else if (reactionTime < 500) {
                    coins = 1000;
                } else {
                    coins = 500;
                }
            
                document.getElementById('reflex-result').innerText = `ááŒ¥áŠá‰µá‹: ${reactionTime}ms. áˆ½áˆáˆ›á‰µ: +${coins.toLocaleString()} coin!`; // ğŸ›‘ áŠáŒ¥á‰¥ á‹ˆá‹° coin

                if (await updateScore(coins, 'Reflex Game', 'last_reflex_time')) { 
                    WebApp.showAlert(`ğŸ¥³ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${coins.toLocaleString()} coin áŠ áˆ¸áŠ•áˆá‹‹áˆ!`); 
                    window.playSound('win'); // ğŸ›‘ á‹¨ Win á‹µáˆáŒ½ áˆ˜áŒ¨áˆ˜áˆ­
                }
            }
            
            startCooldownTimer('last_reflex_time', 'reflex-game-timer', 'reflex-game-action');
            document.getElementById('reflex-game-action').innerText = 'á‹ˆá‹° á‹‹áŠ“ áŒˆá… á‰°áˆ˜áˆˆáˆµ';
            // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: showMainPage()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
            document.getElementById('reflex-game-action').onclick = window.showMainPage;
            document.getElementById('reflex-game-action').disabled = false;
            
            setTimeout(() => {
                // ğŸ›‘ á‹¨á‰°áˆ»áˆ»áˆˆá‹: handleReflexTooEarlyClick()áŠ• á‰ á‰€áŒ¥á‰³ áŒ áˆ­á‰·áˆ
                document.getElementById('reflex-play-area').onclick = window.handleReflexTooEarlyClick;
            }, 100); 
            renderPageContent(); // coináŠ• áˆˆáˆ›áˆ»áˆ»áˆ
        }




    // ======================================================================
//                          SCRATCH CARD GAME CODE ğŸ›‘ áˆ™áˆ‰ á‰ áˆ™áˆ‰ I18N á‹¨á‰°á‹°áˆ¨áŒˆ
// ======================================================================

let scratchCanvas, scratchCtx, isScratching = false;
let isScratchGameActive = false;
let scratchPrizeAmount = 0;
const SCRATCH_PRIZES = [100, 150, 200, 300, 500];

// 1. á‹¨ Canvas áˆ˜áˆá‰…áˆá‰‚á‹« áˆ˜á‰†áŒ£áŒ áˆªá‹«
function getScratchCoords(e) {
    const rect = scratchCanvas.getBoundingClientRect();
    let x, y;
    if (e.touches) {
        x = e.touches[0].clientX - rect.left;
        y = e.touches[0].clientY - rect.top;
    } else {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
    }
    return { x, y };
}

function startScratch(e) {
    if (!isScratchGameActive) return;
    isScratching = true;
    scratch(e);
}

function stopScratch() {
    if (!isScratchGameActive) return;
    isScratching = false;
    checkScratchPercentage();
}

function scratch(e) {
    if (!isScratching || !isScratchGameActive) return;
    e.preventDefault(); 

    const { x, y } = getScratchCoords(e);
    
    scratchCtx.globalCompositeOperation = 'destination-out';
    scratchCtx.beginPath();
    scratchCtx.arc(x, y, 20, 0, Math.PI * 2, false);
    scratchCtx.fill();
}

// 2. áˆáŠ• á‹«áˆ…áˆ áŠ¥áŠ•á‹°á‰°áˆá‰€áˆá‰€ áˆ›á‹ˆá‰…
function checkScratchPercentage() {
    if (!isScratchGameActive) return;

    const imageData = scratchCtx.getImageData(0, 0, scratchCanvas.width, scratchCanvas.height);
    const data = imageData.data;
    let transparentPixels = 0;

    for (let i = 0; i < data.length; i += 32) {
        if (data[i + 3] === 0) {
            transparentPixels++;
        }
    }

    const totalPixels = (data.length / 32);
    const percentage = (transparentPixels / totalPixels) * 100;

    if (percentage > 60) {
        revealScratchPrize();
    }
}

// 3. áˆ½áˆáˆ›á‰±áŠ• áˆ˜áˆµáŒ á‰µ
async function revealScratchPrize() {
    if (!isScratchGameActive) return;
    
    isScratchGameActive = false;
    window.playSound('win');

    scratchCanvas.style.transition = 'opacity 0.5s ease';
    scratchCanvas.style.opacity = '0';
    
    // ğŸ›‘ Translation: Win Message
    document.getElementById('scratch-result-message').innerText = t('scratch_win_msg', { amount: scratchPrizeAmount.toLocaleString() });

    const success = await updateScore(scratchPrizeAmount, 'Scratch Card Game', 'last_scratch_time');
    
    const actionButton = document.getElementById('scratch-card-action');

    if (success) {
        startCooldownTimer('last_scratch_time', 'scratch-card-timer', 'scratch-card-action');
        renderPageContent();
        
        // ğŸ›‘ Translation: Go Home Button
        actionButton.innerText = t('btn_go_home');
        actionButton.style.display = 'block';
        actionButton.disabled = false;
        actionButton.onclick = window.showMainPage;
    } else {
        // ğŸ›‘ Translation: Error Message
        document.getElementById('scratch-result-message').innerText = t('scratch_error_giving_prize');
        // If failure, keep action button hidden or set to reset if needed
        actionButton.innerText = t('btn_go_home');
        actionButton.onclick = window.showMainPage;
        actionButton.style.display = 'block';
        actionButton.disabled = false;
    }
}


// 4. á‹¨ Scratch Card áŒ¨á‹‹á‰³ á‹‹áŠ“ á‰°áŒá‰£áˆ­ (Initializer)
window.initScratchCard = (isReset = false) => {
    const timestampField = 'last_scratch_time';
    const actionButton = document.getElementById('scratch-card-action');
    const messageEl = document.getElementById('scratch-result-message');
    const prizeTextEl = document.getElementById('scratch-prize-text');
    
    scratchCanvas = document.getElementById('scratch-canvas');
    scratchCtx = scratchCanvas.getContext('2d', { willReadFrequently: true });
    
    scratchCanvas.width = scratchCanvas.clientWidth;
    scratchCanvas.height = scratchCanvas.clientHeight;
    scratchCanvas.style.opacity = '1';
    scratchCanvas.style.transition = 'none';

    const { isReady } = checkDailyLimit(timestampField);

    if (isReady || isReset) {
        // 1. áŒ¨á‹‹á‰³á‹ á‹áŒáŒ áŠá‹
        isScratchGameActive = true;
        
        // 2. á‹¨á‹˜áˆá‰€á‹° áˆ½áˆáˆ›á‰µ áˆ˜áˆáˆ¨áŒ¥
        scratchPrizeAmount = SCRATCH_PRIZES[Math.floor(Math.random() * SCRATCH_PRIZES.length)];
        prizeTextEl.innerHTML = `<span>+${scratchPrizeAmount.toLocaleString()} ğŸ’°</span>`;
        
        // 3. á‹¨áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áˆ¸áˆ« (Canvas) áˆ˜áˆ™áˆ‹á‰µ
        scratchCtx.globalCompositeOperation = 'source-over';
        scratchCtx.fillStyle = '#AAAAAA';
        scratchCtx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);
        
        // ğŸ›‘ Translation: Scratch Text
        scratchCtx.fillStyle = '#333333';
        scratchCtx.font = 'bold 20px Arial';
        scratchCtx.textAlign = 'center';
        scratchCtx.fillText(t('scratch_text'), scratchCanvas.width / 2, scratchCanvas.height / 2 + 8);
        
        // 4. Event Listeners áˆ˜áŒ¨áˆ˜áˆ­
        scratchCanvas.addEventListener('mousedown', startScratch);
        scratchCanvas.addEventListener('mousemove', scratch);
        window.addEventListener('mouseup', stopScratch);
        
        scratchCanvas.addEventListener('touchstart', startScratch, { passive: false });
        scratchCanvas.addEventListener('touchmove', scratch, { passive: false });
        window.addEventListener('touchend', stopScratch);

        // 5. UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
        // ğŸ›‘ Translation: Ready Instruction
        messageEl.innerText = t('msg_scratch_instruction');
        actionButton.style.display = 'none';
        scratchCanvas.style.display = 'block';

    } else {
        // 1. áŒ¨á‹‹á‰³á‹ á‹áŒáŒ áŠ á‹­á‹°áˆˆáˆ (Cooldown áˆ‹á‹­ áŠá‹)
        isScratchGameActive = false;
        
        // 2. áˆ˜áˆá‰…áˆá‰‚á‹«á‹áŠ• áˆ˜á‹°á‰ á‰… áŠ¥áŠ“ "áŠ áˆá‰‹áˆ" á‹¨áˆšáˆ áˆ›áˆ³á‹¨á‰µ
        // ğŸ›‘ Translation: Limit Reached
        scratchCanvas.style.display = 'none';
        prizeTextEl.innerHTML = t('scratch_daily_limit_reached');
        
        // 3. UI áˆ›áˆµá‰°áŠ«áŠ¨áˆ
        // ğŸ›‘ Translation: Wait Message
        messageEl.innerText = t('msg_wait_cooldown');
        
        // ğŸ›‘ Translation: Go Home Button
        actionButton.innerText = t('btn_go_home');
        actionButton.style.display = 'block';
        actionButton.disabled = false;
        actionButton.onclick = window.showMainPage;
    }
    
    startCooldownTimer(timestampField, 'scratch-card-timer', 'scratch-card-action');
}

// ======================================================================
//                          SCRATCH CARD GAME CODE áˆ˜áŒ¨áˆ¨áˆ»
// ======================================================================
    



// ======================================================================
// âœ… ğŸ›‘ áŠ á‹²áˆµ: áˆˆ Exchange Page á‹¨áˆšáˆ†áŠ‘ áˆ¨á‹³á‰µ á‰°áŒá‰£áˆ«á‰µ (FIXED & LOCALIZED)
// ======================================================================

const EXCHANGE_RATE = 10000; // 10,000 Coin = 1 Smart Coin

// [+] áŠ¥áŠ“ [-] áŠ á‹áˆ«áˆ®á‰½áŠ• áŠ¥áŠ•á‹²áˆ°áˆ« á‹«á‹°áˆ­áŒ‹áˆ
window.adjustExchangeInput = (amount) => {
    const inputEl = document.getElementById('exchangePointsInput');
    let currentValue = parseInt(inputEl.value) || 0;
    let newValue = currentValue + amount;

    // áŠ¨á‹á‰…á‰°áŠ›á‹ áˆáŒ£áŠ” (Rate) á‰ á‰³á‰½ áŠ¥áŠ•á‹³á‹­á‹ˆáˆ­á‹µ
    if (newValue < EXCHANGE_RATE) {
        newValue = EXCHANGE_RATE;
    }
    
    // âœ… áŠ«áˆˆáŠ• "Coin" (currentScore) áŠ¥áŠ•á‹³á‹­á‰ áˆáŒ¥
    if (newValue > currentScore) {
        newValue = currentScore;
    }
    
    inputEl.value = newValue;
    window.calculateSmartCoin(); // á‹áŒ¤á‰±áŠ• á‹«áˆ°áˆ‹áˆ
}

// áˆáŠ• á‹«áˆ…áˆ "Smart Coin" áŠ¥áŠ•á‹°áˆáŠ“áŒˆáŠ á‹«áˆ°áˆ‹áˆ
window.calculateSmartCoin = () => {
    const inputEl = document.getElementById('exchangePointsInput');
    const resultEl = document.getElementById('smartCoinResult');
    let pointsToExchange = parseInt(inputEl.value) || 0;
    
    let smartCoinsToGet = 0;
    
    // á‰µáŠ­áŠ­áˆˆáŠ› á‹¨ 10,000 á‰¥á‹œá‰µ áˆ˜áˆ†áŠ‘áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
    if (pointsToExchange >= EXCHANGE_RATE && pointsToExchange % EXCHANGE_RATE === 0) {
        smartCoinsToGet = pointsToExchange / EXCHANGE_RATE;
        resultEl.innerText = `${smartCoinsToGet.toLocaleString()} Smart Coin`;
    } else {
        resultEl.innerText = "0 Smart Coin";
    }
    
    window.validateExchangeButton(); // áŠ á‹áˆ«áˆ©áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
}

// á‹¨ "EXCHANGE NOW" áŠ á‹áˆ«áˆ­áŠ• á‹«áˆ¨áŒ‹áŒáŒ£áˆ
window.validateExchangeButton = () => {
    const inputEl = document.getElementById('exchangePointsInput');
    const buttonEl = document.getElementById('finalExchangeButton'); // âœ… á‰µáŠ­áŠ­áˆˆáŠ›á‹ ID
    let pointsToExchange = parseInt(inputEl.value) || 0;

    const isValid = pointsToExchange >= EXCHANGE_RATE && 
                    pointsToExchange <= currentScore && 
                    pointsToExchange % EXCHANGE_RATE === 0;

    if (isValid) {
        buttonEl.disabled = false;
        buttonEl.classList.remove('disabled-btn');
        buttonEl.style.backgroundColor = 'var(--et-green)'; 
        buttonEl.style.cursor = 'pointer';
    } else {
        buttonEl.disabled = true;
        buttonEl.classList.add('disabled-btn');
        buttonEl.style.backgroundColor = '#555';
        buttonEl.style.cursor = 'not-allowed';
    }
}

// ======================================================================
//                          EXCHANGE PAGE CODE (EVENT LISTENER)
// ======================================================================

// âœ… áˆ›áˆµá‰³á‹ˆáˆ»: áŠ¥á‹šáˆ… á‹¨áŠá‰ áˆ¨á‹ 'input' event listener á‰°á‹ˆáŒá‹·áˆá¢ 
// áˆáŠ­áŠ•á‹«á‰±áˆ 'window.calculateSmartCoin' á‰  HTML oninput áˆ‹á‹­ áˆµáˆˆáˆšáŒ áˆ« áŠ á‹«áˆµáˆáˆáŒáˆá¢

// âœ…âœ…âœ… á‹¨ Exchange Button Click áŠ áˆ˜áŠ­áŠ•á‹® (Localized & Fixed) âœ…âœ…âœ…
document.addEventListener('click', async (event) => {
    // IDá‹ 'finalExchangeButton' áˆ˜áˆ†áŠ‘áŠ• áŠ áˆ¨áŒ‹áŒáŒ áŠ“áˆ
    if (event.target.id === 'finalExchangeButton' && !event.target.disabled) {

        const pointsInput = document.getElementById('exchangePointsInput');
        const changeButton = document.getElementById('finalExchangeButton');
        const exchangeMessage = document.getElementById('exchangeMessage');

        const pointsToExchange = parseInt(pointsInput.value); // á‹­áˆ„ "Coin" áŠá‹
        const smartCoinsToGet = pointsToExchange / EXCHANGE_RATE;

        // 1. Validation (áˆ›áˆ¨áŒ‹áŒˆáŒ«)
        if (pointsToExchange < EXCHANGE_RATE || pointsToExchange % EXCHANGE_RATE !== 0) {
            exchangeMessage.style.color = '#F44336';
            // ğŸŒ Translation Used
            exchangeMessage.innerText = t('exchange_min_error', {amount: EXCHANGE_RATE.toLocaleString()});
            return;
        }

        if (currentScore < pointsToExchange) {
            exchangeMessage.style.color = '#F44336';
            // ğŸŒ Translation Used
            exchangeMessage.innerText = t('exchange_insufficient');
            return;
        }

        // 2. Processing State
        changeButton.disabled = true;
        // ğŸŒ Translation Used
        changeButton.innerText = t('exchange_processing_btn'); 

        // 3. Firebase Transaction
        const userRef = doc(db, "users", currentFirebaseUserId); 

        try {
            await updateDoc(userRef, {
                total_score: increment(pointsToExchange * -1),
                smart_coin_balance: increment(smartCoinsToGet)
            });

            // 4. Success Handling
            exchangeMessage.style.color = 'var(--et-green)';
            // ğŸŒ Translation Used
            exchangeMessage.innerText = t('exchange_success_msg', {amount: smartCoinsToGet.toLocaleString()});

            // Global Variables Update
            currentScore -= pointsToExchange;
            currentSmartCoinBalance += smartCoinsToGet;
            
            // History Save
            if(typeof window.saveGeneralHistory === 'function') {
                window.saveGeneralHistory('Swap', pointsToExchange, 'Coin', 'Success');
            }

            // Confetti & Sound
            if(window.playSound) window.playSound('win');
            if(window.triggerConfetti) window.triggerConfetti(200);

            // Update UI
            if(typeof renderPageContent === 'function') renderPageContent(); 

        } catch (error) {
            exchangeMessage.style.color = '#F44336';
            // ğŸŒ Translation Used
            exchangeMessage.innerText = t('exchange_error_msg') + error.message;
        }

        // 5. Reset UI
        // ğŸŒ Translation Used
        changeButton.innerText = t('exchange_default_btn'); 
        changeButton.disabled = true; 
        pointsInput.value = EXCHANGE_RATE.toString(); 
        window.calculateSmartCoin(); 

        setTimeout(() => {
            exchangeMessage.innerText = '';
        }, 5000);
    }
});





        
        // ======================================================================
        //                          EXCHANGE PAGE CODE áˆ˜áŒ¨áˆ¨áˆ»
        // ======================================================================


// =========================================================
// âœ… TRANSACTION HISTORY LOGIC
// =========================================================

// 1. á‰³áˆªáŠ­áŠ• áŠ¨ LocalStorage áˆ›áˆáŒ£á‰µ
const getGeneralHistory = () => {
    try {
        const history = localStorage.getItem('generalTransactionHistory');
        return JSON.parse(history || '[]');
    } catch (e) {
        return [];
    }
};

// 2. áŠ á‹²áˆµ á‰³áˆªáŠ­ áˆ˜áˆ˜á‹áŒˆá‰¥ (á‹­áˆ…áŠ•áŠ• á‰  Swap áŠ¥áŠ“ Withdraw áŒŠá‹œ áŠ¥áŠ•áŒ áˆ«á‹‹áˆˆáŠ•)
window.saveGeneralHistory = (type, amount, coinType, status) => {
    let history = getGeneralHistory();
    
    const newEntry = {
        id: Date.now(), // Unique ID
        date: new Date().toLocaleString(),
        type: type,       // 'Swap' or 'Withdraw'
        amount: amount,
        coinType: coinType, // 'Coin' or 'Smart Coin'
        status: status    // 'Success', 'Pending'
    };

    history.unshift(newEntry); // áŠ á‹²áˆ±áŠ• á‹ˆá‹° áˆ‹á‹­ áŠ áˆáŒ£
    if (history.length > 30) history.pop(); // áŠ¨30 á‰ áˆ‹á‹­ áŠ¨áˆ†áŠ á‹¨á‹µáˆ®á‹áŠ• áŠ áŒ¥á‹
    
    localStorage.setItem('generalTransactionHistory', JSON.stringify(history));
};

// 3. á‰³áˆªáŠ©áŠ• á‰ áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ áˆ›áˆ³á‹¨á‰µ
window.renderTransactionHistory = () => {
    const listContainer = document.getElementById('general-history-list');
    const history = getGeneralHistory();

    if (history.length === 0) {
        listContainer.innerHTML = '<p style="text-align: center; color: #888; margin-top: 20px;">áˆáŠ•áˆ á‹¨á‰°áˆ˜á‹˜áŒˆá‰  á‰³áˆªáŠ­ á‹¨áˆˆáˆá¢</p>';
        return;
    }

    let htmlContent = '';
    
    history.forEach(item => {
        let icon = '';
        let colorClass = '';
        let amountSign = '';

        // áˆˆáŠ¥á‹­á‰³ á‹¨áˆšáˆ†áŠ• á‰€áˆˆáˆ áŠ¥áŠ“ áˆáˆáŠ­á‰µ áˆ˜áˆáˆ¨áŒ¥
        if (item.type === 'Swap') {
            icon = 'ğŸ’±';
            colorClass = '#FFC107'; // á‰¢áŒ« (Swap)
            amountSign = '-';
        } else if (item.type === 'Withdraw') {
            icon = 'ğŸ’¸';
            colorClass = '#F44336'; // á‰€á‹­ (Withdraw)
            amountSign = '-';
        } else if (item.type === 'Deposit' || item.type === 'Reward') {
            icon = 'ğŸ’°';
            colorClass = '#4CAF50'; // áŠ áˆ¨áŠ•áŒ“á‹´
            amountSign = '+';
        }

        htmlContent += `
            <div class="modern-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 15px; text-align: left;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 24px; background: #333; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">${icon}</div>
                    <div>
                        <div style="font-weight: bold; font-size: 16px; color: white;">${item.type}</div>
                        <div style="font-size: 12px; color: #888;">${item.date}</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: bold; font-size: 16px; color: ${colorClass};">
                        ${amountSign}${item.amount.toLocaleString()}
                    </div>
                    <div style="font-size: 11px; color: #aaa;">${item.coinType}</div>
                    <div style="font-size: 10px; margin-top: 2px; color: ${item.status === 'Success' ? '#4CAF50' : '#FF9800'}">
                        ${item.status}
                    </div>
                </div>
            </div>
        `;
    });

    listContainer.innerHTML = htmlContent;
};

// 4. áŒˆáŒ¹áŠ• áˆ˜áŠ­áˆá‰» Function
window.showTransactionHistory = () => {
    window.renderTransactionHistory(); // áˆ˜áŒ€áˆ˜áˆªá‹« á‰³áˆªáŠ©áŠ• áŒ«áŠ•
    switchPage('transaction-history-page'); // áŒˆáŒ¹áŠ• áŠ­áˆá‰µ
};

// ======================================================================
// âœ… ğŸ›‘ áŠ á‹²áˆµ: á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (WITHDRAWAL PAGE) áŠ®á‹µ (FIXED & LOCALIZED)
// ======================================================================

let selectedWithdrawMethod = null;
let selectedWithdrawFee = 0;
const MIN_WITHDRAWAL = 100; // á‹á‰…á‰°áŠ› áˆ›á‹áŒ«

// á‹¨áˆ˜á‹áŒ« á‹˜á‹´á‹á‰½ áŠ¥áŠ“ áŠ­áá‹«á‹á‰»á‰¸á‹ (á‰ áˆ˜á‰¶áŠ›)
const withdrawFees = {
    telegram: 0.01, // 1%
    crypto: 0.015,  // 1.5%
    paypal: 0.02    // 2%
};

/**
 * á‹¨áˆ˜á‹áŒ« áˆ˜áŒ áŠ• áˆ˜á‰†áŒ£áŒ áˆªá‹« (+/-)
 */
window.adjustWithdrawInput = (amount) => {
    const inputEl = document.getElementById('withdrawAmountInput');
    let currentValue = parseInt(inputEl.value) || 0;
    let newValue = currentValue + amount;

    // áŠ¨á‹á‰…á‰°áŠ›á‹ áˆáŒ£áŠ” á‰ á‰³á‰½ áŠ¥áŠ•á‹³á‹­á‹ˆáˆ­á‹µ
    if (newValue < MIN_WITHDRAWAL) {
        newValue = MIN_WITHDRAWAL;
    }
    
    // áŠ¨ Smart Coin áˆ‚áˆ³á‰¥ áŠ¥áŠ•á‹³á‹­á‰ áˆáŒ¥
    if (newValue > currentSmartCoinBalance) { 
        newValue = currentSmartCoinBalance;
    }

    // áŠ¥áˆ´á‰±áŠ• áˆ›á‹˜áˆ˜áŠ• áŠ¥áŠ“ áˆ›áˆ¨áŒ‹áŒˆáŒ¥
    inputEl.value = newValue;
    window.validateWithdrawal(); 
}

/**
 * á‹¨áˆ˜áŠ­áˆá‹« á‹˜á‹´ áˆ˜áˆáˆ¨áŒ«
 */
window.selectMethod = (method, element) => {
    // áˆáˆ‰áŠ•áˆ .active áŠ¨ .method-wrapper áˆ›áˆµá‹ˆáŒˆá‹µ
    document.querySelectorAll('#withdraw-page .method-wrapper').forEach(wrapper => {
        wrapper.classList.remove('active');
    });

    // á‹¨á‰°áŒ«áŠá‹áŠ• .active áˆ›á‹µáˆ¨áŒ
    const parentWrapper = element.closest('.method-wrapper');
    if (parentWrapper) {
        parentWrapper.classList.add('active');
    }

    selectedWithdrawMethod = method;
    selectedWithdrawFee = withdrawFees[method] || 0;
    
    window.validateWithdrawal(); // á‹˜á‹´ áˆ²áˆ˜áˆ¨áŒ¥ áˆ›áˆ¨áŒ‹áŒˆáŒ¥
}

/**
 * áŒˆáŒ¹áŠ• á‹¨áˆšá‹«áˆ¨áŒ‹áŒáŒ¥ á‹‹áŠ“ á‰°áŒá‰£áˆ­ (Validation)
 */
window.validateWithdrawal = () => {
    const inputEl = document.getElementById('withdrawAmountInput');
    const messageEl = document.getElementById('withdrawMessage');
    const buttonEl = document.getElementById('finalWithdrawButton');
    
    const amount = parseInt(inputEl.value) || 0;
    
    // 1. á‹˜á‹´ á‰°áˆ˜áˆ­áŒ§áˆ?
    if (!selectedWithdrawMethod) {
       // ğŸŒ Translation Used
       messageEl.innerText = t('withdraw_select_method');
       buttonEl.classList.add('disabled-btn');
       buttonEl.disabled = true;
       return;
    }
    
    // 2. áˆ˜áŒ áŠ‘ áŠ¨á‹á‰…á‰°áŠ›á‹ á‹«áŠ•áˆ³áˆ?
    if (amount < MIN_WITHDRAWAL) {
        // ğŸŒ Translation Used
        messageEl.innerText = t('withdraw_min_limit', {amount: MIN_WITHDRAWAL});
        buttonEl.classList.add('disabled-btn');
        buttonEl.disabled = true;
        return;
    }
    
    // 3. áŠ­áá‹« (Fee) áˆ›áˆµáˆ‹á‰µ
    const feeAmount = Math.ceil(amount * selectedWithdrawFee);
    const totalDeducted = amount + feeAmount;
    
    // 4. áˆ‚áˆ³á‰¥ áˆ›áˆ¨áŒ‹áŒˆáŒ¥ (Smart Coin Balance)
    if (totalDeducted > currentSmartCoinBalance) { 
        // ğŸŒ Translation Used
        messageEl.innerText = t('withdraw_insufficient', {amount: totalDeducted});
        buttonEl.classList.add('disabled-btn');
        buttonEl.disabled = true;
        return;
    }
    
    // 5. áˆáˆ‰áˆ áŠáŒˆáˆ­ á‰µáŠ­áŠ­áˆ áŠ¨áˆ†áŠ
    // ğŸŒ Translation Used (Complex string handling)
    messageEl.innerText = t('msg_withdraw_fee_calc', {
        fee: feeAmount, 
        total: totalDeducted, 
        amount: amount
    });
    
    messageEl.style.color = 'var(--et-green, #4CAF50)'; 
    buttonEl.classList.remove('disabled-btn');
    buttonEl.disabled = false;
}


/**
 * á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ£á‰µ áŒ¥á‹«á‰„áŠ• á‹ˆá‹° Firebase áˆ˜áˆ‹áŠ­
 * âœ… ğŸ›‘ áŒŠá‹œá‹«á‹Š áˆ›áˆµá‰°áŠ«áŠ¨á‹«: WithdrawaláŠ• áˆˆáŒŠá‹œá‹ áˆ˜á‹áŒ‹á‰µ (Pending Simulation)
 */
window.initiateWithdrawal = async () => {
    const messageEl = document.getElementById('withdrawMessage');
    const buttonEl = document.getElementById('finalWithdrawButton');
    const inputEl = document.getElementById('withdrawAmountInput'); 
    
    // 1. áˆ˜áŒ áŠ‘áŠ• á‹ˆá‹° á‰áŒ¥áˆ­ áˆ˜á‰€á‹¨áˆ­
    const amount = parseInt(inputEl.value) || 0;

    // 2. áŠ á‹áˆ«áˆ©áŠ• áˆˆáŒŠá‹œá‹ áˆ›á‰¦á‹˜áŠ•
    buttonEl.disabled = true;
    // ğŸŒ Translation Used
    buttonEl.innerHTML = t('withdraw_processing_btn');

    // 3. á‰³áˆªáŠ©áŠ• áˆ˜áˆ˜á‹áŒˆá‰¥ á‰¥á‰» (áŒˆáŠ•á‹˜á‰¥ áŠ á‹­á‰€áŠ•áˆµáˆ!)
    window.saveGeneralHistory('Withdraw', amount, 'Smart Coin', 'Pending');

    // 4. á‹¨áˆ›áˆ³á‹ˆá‰‚á‹« áˆ˜áˆá‹•áŠ­á‰µ áˆ˜áˆµáŒ á‰µ
    messageEl.style.color = 'var(--et-yellow)';
    // ğŸŒ Translation Used
    messageEl.innerText = t('withdraw_request_pending');
    
    // 5. áŠ¨ 6 áˆ°áŠ¨áŠ•á‹µ á‰ áŠ‹áˆ‹ áŠ á‹áˆ«áˆ©áŠ• áˆ˜áˆ˜áˆˆáˆµ
    setTimeout(() => {
        messageEl.innerText = "";
        // ğŸŒ Translation Used
        buttonEl.innerHTML = t('withdraw_default_btn');
        buttonEl.disabled = false;
        // áŠ á‹áˆ«áˆ© áŠ¥áŠ•á‹°áŒˆáŠ“ áŠ¥áŠ•á‹²áˆ°áˆ« validateWithdrawaláŠ• áŠ¥áŠ•áŒ áˆ«áˆˆáŠ•
        window.validateWithdrawal(); 
    }, 6000);
}
// ======================================================================
// âœ… ğŸ›‘ á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (WITHDRAWAL PAGE) áŠ®á‹µ áˆ˜áŒ¨áˆ¨áˆ»
// ======================================================================






// ======================================================================
// âœ… ğŸ›‘ áŠ á‹²áˆµ: KENO GAME LOGIC (áˆ™áˆ‰ áˆˆáˆ™áˆ‰ Internationalized)
// ======================================================================

// á‹¨ Keno áŒ¨á‹‹á‰³ á‰…áŠ•á‰¥áˆ®á‰½
const KENO_TOTAL_NUMBERS = 80; 
const KENO_MAX_PICKS = 10;     
const KENO_DRAW_COUNT = 20;    
const KENO_DRAW_INTERVAL = 1000; 
const KENO_MIN_BET = 100; 

// á‹¨ Keno áŒ¨á‹‹á‰³ á‰°áˆˆá‹‹á‹‹áŒ®á‰½
let kenoTotalPoints = 0; 
let kenoSelectedNumbers = [];
let kenoDrawnNumbers = [];
let kenoBetAmount = KENO_MIN_BET;
let kenoGameInProgress = false;
let kenoLastBetAmount = KENO_MIN_BET; 
let kenoLastSelectedNumbers = [];
// History á‰  localStorage á‹­á‰€áˆ˜áŒ£áˆ
let kenoGameHistory = JSON.parse(localStorage.getItem('kenoHistory') || '[]');

// á‹¨ Keno UI áŠ¤áˆˆáˆ˜áŠ•á‰¶á‰½
let kenoTotalPointsEl, kenoGridEl, kenoBetAmountInput, kenoBetBtn, kenoPickInfoEl, kenoMessageEl, kenoSelectedPicksAreaEl, kenoDrawShakerAreaEl, kenoDrawCountAreaEl, kenoDrawStatusEl, kenoRandomPickBtn, kenoHistoryListEl, kenoPaytableContentEl, kenoCurrentBallAreaEl;

/**
 * á‹¨ Keno áŒˆáŒ½ áˆ²áŠ¨áˆá‰µ á‹­áˆ… á‰°áŒá‰£áˆ­ á‹­áŒ áˆ«áˆ
 */
window.initKenoGame = () => {
    // 1. á‹¨ UI áŠ¤áˆˆáˆ˜áŠ•á‰¶á‰½áŠ• áˆ›áŒáŠ˜á‰µ
    kenoTotalPointsEl = document.getElementById('keno-total-points');
    kenoGridEl = document.getElementById('keno-grid');
    kenoBetAmountInput = document.getElementById('keno-bet-amount-input');
    kenoBetBtn = document.getElementById('keno-bet-btn');
    kenoPickInfoEl = document.getElementById('keno-pick-info');
    kenoMessageEl = document.getElementById('keno-message');
    kenoSelectedPicksAreaEl = document.getElementById('keno-selected-picks-area');
    kenoDrawShakerAreaEl = document.getElementById('keno-draw-shaker-area');
    kenoDrawCountAreaEl = document.getElementById('keno-draw-count-area');
    kenoDrawStatusEl = document.getElementById('keno-draw-status');
    kenoRandomPickBtn = document.getElementById('keno-random-pick-btn');
    kenoHistoryListEl = document.getElementById('keno-history-list');
    kenoPaytableContentEl = document.getElementById('keno-paytable-content');
    kenoCurrentBallAreaEl = document.getElementById('keno-current-ball-area');

    // 2. âœ… á‹¨ Firebase coináŠ• áˆ˜áŒ«áŠ•
    kenoTotalPoints = currentScore; 
    kenoBetAmount = KENO_MIN_BET;
    
    // 3. áŒ¨á‹‹á‰³á‹áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ
    window.kenoCreateGrid();
    window.kenoRenderHistory(); 
    window.kenoResetGame(); 
    window.kenoRenderPaytable();
    
    // 4. UI áˆ›á‹˜áˆ˜áŠ•
    window.kenoUpdateUI();
}

// ------------------- KENO TAB LOGIC -------------------
window.kenoShowTab = (tabId, clickedButton) => {
    document.querySelectorAll('#keno-game-page .keno-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('#keno-game-page .keno-tab-button').forEach(button => {
        button.classList.remove('active');
    });

    document.getElementById(tabId).classList.add('active');
    if (clickedButton) {
        clickedButton.classList.add('active');
    }
    
    if (tabId === 'keno-history-tab') {
        window.kenoRenderHistory();
    } else if (tabId === 'keno-results-tab') {
        window.kenoRenderPaytable();
    }
}

window.kenoRenderPaytable = () => {
    const paytableData = [
        {picks: 1, payouts: {1: '10x'}},
        {picks: 3, payouts: {2: '1x', 3: '100x'}},
        {picks: 5, payouts: {3: '1x', 4: '10x', 5: '500x'}},
        {picks: 7, payouts: {4: '3x', 5: '30x', 6: '200x', 7: '5000x'}},
        {picks: 10, payouts: {3: 1, 4: '2x', 5: '10x', 6: '50x', 7: '100x', 8: '500x', 9: '5000x', 10: '25000x'}}
    ];
    
    if (!kenoPaytableContentEl) return;
    kenoPaytableContentEl.innerHTML = ''; 
    
    paytableData.forEach(item => {
        const card = document.createElement('div');
        card.className = 'keno-paytable-card';
        // ğŸ›‘ Translation: Headers
        let tableHtml = `<table><thead><tr><th>${t('label_matches')}</th><th>${t('label_multiplier')}</th></tr></thead><tbody>`;
        
        Object.entries(item.payouts).forEach(([matches, multiplier]) => {
            // ğŸ›‘ Translation: Hit/Hits
            const hitLabel = matches == 1 ? t('label_hit') : t('label_hits');
            tableHtml += `<tr><td>${matches} ${hitLabel}</td><td>${multiplier}</td></tr>`;
        });
        tableHtml += '</tbody></table>';
        
        // ğŸ›‘ Translation: Pick/Picks
        const pickLabel = item.picks === 1 ? t('label_pick') : t('label_picks');
        card.innerHTML = `<div class="keno-paytable-header">${item.picks} ${pickLabel}</div>${tableHtml}`;
        kenoPaytableContentEl.appendChild(card);
    });
}

// ------------------- KENO GAME LOGIC -------------------

window.kenoUpdateUI = () => {
    if (!kenoTotalPointsEl) return;
    
    kenoTotalPoints = currentScore;
    
    kenoTotalPointsEl.textContent = `${kenoTotalPoints.toFixed(2)} Coin`; 
    
    if (kenoBetAmount < KENO_MIN_BET) kenoBetAmount = KENO_MIN_BET;
    if (kenoBetAmount > kenoTotalPoints) kenoBetAmount = kenoTotalPoints;
    
    if (parseFloat(kenoBetAmountInput.value) > kenoTotalPoints) {
        kenoBetAmount = kenoTotalPoints;
    }
    
    kenoBetAmountInput.value = kenoBetAmount.toFixed(0);
    kenoBetAmountInput.min = KENO_MIN_BET;
    
    // ğŸ›‘ Translation: Pick Info
    kenoPickInfoEl.innerText = t('label_picks_count', { current: kenoSelectedNumbers.length, max: KENO_MAX_PICKS });
    
    // ğŸ›‘ Translation: Selected Numbers
    kenoSelectedPicksAreaEl.innerHTML = `${t('label_your_picks')} <span style="font-weight: bold;">[ ${kenoSelectedNumbers.sort((a, b) => a - b).join(', ')} ]</span>`; 
    
    const canBet = kenoSelectedNumbers.length > 0 && 
                   kenoSelectedNumbers.length <= KENO_MAX_PICKS && 
                   kenoBetAmount <= kenoTotalPoints && 
                   !kenoGameInProgress && 
                   kenoTotalPoints >= KENO_MIN_BET;
                   
    kenoBetBtn.disabled = !canBet;
    
    // ğŸ›‘ Translation: Messages using t()
    if (kenoTotalPoints < KENO_MIN_BET) {
        kenoMessageEl.innerText = t('msg_keno_no_coin');
        kenoBetBtn.disabled = true;
    } else if (kenoBetAmount > kenoTotalPoints) {
        kenoMessageEl.innerText = t('msg_keno_high_bet');
        kenoBetBtn.disabled = true;
    } else if (kenoSelectedNumbers.length === 0 && !kenoGameInProgress) {
        kenoMessageEl.innerText = t('msg_keno_select_one');
    } else if (!kenoGameInProgress) {
        kenoMessageEl.innerText = t('msg_keno_ready');
    }
}

window.kenoChangeBet = (amount) => {
    let newBet = kenoBetAmount + amount;
    if (newBet < KENO_MIN_BET) newBet = KENO_MIN_BET; 
    
    kenoTotalPoints = currentScore;
    if (newBet > kenoTotalPoints) newBet = kenoTotalPoints;
    
    kenoBetAmount = newBet;
    window.kenoUpdateUI();
};

document.addEventListener('input', (event) => {
    if (event.target.id === 'keno-bet-amount-input') {
        let newBet = parseFloat(kenoBetAmountInput.value) || KENO_MIN_BET;
        if (newBet < KENO_MIN_BET) newBet = KENO_MIN_BET; 
        
        kenoTotalPoints = currentScore;
        if (newBet > kenoTotalPoints) newBet = kenoTotalPoints;
        
        kenoBetAmount = newBet;
        kenoBetAmountInput.value = newBet.toFixed(0);
        window.kenoUpdateUI();
    }
});


window.kenoCreateGrid = () => {
    if (!kenoGridEl) return;
    kenoGridEl.innerHTML = '';
    for (let i = 1; i <= KENO_TOTAL_NUMBERS; i++) {
        const cell = document.createElement('div');
        cell.className = 'number-cell';
        cell.textContent = i;
        cell.dataset.number = i;
        cell.onclick = () => window.kenoSelectNumber(i);
        kenoGridEl.appendChild(cell);
    }
}

window.kenoSelectNumber = (number) => {
    if (kenoGameInProgress) return;
    const index = kenoSelectedNumbers.indexOf(number);
    const cell = document.querySelector(`#keno-game-page [data-number="${number}"]`);

    if (index > -1) {
        kenoSelectedNumbers.splice(index, 1);
        cell.classList.remove('selected');
    } else if (kenoSelectedNumbers.length < KENO_MAX_PICKS) {
        kenoSelectedNumbers.push(number);
        cell.classList.add('selected'); 
        window.playSound('click'); 
    } else {
        // ğŸ›‘ Translation: Max Picks
        kenoMessageEl.innerText = t('msg_keno_max_picks_reached', { count: KENO_MAX_PICKS });
    }
    window.kenoUpdateUI();
}

window.kenoRandomSelect = (count) => {
    if (kenoGameInProgress) return;
    window.kenoResetSelection(); 

    const allNumbers = Array.from({ length: KENO_TOTAL_NUMBERS }, (_, i) => i + 1);
    allNumbers.sort(() => Math.random() - 0.5); 
    const picks = allNumbers.slice(0, count);
    
    picks.forEach(num => window.kenoSelectNumber(num));
    
    // ğŸ›‘ Translation: Random Select
    kenoMessageEl.innerText = t('msg_keno_random_selected', { count: count });
    window.kenoUpdateUI();
}

window.kenoResetSelection = () => {
    kenoSelectedNumbers.forEach(num => {
         const cell = document.querySelector(`#keno-game-page [data-number="${num}"]`);
         if (cell) cell.classList.remove('selected');
    });
    kenoSelectedNumbers = [];
}

// ------------------- KENO ASYNC GAME FLOW -------------------

window.kenoStartGame = async () => {
    if (kenoGameInProgress) return;
    
    kenoBetAmount = parseFloat(kenoBetAmountInput.value);
    kenoTotalPoints = currentScore;

    if (kenoBetAmount < KENO_MIN_BET || kenoBetAmount > kenoTotalPoints) { 
        // ğŸ›‘ Translation
        kenoMessageEl.innerText = t('keno_bet_error');
        return;
    }
    if (kenoSelectedNumbers.length === 0) {
         // ğŸ›‘ Translation
         kenoMessageEl.innerText = t('keno_select_error');
         return;
    }

    kenoGameInProgress = true;
    kenoBetBtn.disabled = true;
    // ğŸ›‘ Translation
    kenoMessageEl.innerText = t('keno_bet_placed');
    
    const success = await updateScore(kenoBetAmount * -1, 'Keno Bet');
    
    if (!success) {
        kenoGameInProgress = false;
        // ğŸ›‘ Translation
        kenoMessageEl.innerText = t('keno_low_balance');
        window.kenoUpdateUI();
        return;
    }
    
    window.playSound('kenoBet');
    
    kenoTotalPoints = currentScore;
    kenoLastBetAmount = kenoBetAmount; 
    kenoLastSelectedNumbers = [...kenoSelectedNumbers]; 
    kenoDrawnNumbers = [];
    
    window.kenoShowTab('keno-live-tab'); 

    kenoGridEl.style.width = '60%'; 
    kenoDrawShakerAreaEl.style.display = 'flex';
    
    document.getElementById('keno-bet-controls').style.display = 'none';
    kenoRandomPickBtn.style.display = 'none';
    
    window.kenoToggleGridInteraction(false);
    window.kenoUpdateUI(); 
    
    // ğŸ›‘ Translation: Status
    kenoDrawStatusEl.innerText = t('status_in_progress');
    kenoMessageEl.innerText = t('status_drawing');

    const allNumbers = Array.from({ length: KENO_TOTAL_NUMBERS }, (_, i) => i + 1);
    allNumbers.sort(() => Math.random() - 0.5); 
    const winningNumbers = allNumbers.slice(0, KENO_DRAW_COUNT);

    window.kenoStartLiveDraw(winningNumbers);
}

window.kenoStartLiveDraw = (winningNumbers) => {
    let drawIndex = 0;
    kenoCurrentBallAreaEl.textContent = '?';
    
    const drawInterval = setInterval(() => {
        if (drawIndex >= KENO_DRAW_COUNT) {
            clearInterval(drawInterval);
            setTimeout(window.kenoFinishGame, 1500); 
            return;
        }
        
        const drawnNumber = winningNumbers[drawIndex];
        kenoDrawnNumbers.push(drawnNumber);
        
        kenoCurrentBallAreaEl.textContent = drawnNumber;
        kenoDrawCountAreaEl.textContent = `${drawIndex + 1} / ${KENO_DRAW_COUNT}`;

        const cell = document.querySelector(`#keno-game-page [data-number="${drawnNumber}"]`);
        if (cell) {
            cell.classList.add('drawn-cell'); 
            if (kenoSelectedNumbers.includes(drawnNumber)) {
                cell.classList.add('match'); 
                window.playSound('kenoDraw');
            }
        }

        drawIndex++;
    }, KENO_DRAW_INTERVAL);
}

window.kenoFinishGame = async () => {
    const matches = kenoSelectedNumbers.filter(num => kenoDrawnNumbers.includes(num)).length;
    const { winAmount, multiplier } = window.kenoCalculatePayout(matches, kenoLastBetAmount, kenoSelectedNumbers.length);
    
    let resultMessage;
    
    if (winAmount > 0) {
        window.playSound('kenoWin'); 
        // ğŸ›‘ Translation: Win Msg with Params
        resultMessage = t('keno_win_msg', { matches: matches, multiplier: multiplier, amount: winAmount.toFixed(2) });
        await updateScore(winAmount, 'Keno Win'); 
    } else {
        window.playSound('fail'); 
        // ğŸ›‘ Translation: Loss Msg with Params
        resultMessage = t('keno_loss_msg', { matches: matches, amount: kenoLastBetAmount.toFixed(2) });
    }
    
    kenoTotalPoints = currentScore;
    
    // ğŸ›‘ Translation: Status
    kenoDrawStatusEl.innerText = t('status_completed');
    kenoMessageEl.innerText = resultMessage;
    
    window.kenoSaveHistory(kenoLastSelectedNumbers, kenoDrawnNumbers, kenoLastBetAmount, winAmount);

    setTimeout(window.kenoResetGame, 4000); 
}

window.kenoCalculatePayout = (matches, bet, picks) => {
    let payoutTable = {};
    if (picks === 1) payoutTable = { 1: 10 }; 
    else if (picks === 2) payoutTable = { 2: 50 };
    else if (picks === 3) payoutTable = { 2: 1, 3: 100 };
    else if (picks === 4) payoutTable = { 3: 5, 4: 200 }; 
    else if (picks === 5) payoutTable = { 3: 1, 4: 10, 5: 500 }; 
    else if (picks === 6) payoutTable = { 3: 0, 4: 2, 5: 20, 6: 1000 }; 
    else if (picks === 7) payoutTable = { 4: 3, 5: 30, 6: 200, 7: 5000 }; 
    else if (picks === 8) payoutTable = { 4: 1, 5: 10, 6: 80, 7: 500, 8: 10000 }; 
    else if (picks === 9) payoutTable = { 4: 0, 5: 5, 6: 40, 7: 250, 8: 2000, 9: 15000 };
    else if (picks === 10) payoutTable = { 3: 1, 4: 2, 5: 10, 6: 50, 7: 100, 8: 500, 9: 5000, 10: 25000 };
    
    const multiplier = payoutTable[matches] || 0;
    const winAmount = bet * multiplier;
    return { winAmount, multiplier };
}

// ------------------- KENO HISTORY (localStorage) -------------------
window.kenoSaveHistory = (picks, drawn, bet, win) => {
    const newId = kenoGameHistory.length > 0 ? kenoGameHistory[0].id + 1 : 1;
    const entry = {
        id: newId, 
        date: new Date().toLocaleTimeString(),
        picks: picks.sort((a, b) => a - b),
        drawn: drawn.sort((a, b) => a - b),
        bet: bet.toFixed(2),
        win: win.toFixed(2),
        result: win > 0 ? 'WIN' : 'LOSS'
    };
    kenoGameHistory.unshift(entry); 
    if (kenoGameHistory.length > 10) kenoGameHistory.pop(); 
    localStorage.setItem('kenoHistory', JSON.stringify(kenoGameHistory));
    window.kenoRenderHistory();
}

window.kenoRenderHistory = () => {
    if (!kenoHistoryListEl) return;
    if (kenoGameHistory.length === 0) {
        // ğŸ›‘ Translation: No List
        kenoHistoryListEl.innerHTML = `<p style="text-align: center;">${t('msg_no_list')}</p>`;
        return;
    }
    kenoHistoryListEl.innerHTML = '';
    kenoGameHistory.forEach(entry => {
        const div = document.createElement('div');
        const resultClass = entry.result === 'WIN' ? 'win' : 'loss';
        div.className = `keno-history-card ${resultClass}`;
        
        // ğŸ›‘ Translation: History Card
        // WON/LOST texts handled manually or need more keys, reusing existing logic + translate
        const wonText = t('label_won');
        const lostText = t('label_lost');
        const showDrawnText = t('btn_show_drawn');
        const gameLabel = t('label_game_num');
        const picksLabel = t('label_picks');
        const resultLabel = t('label_result');

        div.innerHTML = `
            <div class="card-header">
                <span class="game-id">${gameLabel}${entry.id} <span class="game-date">(${entry.date})</span></span>
                <span class="game-result ${resultClass}">${entry.result}</span>
            </div>
            <div class="card-body">
                <p><strong>${picksLabel} (${entry.picks.length}):</strong> <span class="pick-list">${entry.picks.join(', ')}</span></p>
                <p><strong>${resultLabel}</strong> ${entry.result === 'WIN' ? `${wonText} +${entry.win}` : `${lostText} -${entry.bet}`} Coin</p>
                <details>
                    <summary>${showDrawnText}</summary>
                    <p class="drawn-list">${entry.drawn.join(', ')}</p>
                </details>
            </div>
        `;
        kenoHistoryListEl.appendChild(div);
    });
}

// ------------------- KENO UTILITY FUNCTIONS -------------------
window.kenoToggleGridInteraction = (enabled) => {
    document.querySelectorAll('#keno-game-page .number-cell').forEach(cell => {
        cell.classList.toggle('disabled', !enabled);
    });
}

window.kenoResetGame = () => {
    kenoGameInProgress = false;
    kenoSelectedNumbers = []; 
    
    document.querySelectorAll('#keno-game-page .number-cell').forEach(cell => {
        cell.classList.remove('selected', 'drawn-cell', 'match', 'disabled');
    });
    
    window.kenoShowTab('keno-live-tab'); 

    kenoDrawShakerAreaEl.style.display = 'none';
    kenoGridEl.style.width = '100%'; 

    document.getElementById('keno-bet-controls').style.display = 'flex';
    kenoRandomPickBtn.style.display = 'block';
    
    // ğŸ›‘ Translation: Status
    kenoDrawStatusEl.innerText = t('status_waiting');
    kenoCurrentBallAreaEl.textContent = '?';
    kenoDrawCountAreaEl.textContent = '0 / 20';
    
    window.kenoToggleGridInteraction(true);
    
    // âœ… á‹¨ Firebase coináŠ• áŠ¥áŠ•á‹°áŒˆáŠ“ áˆ˜áŒ«áŠ•
    kenoTotalPoints = currentScore;
    kenoBetAmount = KENO_MIN_BET; 
    
    window.kenoUpdateUI();
}

// ======================================================================
// âœ… ğŸ›‘ á‹¨ KENO GAME LOGIC áˆ˜áŒ¨áˆ¨áˆ»
// ======================================================================





// ======================================================================
// ======================================================================
// âœ… ğŸ›‘ á‹¨áˆ˜áŒ¨áˆ¨áˆ»á‹ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ: Staking Game Logic (FULL VERSION)
// ======================================================================
// ======================================================================

// á‹¨ Stake á•áˆ‹áŠ–á‰½
const STAKING_PLANS = [
    { id: 1, lang_key: "plan_bronze", amount: 10000, duration_hours: 24, interest_rate: 0.20 },
    { id: 2, lang_key: "plan_silver", amount: 50000, duration_hours: 24, interest_rate: 0.25 },
    { id: 3, lang_key: "plan_gold", amount: 100000, duration_hours: 24, interest_rate: 0.30 }
];


let stakeCooldownInterval = null; 

// ====================================================
// Navigation Fix
// ====================================================

window.showMainLobby = () => {
    
    document.querySelectorAll('.game-page-container').forEach(page => {
        page.style.display = 'none';
    });

    const mainPage = document.getElementById('tasks-page');
    if (mainPage) {
        mainPage.style.display = 'block';
    }
    
    const rootContainer = document.getElementById('root');
    if (rootContainer) {
        rootContainer.style.display = 'block';
    }

    const navBar = document.getElementById('nav-bar');
    if (navBar) {
        navBar.style.display = 'flex';
    }
    
    document.querySelectorAll('#nav-bar .nav-item').forEach(item => {
        item.classList.remove('active');
    });
    const tasksNav = document.getElementById('nav-tasks');
    if (tasksNav) {
        tasksNav.classList.add('active');
    }
};

// ====================================================
// History Functions
// ====================================================

const getStakeHistory = () => {
    try {
        const history = localStorage.getItem('stakeHistory');
        return JSON.parse(history || '[]');
    } catch (e) {
        console.error("Error loading stake history:", e);
        return [];
    }
};

window.saveStakeHistory = (type, amount, note) => {
    let stakeGameHistory = getStakeHistory(); 
    
    const newId = stakeGameHistory.length > 0 ? (stakeGameHistory[0].id + 1) : 1;
    const entry = {
        id: newId, 
        date: new Date().toLocaleString(), 
        type: type, 
        amount: amount,
        note: note
    };
    stakeGameHistory.unshift(entry); 
    if (stakeGameHistory.length > 20) stakeGameHistory.pop(); 
    localStorage.setItem('stakeHistory', JSON.stringify(stakeGameHistory));
    window.renderStakeHistory();
}

window.renderStakeHistory = () => {
    const historyListEl = document.getElementById('stake-history-list');
    if (!historyListEl) return;
    
    const stakeGameHistory = getStakeHistory(); 
    
    if (stakeGameHistory.length === 0) {
        historyListEl.innerHTML = '<p style="text-align: center; color: var(--stake-text-secondary);">á‹áˆ­á‹áˆ­ á‹¨áˆˆáˆá¢</p>';
        return;
    }
    
    historyListEl.innerHTML = '';
    stakeGameHistory.forEach(entry => {
        const div = document.createElement('div');
        const typeClass = entry.type === 'Stake' ? 'stake' : 'claim';
        const amountSign = entry.type === 'Stake' ? '-' : '+';
        
        div.className = `stake-history-card ${typeClass}`;
        div.innerHTML = `
            <div class="card-header">
                <span class="action-type">${entry.type}</span>
                <span class="action-amount ${typeClass}">${amountSign}${entry.amount.toLocaleString()} Coin</span>
            </div>
            <div class="card-body">
                <strong>${entry.note}</strong><br>
                <span class="action-date">${entry.date}</span>
            </div>
        `;
        historyListEl.appendChild(div);
    });
}
// ====================================================
// ğŸ“¢ á‹¨áŒáˆ áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‰°áŒá‰£áˆ­ (Timed & Skippable Ad Logic)
// ====================================================

/**
 * âœ… áŠ á‹²áˆµ: áˆ›áˆµá‰³á‹ˆá‰‚á‹« áˆ²áŠáŠ« áˆŠáŠ•áŠ©áŠ• á‹¨áˆšáŠ¨áá‰µ á‰°áŒá‰£áˆ­
 * (Telegram Link áŠ¨áˆ†áŠ á‰ á‰´áˆŒáŒáˆ«áˆá£ áˆŒáˆ‹ áŠ¨áˆ†áŠ á‰ á‰¥áˆ«á‹á‹˜áˆ­ á‹­áŠ¨áá‰³áˆ)
 */
window.handleAdClick = (url) => {
    try {
        if (url.includes('t.me')) {
            window.Telegram.WebApp.openTelegramLink(url);
        } else {
            window.Telegram.WebApp.openLink(url);
        }
    } catch (e) {
        console.error("Link Error:", e);
        // Fallback (áˆˆá‹°áˆ…áŠ•áŠá‰µ)
        window.open(url, '_blank');
    }
};

/**
 * âœ… áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áŠ¨áŒˆáŒ¹ áˆ‹á‹­ áˆ™áˆ‰ á‰ áˆ™áˆ‰ á‹¨áˆšá‹«áŒ á‹ á‰°áŒá‰£áˆ­
 */
window.removeSelfAd = () => {
    // 1. áŠ¥á‹¨áˆ°áˆ© á‹«áˆ‰á‰µáŠ• á‰†áŒ£áˆªá‹á‰½ (Timers) áŠ á‰áˆ
    
    // â­ Tasks áŒˆáŒ½ Timers áˆ›áŒ¥á‹á‰µ
    if (window.adInterval_tasks) clearInterval(window.adInterval_tasks);
    if (window.skipTimer_tasks) clearInterval(window.skipTimer_tasks);

    // â­ Staking áŒˆáŒ½ Timers áˆ›áŒ¥á‹á‰µ
    if (window.adInterval_stake) clearInterval(window.adInterval_stake);
    if (window.skipTimer_stake) clearInterval(window.skipTimer_stake);

    // 2. á‹¨ Tasks áŒˆáŒ½ áˆ›áˆµá‰³á‹ˆá‰‚á‹« áŠ®áŠ•á‰´á‹­áŠáˆ­áŠ• á‰£á‹¶ áŠ á‹µáˆ­áŒ
    const tasksContainer = document.getElementById('tasks-ad-container');
    if (tasksContainer) {
        tasksContainer.innerHTML = ''; 
        tasksContainer.style.display = 'none';
    }

    // 3. á‹¨ Staking áŒˆáŒ½ áˆ›áˆµá‰³á‹ˆá‰‚á‹« áŠ®áŠ•á‰´á‹­áŠáˆ­áŠ• á‰£á‹¶ áŠ á‹µáˆ­áŒ
    const stakeContainer = document.getElementById('self-ad-banner-container');
    if (stakeContainer) {
        stakeContainer.innerHTML = ''; 
        stakeContainer.style.display = 'none';
    }
};

/**
 * âœ… áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‹¨áˆšáŒ­áŠ• á‹‹áŠ“ á‰°áŒá‰£áˆ­
 */
window.loadSelfAd = (containerId) => {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    // â­ áˆá‹© IDá‹á‰½áŠ• áŠ¥áŠ“ á‹¨Timer áˆµáˆá‰½áŠ• áˆ˜ááŒ áˆ­
    let uniqueIdSuffix = containerId.replace('-container', '');
    // IDá‹ áŠ¥áŠ•á‹³á‹­áˆ¨á‹áˆ áŠ¥áŠ“áŒ áˆ¨á‹
    if (uniqueIdSuffix === 'tasks-ad') uniqueIdSuffix = 'tasks';
    if (uniqueIdSuffix === 'self-ad-banner') uniqueIdSuffix = 'stake';
    
    const skipButtonId = 'skipAdButton-' + uniqueIdSuffix;
    const adIntervalName = 'adInterval_' + uniqueIdSuffix;
    const skipTimerName = 'skipTimer_' + uniqueIdSuffix;

    const SKIP_DELAY_SECONDS = 15; 
    let secondsLeft = SKIP_DELAY_SECONDS; 

    // 1. á‹¨áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹á‰½ á‹áˆ­á‹áˆ­
    const adsList = [
        {
            id: 1,
            title: "á‹¨áŠ á‹³áˆ› á‹¨áˆµáˆ« áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‰»áŠ“áˆ",
            desc: "áŠ á‹³á‹²áˆµ á‹¨áˆµáˆ« áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹á‰½áŠ• áˆˆáˆ›áŒáŠ˜á‰µ á‹­á‰€áˆ‹á‰€áˆ‰!",
            image: "https://tame3232.github.io/2/adama-jobs-ad.jpg",
            link: "https://t.me/adama_jobss",
            btnText: "JOIN NOW"
        },
        {
            id: 2,
            title: "Smart Airdrop VIP",
            desc: "á‰°áŒ¨áˆ›áˆª á‰¦áŠáˆµ áŠ¥áŠ“ áˆ½áˆáˆ›á‰¶á‰½!",
            image: "https://tame3232.github.io/2/smart-airdrop-vip-ads.jpg",
            link: "https://t.me/Smartairdrops_bot",
            btnText: "UPGRADE"
        },
        {
            id: 3,
            title: "Crypto Trading Tips",
            desc: "á‹¨áŠ­áˆªá•á‰¶ áŠ•áŒá‹µ á‰ áŠáƒ á‹­áˆ›áˆ©",
            image: "https://tame3232.github.io/2/smart-airdrop-crypto-ads.jpg",
            link: "https://t.me/CryptoTradingTips2",
            btnText: "LEARN MORE"
        },
        {
            id: 4,
            title: "Daily Bonus Shop",
            desc: "áŠ¥á‰ƒá‹á‰½áŠ• á‰ á‰…áŠ“áˆ½ á‹­áŒá‹™",
            image: "https://tame3232.github.io/2/smart-airdrop-sales-ads.jpg",
            link: "https://t.me/Kidu_dani",
            btnText: "SHOP NOW"
        },
        {
            id: 5,
            title: "Invite & Earn More",
            desc: "áŒ“á‹°áŠ› áŒ‹á‰¥á‹˜á‹ á‹«áŒáŠ™",
            image: "https://tame3232.github.io/2/smart-airdrop-invite-ads.jpg",
            link: "samrtgame21_bot",
            btnText: "INVITE"
        }
    ];

    // 2. á‹¨ HTML áŠ á‹ˆá‰ƒá‰€áˆ©áŠ• áˆ˜ááŒ áˆ­
    let slidesHTML = '';
    let dotsHTML = '';

    adsList.forEach((ad, index) => {
        // ğŸ›‘ FIX: <a> á‰³áŒ á‰°á‹ˆáŒá‹¶ á‰  div + onclick á‰°á‰°áŠ­á‰·áˆ (áˆˆá‰´áˆŒáŒáˆ«áˆ áŠ¥áŠ•á‹²áˆ˜á‰½)
        slidesHTML += `
            <div class="ad-slide" data-index="${index}">
                <div class="ad-card-3d" onclick="window.handleAdClick('${ad.link}')" 
                   style="background-image: url('${ad.image}');">
                    <div class="ad-overlay">
                        <div class="ad-title">${ad.title}</div>
                        <div style="font-size: 12px; color: #ddd; margin-bottom: 8px;">${ad.desc}</div>
                        <div class="ad-btn">${ad.btnText}</div>
                    </div>
                </div>
            </div>
        `;
        // Dots
        dotsHTML += `<div class="ad-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`;
    });

    // ğŸ›‘ HTML á‹ˆá‹° áŠ®áŠ•á‰´á‹­áŠáˆ© áˆ˜áŒ¨áˆ˜áˆ­
    container.innerHTML = `
        <div class="ad-carousel-container" id="adCarousel-${uniqueIdSuffix}">
            <div class="ad-track" id="adTrack-${uniqueIdSuffix}">
                ${slidesHTML}
            </div>
            <div class="ad-dots" id="adDots-${uniqueIdSuffix}">
                ${dotsHTML}
            </div>
        </div>
        
        <button id="${skipButtonId}" class="skip-ad-btn" disabled>
            Skip Ad in ${SKIP_DELAY_SECONDS}
        </button>
    `;
    
    // áŠ®áŠ•á‰´á‹­áŠáˆ©áŠ• áˆ›áˆ³á‹¨á‰µ
    container.style.display = 'block';

    // 3. á‹¨áˆ›áŠ•á‰€áˆ³á‰€áˆµ (Sliding) áˆáŒ‚áŠ­
    let currentIndex = 0;
    const track = document.getElementById(`adTrack-${uniqueIdSuffix}`);
    const dots = document.querySelectorAll(`#adDots-${uniqueIdSuffix} .ad-dot`);
    const slides = document.querySelectorAll(`#adCarousel-${uniqueIdSuffix} .ad-slide`);
    const totalSlides = adsList.length;

    const updateSlider = () => {
        if(track) track.style.transform = `translateX(-${currentIndex * 100}%)`;
        
        dots.forEach(dot => dot.classList.remove('active'));
        if(dots[currentIndex]) dots[currentIndex].classList.add('active');
        
        slides.forEach(slide => slide.classList.remove('active'));
        if(slides[currentIndex]) slides[currentIndex].classList.add('active');
    };

    const nextSlide = () => {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateSlider();
    };

    // Auto Slide IntervaláŠ• á‰ áˆá‹© áˆµáˆ áˆ˜áŒ€áˆ˜áˆ­/áˆ›á‰†áˆ
    if (window[adIntervalName]) clearInterval(window[adIntervalName]);
    window[adIntervalName] = setInterval(nextSlide, 3500);

    // á‹¨áˆ˜áŒ€áˆ˜áˆªá‹«á‹áŠ• áˆµáˆ‹á‹­á‹µ Active áˆ›á‹µáˆ¨áŒ
    if(slides.length > 0) setTimeout(() => slides[0].classList.add('active'), 100);

    // 4. á‹¨ Skip Timer áŠ¥áŠ“ áŠ á‹áˆ«áˆ­ áˆáŒ‚áŠ­
    const skipButton = document.getElementById(skipButtonId);

    const updateSkipTimer = () => {
        secondsLeft--;
        if (skipButton) {
            if (secondsLeft > 0) {
                skipButton.textContent = `Skip Ad in ${secondsLeft}`;
            } else {
                // áŒŠá‹œá‹ áˆ²á‹«áˆá‰…
                clearInterval(window[skipTimerName]); 
                skipButton.textContent = 'SKIP AD';
                skipButton.disabled = false;
            }
        } else {
            // áŠ á‹áˆ«áˆ© áŠ¨áŒ á‹ (áŒˆáŒ½ áŠ¨á‰°á‰€á‹¨áˆ¨) á‰†áŒ£áˆªá‹áŠ• áŠ á‰áˆ
            clearInterval(window[skipTimerName]);
        }
    };
    
    if (skipButton) {
        // Click Event áˆ›áˆµá‰°áŠ“áŒˆá‹µ
        skipButton.onclick = window.removeSelfAd; // addEventListener áˆ³á‹­áˆ†áŠ• onclick á‰°áŒ á‰…áˆ˜áŠ“áˆ (áˆˆá‹°áˆ…áŠ•áŠá‰µ)

        // TimeráŠ• á‰ á‹¨ 1 áˆ°áŠ¨áŠ•á‹± áˆ˜áŒ€áˆ˜áˆ­
        if (window[skipTimerName]) clearInterval(window[skipTimerName]);
        window[skipTimerName] = setInterval(updateSkipTimer, 1000);
        skipButton.textContent = `Skip Ad in ${SKIP_DELAY_SECONDS}`;
    }
};


// ====================================================
// Staking Logic
// ====================================================

window.showStakeTab = (tabId, clickedButton) => {
    document.querySelectorAll('#staking-page .stake-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('#staking-page .stake-tab-button').forEach(button => {
        button.classList.remove('active');
    });

    document.getElementById(tabId).classList.add('active');
    if (clickedButton) {
        clickedButton.classList.add('active');
    }
    
    if (tabId === 'stake-history-tab') {
        window.renderStakeHistory();
    }
}


/**
 * á‹¨ Stake áŒˆáŒ½ áˆ²áŠ¨áˆá‰µ UI áŠ• á‹«á‹‹á‰…áˆ«áˆ
 * ğŸ›‘ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ áŠ¥á‹šáˆ… á‹­áŒ áˆ«áˆ
 */
window.initStakingPage = () => {
    if (typeof currentUserDocData === 'undefined' || !currentUserDocData) return;

    if (stakeCooldownInterval) {
        clearInterval(stakeCooldownInterval);
        stakeCooldownInterval = null;
    }

    document.getElementById('stake-total-points').textContent = `${currentScore.toLocaleString()} Coin`;
    
    window.updateStakingUI();
    
    // ğŸ›‘ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áˆ˜áŒ¥áˆ«á‰µ
    window.loadSelfAd('self-ad-banner-container');
    
    window.showStakeTab('stake-live-tab', document.querySelector('#stake-tab-navigation .stake-tab-button'));
}

window.updateStakingUI = () => {
    const inputCard = document.getElementById('staking-input-card');
    const claimCard = document.getElementById('staking-claim-card');
    const stakedAmount = currentUserDocData.staked_amount || 0;
    const stakeStartTime = currentUserDocData.stake_start_time; // Firebase Timestamp

    if (stakedAmount > 0 && stakeStartTime) {
        inputCard.style.display = 'none';
        claimCard.style.display = 'block';
        window.startStakeClaimTimer(stakedAmount, stakeStartTime);
    } else {
        inputCard.style.display = 'block';
        claimCard.style.display = 'none';
        window.renderStakePlans(); 
    }
    
    document.getElementById('stake-total-points').textContent = `${currentScore.toLocaleString()} Coin`;
}



window.renderStakePlans = () => {
    const plansContainer = document.getElementById('stake-plans-container');
    if (!plansContainer) return;
    
    plansContainer.innerHTML = ''; 
    
    STAKING_PLANS.forEach(plan => {
        const canAfford = typeof currentScore !== 'undefined' && currentScore >= plan.amount;
        const returnAmount = plan.amount * (1 + plan.interest_rate);
        
        // ğŸ‘‡ áŠ¥á‹šáˆ… áŒ‹áˆ­ t() function á‰°áŒ á‰…áˆ˜áŠ• áˆµáˆ™áŠ• áŠ¥áŠ•áŒ áˆ«áˆˆáŠ•
        const translatedTitle = t(plan.lang_key); 

        const planCard = document.createElement('div');
        planCard.className = `stake-plan-card ${canAfford ? '' : 'disabled'}`;
        planCard.innerHTML = `
            <div class="plan-header">
                <div class="plan-title">${translatedTitle}</div>
                <div class="plan-rate">+${plan.interest_rate * 100}%</div>
            </div>
            <div class="plan-details">
                Stake: <span>${plan.amount.toLocaleString()} Coin</span><br>
                Duration: <span>${plan.duration_hours} Hours</span><br>
                Return: <span>${returnAmount.toLocaleString()} Coin</span>
            </div>
        `;
        
        if (canAfford) {
            planCard.onclick = () => window.handleStakeClick(plan);
        } else {
            planCard.onclick = () => {
                document.getElementById('stakeInputMessage').innerText = t('stake_insufficient'); // á‰‹áŠ•á‰‹á‹áŠ• á‹­áŒ á‰€áˆ›áˆ
            }
        }
        
        plansContainer.appendChild(planCard);
    });
}


/**
 * âœ… á‹¨á‰°áˆ»áˆ»áˆˆ: á‹¨ Claim áŠ«áˆ­á‹µ áˆ°á‹“á‰µ á‰†áŒ£áˆª áŠ¨ Progress Bar áŒ‹áˆ­
 */
window.startStakeClaimTimer = (stakedAmount, stakeStartTime) => {
    const stakedAmountDisplay = document.getElementById('stakedAmountDisplay');
    const claimButton = document.getElementById('stakeClaimButton');
    const timerDisplay = document.getElementById('stakeCooldownTimer');
    const returnMsg = document.getElementById('stakeReturnMessage');
    const progressBar = document.getElementById('stakeProgressBar'); 
    const accruedDisplay = document.getElementById('accruedInterestDisplay'); 

    const durationHours = currentUserDocData.stake_duration_hours || 24;
    const durationMs = durationHours * 60 * 60 * 1000;
    const interestRate = currentUserDocData.stake_interest_rate || 0.20;
    
    // áŒ á‰…áˆ‹áˆ‹ á‹¨áˆšáŒˆáŠ˜á‹ á‰µáˆ­á (Total Profit)
    const totalProfit = stakedAmount * interestRate;
    const returnAmount = stakedAmount + totalProfit;

    stakedAmountDisplay.innerText = stakedAmount.toLocaleString();
    returnMsg.innerText = `+${returnAmount.toLocaleString()} Coin`;

    const updateTimer = () => {
        const now = new Date();
        const startTime = stakeStartTime.toDate ? stakeStartTime.toDate() : new Date(stakeStartTime);
        const elapsedMs = now.getTime() - startTime.getTime(); // á‹«áˆˆáˆá‹ áŒŠá‹œ
        const remainingMs = durationMs - elapsedMs; // á‹¨á‰€áˆ¨á‹ áŒŠá‹œ

        // 1. á‹¨áˆ‚á‹°á‰µ áŠ áˆáˆŒ áˆ›áˆµáˆ‹á‰µ (Progress Percentage)
        let progressPercent = (elapsedMs / durationMs) * 100;
        if (progressPercent > 100) progressPercent = 100;
        if (progressBar) progressBar.style.width = `${progressPercent}%`;

        // 2. áŠ¥áˆµáŠ«áˆáŠ• á‹¨á‰°áŒ áˆ«á‰€áˆ˜ á‹ˆáˆˆá‹µ áˆ›áˆ³á‹¨á‰µ (Accrued Interest) - áˆˆá‹•á‹­á‰³ á‰¥á‰»
        let accrued = (totalProfit * (progressPercent / 100));
        if (accruedDisplay) accruedDisplay.innerText = `+${accrued.toFixed(2)}`;

        // 3. áŒŠá‹œá‹ áŠ«áˆˆá‰€
        if (remainingMs <= 0) {
            timerDisplay.innerText = "âœ… Completed!";
            timerDisplay.style.color = "var(--et-green)";
            
            claimButton.disabled = false;
            claimButton.innerText = `CLAIM ${returnAmount.toLocaleString()} COIN`;
            claimButton.style.backgroundColor = "var(--et-green)";
            claimButton.style.boxShadow = "0 0 15px rgba(76, 175, 80, 0.5)"; // á‹¨áˆšá‹«á‰ áˆ« áŠ á‹áˆ«áˆ­
            
            if (stakeCooldownInterval) clearInterval(stakeCooldownInterval);
        } else {
            // áŒŠá‹œá‹ áŠ«áˆ‹áˆˆá‰€
            timerDisplay.innerText = formatTime(remainingMs); 
            timerDisplay.style.color = "var(--tg-text)";
            
            claimButton.disabled = true;
            claimButton.innerText = t('btn_locked');
            claimButton.style.backgroundColor = "#555";
            claimButton.style.boxShadow = "none";
        }
    };

    updateTimer(); 
    if (window.stakeCooldownInterval) clearInterval(window.stakeCooldownInterval);
    window.stakeCooldownInterval = setInterval(updateTimer, 1000); 
}


/**
 * âœ… á‹¨á‰°áˆ»áˆ»áˆˆ: "Claim Reward" á‰°áŒá‰£áˆ­ (Safe & Animated)
 */
window.handleClaimStakeClick = async () => {
    const claimButton = document.getElementById('stakeClaimButton');
    
    if (claimButton.disabled || claimButton.getAttribute('data-processing') === 'true') return; 

    claimButton.setAttribute('data-processing', 'true');
    claimButton.disabled = true;
    claimButton.innerText = "Processing... ğŸ”„";

    const stakedAmount = currentUserDocData.staked_amount || 0;
    const interestRate = currentUserDocData.stake_interest_rate || 0.20; 
    
    if (stakedAmount === 0) {
        claimButton.innerText = "Error: No Stake";
        claimButton.removeAttribute('data-processing');
        return;
    }

    const rewardAmount = stakedAmount * interestRate;
    const totalReturn = Math.floor(stakedAmount + rewardAmount); 

    if (typeof db === 'undefined' || !currentFirebaseUserId) {
         WebApp.showAlert("Connection Error.");
         return;
    }

    const userRef = doc(db, "users", currentFirebaseUserId);
    
    try {
        await updateDoc(userRef, {
            total_score: increment(totalReturn), 
            staked_amount: 0,                  
            stake_start_time: null,
            stake_duration_hours: null,
            stake_interest_rate: null
        });

        window.playSound('win');
        window.triggerConfetti(totalReturn); 
        
        window.saveStakeHistory('Claim', totalReturn, `+${(interestRate*100).toFixed(0)}% Profit`);
        
        currentScore += totalReturn;
        currentUserDocData.staked_amount = 0;
        currentUserDocData.stake_start_time = null;
        
        window.updateStakingUI(); 
        window.renderPageContent(); 

        WebApp.showAlert(`ğŸ‰ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ! ${totalReturn.toLocaleString()} Coin á‹ˆá‹° áˆ‚áˆ³á‰¥á‹ áŒˆá‰¥á‰·áˆ!`);

    } catch (error) {
        console.error("Claim Error:", error);
        claimButton.disabled = false;
        claimButton.innerText = "RETRY CLAIM";
        claimButton.removeAttribute('data-processing');
        WebApp.showAlert(`âŒ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ: ${error.message}`);
    }
}


/**
 * "Stake Now" (á•áˆ‹áŠ• áˆ²áˆ˜áˆ­áŒ¥)
 */
window.handleStakeClick = async (plan) => {
    const stakeInputMessage = document.getElementById('stakeInputMessage');
    
    if (plan.amount > currentScore) {
        stakeInputMessage.innerText = `âŒ á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆá¢`;
        return;
    }

    document.querySelectorAll('#staking-page .stake-plan-card').forEach(card => {
        card.style.pointerEvents = 'none';
        card.style.opacity = '0.5';
    });
    stakeInputMessage.innerText = "Staking...";

    const userRef = doc(db, "users", currentFirebaseUserId);
    try {
        await updateDoc(userRef, {
            total_score: increment(plan.amount * -1), 
            staked_amount: plan.amount,              
            stake_start_time: serverTimestamp(),       
            stake_duration_hours: plan.duration_hours,
            stake_interest_rate: plan.interest_rate
        });
        
        const successMessage = `âœ… ${plan.amount.toLocaleString()} Coin á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ Stake á‰°á‹°áˆ­áŒ“áˆ!`;
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.showAlert) {
            WebApp.showAlert(successMessage);
        } else {
            alert(successMessage);
        }
        
        window.playSound('win');
        
        window.saveStakeHistory('Stake', plan.amount, plan.title);

        currentScore -= plan.amount;
        currentUserDocData.staked_amount = plan.amount;
        currentUserDocData.stake_start_time = { toDate: () => new Date() }; 
        currentUserDocData.stake_duration_hours = plan.duration_hours;
        currentUserDocData.stake_interest_rate = plan.interest_rate;
        
        updateStakingUI(); 
        renderPageContent(); 

    } catch (error) {
        stakeInputMessage.innerText = `âŒ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ: ${error.message}`;
        window.renderStakePlans(); 
    }
}

// ======================================================================
//  Staking Game Logic áˆ˜áŒ¨áˆ¨áˆ»
// ======================================================================

// ======================================================================
// âœ… DAILY CIPHER GAME LOGIC (FIXED)
// ======================================================================

const CIPHER_REWARD = 50000; 
const cipherTimestampField = 'last_daily_cipher_time';

window.submitDailyCipher = async () => {
    const inputEl = document.getElementById('cipher-input');
    const messageEl = document.getElementById('cipher-message');
    const submitBtn = document.getElementById('cipher-submit-btn');

    // 1. á‹¨á‰°áŒ á‰ƒáˆšá‹áŠ• áŠ®á‹µ áˆ˜á‰€á‰ áˆ (á‹ˆá‹° Capital letter áˆ˜á‰€á‹¨áˆ­)
    const userCode = inputEl.value.toUpperCase().trim();
    
    // á‹¨á‰°áŒ á‰ƒáˆš ID áˆ›áˆ¨áŒ‹áŒˆáŒ¥
    const currentUserId = currentFirebaseUserId; // á‰€á‹µáˆ á‹¨á‰°áŒ«áŠá‹áŠ• áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ•

    if (!currentUserId) {
        WebApp.showAlert("Error: User not logged in.");
        return;
    }

    if (!userCode) {
        messageEl.innerText = t('msg_cipher_enter'); // ğŸŸ¢ Fixed variable
        messageEl.style.color = "var(--et-yellow)";
        return;
    }

    // 2. Cooldown á‰¼áŠ­ áˆ›á‹µáˆ¨áŒ
    const { isReady } = checkDailyLimit(cipherTimestampField);
    if (!isReady) {
        messageEl.innerText = t('msg_cipher_done_today'); // ğŸŸ¢ Fixed variable
        messageEl.style.color = "var(--et-red)";
        return;
    }

    // 3. áŠ¥á‹¨áˆ°áˆ« áˆ˜áˆ†áŠ‘áŠ• áˆ›áˆ³á‹¨á‰µ
    submitBtn.disabled = true;
    submitBtn.innerText = t('btn_checking'); 
    messageEl.innerText = t('msg_checking_code'); // ğŸŸ¢ Translated
    messageEl.style.color = "var(--tg-hint)";

    try {
        // Firebase Transaction áˆ˜áŒ€áˆ˜áˆ­
        const result = await runTransaction(db, async (transaction) => {
            
            // áˆ€. á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ Referenceá‹á‰½áŠ• áˆ˜ááŒ áˆ­
            // 'daily_cipher_config' á‹¨áˆšá‰£áˆ Collection áŠ¥áŠ“ 'current_settings' á‹¨áˆšá‰£áˆ Document á‰  Firebase áˆ‹á‹­ áˆ˜áŠ–áˆ­ áŠ áˆˆá‰ á‰µ!
            const settingsRef = doc(db, "daily_cipher_config", "current_settings");
            const userRef = doc(db, "users", currentUserId);
            
            const settingsSnap = await transaction.get(settingsRef);
            const userSnap = await transaction.get(userRef);

            if (!settingsSnap.exists()) {
                 throw new Error("CONFIG_MISSING"); 
            }
            
            const currentSettings = settingsSnap.data();
            const userData = userSnap.data() || {}; 
            
            // áˆˆ. áŠ®á‹±áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥ (á‹³á‰³á‰¤á‹ áˆ‹á‹­ áŠ«áˆˆá‹ 'code' áŒ‹áˆ­)
            const CORRECT_CODE = (currentSettings.code || "").toUpperCase().trim();
            
            if (userCode !== CORRECT_CODE) {
                throw new Error("WRONG_CODE");
            }
            
            // áˆ. á‹¨áˆ°á‹á‰½ á‰¥á‹›á‰µ áŒˆá‹°á‰¥ (áˆˆáˆáˆ³áˆŒ áˆˆáˆ˜áŒ€áˆ˜áˆªá‹«á‹á‰¹ 100 áˆ°á‹á‰½)
            let currentClaimCount = currentSettings.claim_count || 0;
            const MAX_CLAIMS = currentSettings.max_claims || 10000; // á‰ áŠá‰£áˆª á‰¥á‹™ áŠ¥áŠ“á‹µáˆ­áŒˆá‹

            if (currentClaimCount >= MAX_CLAIMS) {
                throw new Error("LIMIT_REACHED");
            }

            // áˆ˜. áˆ½áˆáˆ›á‰µ áˆ˜áˆµáŒ á‰µ
            const newClaimCount = currentClaimCount + 1;
            const newScore = (userData.total_score || 0) + CIPHER_REWARD;
            
            // 1. á‹¨áˆ˜áˆáˆµ áˆ°áŒªá‹á‰½áŠ• á‰áŒ¥áˆ­ áˆ˜áŒ¨áˆ˜áˆ­
            transaction.update(settingsRef, { claim_count: newClaimCount });
            
            // 2. áˆˆá‰°áŒ á‰ƒáˆšá‹ Coin áˆ˜áŒ¨áˆ˜áˆ­ áŠ¥áŠ“ áˆ°á‹“á‰±áŠ• áˆ˜áˆ˜á‹áŒˆá‰¥
            transaction.update(userRef, { 
                [cipherTimestampField]: serverTimestamp(),
                total_score: newScore 
            });
            
            return { success: true, newCount: newClaimCount, max: MAX_CLAIMS };
        });

        // 4. áŠ¨á‰°áˆ³áŠ« á‰ áŠ‹áˆ‹
        if (result.success) {
            window.playSound('win');
            window.triggerConfetti(CIPHER_REWARD); // áŠ®áŠ•áŒá‰²
            
            // ğŸŸ¢ Fixed variable & using template literal for reward message
            messageEl.innerText = `${t('msg_correct_code')} +${CIPHER_REWARD.toLocaleString()} Coin!`; 
            messageEl.style.color = "var(--et-green)";
            inputEl.value = "";
            
            // á‹¨áŠ áŠ«á‰£á‰¢ á‰°áˆˆá‹‹á‹‹áŒ®á‰½áŠ• áˆ›á‹˜áˆ˜áŠ•
            currentScore += CIPHER_REWARD;
            
            // áŠ á‹áˆ«áˆ©áŠ• á‰  Timer áˆ˜á‰†áˆˆá
            startCooldownTimer(cipherTimestampField, 'daily-cipher-timer', 'cipher-submit-btn');
            renderPageContent(); // áŠáŒ¥á‰¡áŠ• á‰ áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ áˆ›áˆ³á‹¨á‰µ
        }

    } catch (error) {
        // 5. áˆµáˆ…á‰°á‰¶á‰½áŠ• áˆ˜á‰†áŒ£áŒ áˆ­
        submitBtn.disabled = false;
        submitBtn.innerText = t('btn_check_code'); // ğŸŸ¢ Translated: Revert button text
        
        if (error.message === "WRONG_CODE") {
             messageEl.innerText = t('msg_wrong_code'); // ğŸŸ¢ Fixed variable
             messageEl.style.color = "var(--et-red)";
             window.playSound('fail');
        } else if (error.message === "LIMIT_REACHED") {
             messageEl.innerText = t('msg_cipher_limit'); // ğŸŸ¢ Fixed variable
             messageEl.style.color = "var(--et-red)";
        } else if (error.message === "CONFIG_MISSING") {
             messageEl.innerText = t('alert_config_error'); // ğŸŸ¢ Translated
             messageEl.style.color = "var(--et-red)";
             console.error("Firebase áˆ‹á‹­ daily_cipher_config/current_settings áŠ áˆá‰°áˆáŒ áˆ¨áˆá¢");
        } else {
             console.error("Transaction failed:", error);
             // áŠ¥á‹šáˆ… áŒ‹áˆ­ á‰µáŠ­áŠ­áˆˆáŠ›á‹áŠ• á‹¨ error áˆ˜áˆáŠ¥áŠ­á‰µ áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ áŠ¥áŠ“áˆ³á‹«áˆˆáŠ•
             messageEl.innerText = "Error: " + error.message; 
             messageEl.style.color = "var(--et-red)";
        }
    }
};


// ======================================================================
// âœ… MEMORY MATCH GAME LOGIC (FIXED)
// ======================================================================
const MEMORY_ICONS = ['ğŸ’', 'ğŸ’°', 'ğŸš€', 'â‚¿', 'ETH', 'ğŸ²']; // 6 áŒ¥áŠ•á‹¶á‰½ (12 áŠ«áˆ­á‹¶á‰½)
let hasFlippedCard = false;
let lockBoard = false;
let firstCard, secondCard;
let matchedPairs = 0;
let memoryTimerInterval;
let memoryTimeLeft = 60;

// âœ… áŠ á‹²áˆµ á‰°áŒá‰£áˆ­: áŒ¨á‹‹á‰³á‹áŠ• áˆˆá‰…á‰€á‹ áˆ²á‹ˆáŒ¡ á‹¨á‰†áŒ£áˆªá‹á‰½áŠ• áˆ›á…á‹³á‰µ
window.cleanupGame = () => {
    if (window.memoryTimerInterval) {
        clearInterval(window.memoryTimerInterval);
        window.memoryTimerInterval = null;
    }
    window.showMainPage();
};

window.startMemoryGame = () => {
    const timestampField = 'last_memory_game_time';
    const messageEl = document.getElementById('memory-message');
    
    // 1. Cooldown áˆ˜áˆá‰°áˆ½
    const { isReady } = checkDailyLimit(timestampField);
    
    if (!isReady) {
        // âœ… á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ áˆáŒ‚áŠ­: áŒˆá‹°á‰¥ áˆ‹á‹­ áŠ¨áˆ†áŠ á‰†áŒ£áˆªá‹áŠ•áˆ áŒ áˆ­á‰°áŠ• áˆ˜áˆá‹•áŠ­á‰µ áŠ¥áŠ“áˆ³á‹«áˆˆáŠ•
        messageEl.innerText = t('alert_memory_cooldown'); // ğŸŸ¢ Translated
        messageEl.style.color = "var(--et-red)";
        
        // á‰†áŒ£áˆªá‹áŠ• á‹«áˆµáŒ€áˆáˆ«áˆ (áŒŠá‹œá‹áŠ• á‹«áˆ³á‹«áˆ áŠ¥áŠ“ áŠ á‹áˆ«áˆ©áŠ• á‹«áŒá‹³áˆ)
        startCooldownTimer(timestampField, 'memory-game-timer-display', 'memory-start-btn');
        return; 
    }

    // 2. áŒ¨á‹‹á‰³á‹áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ 
    const grid = document.getElementById('memory-game-grid');
    const startBtn = document.getElementById('memory-start-btn');
    
    grid.innerHTML = '';
    messageEl.innerText = '';
    startBtn.style.display = 'none';
    
    // ğŸ›‘ FIXED: 'let' á‰°á‹ˆáŒá‹¶ áŒáˆá‰£áˆ á‰°áˆˆá‹‹á‹‹áŒ®á‰½áŠ• á‹«á‹˜áˆáŠ“áˆ
    matchedPairs = 0;
    memoryTimeLeft = 60;
    hasFlippedCard = false;
    lockBoard = false;

    // 3. áŠ«áˆ­á‹¶á‰½áŠ• áˆ›á‹°á‰£áˆˆá‰… (Double the icons and shuffle)
    const cardsArray = [...MEMORY_ICONS, ...MEMORY_ICONS];
    cardsArray.sort(() => 0.5 - Math.random());
    
    // 4. HTML áˆ˜ááŒ áˆ­
    cardsArray.forEach(icon => {
        const card = document.createElement('div');
        card.classList.add('memory-card');
        card.dataset.icon = icon;
        
        card.innerHTML = `
            <div class="front-face">${icon}</div>
            <div class="back-face">?</div>
        `;
        
        card.addEventListener('click', flipCard);
        grid.appendChild(card);
    });

    // 5. áˆ°á‹“á‰µ á‰†áŒ£áˆª áˆ›áˆµáŒ€áˆ˜áˆ­
    document.getElementById('memory-game-timer-display').innerText = t('msg_timer_display', { time: memoryTimeLeft }); // ğŸŸ¢ Translated Time Display
    if (memoryTimerInterval) clearInterval(memoryTimerInterval);
    
    memoryTimerInterval = setInterval(() => {
        memoryTimeLeft--;
        document.getElementById('memory-game-timer-display').innerText = t('msg_timer_display', { time: memoryTimeLeft });
        
        if (memoryTimeLeft <= 0) {
            window.endMemoryGame(false);
        }
    }, 1000);
};


function flipCard() {
    if (lockBoard) return;
    if (this === firstCard) return;

    this.classList.add('flip');
    window.playSound('click');

    if (!hasFlippedCard) {
        hasFlippedCard = true;
        firstCard = this;
        return;
    }

    secondCard = this;
    checkForMatch();
}

function checkForMatch() {
    let isMatch = firstCard.dataset.icon === secondCard.dataset.icon;

    if (isMatch) {
        disableCards();
        window.playSound('win');
    } else {
        unflipCards();
    }
}

function disableCards() {
    firstCard.removeEventListener('click', flipCard);
    secondCard.removeEventListener('click', flipCard);
    
    firstCard.classList.add('matched');
    secondCard.classList.add('matched');

    resetBoard();
    matchedPairs++;

    if (matchedPairs === MEMORY_ICONS.length) {
        window.endMemoryGame(true);
    }
}

function unflipCards() {
    lockBoard = true;

    setTimeout(() => {
        firstCard.classList.remove('flip');
        secondCard.classList.remove('flip');
        resetBoard();
    }, 1000);
}

function resetBoard() {
    [hasFlippedCard, lockBoard] = [false, false];
    [firstCard, secondCard] = [null, null];
}

window.endMemoryGame = async (isWin) => {
    clearInterval(memoryTimerInterval);
    const messageEl = document.getElementById('memory-message');
    const startBtn = document.getElementById('memory-start-btn');
    const timestampField = 'last_memory_game_time';
    const grid = document.getElementById('memory-game-grid'); // Grid ElementáŠ• áŠ áŒáŠ

    // âœ… á‹ˆáˆ³áŠ áˆ›áˆµá‰°áŠ«áŠ¨á‹«: á‰°áŒ¨áˆ›áˆª áŠ­áˆŠáŠ®á‰½áŠ• á‹ˆá‹²á‹«á‹áŠ‘ áˆˆáˆ˜áŠ¨áˆ‹áŠ¨áˆ áˆ˜á‰†áˆˆá
    grid.style.pointerEvents = 'none';
    
    let scoreToAward = 0;
    
    if (isWin) {
        scoreToAward = 5000;
        // ğŸŸ¢ Translated and using interpolation
        messageEl.innerText = t('msg_memory_win', { amount: scoreToAward.toLocaleString() });
        window.playSound('win');
    } else {
        // ğŸŸ¢ Translated
        messageEl.innerText = t('msg_memory_timeout');
        window.playSound('fail');
    }

    // á‹¨áŒŠá‹œ áŒˆá‹°á‰¡áŠ• (Timestamp) á‹«áˆµáŒ€áˆáˆ«áˆ
    await updateScore(scoreToAward, isWin ? 'Memory Game Win' : 'Memory Game Cooldown', timestampField);
    
    // á‹¨24 áˆ°á‹“á‰µ áŒˆá‹°á‰¡áŠ• á‰ áˆµáŠ­áˆªáŠ‘ áˆ‹á‹­ á‹«áˆ³á‹«áˆ áŠ¥áŠ“ á‰áˆá‰áŠ• á‹­á‰†áŒ£áŒ áˆ«áˆ
    startCooldownTimer(timestampField, 'memory-game-timer-display', 'memory-start-btn');
    
    // á‹¨áŒ¨á‹‹á‰³á‹áŠ• Grid á‰£á‹¶ áˆ›á‹µáˆ¨áŒ
    grid.innerHTML = '';
}


// ============================================================
// âœ… ğŸ›‘ ADMIN REPORT SYSTEM (á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ)
// ============================================================

const ADMIN_TELEGRAM_ID = "40300" + "1547";
const TOP10_REWARD_AMOUNT = 2000; 

// 1. áŠ á‹µáˆšáŠ• áˆ˜áˆ†áŠ•á‹áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
function checkAdminStatus() {
    if (String(window.telegramUserId) === String(ADMIN_TELEGRAM_ID)) {
        const adminPanel = document.getElementById('admin-panel');
        if (adminPanel) adminPanel.style.display = 'block';
    }
}

// ğŸ›‘ áˆ›áˆ»áˆ»á‹« 1á¡ áˆˆá‰°áŒ á‰ƒáˆšá‹ á‹¨áŒáˆ áˆ˜áˆá‹•áŠ­á‰µ á‹¨áˆšáˆáŠ¨á‹ á‰°áŒá‰£áˆ­ (áŠ áˆáŠ• á‹­áˆ°áˆ«áˆ!)
async function sendRewardNotification(userId, rewardAmount, customMessage = null) {
    const msgToSend = customMessage || `ğŸ‰ <b>áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ!</b>\n\ná‰ áˆ³áˆáŠ•á‰± áŠ¨áá‰°áŠ› á‰°áˆ³á‰³áŠ á‰ áˆ˜áˆ†áŠ•á‹ <b>${rewardAmount.toLocaleString()} Coins</b> á‰°áˆ¸áˆáˆ˜á‹‹áˆ! ğŸ†`;

    try {
        // á‹ˆá‹° Netlify Function áŠ¥áŠ•áˆáŠ«áˆˆáŠ•á£ áŒáŠ• "custom_chat_id" áŠ á‰¥áˆ¨áŠ• áŠ¥áŠ•áˆáŠ«áˆˆáŠ•
        const response = await fetch('/.netlify/functions/send_alert', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                message: msgToSend, 
                custom_chat_id: userId // ğŸ‘ˆ á‹­áˆ… áŠ á‹²áˆ± á‰áˆá áŠáŒˆáˆ­ áŠá‹! (áˆˆá‰°áŒ á‰ƒáˆšá‹ á‹­áˆ‹áŠ«áˆ)
            }), 
        });

        if (!response.ok) {
            console.warn(`Failed to notify user ${userId}`);
        } else {
            console.log(`Notification sent to user ${userId}`);
        }
    } catch (error) {
        console.error("Notification Error:", error);
    }
}

// 2. áŠ áŒ á‰ƒáˆ‹á‹­ áˆªá–áˆ­á‰µ (áˆˆáŠ á‹µáˆšáŠ• á‰¥á‰»)
window.generateWeeklyReport = async () => {
    const statusEl = document.getElementById('report-status');
    statusEl.innerText = "áˆ˜áˆ¨áŒƒ á‰ áˆ˜áˆ°á‰¥áˆ°á‰¥ áˆ‹á‹­...";
    statusEl.style.color = "#FFC107";

    try {
        const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
        const usersCollectionRef = collection(db, "users");
        
        const q = query(
            usersCollectionRef, 
            where('last_played', '>', sevenDaysAgo),
            orderBy('last_played', 'desc'),
            limit(50) 
        );
        
        const snapshot = await getDocs(q);
        
        if (snapshot.empty) {
            statusEl.innerText = "á‰£áˆˆá‰á‰µ 7 á‰€áŠ“á‰µ áˆáŠ•áˆ á‰°áˆ³á‰³áŠ á‹¨áˆˆáˆá¢";
            return;
        }

        let message = `ğŸ“Š <b>áˆ³áˆáŠ•á‰³á‹Š á‹¨áŠ•á‰ á‰°áˆ³á‰³áŠá‹á‰½ áˆªá–áˆ­á‰µ</b>\n`; 
        message += `ğŸ“… á‰€áŠ•: ${new Date().toLocaleDateString()}\n`;
        message += `ğŸ‘¥ áŒ á‰…áˆ‹áˆ‹ Active Users (Top 50 shown): ${snapshot.size}\n\n`;
        message += `--------------------------------\n`;

        let count = 0;
        snapshot.forEach((doc) => {
            count++;
            const data = doc.data();
            const lastDate = data.last_played ? data.last_played.toDate().toLocaleDateString() : 'N/A';
            message += `${count}. ğŸ‘¤ ${data.username || 'No Name'}\n`;
            message += `   ğŸ’° Score: ${data.total_score.toLocaleString()}\n`;
            message += `   ğŸ•’ Last Seen: ${lastDate}\n\n`;
        });

        message += `--------------------------------\n`;
        message += `ğŸ¤– Sent from Smart Airdrop System`;

        // áˆˆáŠ á‹µáˆšáŠ• áˆ˜áˆ‹áŠ­ (custom_chat_id áˆµáˆˆáˆŒáˆˆ á‰ áŠá‰£áˆª á‹ˆá‹° Admin á‹­áˆ„á‹³áˆ)
        await sendToTelegram(message);
        
        statusEl.innerText = "âœ… áˆªá–áˆ­á‰± á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áˆáŠ³áˆ!";
        statusEl.style.color = "#4CAF50";

    } catch (error) {
        console.error("Report Error:", error);
        statusEl.innerText = "âŒ áˆµáˆ…á‰°á‰µ: " + error.message;
        statusEl.style.color = "#F44336";
    }
};

// 3. á‹ˆá‹° Netlify Function á‹¨áˆšáˆáŠ­ (áˆˆáŠ á‹µáˆšáŠ• áˆªá–áˆ­á‰µ)
async function sendToTelegram(text) {
    const functionUrl = 'https://newsmartgame.netlify.app/.netlify/functions/send_alert'; 
    const response = await fetch(functionUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text }), // custom_chat_id á‹¨áˆˆáˆ (á‹ˆá‹° Admin á‹­áˆ„á‹³áˆ)
    });

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`Failed to send via Netlify: ${errorData.error || 'Unknown'}`);
    }
}

// 4. Top 10 á‰°áŒ á‰ƒáˆšá‹á‰½áŠ• áˆ˜áˆ¸áˆˆáˆ áŠ¥áŠ“ áˆ›áˆ³á‹ˆá‰…
// ============================================================
// âœ… ğŸ›‘ ADMIN REPORT SYSTEM (Final Fix)
// ============================================================

// 4. Top 10 á‰°áŒ á‰ƒáˆšá‹á‰½áŠ• áˆ˜áˆ¸áˆˆáˆ áŠ¥áŠ“ áˆ›áˆ³á‹ˆá‰…
window.generateTop10FrequentUsers = async () => {
    const statusEl = document.getElementById('report-status');
    statusEl.innerText = "áŠ¨áá‰°áŠ› 10 á‰°áŒ á‰ƒáˆšá‹á‰½áŠ• á‰ áˆ˜áˆ¸áˆˆáˆ áˆ‹á‹­...";
    statusEl.style.color = "#FFC107";

    try {
        const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
        const usersCollectionRef = collection(db, "users");
        
        // ğŸ›‘ Query-á‹ áá‰µáˆƒá‹Š áŠ¥áŠ•á‹²áˆ†áŠ• áŠ¥áŠ“ Index-áˆ… áŠ¥áŠ•á‹²áˆ°áˆ« á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ
        const q = query(
            usersCollectionRef, 
            where('last_played', '>', sevenDaysAgo), 
            orderBy('last_played', 'asc'),           // Index-áˆ… á‹¨áˆšáˆáˆáŒˆá‹ á‰…á‹°áˆ á‰°áŠ¨á‰°áˆ
            orderBy('total_score', 'desc'),          
            limit(10) 
        );
        
        const snapshot = await getDocs(q);
        
        if (snapshot.empty) {
            statusEl.innerText = "á‰£áˆˆá‰á‰µ 7 á‰€áŠ“á‰µ áˆáŠ•áˆ áŠ•á‰ á‰°áŒ á‰ƒáˆš áŠ áˆá‰°áŒˆáŠ˜áˆá¢";
            return;
        }

        const rewardPromises = [];
        const customMessage = `ğŸ¥‡ <b>áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹á‰µ!</b>\n\ná‰ áˆ³áˆáŠ•á‰± áŠ¨áá‰°áŠ› á‹áŒ¤á‰µ á‰ áˆ›áˆáŒ£á‰µá‹ áŠ¨ Top 10 á‹áˆµáŒ¥ áŒˆá‰¥á‰°á‹‹áˆ!\n\nğŸ áˆ½áˆáˆ›á‰µ: <b>${TOP10_REWARD_AMOUNT.toLocaleString()} Coins</b> á‰°á‰€á‰¥áˆˆá‹‹áˆá¢`;
        
        // ğŸ›‘ áˆ›áˆ»áˆ»á‹«á¡ 'doc' á‹¨áˆšáˆˆá‹ á‹¨áˆ‰á• á‰°áˆˆá‹‹á‹‹áŒ­ á‹ˆá‹° 'userDoc' á‰°á‰€á‹­áˆ¯áˆá¢
        snapshot.forEach((userDoc) => { 
            // áŠ áˆáŠ• á‹¨ Firebase doc() á‰°áŒá‰£áˆ­áŠ• á‰ á‰µáŠ­áŠ­áˆ áˆ˜áŒ¥áˆ«á‰µ á‰µá‰½áˆ‹áˆˆáˆ…
            const userRef = doc(db, "users", userDoc.id); 
            const userId = userDoc.data().telegram_id; 
            
            // 1. áŠ®á‹­áŠ• áˆ˜áŒ¨áˆ˜áˆ­
            const rewardUpdatePromise = updateDoc(userRef, {
                total_score: increment(TOP10_REWARD_AMOUNT),
                last_top10_reward_time: serverTimestamp() 
            });

            // 2. áˆˆá‰°áŒ á‰ƒáˆšá‹ áˆ˜áˆá‹•áŠ­á‰µ áˆ˜áˆ‹áŠ­
            if (userId) {
                const notificationPromise = sendRewardNotification(
                    userId, 
                    TOP10_REWARD_AMOUNT, 
                    customMessage
                ).catch(e => console.error(`Failed to notify user ${userId}`, e));
                rewardPromises.push(notificationPromise);
            }
            
            rewardPromises.push(rewardUpdatePromise);
        });

        await Promise.all(rewardPromises);
        
        // áˆˆáŠ á‹µáˆšáŠ• áˆªá–áˆ­á‰µ áˆ˜áˆ‹áŠ­
        let message = `ğŸ‘‘ <b>Top 10 áˆ½áˆáˆ›á‰µ á‰°áŠ¨á‹ááˆáˆ!</b>\n\n`;
        let count = 0;
        snapshot.forEach((userDoc) => {
            count++;
            const data = userDoc.data();
            message += `#${count} ğŸ‘¤ ${data.username || 'No Name'} (+${TOP10_REWARD_AMOUNT})\n`;
        });
        
        await sendToTelegram(message);
        
        statusEl.innerText = `âœ… áˆˆ ${snapshot.size} á‰°áŒ á‰ƒáˆšá‹á‰½ áˆ½áˆáˆ›á‰µ áŠ¥áŠ“ áˆ˜áˆá‹•áŠ­á‰µ á‰°áˆáŠ³áˆ!`;
        statusEl.style.color = "#4CAF50";

    } catch (error) {
        console.error("Reward Error:", error);
        statusEl.innerText = "âŒ áˆµáˆ…á‰°á‰µ: " + error.message;
        statusEl.style.color = "#F44336";
        
        if (error.message.includes('index')) {
            statusEl.innerText += "\n(ğŸ’¡ Index á‰½áŒáˆ­: Index-á‹ á‰ á‰µáŠ­áŠ­áˆ á‹¨á‰°áˆ°áˆ« á‰¢áˆ†áŠ•áˆá£ áˆáŠ“áˆá‰£á‰µ Building Time áŠ áˆáŒ¨áˆ¨áˆ°áˆ á‹­áˆ†áŠ“áˆá¢ áˆˆá‰°á‹ˆáˆ°áŠ áŒŠá‹œ áŒ á‰¥á‰€áˆ… áˆáŠ­áˆ­á¢)";
        }
    }
};

    // ============================================================
// ğŸ’° ADSGRAM INTEGRATION LOGIC (FIXED & ROBUST)
// ============================================================

const ADSGRAM_BLOCK_ID = "18448"; 

// á‹¨á‰°áŒ á‰ƒáˆš ID áˆ›áŒáŠ˜á‰µ
const USER_ID = window.Telegram.WebApp.initDataUnsafe.user 
    ? window.Telegram.WebApp.initDataUnsafe.user.id 
    : null; 

// âœ… á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆá‹ á‹¨Adsgram áˆ›áˆ³á‹« áˆáŠ•áŠ­áˆ½áŠ•
window.showAdsgramAd = async () => {
    // 1. á‹¨ User ID áˆ˜áŠ–áˆ©áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
    if (!USER_ID) {
        WebApp.showAlert("âš ï¸ á‹¨á‰´áˆŒáŒáˆ«áˆ áˆ˜á‰³á‹ˆá‰‚á‹«á‹ (User ID) áŠ áˆá‰°áŒˆáŠ˜áˆá¢ áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢");
        return;
    }
    
    // 2. Adsgram áŠ«áˆá‰°áŒ«áŠ (Undefined áŠ¨áˆ†áŠ) á‰ á‹µáŒ‹áˆš áŠ¥áŠ•á‹²áŒ­áŠ• áˆ›áˆµáŒˆá‹°á‹µ
    if (typeof window.Adsgram === 'undefined') {
        // áˆˆá‰°áŒ á‰ƒáˆšá‹ áˆ˜áˆáŠ¥áŠ­á‰µ áŠ¥áŠ“áˆ³á‹«áˆˆáŠ•
        WebApp.showAlert("âš™ï¸ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ á‰ áˆ˜áŒ«áŠ• áˆ‹á‹­ áŠá‹... áŠ¥á‰£áŠ­á‹ 3 áˆ°áŠ¨áŠ•á‹µ áŒ á‰¥á‰€á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áŒ«áŠ‘á¢");
        
        // áˆµáŠ­áˆªá•á‰±áŠ• á‰ á‹³á‹­áŠ“áˆšáŠ­ áˆ˜áŠ•áŒˆá‹µ áˆ˜áŒ¨áˆ˜áˆ­ (Dynamic Script Injection)
        const script = document.createElement('script');
        script.src = "https://adsgram.ai/js/adsgram.js";
        script.async = true;
        
        script.onload = () => {
            console.log("Adsgram script loaded successfully!");
        };
        
        script.onerror = () => {
            WebApp.showAlert("âŒ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áˆ˜áŒ«áŠ• áŠ áˆá‰°á‰»áˆˆáˆ! áŠ¥á‰£áŠ­á‹ VPN áŠ«áˆˆ á‹«áŒ¥á‰ á‹ˆá‹­áˆ áŠ¢áŠ•á‰°áˆ­áŠ”á‰µá‹áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡á¢");
        };
        
        document.body.appendChild(script);
        return; // áˆˆá‹šáˆ… á‹™áˆ­ áŠ¥áŠ•á‹ˆáŒ£áˆˆáŠ•á£ á‰ áˆšá‰€áŒ¥áˆˆá‹ áŠ­áˆŠáŠ­ á‹­áˆ°áˆ«áˆá¢
    }

    // 3. Adsgram áŠ¨á‰°áŒ«áŠ á‰ áŠ‹áˆ‹ á‹¨áˆšáˆ áˆ«á‹ áˆ˜á‹°á‰ áŠ› áŠ®á‹µ
    try {
        const AdController = window.Adsgram.init({ 
            blockId: ADSGRAM_BLOCK_ID,
            userId: USER_ID 
        });

        // áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áŠ áˆ³á‹­
        AdController.show().then(async (result) => {
            // á‰°áŒ á‰ƒáˆšá‹ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áŠ á‹­á‰¶ áŠ¨áŒ¨áˆ¨áˆ° (Reward)
            if (result.done) {
                const rewardAmount = 1000; // á‰ áŠ«áˆ­á‹± áˆ‹á‹­ 1000 áˆµáˆˆáˆšáˆ
                
                // áŠ®á‹­áŠ‘áŠ• á‹ˆá‹° á‹³á‰³á‰¤á‹ áˆ˜áŒ¨áˆ˜áˆ­ 
                const success = await updateScore(rewardAmount, 'Ad Watched', 'last_ad_watch_time');
                
                if (success) {
                    WebApp.showAlert(`ğŸ‰ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áŠ á‹­á‰°á‹ áŒ¨áˆ­áˆ°á‹‹áˆ! +${rewardAmount} Coin áŠ áŒáŠá‰°á‹‹áˆ!`);
                    window.playSound('win'); 
                    
                    // UI áˆ›á‹˜áˆ˜áŠ•
                    renderPageContent();
                }
            }
        }).catch((result) => {
            // áˆµáˆ…á‰°á‰µ áŠ¨á‰°áˆáŒ áˆ¨ á‹ˆá‹­áˆ á‰°áŒ á‰ƒáˆšá‹ áŠ«á‰‹áˆ¨áŒ á‹ (Skip)
            console.log("Adsgram Error/Skip:", result);
            if (result.state === 'skip') {
                WebApp.showAlert("âš ï¸ á‰ªá‹²á‹®á‹áŠ• áŠ á‰‹áˆ­áŒ á‹‹áˆ! áˆ½áˆáˆ›á‰µ áŠ á‹­áˆ°áŒ¥áˆ::");
            } else if (result.state === 'load_fail') {
                WebApp.showAlert("âš ï¸ áˆ›áˆµá‰³á‹ˆá‰‚á‹« áˆ˜áŒ«áŠ• áŠ áˆá‰°á‰»áˆˆáˆ (No ads available)á¢ áŠ¥á‰£áŠ­á‹ á‰µáŠ•áˆ½ á‰†á‹­á‰°á‹ á‹­áˆáŠ­áˆ©á¢");
            } else {
                WebApp.showAlert("âš ï¸ Error: " + JSON.stringify(result));
            }
        });
    } catch (e) {
        console.error("Adsgram Init Error:", e);
        WebApp.showAlert("âš ï¸ áˆ²áˆµá‰°áˆ áˆµáˆ…á‰°á‰µ: " + e.message);
    }
};



   // =====================================================================
// ğŸ’£ MINES GAME LOGIC
// ======================================================================

const MINES_GRID_SIZE = 25; // 5x5
let minesBetAmount = 100;
let minesCount = 3;
let minesGameActive = false;
let minesLocations = []; // á‹¨á‰¦áˆá‰¦á‰¹ á‰¦á‰³ (0-24)
let revealedTilesCount = 0;
let currentMinesMultiplier = 1.0;

// á‹¨áŒ¨á‹‹á‰³á‹áŠ• áŒˆáŒ½ áˆ²áŠ¨áá‰µ á‹¨áˆšáŒ áˆ«
window.initMinesGame = () => {
    document.getElementById('mines-balance-display').innerText = currentScore.toLocaleString() + ' Coin';
    window.renderMinesGrid();
    minesGameActive = false;
    document.getElementById('mines-start-btn').style.display = 'block';
    document.getElementById('mines-cashout-btn').style.display = 'none';
    document.getElementById('mines-status-bar').style.display = 'none';
    
    // áˆ˜á‰†áŒ£áŒ áˆªá‹«á‹á‰¹áŠ• Enable áˆ›á‹µáˆ¨áŒ
    document.querySelectorAll('#mines-controls button').forEach(b => b.disabled = false);
}

// áŒáˆªá‹±áŠ• áˆ˜ááŒ áˆ­ (á‰£á‹¶)
window.renderMinesGrid = () => {
    const grid = document.getElementById('mines-grid-container');
    grid.innerHTML = '';
    for (let i = 0; i < MINES_GRID_SIZE; i++) {
        const tile = document.createElement('div');
        tile.className = 'mine-tile';
        tile.dataset.index = i;
        tile.onclick = () => window.handleTileClick(i, tile);
        grid.appendChild(tile);
    }
}

// á‹¨áŒˆáŠ•á‹˜á‰¥ áŠ¥áŠ“ á‹¨á‰¦áˆá‰¥ á‰¥á‹›á‰µ áˆ˜á‰†áŒ£áŒ áˆªá‹«
window.adjustMinesBet = (amount) => {
    if (minesGameActive) return;
    let newBet = minesBetAmount + amount;
    if (newBet < 100) newBet = 100;
    if (newBet > currentScore) newBet = currentScore;
    minesBetAmount = newBet;
    document.getElementById('mines-bet-input').value = minesBetAmount;
}

window.adjustMinesCount = (count) => {
    if (minesGameActive) return;
    let newCount = minesCount + count;
    if (newCount < 1) newCount = 1;
    if (newCount > 24) newCount = 24; // á‰¢á‹«áŠ•áˆµ áŠ áŠ•á‹µ á‰£á‹¶ á‰¦á‰³ áˆ˜áŠ–áˆ­ áŠ áˆˆá‰ á‰µ
    minesCount = newCount;
    document.getElementById('mines-count-input').value = minesCount;
}

// áŒ¨á‹‹á‰³ áˆ˜áŒ€áˆ˜áˆ­
window.startMinesGame = async () => {
    if (minesGameActive) return;
    
    // áˆ›áˆ¨áŒ‹áŒˆáŒ«
    if (minesBetAmount > currentScore) {
        WebApp.showAlert("á‰ á‰‚ Coin á‹¨áˆˆá‹á‰µáˆ!");
        return;
    }

    // áŠ¨áˆ‚áˆ³á‰¥ áˆ˜á‰€áŠáˆµ
    const success = await updateScore(-minesBetAmount, 'Mines Bet');
    if (!success) return;

    minesGameActive = true;
    revealedTilesCount = 0;
    currentMinesMultiplier = 1.0;
    
    // á‹¨á‰¦áˆá‰¥ á‰¦á‰³á‹á‰½áŠ• á‰ á‹˜áˆá‰€á‹° áˆ˜áˆáˆ¨áŒ¥
    minesLocations = [];
    while (minesLocations.length < minesCount) {
        let r = Math.floor(Math.random() * MINES_GRID_SIZE);
        if (!minesLocations.includes(r)) minesLocations.push(r);
    }

    // UI áˆ›á‹˜áˆ˜áŠ•
    window.renderMinesGrid(); // áŒáˆªá‹±áŠ• áŠ áŒ½á‹³
    document.getElementById('mines-start-btn').style.display = 'none';
    document.getElementById('mines-cashout-btn').style.display = 'block';
    document.getElementById('mines-status-bar').style.display = 'flex';
    document.getElementById('mines-current-win').innerText = minesBetAmount.toLocaleString();
    
    // áˆ˜á‰†áŒ£áŒ áˆªá‹«á‹á‰¹áŠ• Disable áˆ›á‹µáˆ¨áŒ
    document.querySelectorAll('#mines-controls button').forEach(b => b.disabled = true);
    
    window.updateMinesMultiplier();
}

// áˆ³áŒ¥áŠ• áˆ²áŠáŠ«
window.handleTileClick = (index, tileElement) => {
    if (!minesGameActive) return;
    if (tileElement.classList.contains('revealed')) return; // á‹¨á‰°áŠáŠ«áŠ• áˆ˜áˆáˆ¶ áŠ áˆˆáˆ˜áŠ•áŠ«á‰µ

    // 1. á‰¦áˆá‰¥ áŠ¨áˆ†áŠ (GAME OVER)
    if (minesLocations.includes(index)) {
        window.endMinesGame(false, index);
        return;
    }

    // 2. áŠ áˆáˆ›á‹ áŠ¨áˆ†áŠ (SUCCESS)
    tileElement.classList.add('revealed', 'diamond');
    tileElement.innerHTML = 'ğŸ’';
    window.playSound('click'); // á‹ˆá‹­áˆ á‹¨á‹³á‹­áˆ˜áŠ•á‹µ á‹µáˆáŒ½
    
    revealedTilesCount++;
    
    // áŠ áˆ¸áŠ“áŠáŠá‰µáŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥ (á‰¦áˆá‰¥ áŠ«áˆáˆ†áŠ‘á‰µ á‰ áˆµá‰°á‰€áˆ­ áˆáˆ‰áŠ•áˆ áŠ¨áŠáŠ«)
    const safeTiles = MINES_GRID_SIZE - minesCount;
    if (revealedTilesCount === safeTiles) {
        window.cashoutMines(); // áˆáˆ‰áŠ•áˆ áŠ«áŒˆáŠ˜ á‰ áˆ«áˆµ áˆ°áˆ­ Cashout
        return;
    }

    // Multiplier áˆ›á‹˜áˆ˜áŠ•
    window.updateMinesMultiplier();
}

// Multiplier áˆµáˆŒá‰µ (á‰€áˆ‹áˆ á‰€áˆ˜áˆ­)
window.updateMinesMultiplier = () => {
    // á‰€áˆ˜áˆ­: Multiplier á‰ á‹¨á‹°áˆ¨áŒƒá‹ á‹­áŒ¨áˆáˆ«áˆ
    // áˆáˆ³áˆŒ: 1.0 -> 1.13 -> 1.28 ... (áŠ¥áŠ•á‹° á‰¦áˆá‰¡ á‰¥á‹›á‰µ á‹­áˆˆá‹«á‹«áˆ)
    
    // áˆˆá‰€áˆ‹áˆáŠá‰µ á‹­áˆ…áŠ•áŠ• á‰€áˆ˜áˆ­ áŠ¥áŠ•áŒ á‰€áˆ (House Edge 1% á‹«áˆ…áˆ)
    const totalTiles = MINES_GRID_SIZE;
    const remainingTiles = totalTiles - revealedTilesCount;
    const remainingSafe = totalTiles - minesCount - revealedTilesCount;
    
    // áŠ áˆáŠ• á‹«áˆˆáŠ•á‰ á‰µáŠ• áˆ›áˆ³á‹°áŒ
    let nextProb = remainingSafe / remainingTiles;
    // á‰µáŠ•áˆ½ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (áˆˆáˆ›á‰ áˆ¨á‰³á‰³á‰µ)
    
    // á‰µáŠ­áŠ­áˆˆáŠ› á‹¨áŒ¨á‹‹á‰³ áˆµáˆŒá‰µ (Compounding)
    let rawMulti = 0.99 * (totalTiles / (totalTiles - minesCount)); // Base
    
    // áˆˆá‹šáˆ… á‹™áˆ­ á‹¨áˆšáˆ†áŠ• áˆµáˆŒá‰µ (á‹­áˆ… á‰€áˆ‹áˆ áˆµáˆªá‰µ áŠá‹)
    // áŠ¥á‹«áŠ•á‹³áŠ•á‹± áŠ¥áˆ­áˆáŒƒ Multiplierá‹áŠ• á‹«áˆ³á‹µáŒˆá‹‹áˆ
    let stepGrowth = 1 + (minesCount / (25 - minesCount));
    currentMinesMultiplier = currentMinesMultiplier * stepGrowth; 
    
    // UI Update
    // á‹¨áˆ˜áŒ€áˆ˜áˆªá‹«á‹ áŠ¥áˆ­áˆáŒƒ áˆ‹á‹­ á‰µáŠ•áˆ½ á‰…áŠ“áˆ½ á‹­áŠ‘áˆ¨á‹
    if (revealedTilesCount === 0) currentMinesMultiplier = 1.0;

    const currentWin = Math.floor(minesBetAmount * currentMinesMultiplier);
    
    document.getElementById('mines-next-multi').innerText = (currentMinesMultiplier * 1.1).toFixed(2) + 'x'; // á‹¨áˆšá‰€áŒ¥áˆˆá‹ áŒáˆá‰µ
    document.getElementById('mines-current-win').innerText = currentWin.toLocaleString();
    document.getElementById('mines-cashout-btn').innerText = `ğŸ’° TAKE ${currentWin.toLocaleString()}`;
}


// áŒ¨á‹‹á‰³ áˆ˜áŒ¨áˆ¨áˆµ (áˆ›áˆ¸áŠá á‹ˆá‹­áˆ áˆ˜áˆ¸áŠá)
window.endMinesGame = (win, explodedIndex = -1) => {
    minesGameActive = false;
    
    const grid = document.getElementById('mines-grid-container');
    const tiles = grid.children;

    // áˆáˆ‰áŠ•áˆ áˆ˜áŒáˆˆáŒ¥
    for (let i = 0; i < MINES_GRID_SIZE; i++) {
        if (minesLocations.includes(i)) {
            tiles[i].innerHTML = 'ğŸ’£';
            tiles[i].classList.add('revealed');
            if (i === explodedIndex) {
                tiles[i].classList.add('exploded');
            }
        } else {
            tiles[i].classList.add('revealed');
            if (!tiles[i].innerHTML) tiles[i].style.opacity = '0.5'; // á‹«áˆá‰°áŠáŠ© áŠ áˆáˆ›á‹á‰½
        }
    }

    if (win) {
        window.playSound('win');
    } else {
    window.playSound('fail'); // á‹µáˆáŒ¹áŠ• áŒ áˆ«
    
    // ğŸ›‘ áŠ á‹²áˆ± áˆ›áˆµá‰°áŠ«áŠ¨á‹«: á‰ 10 áˆšáˆŠáˆ°áŠ¨áŠ•á‹µ á‹«á‹˜áŒˆá‹¨á‹‹áˆ
    setTimeout(() => {
        WebApp.showAlert("ğŸ’£ á‰¦áˆá‰¥! á‰°áˆ¸áŠ•áˆá‹‹áˆá¢");
    }, 10); // 10 áˆšáˆŠáˆ°áŠ¨áŠ•á‹¶á‰½ á‰¥á‰»
}

    // áŠ á‹áˆ«áˆ®á‰½áŠ• áˆ˜áˆ˜áˆˆáˆµ
    document.getElementById('mines-start-btn').style.display = 'block';
    document.getElementById('mines-cashout-btn').style.display = 'none';
    
    // áˆ˜á‰†áŒ£áŒ áˆªá‹«á‹á‰½áŠ• áˆ˜áˆ˜áˆˆáˆµ
    document.querySelectorAll('#mines-controls button').forEach(b => b.disabled = false);
}

// Cashout áˆ›á‹µáˆ¨áŒ
window.cashoutMines = async () => {
    if (!minesGameActive) return;
    
    const winAmount = Math.floor(minesBetAmount * currentMinesMultiplier);
    
    // Firebase Update
    await updateScore(winAmount, 'Mines Win');
    
    window.endMinesGame(true);
    WebApp.showAlert(`ğŸ‰ áŠ áˆ¸áŠ•áˆá‹‹áˆ! +${winAmount.toLocaleString()} Coin`);
    window.triggerConfetti(winAmount);
}


 



// ==========================================
// ğŸ“º LAUNCH AD SYSTEM INTEGRATION
// ==========================================

let currentAdLink = ""; 
let autoCloseTimer = null; // á‹¨4 áˆ°áŠ¨áŠ•á‹±áŠ• á‰†áŒ£áˆª áˆˆáˆ˜á‹«á‹

async function initLaunchAd() {
    // á‰€á‹µáˆá‹áŠ‘ áŠ­áá‰µ áŠ¨áˆ†áŠ áˆ˜á‹µáŒˆáˆ áŠ á‹«áˆµáˆáˆáŒáˆ
    if(document.getElementById('launch-ad-overlay').style.display === 'flex') return;

    try {
        const docRef = doc(db, "app_settings", "launch_ad");
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            const adData = docSnap.data();

            if (adData.isActive) {
                // áˆáˆµáˆ‰áŠ• Preload áŠ¥áŠ“á‹°áˆ­áŒ‹áˆˆáŠ• (áˆáˆµáˆ‰ áˆ˜áˆáŒ£á‰±áŠ• áˆˆáˆ›áˆ¨áŒ‹áŒˆáŒ¥)
                const img = new Image();
                img.src = adData.imageUrl;
                img.onload = () => {
                    showLaunchAdUI(adData);
                };
                img.onerror = () => {
                    console.error("Ad Image failed to load:", adData.imageUrl);
                };
            }
        }
    } catch (error) {
        console.warn("Ad fetch skipped:", error);
    }
}

function showLaunchAdUI(data) {
    const overlay = document.getElementById('launch-ad-overlay');
    if (!overlay) return;

    // ID áˆµáˆá‰¹áŠ• áŠ áˆ»áˆ½áˆˆáŠ“áˆ (launch- á‰ áˆšáˆ áŒ€áˆáˆ¨áŠ“áˆ)
    const adImg = document.getElementById('launch-image');
    const adTitle = document.getElementById('launch-title');
    const adDesc = document.getElementById('launch-desc');
    const timerCircle = document.getElementById('launch-timer-circle');

    if (adImg) adImg.src = data.imageUrl;
    if (adTitle) adTitle.innerText = data.title || "Special Offer";
    if (adDesc) adDesc.innerText = data.description || "Check this out!";
    
    currentAdLink = data.targetUrl;

    // UI áˆ›áˆ³á‹¨á‰µ
    overlay.style.display = 'flex';
    
    // á‹¨áŠ­á‰¥ áŠ áŠ’áˆœáˆ½áŠ•
    if(timerCircle) {
        // Reset and start animation
        timerCircle.style.transition = 'none';
        timerCircle.style.strokeDashoffset = '0';
        
        setTimeout(() => {
            timerCircle.style.transition = 'stroke-dashoffset 4s linear';
            timerCircle.style.strokeDashoffset = '138'; 
        }, 50);
    }

    // áˆ«áˆµ-áˆ°áˆ­ áˆ˜á‹áŒŠá‹«
    if (autoCloseTimer) clearTimeout(autoCloseTimer);
    autoCloseTimer = setTimeout(() => {
        closeLaunchAd();
    }, 8000); 
}

// áˆ˜á‹áŒŠá‹« Function
window.closeLaunchAd = (event) => {
    if(event) event.stopPropagation();
    
    if (autoCloseTimer) {
        clearTimeout(autoCloseTimer);
        autoCloseTimer = null;
    }

    const overlay = document.getElementById('launch-ad-overlay');
    if(!overlay) return;

    overlay.style.transition = 'opacity 0.3s ease';
    overlay.style.opacity = '0';
    
    setTimeout(() => {
        overlay.style.display = 'none';
        overlay.style.opacity = '1'; // áˆˆáˆšá‰€áŒ¥áˆˆá‹ áŒŠá‹œ á‹áŒáŒ áˆ›á‹µáˆ¨áŒ
    }, 300);
};


// áŠ­áˆŠáŠ­ áˆ›áˆµá‰°áŠ“áŒˆáŒƒ
window.handleAdClick = () => {
    // á‰°áŒ á‰ƒáˆšá‹ áŠ¨áŠáŠ«á‹ áˆ«áˆ± áŠ¥áŠ•á‹²á‹˜áŒ‹ áŠ áŠ•áˆáˆáŒáˆ (áˆŠáŠ•áŠ© áŠ¥áˆµáŠªáŠ¨áˆá‰µ)
    if (autoCloseTimer) clearTimeout(autoCloseTimer);

    if (currentAdLink) {
        if (currentAdLink.includes('t.me')) {
            window.Telegram.WebApp.openTelegramLink(currentAdLink);
        } else {
            window.Telegram.WebApp.openLink(currentAdLink);
        }
        closeLaunchAd();
    }
};


// =========================================================
// âœ… MERGED P2P SYSTEM (MARKET + TRANSFER)
// =========================================================

// --- 1. Global Variables ---
// áˆˆ Market
let marketType = 'buy'; // 'buy' or 'sell'
let adType = 'sell';

// áˆˆ Transfer
const ADMIN_WALLET_ID = "MPrYYot9ldV9qbfxJA1uXC0wUzi2"; // ğŸ›‘ á‹¨áŠ á‹µáˆšáŠ• ID
if (typeof ADMIN_TELEGRAM_ID === 'undefined') {
    window.ADMIN_TELEGRAM_ID = 403001547;
}
const MIN_REQUIRED_BALANCE = 1000000;
const DAILY_TRANSFER_LIMIT = 100000;
const P2P_FEE_PERCENT = 0.05; 
let p2pSearchType = 'id'; 
let verifiedRecipientDoc = null; 

// --- 2. Switch Tab Logic (Unified) ---
window.switchP2PTab = (tab) => {
    // UI Active State
    document.querySelectorAll('.p2p-tab').forEach(t => t.classList.remove('active'));
    
    // HTML áˆ‹á‹­ á‰£áˆˆá‹ á‰…á‹°áˆ á‰°áŠ¨á‰°áˆ áˆ˜áˆ°áˆ¨á‰µ Index:
    // 0 = Market, 1 = Send, 2 = History, 3 = Rules
    let tabIndex = 0;
        if (tab === 'market') tabIndex = 0;
    else if (tab === 'my-orders') tabIndex = 1; // á‹­áˆ… áŠ á‹²áˆµ áŠá‹
    else if (tab === 'send') tabIndex = 2;
    else if (tab === 'history') tabIndex = 3;
    else if (tab === 'rules') tabIndex = 4;


    // á‰³á‰¡áŠ• Active áŠ á‹µáˆ­áŒ (If exists)
    const tabs = document.querySelectorAll('.p2p-tab');
    if(tabs[tabIndex]) tabs[tabIndex].classList.add('active');

    // Section Visibility
    document.querySelectorAll('.p2p-content-section').forEach(s => s.style.display = 'none');
    
    const targetSection = document.getElementById(`p2p-section-${tab}`);
    if (targetSection) targetSection.style.display = 'block';

    // Logic for each tab
    if (tab === 'market') {
        fetchMarketOffers();
        } else if (tab === 'my-orders') {
        fetchMyAds();
    } else if (tab === 'send') {
        document.getElementById('p2p-user-balance').innerText = currentScore.toLocaleString() + ' ğŸ’°';
    } else if (tab === 'history') {
        fetchP2PHistory();
    }
};

// =========================================================
// ğŸ›’ MARKET FUNCTIONS
// =========================================================

window.fetchMarketOffers = async () => {
    const listContainer = document.getElementById('p2p-market-list');
    if(!listContainer) return;
    
    listContainer.innerHTML = '<div class="spinner"></div>'; 

    try {
        const offersRef = collection(db, "p2p_market");
        // áŠ¥áŠ” áˆ˜áŒá‹›á‰µ áŠ¨áˆáˆˆáŒáŠ© (Buy Tab) -> á‹¨áˆšáˆ¸áŒ¡ áˆ°á‹á‰½áŠ• (Sell Ads) áˆ›á‹¨á‰µ áŠ áˆˆá‰¥áŠ
        const typeToShow = marketType === 'buy' ? 'sell' : 'buy';
        
        const q = query(offersRef, 
            where("type", "==", typeToShow),
            where("status", "==", "open"),
            orderBy("price", "asc"), 
            limit(20)
        );

        const snapshot = await getDocs(q);
        
        if (snapshot.empty) {
            listContainer.innerHTML = `
                <div style="text-align:center; padding:30px; color:#666;">
                    <p style="font-size:40px;">ğŸ“­</p>
                    <p>áˆáŠ•áˆ áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‹¨áˆˆáˆá¢<br>á‹¨áˆ˜áŒ€áˆ˜áˆªá‹«á‹áŠ• áˆˆáŒ¥á!</p>
                </div>`;
            return;
        }

        let html = '';
        snapshot.forEach(doc => {
            const data = doc.data();     
     
const avgRating = data.rating_count > 0 
    ? (data.total_rating_sum / data.rating_count).toFixed(1) 
    : "0.0";

            const badgeClass = data.payment_method === 'Telebirr' ? 'pm-telebirr' : 'pm-cbe';
            
            const isMyAd = data.creator_id === currentFirebaseUserId;
            const btnText = isMyAd ? "Cancel" : (marketType === 'buy' ? "Buy" : "Sell");
            const btnColor = isMyAd ? "#888" : (marketType === 'buy' ? "#4CAF50" : "#F44336");

            html += `
            <div class="offer-card ${data.type}-type">
                <div class="offer-header">
                    <div class="trader-name">
    ğŸ‘¤ ${data.creator_name} 
    <span style="color: #FFD700; font-size: 11px; margin-left: 5px;">
        â­ ${avgRating} (${data.rating_count || 0})
    </span>
    ${data.is_verified ? '<span class="verified-badge">âœ”</span>' : ''}
</div>

                    <div class="price-tag">
                        ${data.price} <span class="price-currency">ETB/Coin</span>
                    </div>
                </div>
                
                <div class="offer-limits">
                    Limit: ${data.min_limit} - ${data.amount} Coins
                </div>

                <div class="offer-actions">
                    <div class="payment-methods">
                        <span class="pm-badge ${badgeClass}">${data.payment_method}</span>
                    </div>
                    <button class="trade-btn" 
                        style="background: ${btnColor}"
                        onclick="initiateTrade('${doc.id}', '${data.creator_id}', ${isMyAd})">
                        ${btnText}
                    </button>
                </div>
            </div>`;
        });

        listContainer.innerHTML = html;

    } catch (e) {
        console.error("Market Error:", e);
        listContainer.innerHTML = `<p style="color:red; text-align:center">Error loading market. Index required?</p>`;
    }
};

window.openCreateAdModal = () => {
    document.getElementById('create-ad-modal').style.display = 'flex';
};

window.setAdType = (type) => {
    adType = type;
    document.getElementById('btn-type-sell').classList.toggle('active', type === 'sell');
    document.getElementById('btn-type-buy').classList.toggle('active', type === 'buy');
};
window.toggleAccountInput = () => {
    const paymentType = document.getElementById('ad-payment').value;
    const label = document.getElementById('account-label');
    const input = document.getElementById('ad-account-number');

    if (paymentType === "Telebirr") {
        label.innerText = "á‹¨ Telebirr áˆµáˆáŠ­ á‰áŒ¥áˆ­";
        input.placeholder = "09xxxxxxxx";
    } else {
        label.innerText = "á‹¨ " + paymentType + " áˆ‚áˆ³á‰¥ á‰áŒ¥áˆ­ (Account)";
        input.placeholder = "á‹¨á‰£áŠ•áŠ­ á‰áŒ¥áˆ©áŠ• áŠ¥á‹šáˆ… á‹«áˆµáŒˆá‰¡...";
    }
};

window.postMarketAd = async () => {
    const amount = Number(document.getElementById('ad-amount').value);
    const price = Number(document.getElementById('ad-price').value);
    const payment = document.getElementById('ad-payment').value;
    const accountNumber = document.getElementById('ad-account-number').value;

    if(!amount || !price || !accountNumber) {
        return WebApp.showAlert("áŠ¥á‰£áŠ­á‹ áˆáˆ‰áŠ•áˆ áˆ˜áˆ¨áŒƒá‹á‰½ á‰ á‰µáŠ­áŠ­áˆ á‹­áˆ™áˆ‰");
    }
    
    // áŠ¨ 500 á‰ á‰³á‰½ áˆ˜áˆˆáŒ á áŠ á‹­á‰»áˆáˆ
    if(amount < 500) return WebApp.showAlert("á‹á‰…á‰°áŠ›á‹ áˆ˜áŒ áŠ• 500 Coin áŠá‹");

    WebApp.MainButton.showProgress();

    try {
        await runTransaction(db, async (transaction) => {
            const userRef = doc(db, "users", currentFirebaseUserId);
            const userSnap = await transaction.get(userRef);
            const currentBalance = userSnap.data().total_score || 0;

            // 1. áˆ˜áˆ¸áŒ¥ áŠ¨áˆ†áŠ á‰¥á‰» áŠá‹ áˆ³áŠ•á‰²áˆ á‹¨áˆáŠ•á‰€áŠ•áˆ°á‹
            if (adType === 'sell') {
                if (currentBalance < amount) {
                    throw "á‰ á‰‚ áˆ³áŠ•á‰²áˆ á‹¨áˆˆá‹á‰µáˆ!";
                }
                // áˆ³áŠ•á‰²áˆ™áŠ• áŠ¨á‰°áŒ á‰ƒáˆšá‹ áˆ‹á‹­ áˆ˜á‰€áŠáˆµ (Lock áˆ›á‹µáˆ¨áŒ)
                transaction.update(userRef, { total_score: increment(-amount) });
            }

            // 2. áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áˆ˜ááŒ áˆ­
            const adRef = doc(collection(db, "p2p_market"));
            transaction.set(adRef, {
                creator_id: currentFirebaseUserId,
                creator_name: currentUserDocData.username || "User",
                type: adType, 
                amount: amount,
                min_limit: 500, 
                price: price,
                payment_method: payment,
                payment_account: accountNumber,
                status: 'open',
                created_at: serverTimestamp(),
                // áˆ³áŠ•á‰²áˆ™ áˆ˜á‰€áŠáˆ±áŠ• áˆˆáˆ›á‹ˆá‰… á‹­áˆ¨á‹³áŠ“áˆ
                is_locked: adType === 'sell' ? true : false 
            });
        });

        document.getElementById('create-ad-modal').style.display = 'none';
        WebApp.showAlert("âœ… áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áˆˆáŒ¥ááˆ!");
        fetchMarketOffers();

    } catch (e) {
        WebApp.showAlert("áˆµáˆ…á‰°á‰µ: " + e);
        console.error(e);
    } finally {
        WebApp.MainButton.hideProgress();
    }
};



let currentTradeDocListener = null;
let activeTradeId = null;

// áŒˆá‹¢á‹ "Buy" áˆ²áˆ á‹¨áˆšáŒ áˆ«á‹ Function
window.initiateTrade = async (adId, sellerId, isMyAd) => {
    if (isMyAd) return WebApp.showAlert("á‹¨áˆ«áˆµá‹ áˆ›áˆµá‰³á‹ˆá‰‚á‹« áŠá‹á¢");

    WebApp.MainButton.showProgress();
    
    try {
        await runTransaction(db, async (transaction) => {
            // 1. Get Ad Info
            const adRef = doc(db, "p2p_market", adId);
            const adSnap = await transaction.get(adRef);
            if (!adSnap.exists()) throw "Ad does not exist";
            
            const adData = adSnap.data();
            if (adData.status !== 'open') throw "á‹­áˆ… áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‰°áˆ½áŒ§áˆ á‹ˆá‹­áˆ á‰°á‹˜áŒá‰·áˆ!";
            
            const totalCost = adData.amount * adData.price;

            // 2. Lock the Ad so no one else buys it
            transaction.update(adRef, { status: 'locked' });

            // 3. Create Trade Document
            const tradeRef = doc(collection(db, "p2p_trades"));
            const tradeData = {
                ad_id: adId,
                seller_id: sellerId,
                seller_name: adData.creator_name,
                buyer_id: currentFirebaseUserId,
                buyer_name: currentUserDocData.first_name || "Buyer",
                amount: adData.amount,
                price: adData.price,
                total_fiat: totalCost,
                payment_method: adData.payment_method,
                seller_bank_info: adData.payment_account || "áŠ áˆá‰°áŒˆáŠ˜áˆ",                
                status: 'pending', // pending -> paid -> completed
                created_at: serverTimestamp(),
                expires_at: new Date(Date.now() + 15 * 60000) // 15 Minutes Timer
            };
            
            transaction.set(tradeRef, tradeData);
            activeTradeId = tradeRef.id;
        });

        WebApp.MainButton.hideProgress();
        // á‰€áŒ¥á‰³ á‹ˆá‹° Trade Room áˆ˜áŒá‰£á‰µ
        openTradeRoom(activeTradeId);

    } catch (e) {
        WebApp.MainButton.hideProgress();
        WebApp.showAlert("Error: " + e);
        console.error(e);
    }
};
// === CHAT FUNCTIONS ===
window.handleChatEnter = (e) => {
    if(e.key === 'Enter') window.sendChatMessage();
}

window.sendChatMessage = async () => {
    const input = document.getElementById('chat-input-field');
    const text = input.value.trim();
    
    // activeTradeId áŠ¥áŠ“ á‰°áŒ á‰ƒáˆšá‹ áˆ˜áŠ–áˆ«á‰¸á‹áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
    if(!text || !window.activeTradeId || !currentFirebaseUserId) return; 

    input.value = '';
    
    try {
        await addDoc(collection(db, "p2p_trades", window.activeTradeId, "messages"), {
            sender_id: currentFirebaseUserId,
            // áˆ›áˆ³áˆ°á‰¢á‹«á¡ currentUserName á‹¨áˆšáˆˆá‹ variable áˆµáˆ™áŠ• á‹¨á‹«á‹˜ áˆ˜áˆ†áŠ‘áŠ• áŠ áˆ¨áŒ‹áŒáŒ¥
            sender_name: typeof currentUserName !== 'undefined' ? currentUserName : "User", 
            text: text,
            timestamp: serverTimestamp()
        });
        console.log("áˆ˜áˆá‹•áŠ­á‰± á‰°áˆáŠ³áˆ!");
    } catch(e) {
        console.error("Chat Error", e);
        alert("áˆ˜áˆá‹•áŠ­á‰± áŠ áˆá‰°áˆ‹áŠ¨áˆ!");
    }
};

// === AUTO EXPIRE FUNCTION ===
async function autoExpireTrade(tradeId, adId) {
    try {
        await runTransaction(db, async (transaction) => {
            const tradeRef = doc(db, "p2p_trades", tradeId);
            const tradeSnap = await transaction.get(tradeRef);
            if(!tradeSnap.exists()) return;
            const tData = tradeSnap.data();

            if (tData.status !== 'pending') return;

            transaction.update(tradeRef, { 
                status: 'cancelled',
                cancel_reason: 'auto_expired'
            });

            const adRef = doc(db, "p2p_market", adId);
            transaction.update(adRef, { status: 'open' });
        });
    } catch (e) {
        console.error("Auto Expire Error:", e);
    }
}


let currentChatListener = null;

window.openTradeRoom = (tradeId) => {
window.activeTradeId = tradeId;
    document.getElementById('p2p-page').querySelectorAll('.p2p-content-section').forEach(d => d.style.display='none');
    document.getElementById('p2p-trade-room').style.display = 'block';
    
    // Trade Data Listener
    if (currentTradeDocListener) currentTradeDocListener(); 
    currentTradeDocListener = onSnapshot(doc(db, "p2p_trades", tradeId), (docSnap) => {
        if (!docSnap.exists()) return closeTradeRoom();
        const data = docSnap.data();
        updateTradeUI(data, docSnap.id);
    });

    // === áŠ á‹²áˆµá¡ CHAT LISTENER ===
    const chatList = document.getElementById('chat-messages-list');
    chatList.innerHTML = ''; // Clear old messages

    if (currentChatListener) currentChatListener(); // Close old chat listener
    
    const messagesRef = collection(db, "p2p_trades", tradeId, "messages");
    const q = query(messagesRef, orderBy("timestamp", "asc"));

    currentChatListener = onSnapshot(q, (snapshot) => {
        chatList.innerHTML = ''; 
        if(snapshot.empty) {
            chatList.innerHTML = `<p style="text-align: center; color: #555; font-size: 12px; margin-top: 20px;">áŠ•áŒáŒáˆ©áŠ• á‹­áŒ€áˆáˆ©...</p>`;
        }
        
        snapshot.forEach(doc => {
            const msg = doc.data();
            const isMine = msg.sender_id === currentFirebaseUserId;
            const time = msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '...';
            
            const bubble = `
                <div class="chat-bubble ${isMine ? 'mine' : 'theirs'}">
                    <div>${msg.text}</div>
                    <span class="chat-time">${time}</span>
                </div>
            `;
            chatList.insertAdjacentHTML('beforeend', bubble);
        });
        // Scroll to bottom
        chatList.scrollTop = chatList.scrollHeight;
    });
};



function updateTradeUI(data, tradeId) {
    const isBuyer = data.buyer_id === currentFirebaseUserId;
    // á‰  updateTradeUI á‹áˆµáŒ¥


    // Update Texts
    document.getElementById('trade-amount-display').innerText = `${data.amount} Coins`;
    document.getElementById('trade-price-display').innerText = data.price;
    document.getElementById('trade-total-fiat').innerText = data.total_fiat.toLocaleString();
    document.getElementById('trade-status-badge').innerText = data.status.toUpperCase();
    document.getElementById('trade-status-badge').className = `status-badge ${data.status}`;
    
    // Bank Info
    document.getElementById('trade-bank-name').innerText = data.payment_method;
    document.getElementById('trade-seller-name').innerText = data.seller_name;
    document.getElementById('trade-account-num').innerText = isBuyer ? (data.seller_bank_info || "Ask inside") : "á‹¨áˆ«áˆµá‹ áˆ˜áˆ¨áŒƒ";
    document.getElementById('trade-ref-code').innerText = tradeId.slice(0,6).toUpperCase();

const now = new Date();
const expires = (data.expires_at && typeof data.expires_at.toDate === 'function') 
            ? data.expires_at.toDate() 
            : (data.expires_at ? new Date(data.expires_at) : now);

const diff = Math.floor((expires - now) / 1000);
const timerEl = document.getElementById('trade-timer');

if (data.status === 'pending') {
    if (diff > 0) {
        const m = Math.floor(diff / 60);
        const s = diff % 60;
        timerEl.innerText = `${m}:${s < 10 ? '0'+s : s}`;
        timerEl.style.color = "white";
    } else {
        timerEl.innerText = "EXPIRED";
        timerEl.style.color = "red";
        autoExpireTrade(tradeId, data.ad_id);
    }
} else {
    timerEl.innerText = "";
}

    // Button Visibility Logic
    const buyerControls = document.getElementById('buyer-controls');
    const sellerControls = document.getElementById('seller-controls');
    const releaseBtn = document.getElementById('btn-release-coins');
    const disputeBtn = document.getElementById('btn-dispute');

    if (isBuyer) {
        buyerControls.style.display = 'block';
        sellerControls.style.display = 'none';
        if (data.status !== 'pending') buyerControls.style.display = 'none'; // Hide if paid
        if (data.status === 'paid') {
             // Show "Waiting for release" message
             buyerControls.innerHTML = `<p style="color:var(--et-yellow); text-align:center;">áŠ­áá‹«á‹ á‰°áˆ¨áŒ‹áŒáŒ§áˆá¢ áˆ»áŒ© áŠ®á‹­áŠ‘áŠ• áŠ¥áˆµáŠªáˆˆá‰… á‹­áŒ á‰¥á‰...</p>`;
             buyerControls.style.display = 'block';
        }
    } else {
        // Seller
        buyerControls.style.display = 'none';
        sellerControls.style.display = 'block';
        
        if (data.status === 'paid') {
            releaseBtn.disabled = false;
            releaseBtn.innerText = "ğŸ”“ Release Coins (Received)";
            disputeBtn.style.display = 'block';
        } else {
            releaseBtn.disabled = true;
            releaseBtn.innerText = "Waiting for Payment...";
            disputeBtn.style.display = 'none';
        }
    }
    
    if (data.status === 'completed') {
        WebApp.showAlert("Trade Completed! âœ…");
        closeTradeRoom();
    }
}

window.closeTradeRoom = () => {
    if (currentTradeDocListener) currentTradeDocListener();
    if (currentChatListener) currentChatListener(); // <--- áŠ á‹²áˆ± áˆ˜áˆµáˆ˜áˆ­ á‹­áˆ… áŠá‹
    
    document.getElementById('p2p-trade-room').style.display = 'none';
    window.switchP2PTab('market');
};

// 1. áŒˆá‹¢á‹ áŠ¨áá‹«áˆˆáˆ áˆ²áˆ
window.markTradePaid = async () => {
    if(!confirm("áŠ¥áˆ­áŒáŒ áŠ› áŠá‹á‰µ á‰¥áˆ©áŠ• áˆáŠ¨á‹‹áˆ? áˆ€áˆ°á‰°áŠ› áˆ˜áˆ¨áŒƒ áŠ¨áˆ†áŠ á‹­á‰€áŒ£áˆ‰!")) return;
    
    await updateDoc(doc(db, "p2p_trades", activeTradeId), {
        status: 'paid',
        paid_at: serverTimestamp()
    });
    const tSnap = await getDoc(doc(db, "p2p_trades", activeTradeId));
    const tData = tSnap.data();
    const sSnap = await getDoc(doc(db, "users", tData.seller_id));
    const sellerTgId = sSnap.data()?.telegram_id;

    if (sellerTgId) {
        fetch("https://newsmartgame.netlify.app/.netlify/functions/send_alert", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                custom_chat_id: String(sellerTgId),
                message: `ğŸ”” <b>áŠ­áá‹« á‰°áˆáŒ½áˆŸáˆ!</b>\nğŸ“¦ ID: #${activeTradeId.slice(0,6)}\nğŸ’° áˆ˜áŒ áŠ•: ${tData.amount} Coins\náŠ¥á‰£áŠ­á‹ á‰£áŠ•áŠ­á‹áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡á¢`
            })
        }).catch(e => console.log("Notif error"));
    }



};
window.releaseTradeCoins = async () => {
    if(!confirm("á‰¥áˆ© áˆ˜áŒá‰£á‰±áŠ• áŠ áˆ¨áŒ‹áŒáŒ á‹‹áˆ? áŠ®á‹­áŠ‘áŠ• áˆˆáŒˆá‹¢á‹ á‹­áˆˆá‰€á‰ƒáˆ!")) return;
    
    WebApp.MainButton.showProgress();
    
    try {
        await runTransaction(db, async (transaction) => {
            const tradeRef = doc(db, "p2p_trades", activeTradeId);
            const tradeSnap = await transaction.get(tradeRef);
            const tData = tradeSnap.data();
            
            // 1. á‹¨áŒˆá‹¢á‹áŠ• áˆ‚áˆ³á‰¥ áˆ˜áŒ¨áˆ˜áˆ­
            const buyerRef = doc(db, "users", tData.buyer_id);
            transaction.update(buyerRef, { total_score: increment(tData.amount) });
            
            // 2. áŒá‰¥á‹­á‰±áŠ• áˆ˜áŒ¨áˆ¨áˆµ
            transaction.update(tradeRef, { status: 'completed' });

            // 3. áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áˆ˜á‹áŒ‹á‰µ
            const adRef = doc(db, "p2p_market", tData.ad_id);
            transaction.update(adRef, { status: 'sold' });
            
            // á‹¨á‰³áˆˆáˆ˜áˆˆá‰µáŠ• áˆ°á‹ ID áˆˆ Rating áˆ›á‹˜áŒ‹áŒ€á‰µ
            ratingTargetUserId = tData.seller_id;
        });
        
        WebApp.MainButton.hideProgress();
        WebApp.showAlert("áŠ®á‹­áŠ• á‹ˆá‹­áˆ áˆ³áŠ•á‰²áˆ™ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áˆˆá‰‹áˆ! âœ…");
        
        // á‹°áˆ¨áˆ°áŠ áˆ›áˆ³á‹¨á‰µ
        showReceipt("P2P-"+activeTradeId, "Seller", "Buyer", tData.amount, 0);
        
        // Rating Modal áˆ›áˆ³á‹¨á‰µ (áŠ¨á‰°áˆáˆˆáŒˆ)
        document.getElementById('rating-modal').style.display = 'flex';
        
    } catch (e) {
        WebApp.MainButton.hideProgress();
        WebApp.showAlert("áˆ˜áˆá‰€á‰… áŠ áˆá‰°á‰»áˆˆáˆ: " + e);
    }
};

// 3. áŠ­áˆ­áŠ­áˆ­ (Dispute)
window.disputeTrade = async () => {
    const reason = prompt("á‹¨áŠ­áˆ­áŠ­áˆ©áŠ• áˆáŠ­áŠ•á‹«á‰µ á‹­áƒá‰:");
    if(!reason) return;
    
    await updateDoc(doc(db, "p2p_trades", activeTradeId), {
        status: 'dispute',
        dispute_reason: reason,
        dispute_at: serverTimestamp()
    });
    WebApp.showAlert("áŠ á‹µáˆšáŠ• á‰ á‰…áˆ­á‰¡ á‹«áŠáŒ‹áŒáˆ­á‹á‰³áˆá¢");
};

// 4. Cancel
window.cancelActiveTrade = async () => {
    if(!confirm("áŒá‰¥á‹­á‰±áŠ• áˆ˜áˆ°áˆ¨á‹ á‹­áˆáˆáŒ‹áˆ‰?")) return;
    
    const tradeRef = doc(db, "p2p_trades", activeTradeId);
    // Get ad ID to unlock it
    const snap = await getDoc(tradeRef);
    const adId = snap.data().ad_id;
    
    await updateDoc(tradeRef, { status: 'cancelled' });
    await updateDoc(doc(db, "p2p_market", adId), { status: 'open' }); // Unlock Ad
    
    closeTradeRoom();
};

// á‰ áŠá‰£áˆ© window.fetchMyAds áˆá‰µáŠ­ á‹­áˆ…áŠ•áŠ• á‰°áŒ á‰€áˆ

window.fetchMyAds = async () => {
    const listContainer = document.getElementById('p2p-my-ads-list');
    if(!listContainer) return;
    
    listContainer.innerHTML = '<div class="spinner"></div><p style="text-align:center">Loading orders...</p>';

    try {
        let html = '';

        // 1. ACTIVE TRADES (áŠ¥á‹¨á‰°áŠ«áˆ„á‹± á‹«áˆ‰ áŒá‰¥á‹­á‰¶á‰½)
        // áŠ¥áŠ” áŒˆá‹¢ á‹ˆá‹­áˆ áˆ»áŒ­ á‹¨áˆ†áŠ•áŠ©á‰ á‰µáŠ• áŠ¥áŠ“ á‹«áˆá‰°áŒ áŠ“á‰€á‰á‰µáŠ• (completed á‹«áˆáˆ†áŠ‘á‰µáŠ•) áŠ¥áˆáˆáŒ‹áˆˆáˆ
        
        // áˆ€. áŠ¥áŠ” áŒˆá‹¢ á‹¨áˆ†áŠ•áŠ©á‰£á‰¸á‹
        const qBuyer = query(
            collection(db, "p2p_trades"), 
            where("buyer_id", "==", currentFirebaseUserId),
            where("status", "in", ["pending", "paid", "dispute"])
        );
        
        // áˆˆ. áŠ¥áŠ” áˆ»áŒ­ á‹¨áˆ†áŠ•áŠ©á‰£á‰¸á‹
        const qSeller = query(
            collection(db, "p2p_trades"), 
            where("seller_id", "==", currentFirebaseUserId),
            where("status", "in", ["pending", "paid", "dispute"])
        );

        const [snapBuyer, snapSeller] = await Promise.all([getDocs(qBuyer), getDocs(qSeller)]);
        
        // Active Trades HTML áˆ›á‹˜áŒ‹áŒ€á‰µ
        if (!snapBuyer.empty || !snapSeller.empty) {
            html += `<h4 style="color:var(--et-yellow); margin:10px 0;">â³ á‰ áˆ‚á‹°á‰µ áˆ‹á‹­ á‹«áˆ‰ (Active Orders)</h4>`;
            
            const processTrade = (doc, role) => {
                const data = doc.data();
                const isActionNeeded = (role === 'Seller' && data.status === 'paid') || (role === 'Buyer' && data.status === 'pending');
                const badgeColor = isActionNeeded ? "red" : "#555";
                
                return `
                <div class="modern-card" onclick="openTradeRoom('${doc.id}')" style="cursor:pointer; border-left: 4px solid #00A3FF; margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:bold; color:white;">${role === 'Buyer' ? 'Buying' : 'Selling'} - ${data.amount} Coins</div>
                            <div style="font-size:12px; color:#aaa;">Status: <span style="color:white; background:${badgeColor}; padding:2px 6px; border-radius:4px;">${data.status.toUpperCase()}</span></div>
                        </div>
                        <div style="font-size:20px;">â¡ï¸</div>
                    </div>
                </div>`;
            };

            snapBuyer.forEach(doc => html += processTrade(doc, 'Buyer'));
            snapSeller.forEach(doc => html += processTrade(doc, 'Seller'));
        }

        // 2. MY ADS (áŠ¥áŠ” á‹¨áˆˆáŒ ááŠ©á‰µ áˆ›áˆµá‰³á‹ˆá‰‚á‹« áŒáŠ• áˆ›áŠ•áˆ á‹«áˆáŒˆá‹›á‹)
        const qAds = query(
            collection(db, "p2p_market"),
            where("creator_id", "==", currentFirebaseUserId),
            where("status", "==", "open"), // open á‹¨áˆ†áŠ‘á‰µáŠ• á‰¥á‰»
            orderBy("created_at", "desc")
        );

        const snapAds = await getDocs(qAds);
        
        if (!snapAds.empty) {
            html += `<h4 style="color:var(--et-green); margin:20px 0 10px 0;">ğŸ“¢ á‹¨áˆˆáŒ ááŠ³á‰¸á‹ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹á‰½</h4>`;
            snapAds.forEach(doc => {
                const data = doc.data();
                html += `
                <div class="modern-card" style="margin-bottom:10px; border-left: 4px solid var(--et-green);">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:bold; color:white;">${data.type.toUpperCase()} - ${data.amount} Coins</div>
                            <div style="font-size:12px; color:#aaa;">${data.price} ETB | Open</div>
                        </div>
                        <button onclick="deleteMyAd('${doc.id}')" style="background:none; border:none; color:var(--et-red); font-size:18px; padding:10px;">ğŸ—‘ï¸</button>
                    </div>
                </div>`;
            });
        }

        if (html === '') {
            html = '<div style="text-align:center; padding:30px; color:#666;">áˆáŠ•áˆ á‹¨á‰°áŒ€áˆ˜áˆ¨ áŒá‰¥á‹­á‰µ á‹¨áˆˆáˆá¢</div>';
        }

        listContainer.innerHTML = html;

    } catch (e) {
        console.error("Orders Error:", e);
        listContainer.innerHTML = `<p style="color:red; text-align:center">Error: ${e.message}</p>`;
    }
};


window.deleteMyAd = async (adId) => {
    if(!confirm("á‹­áˆ…áŠ•áŠ• áˆ›áˆµá‰³á‹ˆá‰‚á‹« áˆ˜áˆ°áˆ¨á‹ á‹­áˆáˆáŒ‹áˆ‰? á‹¨á‰°á‹«á‹˜ áŠ®á‹­áŠ• á‹ˆá‹­áˆ áˆ³áŠ•á‰²áˆ áŠ«áˆˆ á‹­áˆ˜áˆˆáˆ³áˆá¢")) return;

    try {
        await runTransaction(db, async (transaction) => {
            const adRef = doc(db, "p2p_market", adId);
            const adSnap = await transaction.get(adRef);
            
            if (!adSnap.exists()) throw "áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹ áŠ áˆá‰°áŒˆáŠ˜áˆ";
            const adData = adSnap.data();

            // áˆ³áŠ•á‰²áˆ™ á‰°á‰€áŠ•áˆ¶ áŠ¨áŠá‰ áˆ¨ (áˆ˜áˆ¸áŒ¥ áŠ¨áˆ†áŠ) á‹­áˆ˜áˆˆáˆµ
            if (adData.type === 'sell' && adData.is_locked === true) {
                const userRef = doc(db, "users", adData.creator_id);
                transaction.update(userRef, { total_score: increment(adData.amount) });
            }

            // áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹áŠ• áˆ˜áˆ°áˆ¨á‹
            transaction.delete(adRef);
        });

        WebApp.showAlert("á‰°áˆ°áˆ­á‹Ÿáˆ! áŠ®á‹­áŠ–á‹ á‰°áˆ˜áˆáˆ·áˆá¢");
        fetchMyAds();
    } catch (e) {
        WebApp.showAlert("áˆ˜áˆ°áˆ¨á‹ áŠ áˆá‰°á‰»áˆˆáˆ: " + e);
    }
};



window.filterMarket = (type) => {
    marketType = type;
    document.querySelectorAll('.market-filter-btn').forEach(b => b.classList.remove('active'));
    // áŠ á‹áˆ«áˆ©áŠ• Active áˆˆáˆ›á‹µáˆ¨áŒ (áˆáŒ‚áŠ­ á‹«áˆµáˆáˆáŒ‹áˆ)
    fetchMarketOffers();
};


// =========================================================
// ğŸ’¸ TRANSFER FUNCTIONS (Old Logic)
// =========================================================

window.setP2PSearchType = (type) => {
    p2pSearchType = type;
    document.getElementById('btn-search-id').classList.toggle('active', type === 'id');
    document.getElementById('btn-search-user').classList.toggle('active', type === 'username');
    
    const input = document.getElementById('p2p-recipient-input');
    input.placeholder = type === 'id' ? "á‹¨á‰°á‰€á‰£á‹©áŠ• User ID á‹«áˆµáŒˆá‰¡" : "á‹¨á‰°á‰€á‰£á‹©áŠ• Telegram @Username á‹«áˆµáŒˆá‰¡";
    input.value = '';
    window.resetP2PVerification();
};

window.resetP2PVerification = () => {
    verifiedRecipientDoc = null;
    document.getElementById('p2p-recipient-preview').style.display = 'none';
    const sendBtn = document.getElementById('p2p-send-btn');
    if(sendBtn) {
        sendBtn.disabled = true;
        sendBtn.classList.add('disabled-btn');
    }
};

window.verifyP2PUser = async () => {
    const inputVal = document.getElementById('p2p-recipient-input').value.trim();
    const btn = document.querySelector('.verify-btn');
    
    if (!inputVal) return WebApp.showAlert("áŠ¥á‰£áŠ­á‹ áˆ˜áˆ¨áŒƒ á‹«áˆµáŒˆá‰¡");
    if (inputVal === currentFirebaseUserId || inputVal === telegramUserId) return WebApp.showAlert("áˆˆáˆ«áˆµá‹ áˆ˜áˆ‹áŠ­ áŠ á‹­á‰½áˆ‰áˆ!");

    btn.innerText = "Checking...";
    btn.disabled = true;

    try {
        let foundDoc = null;

        if (p2pSearchType === 'id') {
            const directRef = doc(db, "users", inputVal);
            const directSnap = await getDoc(directRef);
            
            if (directSnap.exists()) {
                foundDoc = { id: directSnap.id, ...directSnap.data() };
            } else {
                const q = query(collection(db, "users"), where("telegram_id", "in", [Number(inputVal), String(inputVal)]));
                const qSnap = await getDocs(q);
                if (!qSnap.empty) {
                    foundDoc = { id: qSnap.docs[0].id, ...qSnap.docs[0].data() };
                }
            }
        } else {
            const cleanUser = inputVal.replace('@', '');
            const q = query(collection(db, "users"), where("username", "==", cleanUser));
            const qSnap = await getDocs(q);
            if (!qSnap.empty) {
                foundDoc = { id: qSnap.docs[0].id, ...qSnap.docs[0].data() };
            }
        }

        if (foundDoc) {
            if (foundDoc.id === currentFirebaseUserId) {
                 WebApp.showAlert("á‹­áˆ… á‹¨áŠ¥áˆ­áˆµá‹ áŠ áŠ«á‹áŠ•á‰µ áŠá‹á¢ áˆˆáˆ«áˆµá‹ áˆ˜áˆ‹áŠ­ áŠ á‹­á‰½áˆ‰áˆá¢");
            } else {
                verifiedRecipientDoc = foundDoc;
                document.getElementById('p2p-preview-name').innerText = foundDoc.first_name || foundDoc.username || "Unknown";
                document.getElementById('p2p-preview-avatar').innerHTML = getAvatarHtml(foundDoc.username, foundDoc.photo_url);
                document.getElementById('p2p-recipient-preview').style.display = 'flex';
                const sendBtn = document.getElementById('p2p-send-btn');
                sendBtn.disabled = false;
                sendBtn.classList.remove('disabled-btn');
            }
        } else {
            WebApp.showAlert("âŒ á‰°áŒ á‰ƒáˆšá‹ áŠ áˆá‰°áŒˆáŠ˜áˆá¢ áŠ¥á‰£áŠ­á‹ ID á‹ˆá‹­áˆ Username á‰ á‰µáŠ­áŠ­áˆ á‹«áˆµáŒˆá‰¡á¢");
            window.resetP2PVerification();
        }

    } catch (e) {
        console.error(e);
        WebApp.showAlert("Error verifying user.");
    } finally {
        btn.innerText = "á‰°á‰€á‰£á‹©áŠ• áŠ áˆ¨áŒ‹áŒáŒ¥ (Verify) ğŸ”";
        btn.disabled = false;
    }
};

// Fee Calculator
const p2pInput = document.getElementById('p2p-amount-input');
if(p2pInput){
    p2pInput.addEventListener('input', function(e) {
        const val = parseInt(e.target.value) || 0;
        let feeDisplay = document.querySelector('.fee-preview-text');
        
        if (!feeDisplay) {
            feeDisplay = document.createElement('div');
            feeDisplay.className = 'fee-preview-text';
            feeDisplay.style.fontSize = '12px';
            feeDisplay.style.marginTop = '5px';
            feeDisplay.style.color = '#FFA500';
            e.target.parentNode.appendChild(feeDisplay);
        }

        if (val >= 500) {
            const fee = Math.ceil(val * 0.05);
            feeDisplay.innerText = `ğŸ’¡ Fee (5%): ${fee} Coin | Total: ${val + fee}`;
        } else {
            feeDisplay.innerText = '';
        }
    });
}

window.initiateP2PTransfer = () => {
    const amount = parseInt(document.getElementById('p2p-amount-input').value);
    
    if (currentScore < MIN_REQUIRED_BALANCE) {
        return WebApp.showAlert(`á‹­á‰…áˆ­á‰³! á‹¨P2P á‹á‹á‹áˆ­ áˆˆáˆ˜áŒ á‰€áˆ á‰¢á‹«áŠ•áˆµ ${MIN_REQUIRED_BALANCE.toLocaleString()} Coin áˆŠáŠ–áˆ­á‹á‰µ á‹­áŒˆá‰£áˆá¢`);
    }

    if (!amount || amount < 500) {
        return WebApp.showAlert("á‹á‰…á‰°áŠ›á‹ á‹¨áˆ˜áˆ‹áŠªá‹« áˆ˜áŒ áŠ• 500 Coin áŠá‹á¢");
    }

    if (amount > DAILY_TRANSFER_LIMIT) {
        return WebApp.showAlert(`á‰ áŠ áŠ•á‹µ áŒŠá‹œ áŠ¨ ${DAILY_TRANSFER_LIMIT.toLocaleString()} Coin á‰ áˆ‹á‹­ áˆ˜áˆ‹áŠ­ áŠ á‹­á‰»áˆáˆá¢`);
    }

    if (!verifiedRecipientDoc) {
        return WebApp.showAlert("áŠ¥á‰£áŠ­á‹ áˆ˜áŒ€áˆ˜áˆªá‹« á‰°á‰€á‰£á‹©áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡á¢");
    }

    const fee = Math.ceil(amount * P2P_FEE_PERCENT);
    const totalDeduct = amount + fee;

    if (currentScore < totalDeduct) {
        return WebApp.showAlert(`á‰ á‰‚ á‰€áˆª áˆ‚áˆ³á‰¥ á‹¨áˆˆá‹á‰µáˆá¢ \ná‹«áˆµáˆáˆáŒ‹áˆ: ${totalDeduct} \ná‹«áˆˆá‹á‰µ: ${currentScore}`);
    }

    document.getElementById('confirm-name').innerText = verifiedRecipientDoc.first_name;
    document.getElementById('confirm-amount').innerText = amount.toLocaleString() + " Coin";
    document.getElementById('confirm-fee').innerText = fee + " Coin";
    document.getElementById('confirm-total').innerText = totalDeduct.toLocaleString() + " Coin";
    
    document.getElementById('p2p-confirm-modal').style.display = 'flex';
};

window.executeP2PTransaction = async () => {
    const modal = document.getElementById('p2p-confirm-modal');
    modal.style.display = 'none';
    
    const amount = parseInt(document.getElementById('p2p-amount-input').value);
    const fee = Math.ceil(amount * P2P_FEE_PERCENT);
    const totalDeduct = amount + fee;
    const recipientId = verifiedRecipientDoc.id;
    const senderId = currentFirebaseUserId;
    
    const recipientNameForReceipt = verifiedRecipientDoc.first_name || "Unknown";
    const senderNameForReceipt = currentUserDocData.first_name || "User";

    WebApp.MainButton.showProgress();
    document.getElementById('p2p-loading-overlay').style.display = 'flex';

    try {
       const transferRef = doc(collection(db, "transfers")); 
       
        await runTransaction(db, async (transaction) => {
            const senderRef = doc(db, "users", senderId);
            const senderDoc = await transaction.get(senderRef);
            if (!senderDoc.exists()) throw "Sender doc not found";
            
            const senderData = senderDoc.data();
            const currentSenderBalance = senderData.total_score || 0;

            if (currentSenderBalance < MIN_REQUIRED_BALANCE) throw "Low balance for feature"; 
            if (currentSenderBalance < totalDeduct) throw "Insufficient funds"; 

            const now = new Date();
            const lastDate = senderData.last_transfer_date ? senderData.last_transfer_date.toDate() : null;
            let currentDailyTotal = senderData.daily_sent_amount || 0;

            if (!lastDate || lastDate.getDate() !== now.getDate() || lastDate.getMonth() !== now.getMonth()) {
                currentDailyTotal = 0;
            }

            if ((currentDailyTotal + amount) > DAILY_TRANSFER_LIMIT) {
                throw `Daily limit exceeded. You sent ${currentDailyTotal} today. Limit is ${DAILY_TRANSFER_LIMIT}`;
            }

            const recipientRef = doc(db, "users", recipientId);
            const recipientDoc = await transaction.get(recipientRef);
            if (!recipientDoc.exists()) throw "Recipient doc not found";

            const adminRef = doc(db, "users", ADMIN_WALLET_ID);
            const adminDoc = await transaction.get(adminRef);

            transaction.update(senderRef, {
                total_score: increment(-totalDeduct),
                daily_sent_amount: currentDailyTotal + amount,
                last_transfer_date: serverTimestamp()
            });

            transaction.update(recipientRef, {
                total_score: increment(amount)
            });

            if (ADMIN_WALLET_ID && ADMIN_WALLET_ID.length > 5) {
                if (adminDoc.exists()) {
                    transaction.update(adminRef, { total_score: increment(fee) });
                } else {
                    transaction.set(adminRef, { total_score: fee, username: "AdminWallet", is_admin: true });
                }
            }

            let sentViaValue = recipientId; 
            if (p2pSearchType === 'username' && verifiedRecipientDoc.username) {
                sentViaValue = "@" + verifiedRecipientDoc.username;
            } else if (verifiedRecipientDoc.telegram_id) {
                sentViaValue = "ID: " + verifiedRecipientDoc.telegram_id;
            }
            
            transaction.set(transferRef, {
                sender_id: senderId,
                sender_name: senderNameForReceipt,
                sender_username: currentUserDocData.username ? "@" + currentUserDocData.username : "ID: " + (currentUserDocData.telegram_id || senderId),
                recipient_id: recipientId,
                recipient_name: recipientNameForReceipt,
                recipient_identifier: sentViaValue,
                amount: amount,
                fee: fee,
                timestamp: serverTimestamp(),
                type: 'p2p_transfer'
            });
        });

        WebApp.MainButton.hideProgress();
        document.getElementById('p2p-loading-overlay').style.display = 'none';
        
        if(window.playSound) window.playSound('win');
        
        const recipientTgId = verifiedRecipientDoc.telegram_id;
        if (recipientTgId) sendP2PNotification(recipientTgId, amount, senderNameForReceipt);
        if (typeof ADMIN_TELEGRAM_ID !== 'undefined') sendAdminP2PReport(ADMIN_TELEGRAM_ID, senderNameForReceipt, recipientNameForReceipt, amount, fee);

        document.getElementById('p2p-amount-input').value = '';
        const feePreview = document.querySelector('.fee-preview-text');
        if(feePreview) feePreview.innerText = '';
        
        currentScore -= totalDeduct;
        renderPageContent();

        showReceipt(transferRef.id, senderNameForReceipt, recipientNameForReceipt, amount, fee);
        window.switchP2PTab('history'); 
        window.resetP2PVerification();
        
    } catch (e) {
        WebApp.MainButton.hideProgress();
        document.getElementById('p2p-loading-overlay').style.display = 'none';
        console.error("Transfer Error:", e);
        
        let msg = "Transaction Failed.";
        
        if (e === "Low balance for feature") {
            msg = `á‹­á‰…áˆ­á‰³! á‹­áˆ…áŠ•áŠ• áŠ áŒˆáˆáŒáˆá‰µ áˆˆáˆ˜áŒ á‰€áˆ á‰¢á‹«áŠ•áˆµ ${MIN_REQUIRED_BALANCE.toLocaleString()} Coin áˆŠáŠ–áˆ­á‹á‰µ á‹­áŒˆá‰£áˆá¢`;
        } else if (typeof e === 'string' && e.includes("Daily limit exceeded")) {
             msg = `á‹¨á‰€áŠ• áŒˆá‹°á‰¥ áŠ áˆááˆ! á‰ á‰€áŠ• áŠ¥áˆµáŠ¨ ${DAILY_TRANSFER_LIMIT.toLocaleString()} á‰¥á‰» áˆ˜áˆ‹áŠ­ á‹­á‰»áˆ‹áˆá¢`;
        } else if (e === "Insufficient funds") {
            msg = "á‰ á‰‚ á‰€áˆª áˆ‚áˆ³á‰¥ á‹¨áˆˆá‹á‰µáˆá¢";
        } else if (e === "Recipient doc not found") {
            msg = "á‹¨á‰°á‰€á‰£á‹© áŠ á‹µáˆ«áˆ» áˆ‹á‹­ á‰½áŒáˆ­ áŠ áˆˆá¢";
        }
        
        WebApp.showAlert("âŒ " + msg);
    }
};

// --- Notifications & History ---

function sendP2PNotification(targetTgId, amount, senderName) {
    const botUrl = "https://newsmartgame.netlify.app/.netlify/functions/send_alert";
    fetch(botUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            custom_chat_id: String(targetTgId),
            message: `ğŸ’¸ <b>á‹¨áŒˆáŠ•á‹˜á‰¥ á‹á‹á‹áˆ­ (Incoming Transfer)</b>\n\n` +
                     `ğŸ‘¤ <b>áŠ¨:</b> ${senderName}\n` +
                     `ğŸ’° <b>áˆ˜áŒ áŠ•:</b> +${amount.toLocaleString()} Coins\n` +
                     `ğŸ“… <b>á‰€áŠ•:</b> ${new Date().toLocaleDateString()}\n\n` +
                     `áŠ áˆáŠ• á‹ˆá‹° áŒ¨á‹‹á‰³á‹ áŒˆá‰¥á‰°á‹ á‰€áˆª áˆ‚áˆ³á‰¥á‹áŠ• á‹«áˆ¨áŒ‹áŒáŒ¡! ğŸš€`
        })
    }).catch(e => console.log("Notification trigger failed", e));
}

function sendAdminP2PReport(adminTgId, senderName, recipientName, amount, fee) {
    const botUrl = "https://newsmartgame.netlify.app/.netlify/functions/send_alert";
    fetch(botUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            custom_chat_id: String(adminTgId),
            message: `ğŸ‘®â€â™‚ï¸ <b>P2P Transaction Report</b>\n\n` +
                     `ğŸ“¤ <b>áˆ‹áŠª:</b> ${senderName}\n` +
                     `ğŸ“¥ <b>á‰°á‰€á‰£á‹­:</b> ${recipientName}\n` +
                     `ğŸ’° <b>á‹¨á‰°áˆ‹áŠ¨á‹:</b> ${amount.toLocaleString()} Coins\n` +
                     `ğŸ’µ <b>áŠ®áˆšáˆ½áŠ• (Income):</b> +${fee.toLocaleString()} Coins\n` +
                     `ğŸ“… <b>á‰€áŠ•:</b> ${new Date().toLocaleString()}\n\n` +
                     `System Log.`
        })
    }).catch(e => console.log("Admin notification failed", e));
}

async function fetchP2PHistory() {
    const list = document.getElementById('p2p-history-list');
    list.innerHTML = '<div class="game-spinner" style="margin: 20px auto;"></div>';

    try {
        const transfersRef = collection(db, "transfers");
        
        const q = query(transfersRef, 
            where("sender_id", "==", currentFirebaseUserId),
            orderBy("timestamp", "desc"), 
            limit(20)
        );
        const snapshot = await getDocs(q);
        
        const q2 = query(transfersRef, 
             where("recipient_id", "==", currentFirebaseUserId),
             orderBy("timestamp", "desc"),
             limit(20)
        );
        const snapshot2 = await getDocs(q2);

        let allTransfers = [];
        snapshot.forEach(doc => allTransfers.push({id: doc.id, ...doc.data(), dir: 'out'}));
        snapshot2.forEach(doc => allTransfers.push({id: doc.id, ...doc.data(), dir: 'in'}));
        
        allTransfers.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

        if (allTransfers.length === 0) {
            list.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">áˆáŠ•áˆ á‹¨á‹á‹á‹áˆ­ á‰³áˆªáŠ­ á‹¨áˆˆáˆá¢</p>';
            return;
        }

        let html = '';
        allTransfers.forEach(t => {
            const isIn = t.dir === 'in';
            const color = isIn ? '#4CAF50' : '#F44336';
            const sign = isIn ? '+' : '-';
            const icon = isIn ? 'ğŸ“¥' : 'ğŸ“¤';
            const name = isIn ? `From: ${t.sender_name}` : `To: ${t.recipient_name}`;
            const date = t.timestamp ? new Date(t.timestamp.toDate()).toLocaleDateString() : 'Just now';
            let subDetail = isIn ? (t.sender_username || "ID: Hidden") : (t.recipient_identifier || "ID: " + t.recipient_id);

            html += `
            <div class="modern-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 12px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="font-size: 20px;">${icon}</div>
                    <div>
                        <div style="font-weight: bold; color: white; font-size: 14px;">${name}</div>
                      <div style="font-size: 11px; color: #aaa; margin-top: 2px;">${subDetail}</div> 
                      <div style="font-size: 10px; color: #777;">${date}</div>

                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: bold; color: ${color};">${sign}${t.amount}</div>
                    ${!isIn ? `<div style="font-size: 10px; color: #555;">Fee: ${t.fee}</div>` : ''}
                </div>
            </div>`;
        });

        list.innerHTML = html;

    } catch (e) {
        console.error(e);
        list.innerHTML = `<p style="color: var(--et-red); text-align: center;">Error loading history.</p>`;
    }
}
let selectedRating = 0;
let ratingTargetUserId = null; // á‹¨áˆ»áŒ© ID

window.setRating = (stars) => {
    selectedRating = stars;
    const starElements = document.querySelectorAll('.star-rating span');
    starElements.forEach((s, index) => {
        s.style.opacity = index < stars ? "1" : "0.3";
    });
    document.getElementById('rating-value-text').innerText = stars + " áŠ®áŠ¨á‰¥";
};

window.submitUserRating = async () => {
    if (selectedRating === 0) return WebApp.showAlert("áŠ¥á‰£áŠ­á‹ áˆ˜áŒ€áˆ˜áˆªá‹« áŠ®áŠ¨á‰¥ á‹­áˆáˆ¨áŒ¡!");

    try {
        const userRef = doc(db, "users", ratingTargetUserId);
        
        await runTransaction(db, async (transaction) => {
            const userSnap = await transaction.get(userRef);
            if (!userSnap.exists()) return;

            const userData = userSnap.data();
            const currentTotalRating = userData.total_rating_sum || 0;
            const currentRatingCount = userData.rating_count || 0;

            transaction.update(userRef, {
                total_rating_sum: currentTotalRating + selectedRating,
                rating_count: currentRatingCount + 1
            });
        });

        document.getElementById('rating-modal').style.display = 'none';
        WebApp.showAlert("áˆˆáˆ°áŒ¡á‰µ áŠ áˆµá‰°á‹«á‹¨á‰µ áŠ¥áŠ“áˆ˜áˆ°áŒáŠ“áˆˆáŠ•! â­");
    } catch (e) {
        console.error("Rating Error:", e);
        WebApp.showAlert("á‹°áˆ¨áŒƒá‹áŠ• áˆˆáˆ˜áˆ˜á‹áŒˆá‰¥ áŠ áˆá‰°á‰»áˆˆáˆá¢");
    }
};


        // ======================================================================
        //                         MAIN RENDER FUNCTION
        // ======================================================================

        function renderPageContent() {
            // 1. coin áˆ›áˆ³á‹«á‹á‰½áŠ• á‰  Tasks áŠ¥áŠ“ Profile áŒˆáŒ¾á‰½ áˆ‹á‹­ áˆ›á‹˜áˆ˜áŠ•
            document.getElementById('tasks-score-display').innerText = currentScore.toLocaleString() + ' ğŸ’°'; // ğŸ›‘ score
            
            // 2. Profile Page
            const profileScoreDisplay = document.getElementById('profile-score-display');
            if (profileScoreDisplay) {
                profileScoreDisplay.innerText = currentScore.toLocaleString(); // ğŸ›‘ score
            }
            const profileSmartCoinDisplay = document.getElementById('profile-smart-coin-display');
    if (profileSmartCoinDisplay) {
        profileSmartCoinDisplay.innerText = currentSmartCoinBalance.toLocaleString(); 
    }
            const profileTicketDisplay = document.getElementById('profile-ticket-display'); 
            if (profileTicketDisplay) {
                profileTicketDisplay.innerText = currentTickets.toLocaleString();
            }
            
            const profileBalanceValue = document.querySelector('.profile-stat-box .balance-value');
             if (profileBalanceValue) {
                // áˆˆáŒŠá‹œá‹ coináŠ• áŠ¥áŠ•á‹° áˆá‰µáŠ­ áŒˆáŠ•á‹˜á‰¥ áˆ›áˆ³á‹¨á‰µ (á‹ˆá‹­áˆ áŠ¥áŠ•á‹°áˆáˆˆáŒ‰á‰µ)
                const birrEquivalent = (currentScore / 1000).toFixed(2); // ğŸ›‘ score
                profileBalanceValue.innerText = `${birrEquivalent} á‰¥áˆ­`; 
            }

            // 3. Top Page (Leaderboard) áˆ‹á‹­ áˆ›á‹˜áˆ˜áŠ•
            document.getElementById('top-score-display').innerText = currentScore.toLocaleString() + ' ğŸ’°'; // ğŸ›‘ score
            document.getElementById('top-rank-display').innerText = currentRank; 

            // 4. á‹¨á‰°áŒ á‰ƒáˆš áˆµáˆ áŠ¥áŠ“ áŠ áˆáˆ³áˆ áˆ›áˆ³á‹«
            let username = 'á‰°áŒ«á‹‹á‰½';
            if (currentUserDocData?.username) {
                username = currentUserDocData.username;
            } else {
                 username = getTelegramUsername(); 
            }
            
            const usernameDisplay = document.getElementById('profile-username');
            if (usernameDisplay) {
                usernameDisplay.innerText = username;
            }
            
            const profileAvatar = document.getElementById('profile-avatar');
            if (profileAvatar) {
                profileAvatar.innerHTML = getAvatarHtml(username, currentUserDocData?.photo_url); 
            }
            
            // 5. á‹¨á‰´áˆŒáŒáˆ«áˆ Main ButtonáŠ• áˆ˜á‰†áŒ£áŒ áˆ­
            const isTasksPage = document.getElementById('tasks-page')?.style.display === 'block';

            if (isTasksPage) {
                const { isReady } = checkDailyLimit('last_gift_time');
                if (isReady) {
                    WebApp.MainButton.setText(`ğŸ á‹•áˆˆá‰³á‹Š áˆµáŒ¦á‰³ (+200 coin)`); 
                    WebApp.MainButton.show();
                    WebApp.MainButton.setParams({ color: '#4CAF50', text_color: '#FFFFFF' });
                } else {
                    WebApp.MainButton.hide();
                }
            } else {
                 WebApp.MainButton.hide();
            }
            
            // ğŸ›‘ áŠ á‹²áˆµ: á‹¨áŠ«áˆ­á‹µ á‰£áŒ… áˆ›á‹˜áˆ˜áŠ•áŠ• áˆ›áˆµáŠ¬á‹µ
            if (isTasksPage && timerIntervals['card_status_update']) {
                updateTaskCardStatus('mystery-box-card', 'mystery-box-badge', 'last_mystery_time');
                updateTaskCardStatus('daily-spin-card', 'daily-spin-badge', 'last_spin_time');
                updateTaskCardStatus('reflex-game-card', 'reflex-game-badge', 'last_reflex_time');
                // ğŸ›‘ NEW: áˆˆ Slot Game Card
                updateTaskCardStatus('slots-game-card', 'slots-game-badge', SLOTS_COOLDOWN_FIELD);
            }
            
            // ğŸ›‘ NEW: Slot Game UI á‰ áŒˆáŒ¹ áˆ‹á‹­ áŠ«áˆˆ áˆ›á‹˜áˆ˜áŠ•
            if (document.getElementById('slots-game-page')?.style.display === 'block') {
                 window.updateSlotGameUI();
            }
          checkAdminStatus();

        }
        window.renderPageContent = renderPageContent;
        
        
        
        
        
        function showReceipt(refNo, senderName, receiverName, amount, fee) {
    const total = amount + fee;
    const dateStr = new Date().toLocaleString();
    
    // áˆá‹© áˆ˜áˆˆá‹« á‰áŒ¥áˆ©áŠ• áŠ¥áŠ•á‹²á‹«áˆ³á‹­ (áˆ¨áŒ…áˆ áŠ¨áˆ†áŠ á‹¨áˆ˜áŒ€áˆ˜áˆªá‹« 10 áŠá‹°áˆ‹á‰µ á‰¥á‰»)
    const shortRef = refNo ? refNo.slice(0, 10).toUpperCase() : "TXN-" + Math.floor(Math.random() * 1000000);

    document.getElementById('rec-ref').innerText = shortRef; // áŠ á‹²áˆ± áˆ˜áˆµáˆ˜áˆ­
    document.getElementById('rec-date').innerText = dateStr;
    document.getElementById('rec-sender').innerText = senderName;
    document.getElementById('rec-receiver').innerText = receiverName;
    document.getElementById('rec-amount').innerText = amount.toLocaleString();
    document.getElementById('rec-fee').innerText = fee.toLocaleString();
    document.getElementById('rec-total').innerText = total.toLocaleString() + " Coins";

    document.getElementById('receipt-modal').style.display = 'flex';
}

// ======================================================================
//                              INITIALIZATION (á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆˆ)
// ======================================================================
window.onload = async () => {
    WebApp.ready(); 
    WebApp.setHeaderColor('secondary_bg_color');
    WebApp.expand(); // áŠ á‘ áˆ™áˆ‰ áˆµáŠ­áˆªáŠ• áŠ¥áŠ•á‹²áˆ†áŠ• (Optional)
    
    // á‰‹áŠ•á‰‹ áˆ›áˆµá‰°áŠ«áŠ¨áˆ
    updateAppLanguage(currentLanguage);
    
    // á‹¨ Main Button áŠ­áˆŠáŠ­ áˆ›áˆµá‰°áŠ“áŒˆáŒƒ
    WebApp.MainButton.onClick(async () => {
        const coinsToAdd = 200; 
        const { isReady } = checkDailyLimit('last_gift_time');
        if (!isReady) {
            WebApp.showAlert(`âŒ á‹•áˆˆá‰³á‹Š áˆµáŒ¦á‰³ áˆˆ 24 áˆ°á‹“á‰µ á‰¥á‰» á‹­áˆ°áŒ£áˆá¢`);
            return;
        }
        await updateScore(coinsToAdd, 'Daily Gift', 'last_gift_time');
    });
    
    // ğŸ›‘ 1. á‹¨á‰´áˆŒáŒáˆ«áˆ ID áˆ›áŒáŠ˜á‰µ (Critical Step)
    try {
        if (WebApp.initDataUnsafe && WebApp.initDataUnsafe.user) {
            telegramUserId = WebApp.initDataUnsafe.user.id.toString();
            // áˆˆ Copy button áŠ¥áŠ“ áˆˆáˆŒáˆá‰½ áŒáˆá‰£áˆ á‰°áˆˆá‹‹á‹‹áŒ­
            window.telegramUserId = telegramUserId; 
        } else {
             // áˆˆáˆ™áŠ¨áˆ« (Testing) á‰ á‰¥áˆ«á‹á‹˜áˆ­ á‹¨áˆá‰µáˆ°áˆ« áŠ¨áˆ†áŠ á‹­áˆ…áŠ•áŠ• áŠ­áˆá‰µá¡
             // telegramUserId = "TEST_USER_123"; 
             // window.telegramUserId = telegramUserId;
             
             // áˆˆProduction áŒáŠ• á‹­áˆ… á‹«áˆµáˆáˆáŒ‹áˆá¡
             throw new Error("Missing Telegram User Data.");
        }
    } catch (e) {
        console.error("CRITICAL: Failed to get Telegram User ID.", e);
        WebApp.showAlert("áˆµáˆ…á‰°á‰µ: á‹¨á‰´áˆŒáŒáˆ«áˆ áˆ˜áˆ¨áŒƒáŠ• áˆ›áŒáŠ˜á‰µ áŠ áˆá‰°á‰»áˆˆáˆá¢");
        return; // ID áŠ¨áˆŒáˆˆ áˆ˜á‰€áŒ áˆ á‹¨áˆˆá‰ á‰µáˆ
    }
    await firebaseLogin(); 
    switchPage('tasks-page'); 
    initLaunchAd(); 
};
 </script>
</body>
</html>
